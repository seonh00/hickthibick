
<body>
  <div class="container">
<link rel="stylesheet" href="style.css">


<h1 id="security-monitoring-siem-fundamentals">Security Monitoring &amp; SIEM Fundamentals</h1>
<h2 id="siem-definition-fundamentals">SIEM Definition &amp; Fundamentals</h2>
<hr>
<h3 id="what-is-siem-">What Is SIEM?</h3>
<p>Crucial within the realm of computer protection, Security Information and Event Management (SIEM) encompasses the utilization of software offerings and solutions that merge the management of security data with the supervision of security events. These instruments facilitate real-time evaluations of alerts related to security, which are produced by network hardware and applications.</p>
<p>SIEM tools possess an extensive range of core functionalities, such as the collection and administration of log events, the capacity to examine log events and supplementary data from various sources, as well as operational features like incident handling, visual summaries, and documentation.</p>
<p>Employing SIEM innovations, IT personnel can detect cyberattacks at the time of or even prior to their occurrence, thereby enhancing the speed of their response during incident resolution. Consequently, SIEM plays an indispensable role in the effectiveness and ongoing supervision of a company&#39;s information security framework. It serves as the bedrock of an organization&#39;s security tactics, offering a holistic method for identifying and managing potential threats.</p>
<hr>
<h3 id="the-evolution-of-siem-technology">The Evolution Of SIEM Technology</h3>
<p>The acronym &quot;SIEM&quot; emerged from the collaboration of two Gartner analysts who suggested a novel security information framework that integrated two preceding technologies: Security Information Management (SIM) and Security Event Management (SEM). This proposition appeared in a 2005 Gartner paper titled &quot;Enhance IT Security through Vulnerability Management.&quot;</p>
<p>First-generation SIM technology was developed upon conventional log collection management systems, allowing for extended storage, examination, and reporting of log data while incorporating logs with threat intelligence. Conversely, the second-generation SEM technology tackled security events by delivering consolidation, correlation, and notification of events from a range of security apparatuses, such as antivirus software, firewalls, Intrusion Detection Systems (IDS), in addition to events disclosed directly by authentication, SNMP traps, servers, and databases.</p>
<p>In the years that followed, vendors amalgamated the capabilities of SIM and SEM to devise the SIEM, leading to a fresh definition as per Gartner&#39;s investigation. This nascent technology gained widespread acceptance as it offered a comprehensive methodology for detecting and managing threats, including the ability to amass, preserve, and scrutinize logs and security events from various origins.</p>
<hr>
<h3 id="how-does-a-siem-solution-work-">How Does A SIEM Solution Work?</h3>
<p>SIEM systems function by gathering data from a variety of sources, including PCs, network devices, servers, and more. This data is then standardized and consolidated to facilitate ease of analysis.</p>
<p>SIEM platforms employ security experts who scrutinize the data in order to identify and detect potential threats. This procedure allows businesses to locate security breaches and examine alerts, offering crucial insights into the organization&#39;s security standing.</p>
<p>Alerts notify Security Operations/Monitoring personnel that they must look into a (possible) security event or incident. These notifications are usually concise and inform staff of a specific attack targeting the organization&#39;s information systems. Alerts can be conveyed through multiple channels, such as emails, console pop-up messages, text messages, or phone calls to smartphones.</p>
<p>SIEM systems generate a vast number of alerts owing to the substantial volume of events produced for each monitored platform. It is not unusual for an hourly log of events to range from hundreds to thousands. As a result, fine-tuning the SIEM for detecting and alerting on high-risk events is crucial.</p>
<p>The capacity to accurately pinpoint high-risk events is what distinguishes SIEM from other network monitoring and detection tools, such as Intrusion Prevention Systems (IPS) or Intrusion Detection Systems (IDS). SIEM does not supplant the logging capabilities of these devices; rather, it operates in conjunction with them by processing and amalgamating their log data to recognize events that could potentially lead to system exploitation. By integrating data from numerous sources, SIEM solutions deliver a holistic strategy for threat detection and management.</p>
<hr>
<h3 id="siem-business-requirements-use-cases">SIEM Business Requirements &amp; Use Cases</h3>
<p><strong>Log Aggregation &amp; Normalization</strong></p>
<p>The importance of threat visibility through log consolidation offered by SIEM systems cannot be overstated. In its absence, an organization&#39;s cybersecurity holds as much value as a mere paperweight. Log consolidation entails gathering terabytes of security information from vital firewalls, confidential databases, and essential applications. This process empowers the SOC team to examine the data and discern connections, significantly improving threat visibility.</p>
<p>Utilizing SIEM log consolidation, the SOC team can identify and scrutinize security incidents and events throughout the organization&#39;s IT infrastructure. By centralizing and correlating information from various sources, SIEM delivers a holistic strategy for threat detection and handling. This approach allows organizations to recognize patterns, tendencies, and irregularities that could suggest potential security hazards. Consequently, SOC teams can react promptly and efficiently to security incidents, reducing the repercussions on the organization.</p>
<p><strong>Threat Alerting</strong></p>
<p>Having a SIEM solution that can identify and notify IT security teams about possible threats within the vast volume of collected security event data is essential. This feature is critical as it allows the IT security team to carry out swifter, more targeted investigations and respond to potential security incidents in a timely and efficient manner.</p>
<p>Advanced analytics and threat intelligence are employed by SIEM solutions to recognize potential threats and generate real-time alerts. When a threat is detected, the system forwards alerts to the IT security team, equipping them with the necessary details to effectively investigate and mitigate the risk. By alerting IT security teams promptly, SIEM solutions aid in minimizing the potential impact of security incidents and safeguarding the organization&#39;s vital assets.</p>
<p><strong>Contextualization &amp; Response</strong></p>
<p>It is important to understand that merely generating alerts is not enough. If a SIEM solution sends alerts for every possible security event, the IT security team will soon be overwhelmed by the sheer volume of alerts, and false positives may become a frequent issue, particularly in older solutions. As a result, threat contextualization is crucial for sorting through alerts, determining the actors involved in the security event, the affected parts of the network, and the timing.</p>
<p>Contextualization enables IT security teams to identify genuine potential threats and act swiftly. Automated configuration processes can filter some contextualized threats, reducing the number of alerts received by the team.</p>
<p>An ideal SIEM solution should allow an enterprise to directly manage threats, often by stopping operations while investigations take place. This approach helps to minimize the potential impact of security incidents and protect the organization&#39;s critical assets. SIEM solutions provide context and automate threat filtering, allowing IT security teams to concentrate on genuine threats, reducing alert fatigue, and enhancing the efficiency and effectiveness of incident response.</p>
<p><strong>Compliance</strong></p>
<p>SIEM solutions play a significant role in compliance by assisting organizations in meeting regulatory requirements through a comprehensive approach to threat detection and management.</p>
<p>Regulations like PCI DSS, HIPAA, and GDPR mandate organizations to implement robust security measures, including real-time monitoring and analysis of network traffic. SIEM solutions can help organizations fulfill these requirements, enabling SOC teams to detect and respond to security incidents promptly.</p>
<p>Automated reporting and auditing capabilities are also provided by SIEM solutions, which are essential for compliance. These features allow organizations to produce compliance reports swiftly and accurately, ensuring that they satisfy regulatory requirements and can demonstrate compliance to auditors and regulators.</p>
<hr>
<h3 id="data-flows-within-a-siem">Data Flows Within A SIEM</h3>
<p>Let us now briefly see how data travel within a SIEM, until they are ready for analysis.</p>
<ol>
<li>SIEM solutions ingest logs from various data sources. Each SIEM tool possesses unique capabilities for collecting logs from different sources. This process is known as data ingestion or data collection.</li>
<li>The gathered data is processed and normalized to be understood by the SIEM correlation engine. The raw data must be written or read in a format that can be comprehended by the SIEM and converted into a common format from various types of datasets. This process is called data normalization and data aggregation.</li>
<li>Finally, the most crucial part of SIEM, where SOC teams utilize the normalized data collected by the SIEM to create various detection rules, dashboards, visualizations, alerts, and incidents. This enables the SOC team to identify potential security risks and respond swiftly to security incidents.</li>
</ol>
<hr>
<h3 id="what-are-the-benefits-of-using-a-siem-solution">What Are The Benefits Of Using A SIEM Solution</h3>
<p>It is evident that the advantages of deploying a Security Information and Event Management (SIEM) system significantly outweigh the potential risks associated with not having one, assuming that the security control is safeguarding something of higher importance.</p>
<p>In the absence of a SIEM, IT personnel would not have a centralized perspective on all logs and events, which could result in overlooking crucial events and accumulating a large number of events awaiting investigation. Conversely, a properly calibrated SIEM bolsters the incident response process, improving efficiency and offering a centralized dashboard for notifications based on predetermined categories and event thresholds.</p>
<p>For instance, if a firewall records five successive incorrect login attempts, resulting in the admin account being locked, a centralized logging system that correlates all logs is necessary for monitoring the situation. Similarly, a web filtering software that logs a computer connecting to a malicious website 100 times in an hour can be viewed and acted upon within a single interface using a SIEM.</p>
<p>Contemporary SIEMs often include built-in intelligence capable of detecting configurable threshold limits and events within specific timeframes, as well as providing summaries and customizable reports. More sophisticated SIEMs are now integrating AI to notify based on behavioral and pattern analysis.</p>
<p>The reporting and notification capabilities of a SIEM empower IT staff to swiftly react and respond to potential incidents, emphasizing its ability to identify malicious attacks before they occur. This intelligence can lower the expenses associated with a full-scale security breach, sparing organizations significant financial and reputational harm.</p>
<p>Numerous regulated organizations, such as those in Banking, Finance, Insurance, and Healthcare, are mandated to have a managed SIEM either on-premise or in the cloud. SIEM systems offer evidence that systems are being monitored and logged, reviewed, and adhere to log retention policies, fulfilling compliance standards like ISO and HIPAA.</p>
<h2 id="introduction-to-the-elastic-stack">Introduction To The Elastic Stack</h2>
<hr>
<h3 id="what-is-the-elastic-stack-">What Is The Elastic Stack?</h3>
<p>The Elastic stack, created by Elastic, is an open-source collection of mainly three applications (Elasticsearch, Logstash, and Kibana) that work in harmony to offer users comprehensive search and visualization capabilities for real-time analysis and exploration of log file sources.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/elastic.png" alt="The Elastic Stack"></p>
<p>The high-level architecture of the Elastic stack can be enhanced in resource-intensive environments with the addition of Kafka, RabbitMQ, and Redis for buffering and resiliency, and nginx for security.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/elastic1.png" alt="The Elastic Stack"></p>
<p>Let&#39;s delve into each component of the Elastic stack.</p>
<p><code>Elasticsearch</code> is a distributed and JSON-based search engine, designed with RESTful APIs. As the core component of the Elastic stack, it handles indexing, storing, and querying. Elasticsearch empowers users to conduct sophisticated queries and perform analytics operations on the log file records processed by Logstash.</p>
<p><code>Logstash</code> is responsible for collecting, transforming, and transporting log file records. Its strength lies in its ability to consolidate data from various sources and normalize them. Logstash operates in three main areas:</p>
<ol>
<li><code>Process input</code>: Logstash ingests log file records from remote locations, converting them into a format that machines can understand. It can receive records through different <a href="https://www.elastic.co/guide/en/logstash/current/input-plugins.html">input methods</a>, such as reading from a flat file, a TCP socket, or directly from syslog messages. After processing the input, Logstash proceeds to the next function.</li>
<li><code>Transform and enrich log records</code>: Logstash offers numerous ways to <a href="https://www.elastic.co/guide/en/logstash/current/filter-plugins.html">modify a log record</a>&#39;s format and even content. Specifically, filter plugins can perform intermediary processing on an event, often based on a predefined condition. Once a log record is transformed, Logstash processes it further.</li>
<li><code>Send log records to Elasticsearch</code>: Logstash utilizes <a href="https://www.elastic.co/guide/en/logstash/current/output-plugins.html">output plugins</a> to transmit log records to Elasticsearch.</li>
</ol>
<p><code>Kibana</code> serves as the visualization tool for Elasticsearch documents. Users can view the data stored in Elasticsearch and execute queries through Kibana. Additionally, Kibana simplifies the comprehension of query results using tables, charts, and custom dashboards.</p>
<p>Note: <code>Beats</code> is an additional component of the Elastic stack. These lightweight, single-purpose data shippers are designed to be installed on remote machines to forward logs and metrics to either Logstash or Elasticsearch directly. Beats simplify the process of collecting data from various sources and ensure that the Elastic Stack receives the necessary information for analysis and visualization.</p>
<p><code>Beats</code> -&gt; <code>Logstash</code> -&gt; <code>Elasticsearch</code> -&gt; <code>Kibana</code></p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/beats1.png" alt="Beats -&gt; Logstash"></p>
<p><code>Beats</code> -&gt; <code>Elasticsearch</code> -&gt; <code>Kibana</code></p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/beats2.png" alt="Beats -&gt; Elasticsearch"></p>
<hr>
<h3 id="the-elastic-stack-as-a-siem-solution">The Elastic Stack As A SIEM Solution</h3>
<p>The Elastic stack can be used as a Security Information and Event Management (SIEM) solution to collect, store, analyze, and visualize security-related data from various sources.</p>
<p>To implement the Elastic stack as a SIEM solution, security-related data from various sources such as firewalls, IDS/IPS, and endpoints should be ingested into the Elastic stack using Logstash. Elasticsearch should be configured to store and index the security data, and Kibana should be used to create custom dashboards and visualizations to provide insights into security-related events.</p>
<p>To detect security-related incidents, Elasticsearch can be used to perform searches and correlations on the collected security data.</p>
<p>As Security Operations Center (SOC) analysts, we are likely to extensively use Kibana as our primary interface when working with the Elastic stack. Therefore, it is essential to become proficient with its functionalities and features.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/discover.png" alt="Beats -&gt; Elasticsearch"></p>
<p>Kibana Query Language (KQL) is a powerful and user-friendly query language designed specifically for searching and analyzing data in Kibana. It simplifies the process of extracting insights from your indexed Elasticsearch data, offering a more intuitive approach than Elasticsearch&#39;s Query DSL. Let&#39;s explore the technical aspects and key components of the KQL language.</p>
<ul>
<li><code>Basic Structure</code>: KQL queries are composed of <code>field:value</code> pairs, with the field representing the data&#39;s attribute and the value representing the data you&#39;re searching for. For example:</li>
</ul>
<p>&#x20; Introduction To The Elastic Stack</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">event</span><span class="hljs-selector-class">.code</span><span class="hljs-selector-pseudo">:4625</span>
</code></pre>
<p>The KQL query <code>event.code:4625</code> filters data in Kibana to show events that have the <a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4625">Windows event code 4625</a>. This Windows event code is associated with failed login attempts in a Windows operating system.</p>
<p>By using this query, SOC analysts can identify failed login attempts on Windows machines within the Elasticsearch index, and investigate the source of the attempts and potential security threats. This type of query can help identify brute force attacks, password guessing, and other suspicious activities related to login attempts on Windows systems.</p>
<p>By further refining the query with additional conditions, such as the source IP address, username, or time range, SOC analysts can gain more specific insights and effectively investigate potential security incidents.</p>
<ul>
<li><code>Free Text Search</code>: KQL supports free text search, allowing you to search for a specific term across multiple fields without specifying a field name. For instance:</li>
</ul>
<p>&#x20; Introduction To The Elastic Stack</p>
<pre><code class="lang-shell-session"><span class="hljs-string">"svc-sql1"</span>
</code></pre>
<p>This query returns records containing the string &quot;svc-sql1&quot; in any indexed field.</p>
<ul>
<li><code>Logical Operators</code>: KQL supports logical operators AND, OR, and NOT for constructing more complex queries. Parentheses can be used to group expressions and control the order of evaluation. For example:</li>
</ul>
<p>&#x20; Introduction To The Elastic Stack</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">event</span><span class="hljs-selector-class">.code</span><span class="hljs-selector-pseudo">:4625</span> <span class="hljs-selector-tag">AND</span> <span class="hljs-selector-tag">winlog</span><span class="hljs-selector-class">.event_data</span><span class="hljs-selector-class">.SubStatus</span><span class="hljs-selector-pseudo">:0xC0000072</span>
</code></pre>
<p>The KQL query <code>event.code:4625 AND winlog.event_data.SubStatus:0xC0000072</code> filters data in Kibana to show events that have the Windows event code 4625 (failed login attempts) and the SubStatus value of 0xC0000072.</p>
<p>In Windows, the SubStatus value indicates the reason for a login failure. A SubStatus value of 0xC0000072 indicates that the account is currently disabled.</p>
<p>By using this query, SOC analysts can identify failed login attempts against disabled accounts. Such a behavior requires further investigation, as the disabled account&#39;s credentials may have been identified somehow by an attacker.</p>
<ul>
<li><code>Comparison Operators</code>: KQL supports various comparison operators such as <code>:</code>, <code>:&gt;</code>, <code>:&gt;=</code>, <code>:&lt;</code>, <code>:&lt;=</code>, and <code>:!</code>. These operators enable you to define precise conditions for matching field values. For instance:</li>
</ul>
<p>&#x20; Introduction To The Elastic Stack</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">event</span><span class="hljs-selector-class">.code</span><span class="hljs-selector-pseudo">:4625</span> <span class="hljs-selector-tag">AND</span> <span class="hljs-selector-tag">winlog</span><span class="hljs-selector-class">.event_data</span><span class="hljs-selector-class">.SubStatus</span><span class="hljs-selector-pseudo">:0xC0000072</span> <span class="hljs-selector-tag">AND</span> @<span class="hljs-keyword">timestamp</span> &gt;= <span class="hljs-string">"2023-03-03T00:00:00.000Z"</span> AND @timestamp &lt;= <span class="hljs-string">"2023-03-06T23:59:59.999Z"</span>
</code></pre>
<p>By using this query, SOC analysts can identify failed login attempts against disabled accounts that took place between March 3rd 2023 and March 6th 2023</p>
<ul>
<li><code>Wildcards and Regular Expressions</code>: KQL supports wildcards and regular expressions to search for patterns in field values. For example:</li>
</ul>
<p>&#x20; Introduction To The Elastic Stack</p>
<pre><code class="lang-shell-session">event<span class="hljs-selector-class">.code</span>:<span class="hljs-number">4625</span> AND user<span class="hljs-selector-class">.name</span>: admin*
</code></pre>
<p>The Kibana KQL query <code>event.code:4625 AND user.name: admin*</code> filters data in Kibana to show events that have the Windows event code 4625 (failed login attempts) and where the username starts with &quot;admin&quot;, such as &quot;admin&quot;, &quot;administrator&quot;, &quot;admin123&quot;, etc.</p>
<p>This query (if extended) can be useful in identifying potentially malicious login attempts targeted at administrator accounts.</p>
<hr>
<h3 id="how-to-identify-the-available-data">How To Identify The Available Data</h3>
<hr>
<p>&quot;How can I identify the available fields and values?&quot;, you may ask. Let&#39;s see how we could have identified the available fields and values that we used in this section.</p>
<p><strong>Example</strong>: Identify failed login attempts against disabled accounts that took place between March 3rd 2023 and March 6th 2023 KQL:</p>
<p>&#x20; Introduction To The Elastic Stack</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">event</span><span class="hljs-selector-class">.code</span><span class="hljs-selector-pseudo">:4625</span> <span class="hljs-selector-tag">AND</span> <span class="hljs-selector-tag">winlog</span><span class="hljs-selector-class">.event_data</span><span class="hljs-selector-class">.SubStatus</span><span class="hljs-selector-pseudo">:0xC0000072</span> <span class="hljs-selector-tag">AND</span> @<span class="hljs-keyword">timestamp</span> &gt;= <span class="hljs-string">"2023-03-03T00:00:00.000Z"</span> AND @timestamp &lt;= <span class="hljs-string">"2023-03-06T23:59:59.999Z"</span>
</code></pre>
<p><strong>Data and field identification approach 1: Leverage KQL&#39;s free text search</strong></p>
<p>Using the <a href="https://www.elastic.co/guide/en/kibana/current/discover.html">Discover</a> feature, we can effortlessly explore and sift through the available data, as well as gain insights into the architecture of the available fields, before we start constructing KQL queries.</p>
<ul>
<li>By using a search engine for the Windows event logs that are associated with failed login attempts, we will come across resources such as <a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4625">https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4625</a></li>
<li>Using KQL&#39;s free text search we can search for <code>&quot;4625&quot;</code>. In the returned records we notice <code>event.code:4625</code>, <code>winlog.event_id:4625</code>, and <code>@timestamp</code><ul>
<li><code>event.code</code> is related to the <a href="https://www.elastic.co/guide/en/ecs/current/ecs-event.html#field-event-code">Elastic Common Schema (ECS)</a></li>
<li><code>winlog.event_id</code> is related to <a href="https://www.elastic.co/guide/en/beats/winlogbeat/current/exported-fields-winlog.html">Winlogbeat</a></li>
<li>If the organization we work for is using the Elastic stack across all offices and security departments, it is preferred that we use the ECS fields in our queries for reasons that we will cover at the end of this section.</li>
<li><code>@timestamp</code> typically contains the time extracted from the original event and it is <a href="https://discuss.elastic.co/t/winlogbeat-timestamp-different-with-event-create-time/278160">different from <code>event.created</code></a> <img src="https://academy.hackthebox.com/storage/modules/211/discover1.png" alt="Free Text Search 1"></li>
</ul>
</li>
<li>When it comes to disabled accounts, the aforementioned resource informs us that a SubStatus value of 0xC0000072 inside a 4625 Windows event log indicates that the account is currently disabled. Again using KQL&#39;s free text search we can search for <code>&quot;0xC0000072&quot;</code>. By expanding the returned record we notice <code>winlog.event_data.SubStatus</code> that is related to <a href="https://www.elastic.co/guide/en/beats/winlogbeat/current/exported-fields-winlog.html">Winlogbeat</a> <img src="https://academy.hackthebox.com/storage/modules/211/discover2.png" alt="Free Text Search 2"></li>
</ul>
<p><strong>Data and field identification approach 2: Leverage Elastic&#39;s documentation</strong></p>
<p>It could be a good idea to first familiarize ourselves with Elastic&#39;s comprehensive documentation before delving into the &quot;Discover&quot; feature. The documentation provides a wealth of information on the different types of fields we may encounter. Some good resources to start with are:</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/ecs/current/ecs-reference.html">Elastic Common Schema (ECS)</a></li>
<li><a href="https://www.elastic.co/guide/en/ecs/current/ecs-event.html">Elastic Common Schema (ECS) event fields</a></li>
<li><a href="https://www.elastic.co/guide/en/beats/winlogbeat/current/exported-fields-winlog.html">Winlogbeat fields</a></li>
<li><a href="https://www.elastic.co/guide/en/beats/winlogbeat/current/exported-fields-ecs.html">Winlogbeat ECS fields</a></li>
<li><a href="https://www.elastic.co/guide/en/beats/winlogbeat/master/exported-fields-security.html">Winlogbeat security module fields</a></li>
<li><a href="https://www.elastic.co/guide/en/beats/filebeat/current/exported-fields.html">Filebeat fields</a></li>
<li><a href="https://www.elastic.co/guide/en/beats/filebeat/current/exported-fields-ecs.html">Filebeat ECS fields</a></li>
</ul>
<h3 id="the-elastic-common-schema-ecs-">The Elastic Common Schema (ECS)</h3>
<hr>
<p>Elastic Common Schema (ECS) is a shared and extensible vocabulary for events and logs across the Elastic Stack, which ensures consistent field formats across different data sources. When it comes to Kibana Query Language (KQL) searches within the Elastic Stack, using ECS fields presents several key advantages:</p>
<ul>
<li><code>Unified Data View</code>: ECS enforces a structured and consistent approach to data, allowing for unified views across multiple data sources. For instance, data originating from Windows logs, network traffic, endpoint events, or cloud-based data sources can all be searched and correlated using the same field names.</li>
<li><code>Improved Search Efficiency</code>: By standardizing the field names across different data types, ECS simplifies the process of writing queries in KQL. This means that analysts can efficiently construct queries without needing to remember specific field names for each data source.</li>
<li><code>Enhanced Correlation</code>: ECS allows for easier correlation of events across different sources, which is pivotal in cybersecurity investigations. For example, you can correlate an IP address involved in a security incident with network traffic logs, firewall logs, and endpoint data to gain a more comprehensive understanding of the incident.</li>
<li><code>Better Visualizations</code>: Consistent field naming conventions improve the efficacy of visualizations in Kibana. As all data sources adhere to the same schema, creating dashboards and visualizations becomes easier and more intuitive. This can help in spotting trends, identifying anomalies, and visualizing security incidents.</li>
<li><code>Interoperability with Elastic Solutions</code>: Using ECS fields ensures full compatibility with advanced Elastic Stack features and solutions, such as Elastic Security, Elastic Observability, and Elastic Machine Learning. This allows for advanced threat hunting, anomaly detection, and performance monitoring.</li>
<li><code>Future-proofing</code>: As ECS is the foundational schema across the Elastic Stack, adopting ECS ensures future compatibility with enhancements and new features that are introduced into the Elastic ecosystem.</li>
</ul>
<h2 id="soc-definition-fundamentals">SOC Definition &amp; Fundamentals</h2>
<hr>
<h3 id="what-is-a-soc-">What Is A SOC?</h3>
<p>A Security Operations Center (SOC) is an essential facility that houses a team of information security experts responsible for continuously monitoring and evaluating an organization&#39;s security status. The main objective of a SOC team is to identify, examine, and address cybersecurity incidents by employing a mix of technology solutions and a comprehensive set of procedures.</p>
<p>The SOC team usually consists of proficient security analysts, engineers, and managers overseeing security operations. They collaborate closely with organizational incident response teams to guarantee security concerns are promptly detected and resolved.</p>
<p>Various technology solutions, such as Security Information and Event Management (SIEM) systems, Intrusion Detection and Prevention Systems (IDS/IPS), and Endpoint Detection and Response (EDR) tools, are utilized by the SOC team to monitor and identify security threats. They also make use of threat intelligence and engage in threat hunting initiatives to proactively detect potential threats and vulnerabilities.</p>
<p>Besides employing technology solutions, the SOC team follows a series of well-defined processes for addressing security incidents. These processes encompass incident triage, containment, elimination, and recovery. The SOC team cooperates closely with the incident response team to ensure proper handling of security incidents, safeguarding the organization&#39;s security stance.</p>
<p>In summary, a SOC is a vital element of an organization&#39;s cybersecurity approach. It offers continuous monitoring and response capabilities, enabling organizations to promptly detect and address security incidents, minimizing the consequences of a security breach and decreasing the likelihood of future attacks.</p>
<hr>
<h3 id="how-does-a-soc-work-">How Does A SOC Work?</h3>
<p>The primary function of the SOC team is to manage the ongoing operational aspect of enterprise information security rather than concentrating on the development of security strategies, designing security architecture, or implementing protective measures.</p>
<p>The SOC team mainly consists of security analysts who work collectively to detect, assess, respond to, report on, and prevent cybersecurity incidents.</p>
<p>Besides the primary responsibilities of a SOC team, some SOCs may possess advanced capabilities like forensic analysis and malware analysis. These abilities enable the SOC team to conduct in-depth investigations of security incidents and examine the root cause of the incident to avert future attacks.</p>
<p>As previously mentioned, the SOC team also collaborates closely with the incident response team to guarantee proper handling of security incidents and the preservation of the organization&#39;s security posture.</p>
<hr>
<h3 id="roles-within-a-soc">Roles Within A SOC</h3>
<p>A SOC team consists of diverse roles responsible for handling the continuous, operational aspect of enterprise information security. These roles may encompass:</p>
<ul>
<li><code>SOC Director</code>: Responsible for overall management and strategic planning of the SOC, including budgeting, staffing, and alignment with organizational security objectives.</li>
<li><code>SOC Manager</code>: Oversees day-to-day operations, manages the team, coordinates incident response efforts, and ensures smooth collaboration with other departments.</li>
<li><code>Tier 1 Analyst</code>: Monitors security alerts and events, triages potential incidents, and escalates them to higher tiers for further investigation.</li>
<li><code>Tier 2 Analyst</code>: Performs in-depth analysis of escalated incidents, identifies patterns and trends, and develops mitigation strategies to address security threats.</li>
<li><code>Tier 3 Analyst</code>: Provides advanced expertise in handling complex security incidents, conducts threat hunting activities, and collaborates with other teams to improve the organization&#39;s security posture.</li>
<li><code>Detection Engineer</code>: A Detection Engineer is responsible for developing, implementing, and maintaining detection rules and signatures for security monitoring tools, such as SIEM, IDS/IPS, and EDR solutions. They work closely with security analysts to identify gaps in detection coverage and continuously improve the organization&#39;s ability to detect and respond to threats.</li>
<li><code>Incident Responder</code>: Takes charge of active security incidents, carries out in-depth digital forensics and containment and remediation efforts, and collaborates with other teams to restore affected systems and prevent future occurrences.</li>
<li><code>Threat Intelligence Analyst</code>: Gathers, analyzes, and disseminates threat intelligence data to help SOC team members better understand the threat landscape and proactively defend against emerging risks.</li>
<li><code>Security Engineer</code>: Develops, deploys, and maintains security tools, technologies, and infrastructure, and provides technical expertise to the SOC team.</li>
<li><code>Compliance and Governance Specialist</code>: Ensures that the organization&#39;s security practices and processes adhere to relevant industry standards, regulations, and best practices, and assists with audit and reporting requirements.</li>
<li><code>Security Awareness and Training Coordinator</code>: Develops and implements security training and awareness programs to educate employees about cybersecurity best practices and promote a culture of security within the organization.</li>
</ul>
<hr>
<p>It is important to note that the specific roles and responsibilities within each tier can vary depending on the organization&#39;s size, industry, and specific security requirements.</p>
<p>In general, the tiered structure can be described as follows:</p>
<ul>
<li><code>Tier 1 Analysts</code>: Also known as &quot;first responders,&quot; these analysts monitor security events and alerts, perform initial triage, and escalate potential incidents to higher tiers for further investigation. Their main goal is to quickly identify and prioritize security incidents.</li>
<li><code>Tier 2 Analysts</code>: These analysts are more experienced and perform deeper analysis of escalated incidents. They identify patterns and trends, develop mitigation strategies, and sometimes assist in incident response efforts. They may also be responsible for tuning security monitoring tools to reduce false positives and improve detection capabilities.</li>
<li><code>Tier 3 Analysts</code>: Often considered the most experienced and knowledgeable analysts on the team, Tier 3 analysts handle the most complex and high-profile security incidents. They may also engage in proactive threat hunting, develop advanced detection and prevention strategies, and collaborate with other teams to improve the organization&#39;s overall security posture.</li>
</ul>
<hr>
<h3 id="soc-stages">SOC Stages</h3>
<p>Security Operations Centers (SOCs) have evolved significantly from their early days as Network Operation Centers focused primarily on network security. In the first generation, known as SOC 1.0, organizations invested in certain security layers such as security intelligence platforms or identity management systems. However, the lack of proper integration led to uncorrelated alerts and a buildup of tasks across multiple platforms. This stage was characterized by an emphasis on network and perimeter security, even as threats began exploiting other vectors. Surprisingly, some organizations continue to rely on this outdated approach, seemingly waiting for a major breach to occur.</p>
<p>The emergence of sophisticated threats, including multi-vector, persistent, and asynchronous attacks with concealed indicators of compromise, has spurred the transition to SOC 2.0. Malware, including mobile variants, and botnets serve as the primary delivery methods for these attacks. The longevity, evolving behavior, and growth of botnets over time have become focal points for threat intelligence. SOC 2.0 is built on intelligence, integrating security telemetry, threat intelligence, network flow analysis, and other anomaly detection techniques. Additionally, layer-7 analysis is employed at this stage to identify low and slow attacks and other hidden threats. A forward-looking approach to threat research and collaboration between SOCs, either within sectors or at the national level, is crucial for SOC 2.0&#39;s success. Emphasis is placed on complete situational awareness, pre-event preparedness through vulnerability management, configuration management, and dynamic risk management, as well as post-event analysis and learning through incident response and in-depth forensics. Refining security intelligence rules and deploying countermeasures are also vital in this stage.</p>
<p>The cognitive SOC, or next-generation SOC, seeks to address the remaining shortcomings of SOC 2.0. While SOC 2.0 has all the essential subsystems, it often lacks operational experience and effective collaboration between business and security teams to create rules that detect threats specific to business processes and systems. Moreover, many organizations still lack standardized incident response and recovery procedures.</p>
<p>Cognitive SOCs aim to resolve these issues by incorporating learning systems that compensate for experience gaps in security decision-making. While the success rate of this approach may not be perfect in every instance, it is expected to improve over time.</p>
<p><a href="https://www.linkedin.com/pulse/evolution-security-operations-center-20-beyond-krishnan-jagannathan/">Reference: https://www.linkedin.com/pulse/evolution-security-operations-center-20-beyond-krishnan-jagannathan/</a></p>
<h2 id="mitre-att-ck-security-operations">MITRE ATT\&amp;CK &amp; Security Operations</h2>
<hr>
<h3 id="what-is-mitre-att-ck-">What Is MITRE ATT\&amp;CK?</h3>
<p>The <a href="https://attack.mitre.org/">MITRE ATT\&amp;CK</a> (Adversarial Tactics, Techniques, and Common Knowledge) framework serves as an extensive, regularly updated resource outlining the tactics, techniques, and procedures (TTPs) employed by cyber threat actors. This structured methodology assists cybersecurity experts in comprehending, identifying, and reacting to threats more proactively and knowledgeably.</p>
<p>The ATT\&amp;CK framework comprises matrices tailored to various computing contexts, such as enterprise, mobile, or cloud systems. Each matrix links the tactics (the goals attackers aim to achieve) and techniques (the methods used to accomplish their objectives) to distinct TTPs. This linkage allows security teams to methodically examine and predict attacker activities.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/MITRE.gif" alt="MITRE ATT\&amp;CK"></p>
<hr>
<h3 id="mitre-att-ck-use-cases-in-security-operations">MITRE ATT\&amp;CK Use Cases In Security Operations</h3>
<p>The MITRE ATT\&amp;CK framework not only serves as a comprehensive resource for understanding adversarial tactics, techniques, and procedures (TTPs), but it also plays a crucial role in several aspects of Security Operations. These include:</p>
<ul>
<li><code>Detection and Response</code>: The framework supports SOCs in devising detection and response plans based on recognized attacker TTPs, empowering security teams to pinpoint potential dangers and develop proactive countermeasures.</li>
<li><code>Security Evaluation and Gap Analysis</code>: Organizations can leverage the ATT\&amp;CK framework to identify the strengths and weaknesses of their security posture, subsequently prioritizing security control investments to effectively defend against relevant threats.</li>
<li><code>SOC Maturity Assessment</code>: The ATT\&amp;CK framework enables organizations to assess their Security Operations Center (SOC) maturity by measuring their ability to detect, respond to, and mitigate various TTPs. This assessment assists in identifying areas for improvement and prioritizing resources to strengthen the overall security posture.</li>
<li><code>Threat Intelligence</code>: The framework offers a unified language and format to describe adversarial actions, enabling organizations to bolster their threat intelligence and improve collaboration among internal teams or with external stakeholders.</li>
<li><code>Cyber Threat Intelligence Enrichment</code>: Leveraging the ATT\&amp;CK framework can help organizations enrich their cyber threat intelligence by providing context on attacker TTPs, as well as insights into potential targets and indicators of compromise (IOCs). This enrichment allows for more informed decision-making and effective threat mitigation strategies.</li>
<li><code>Behavioral Analytics Development</code>: By mapping the TTPs outlined in the ATT\&amp;CK framework to specific user and system behaviors, organizations can develop behavioral analytics models to identify anomalous activities indicative of potential threats. This approach enhances detection capabilities and helps security teams proactively mitigate risks.</li>
<li><code>Red Teaming and Penetration Testing</code>: The ATT\&amp;CK framework presents a systematic way to replicate genuine attacker techniques during red teaming exercises and penetration tests, ultimately assessing an organization&#39;s defensive capabilities.</li>
<li><code>Training and Education</code>: The comprehensive and well-organized nature of the ATT\&amp;CK framework makes it an exceptional resource for training and educating security professionals on the latest adversarial tactics and methods.</li>
</ul>
<p>In conclusion, the MITRE ATT\&amp;CK framework is an indispensable asset for security operations, offering a shared language and structure for describing and understanding adversarial behavior. It is vital for enhancing various aspects of security operations, from threat intelligence and behavioral analytics to SOC maturity assessment and cyber threat intelligence enrichment.</p>
<h2 id="siem-use-case-development">SIEM Use Case Development</h2>
<hr>
<h3 id="what-is-a-siem-use-case-">What Is A SIEM Use Case?</h3>
<p>Utilizing SIEM use cases is a fundamental aspect of crafting a robust cybersecurity strategy, as they enable the effective identification and detection of potential security incidents. Use cases are designed to illustrate specific situations where a product or service can be applied, and they can range from general scenarios, such as failed login attempts, to more complex ones like detecting a ransomware outbreak.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/usecase1.png" alt="Use Case 1"></p>
<p>For instance, consider a situation where a user named Rob experiences 10 consecutive failed authentication attempts. These events could originate from the actual user who forgot their credentials or from a malicious actor trying to brute force their way into the account. In either case, these 10 events are sent to the SIEM system, which then correlates them into a single event and triggers an alert to the SOC team under the &quot;brute force&quot; use case category.</p>
<p>Based on the log data generated within the SIEM, the SOC team is then responsible for taking appropriate action. This example demonstrates just one of the many possible use cases that can be developed, ranging from straightforward to more intricate situations.</p>
<hr>
<h3 id="siem-use-case-development-lifecycle">SIEM Use Case Development Lifecycle</h3>
<p>The following critical stages must be considered when developing any use cases:</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/usecase2.png" alt="Use Case Dev Lifecycle"></p>
<ol>
<li><code>Requirements</code>: Comprehend the purpose or necessity of the use case, pinpointing the specific scenario for which an alert or notification is needed. Requirements can be proposed by customers, analysts, or employees. For instance, the goal might be to design a detection use case for a brute force attack that triggers an alert after 10 consecutive login failures within 4 minutes.</li>
<li><code>Data Points</code>: Identify all data points within the network where a user account can be used to log in. Gather information about the data sources that generate logs for unauthorized access attempts or login failures. For example, data might come from Windows machines, Linux machines, endpoints, servers, or applications. Ensure logs capture essential details like user, timestamp, source, destination, etc.</li>
<li><code>Log Validation</code>: Verify and validate the logs, ensuring they contain all crucial information such as user, timestamp, source, destination, machine name, and application name. Confirm all logs are received during various user authentication events for critical data points, including local, web-based, application, VPN, and OWA (Outlook) authentication.</li>
<li><code>Design and Implementation</code>: After identifying and verifying all logs with different data points and sources, begin designing the use case by defining the conditions under which an alert should be triggered. Consider three primary parameters: Condition, Aggregation, and Priority. For example, in a brute force attack use case, create an alert for 10 login failures in 4 minutes while considering aggregation to avoid false positives and setting alert priority based on the targeted user&#39;s privileges.</li>
<li><code>Documentation</code>: Standard Operating Procedures (SOP) detail the standard processes analysts must follow when working on alerts. This includes conditions, aggregations, priorities, and information about other teams to which analysts need to report activities. The SOP also contains the escalation matrix.</li>
<li><code>Onboarding</code>: Start with the development stage before moving the alert directly into the production environment. Identify and address any gaps to reduce false positives, then proceed to production.</li>
<li><code>Periodic Update/Fine-tuning</code>: Obtain regular feedback from analysts and maintain up-to-date correlation rules by whitelisting. Continually refine and optimize the use case to ensure its effectiveness and accuracy.</li>
</ol>
<hr>
<h3 id="how-to-build-siem-use-cases">How To Build SIEM Use Cases</h3>
<ul>
<li>Comprehend your needs, risks, and establish alerts for monitoring all necessary systems accordingly.</li>
<li>Determine the priority and impact, then map the alert to the kill chain or MITRE framework.</li>
<li>Establish the Time to Detection (TTD) and Time to Response (TTR) for the alert to assess the SIEM&#39;s effectiveness and analysts&#39; performance.</li>
<li>Create a Standard Operating Procedure (SOP) for managing alerts.</li>
<li>Outline the process for refining alerts based on SIEM monitoring.</li>
<li>Develop an Incident Response Plan (IRP) to address true positive incidents.</li>
<li>Set Service Level Agreements (SLAs) and Operational Level Agreements (OLAs) between teams for handling alerts and following the IRP.</li>
<li>Implement and maintain an audit process for managing alerts and incident reporting by analysts.</li>
<li>Create documentation to review the logging status of machines or systems, the basis for creating alerts, and their triggering frequency.</li>
<li>Establish a knowledge base document for essential information and updates to case management tools.</li>
</ul>
<hr>
<h3 id="example-1-microsoft-build-engine-started-by-an-office-application-">Example 1 (Microsoft Build Engine Started By An Office Application)</h3>
<p>Now, let&#39;s explore a practical example using the Elastic stack as a SIEM solution to help understand how to map each of the above points.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/us1.png" alt="Use Case Dev Lifecycle"></p>
<p>In the provided snapshot (detection use case), we need to determine our risk and the target of our monitoring efforts.</p>
<p>MSBuild, part of the Microsoft Build Engine, is a software build system that assembles applications according to its XML input file. Typically, Microsoft Visual Studio generates the input file, but the .NET framework and other compilers can also compile applications without it. Attackers <a href="https://blog.talosintelligence.com/building-bypass-with-msbuild/">exploit MSBuild</a>&#39;s ability to include malicious source code within its configuration or project file.</p>
<p>When monitoring process execution command-line arguments, it is crucial to investigate instances where a web browser or Microsoft Office executable initiates MSBuild. This suspicious behavior suggests a potential breach. Once a baseline is established, unusual MSBuild calls should be easily identifiable and relatively rare, avoiding increased workload for the team.</p>
<p>To address this risk, we create a detection use case in our SIEM solution that monitors instances of MSBuild initiated by Excel or Word, as this behavior could indicate a malicious script payload execution.</p>
<p>Next, let&#39;s define priority, impact, and map the alert to the kill chain or MITRE framework.</p>
<p>Given the above risk and threat intelligence, this technique, known as Living-off-the-land binaries (<a href="https://www.cynet.com/attack-techniques-hands-on/what-are-lolbins-and-how-do-attackers-use-them-in-fileless-attacks">LoLBins</a>), poses a significant threat if detected, making it a high global risk category. Consequently, we assign it HIGH severity, though this may vary depending on your organization&#39;s specific context and landscape.</p>
<p>Regarding MITRE mapping, this use case involves bypassing detection techniques via LoLBins usage, falling under the Defense Evasion (<a href="https://attack.mitre.org/tactics/TA0005/">TA0005</a>) tactic, the Trusted Developer Utilities Proxy Execution (<a href="https://attack.mitre.org/techniques/T1127/">T1127</a>) technique, and the Trusted Developer Utilities Proxy Execution: MSBuild (<a href="https://attack.mitre.org/techniques/T1127/001/">T1127.001</a>) sub-technique. Additionally, executing the MSBuild binary on the endpoint also falls under the Execution (<a href="https://attack.mitre.org/tactics/TA0002/">TA0002</a>) tactic.</p>
<p>To define TTD and TTR, we need to focus on the rule&#39;s execution interval and the data ingestion pipeline discussed earlier. For this example, we set the rule to run every five minutes, monitoring all incoming logs.</p>
<p>When creating an SOP and documenting alert handling, consider the following:</p>
<ul>
<li>process.name</li>
<li>process.parent.name</li>
<li>event.action</li>
<li>machine where the alert was detected</li>
<li>user associated with the machine</li>
<li>user activity within +/- 2 days of the alert&#39;s generation</li>
<li>After gathering this information, defenders should engage with the user and examine the user&#39;s machine to analyze system logs, antivirus logs, and proxy logs from the SIEM for full visibility.</li>
</ul>
<p>The SOC team should document all the above points, along with the Incident Response Plan, so that Incident Handlers can reference them during analysis.</p>
<p>For rule fine-tuning, it is essential to understand the conditions that may trigger false positives. For example, while the Build Engine is common among Windows developers, its use by non-engineers is unusual. Excluding legitimate parent process names from the rule helps avoid false positives. Further details on fine-tuning SIEM rules will be given later on.</p>
<hr>
<h3 id="example-2-msbuild-making-network-connections-">Example 2 (MSBuild Making Network Connections)</h3>
<p>Example 1 discussed a high-severity detection use case and rule. Now, let&#39;s examine a medium-severity use case using a SIEM solution to better understand how each pointer contributes to the effectiveness of use cases.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/us2.png" alt="Use Case Dev Lifecycle"></p>
<p>In the given snapshot, we need to determine our risk and what we are trying to monitor.</p>
<p>Like in Example 1, we are again focusing on the MsBuild.exe binary. However, this time, we consider the scenario in which a machine attempts outbound communication with a remote or potentially malicious IP address, and the process behind that connection is MsBuild.exe. This would raise an alarm, as it may indicate adversarial activity. MsBuild is often exploited by adversaries to execute code and evade detection.</p>
<p>To address this risk, we need a monitoring solution capable of detecting instances where MsBuild is responsible for malicious outbound connections. We create a detection use case in our SIEM solution for this purpose.</p>
<p>Next, let&#39;s define priority, impact, and map the alert to the kill chain or MITRE framework.</p>
<p>Unlike the previous example, this situation could occur whenever MsBuild.exe establishes an outbound connection. It&#39;s also possible for this process to connect to a legitimate IP address, such as a Microsoft IP for updates. Therefore, we might encounter more false positives unless we implement a robust threat intelligence process. Consequently, we should assign this detection rule a MEDIUM severity instead of HIGH.</p>
<p>As in Example 1, pulling off this particular threat requires attackers to execute the MsBuild binary on the endpoint, which falls under the Execution (TA0002) tactic.</p>
<p>Most of the other pointers remain the same, but the SOP and Incident Response Plan will differ when handling this specific type of alert. Defenders will need to focus on event.action, IP address, and the reputation of the IP, among other factors.</p>
<h2 id="siem-visualization-example-1-failed-logon-attempts-all-users-">SIEM Visualization Example 1: Failed Logon Attempts (All Users)</h2>
<p>Dashboards in SIEM solutions serve as containers for multiple visualizations, allowing us to organize and display data in a meaningful way.</p>
<p>In this and the following sections, we will create a dashboard and some visualizations from scratch.</p>
<hr>
<h3 id="developing-our-first-dashboard-visualization">Developing Our First Dashboard &amp; Visualization</h3>
<p>Navigate to the bottom of this section and click on <code>Click here to spawn the target system!</code></p>
<p>Now, navigate to <code>http://[Target IP]:5601</code>, click on the side navigation toggle, and click on &quot;Dashboard&quot;.</p>
<p>Delete the existing &quot;SOC-Alerts&quot; dashboard as follows.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization29.png" alt="Visualization 29"></p>
<p>When visiting the Dashboard page again we will be presented with a message indicating that no dashboards currently exist. Additionally, there will be an option available to create a new Dashboard and its first visualization. To initiate the creation of our first dashboard, we simply have to click on the &quot;Create new dashboard&quot; button.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/dashboard.png" alt="New Dashboard"></p>
<p>Now, to initiate the creation of our first visualization, we simply have to click on the &quot;Create visualization&quot; button.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization.png" alt="New Visualization"></p>
<p>Upon initiating the creation of our first visualization, the following new window will appear with various options and settings.</p>
<p>Before proceeding with any configuration, it is important for us to first click on the calendar icon to open the time picker. Then, we need to specify the date range as &quot;last 15 years&quot;. Finally, we can click on the &quot;Apply&quot; button to apply the specified date range to the data.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization1.png" alt="Visualization 1"></p>
<p>There are four things for us to notice on this window:</p>
<ol>
<li><p>A filter option that allows us to filter the data before creating a graph. For example, if our goal is to display failed logon attempts, we can use a filter to only consider event IDs that match <code>4625 – Failed logon attempt on a Windows system</code>. The following image demonstrates how we can specify such a filter.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization2.png" alt="Visualization 2"></p>
</li>
<li>This field indicates the data set (index) that we are going to use. It is common for data from various infrastructure sources to be separated into different indices, such as network, Windows, Linux, etc. In this particular example, we will specify <code>windows*</code> in the &quot;Index pattern&quot;.</li>
<li><p>This search bar provides us with the ability to double-check the existence of a specific field within our data set, serving as another way to ensure that we are looking at the correct data. For example, let&#39;s say we are interested in the <code>user.name.keyword</code> field. We can use the search bar to quickly perform a search and verify if this field is present and discovered within our selected data set. This allows us to confirm that we are accessing the desired field and working with accurate data.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization11.png" alt="Visualization 11"></p>
<p>&quot;Why <code>user.name.keyword</code> and not <code>user.name</code>?&quot;, you may ask. We should use the <code>.keyword</code> field when it comes to aggregations. Please refer to this <a href="https://stackoverflow.com/questions/48869795/difference-between-a-field-and-the-field-keyword">stackoverflow question</a> for a more elaborate answer.</p>
</li>
<li><p>Lastly, this drop-down menu enables us to select the type of visualization we want to create. The default option displayed in the earlier image is &quot;Bar vertical stacked&quot;. If we click on that button, it will reveal additional available options (image redacted as not all options fit on the screen). From this expanded list, we can choose the desired visualization type that best suits our requirements and data presentation needs.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization4.png" alt="Visualization 4"></p>
</li>
</ol>
<hr>
<p>For this visualization, let&#39;s select the &quot;Table&quot; option. After selecting the &quot;Table&quot;, we can proceed to click on the &quot;Rows&quot; option. This will allow us to choose the specific data elements that we want to include in the table view.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization5.png" alt="Visualization 5"></p>
<p>Let&#39;s configure the &quot;Rows&quot; settings as follows.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization6.png" alt="Visualization 6"></p>
<p><strong>Note</strong>: You will notice <code>Rank by Alphabetical</code> and not <code>Rank by Count of records</code> like in the screenshot above. This is OK. By the time you perform the next configuration below, <code>Count of records</code> will become available.</p>
<p>Moving forward, let&#39;s close the &quot;Rows&quot; window and proceed to enter the &quot;Metrics&quot; configuration.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization7.png" alt="Visualization 7"></p>
<p>In the &quot;Metrics&quot; window, let&#39;s select &quot;count&quot; as the desired metric.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization8.png" alt="Visualization 8"></p>
<p>As soon as we select &quot;Count&quot; as the metric, we will observe that the table gets populated with data (assuming that there are events present in the selected data set)</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization9.png" alt="Visualization 9"></p>
<p>One final addition to the table is to include another &quot;Rows&quot; setting to show the machine where the failed logon attempt occurred. To do this, we will select the <code>host.hostname.keyword</code> field, which represents the computer reporting the failed logon attempt. This will allow us to display the hostname or machine name alongside the count of failed logon attempts, as shown in the image.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization12.png" alt="Visualization 12"></p>
<p>Now we can see three columns in the table, which contain the following information:</p>
<ol>
<li>The username of the individuals logging in (Note: It currently displays both users and computers. Ideally, a filter should be implemented to exclude computer devices and only display users).</li>
<li>The machine on which the logon attempt occurred.</li>
<li>The number of times the event has occurred (based on the specified time frame or the entire data set, depending on the settings).</li>
</ol>
<p>Finally, click on &quot;Save and return&quot;, and you will observe that the new visualization is added to the dashboard, appearing as shown in the following image.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization13.png" alt="Visualization 13"></p>
<p>Let&#39;s not forget to save the dashboard as well. We can do so by simply clicking on the &quot;Save&quot; button.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization15.png" alt="Visualization 15"></p>
<hr>
<h3 id="refining-the-visualization">Refining The Visualization</h3>
<p>Suppose the SOC Manager suggested the following refinements:</p>
<ul>
<li>Clearer column names should be specified in the visualization</li>
<li>The Logon Type should be included in the visualization</li>
<li>The results in the visualization should be sorted</li>
<li>The DESKTOP-DPOESND, WIN-OK9BH1BCKSD, and WIN-RMMGJA7T9TC usernames should not be monitored</li>
<li><a href="https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/service-accounts-computer">Computer accounts</a> should not be monitored (not a good practice)</li>
</ul>
<p>Let&#39;s refine the visualization we created, so that it fulfills the suggestions above.</p>
<p>Navigate to <code>http://[Target IP]:5601</code>, click on the side navigation toggle, and click on &quot;Dashboard&quot;.</p>
<p>The dashboard we previously created should be visible. Let&#39;s click on the &quot;pencil&quot;/edit icon.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization16.png" alt="Visualization 16"></p>
<p>Let&#39;s now click on the &quot;gear&quot; button at the upper-right corner of our visualization, and then click on &quot;Edit lens&quot;.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization18.png" alt="Visualization 18"></p>
<p>&quot;Top values of user.name.keyword&quot; should be changed as follows.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization19.png" alt="Visualization 19"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization17.png" alt="Visualization 17"></p>
<p>&quot;Top values of host.hostname.keyword&quot; should be changed as follows.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization20.png" alt="Visualization 20"></p>
<p>The &quot;Logon Type&quot; can be added as follows (we will use the <code>winlog.logon.type.keyword</code> field).</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization21.png" alt="Visualization 21"> <img src="https://academy.hackthebox.com/storage/modules/211/visualization22.png" alt="Visualization 22"></p>
<p>&quot;Count of records&quot; should be changed as follows. <img src="https://academy.hackthebox.com/storage/modules/211/visualization23.png" alt="Visualization 23"></p>
<p>We can introduce result sorting as follows. <img src="https://academy.hackthebox.com/storage/modules/211/visualization25.png" alt="Visualization 25"></p>
<p>All we have to do now is click on &quot;Save and return&quot;.</p>
<p>The DESKTOP-DPOESND, WIN-OK9BH1BCKSD, and WIN-RMMGJA7T9TC usernames can be excluded by specifying additional filters as follows.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization24.png" alt="Visualization 24"></p>
<p>Computer accounts can be excluded by specifying the following KQL query and clicking on the &quot;Update&quot; button.</p>
<p>&#x20; SIEM Visualization Example 1: Failed Logon Attempts (All Users)</p>
<pre><code class="lang-shell-session">NOT user<span class="hljs-selector-class">.name</span>: *$ AND winlog<span class="hljs-selector-class">.channel</span><span class="hljs-selector-class">.keyword</span>: Security
</code></pre>
<p>The <code>AND winlog.channel.keyword: Security</code> part is to ensure that no unrelated logs are accounted for.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization34.png" alt="Visualization 34"></p>
<p>This is our visualization after all the refinements we performed.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization35.png" alt="Visualization 35"></p>
<p>Finally, let&#39;s give our visualization a title by clicking on &quot;No Title&quot;.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization36.png" alt="Visualization 36"></p>
<p>Don&#39;t forget to click on the &quot;Save&quot; button (the one on the upper-right hand side of the window).</p>
<h2 id="siem-visualization-example-2-failed-logon-attempts-disabled-users-">SIEM Visualization Example 2: Failed Logon Attempts (Disabled Users)</h2>
<p>In this SIEM visualization example we want to create visualization to monitor failed login attempts against disabled users.</p>
<p>We mention &quot;failed&quot; because it is not possible to log in with a disabled user, so it will never be successful even if the correct credentials are provided. In a scenario where the correct credentials are provided, the Windows logs will contain an additional SubStatus value of 0xC0000072, that indicates the reason of the failure.</p>
<p>Navigate to the bottom of this section and click on <code>Click here to spawn the target system!</code>.</p>
<p>Navigate to <code>http://[Target IP]:5601</code>, click on the side navigation toggle, and click on &quot;Dashboard&quot;.</p>
<p>A prebaked dashboard should be visible. Let&#39;s click on the &quot;pencil&quot;/edit icon.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization16.png" alt="Visualization 16"></p>
<p>Now, to initiate the creation of our first visualization, we simply have to click on the &quot;Create visualization&quot; button.</p>
<p>Upon initiating the creation of our first visualization, the following new window will appear with various options and settings.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization1.png" alt="Visualization 1"></p>
<p>There are four things for us to notice on this window:</p>
<ol>
<li><p>A filter option that allows us to filter the data before creating a graph. In this case our goal is to display failed logon attempts against disabled users only. We can use a filter to only consider event IDs that match <code>4625 – Failed logon attempt on a Windows system</code>, like we did in the previous visualization example. In this case though, we should also take into account the SubStatus (<code>winlog.event_data.SubStatus</code> field) that indicates, when set to 0xC0000072, that the failure is due to a logon with disabled user. The following image demonstrates how we can specify such a filter.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization30.png" alt="Visualization 30"></p>
</li>
<li>This field indicates the data set (index) that we are going to use. It is common for data from various infrastructure sources to be separated into different indices, such as network, Windows, Linux, etc. In this particular example, we will specify <code>windows*</code> in the &quot;Index pattern&quot;.</li>
<li><p>This search bar provides us with the ability to double-check the existence of a specific field within our data set, serving as another way to ensure that we are looking at the correct data. Like in the previous visualization, we are interested in the <code>user.name.keyword</code> field. We can use the search bar to quickly perform a search and verify if this field is present and discovered within our selected data set. This allows us to confirm that we are accessing the desired field and working with accurate data.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization11.png" alt="Visualization 11"></p>
</li>
<li><p>Lastly, this drop-down menu enables us to select the type of visualization we want to create. The default option displayed in the earlier image is &quot;Bar vertical stacked&quot;. If we click on that button, it will reveal additional available options (image redacted as not all options fit on the screen). From this expanded list, we can choose the desired visualization type that best suits our requirements and data presentation needs.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization4.png" alt="Visualization 4"></p>
</li>
</ol>
<hr>
<p>For this visualization, let&#39;s select the &quot;Table&quot; option. After selecting the &quot;Table&quot;, we can proceed to click on the &quot;Rows&quot; option. This will allow us to choose the specific data elements that we want to include in the table view.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization5.png" alt="Visualization 5"></p>
<p>Let&#39;s configure the &quot;Rows&quot; settings as follows.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization6.png" alt="Visualization 6"></p>
<p>Moving forward, let&#39;s close the &quot;Rows&quot; window and proceed to enter the &quot;Metrics&quot; configuration.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization7.png" alt="Visualization 7"></p>
<p>In the &quot;Metrics&quot; window, let&#39;s select &quot;count&quot; as the desired metric.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization8.png" alt="Visualization 8"></p>
<p>One final addition to the table is to include another &quot;Rows&quot; setting to show the machine where the failed logon attempt occurred. To do this, we will select the <code>host.hostname.keyword</code> field, which represents the computer reporting the failed logon attempt. This will allow us to display the hostname or machine name alongside the count of failed logon attempts, as shown in the image.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization31.png" alt="Visualization 31"></p>
<p>Now we can see three columns in the table, which contain the following information:</p>
<ol>
<li>The disabled user whose credentials generated the failed logon attempt event.</li>
<li>The machine on which the logon attempt occurred.</li>
<li>The number of times the event has occurred (based on the specified time frame or the entire data set, depending on the settings).</li>
</ol>
<p>Finally, click on &quot;Save and return&quot;, and you will observe that the new visualization is added to the dashboard.</p>
<h2 id="siem-visualization-example-3-successful-rdp-logon-related-to-service-accounts">SIEM Visualization Example 3: Successful RDP Logon Related To Service Accounts</h2>
<p>In this SIEM visualization example, we aim to create a visualization to monitor successful RDP logons specifically related to service accounts. Service account credentials are never used for RDP logons in corporate/real-world environments. We have been informed by the IT Operations department that all service accounts on the environment start with <code>svc-</code>.</p>
<p>The motivation for this visualization stems from the fact that service accounts often possess exceptionally high privileges. We need to keep a close eye on how service accounts are used.</p>
<p>Our visualization will be based on the following Windows event log.</p>
<ul>
<li><a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4624">4624: An account was successfully logged on</a></li>
</ul>
<p>Navigate to the bottom of this section and click on <code>Click here to spawn the target system!</code>.</p>
<p>Navigate to <code>http://[Target IP]:5601</code>, click on the side navigation toggle, and click on &quot;Dashboard&quot;.</p>
<p>A prebaked dashboard should be visible. Let&#39;s click on the &quot;pencil&quot;/edit icon.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization16.png" alt="Visualization 16"></p>
<p>Now, to initiate the creation of our first visualization, we simply have to click on the &quot;Create visualization&quot; button.</p>
<p>Upon initiating the creation of our first visualization, the following new window will appear with various options and settings.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization1.png" alt="Visualization 1"></p>
<p>There are five things for us to notice on this window:</p>
<ol>
<li><p>A filter option that allows us to filter the data before creating a graph. In this case our goal is to display successful RDP logons specifically related to service accounts. We can use a filter to only consider event IDs that match <code>4624 – An account was successfully logged on</code>. In this case though, we should also take into account the logon type which should be <code>RemoteInteractive</code> (<code>winlog.logon.type</code> field). The following images demonstrates how we can specify such filters.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization38.png" alt="Visualization 38"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization39.png" alt="Visualization 39"></p>
</li>
<li>This field indicates the data set (index) that we are going to use. It is common for data from various infrastructure sources to be separated into different indices, such as network, Windows, Linux, etc. In this particular example, we will specify <code>windows*</code> in the &quot;Index pattern&quot;.</li>
<li><p>This search bar provides us with the ability to double-check the existence of a specific field within our data set, serving as another way to ensure that we are looking at the correct data. We are interested in the <code>user.name.keyword</code> field. We can use the search bar to quickly perform a search and verify if this field is present and discovered within our selected data set. This allows us to confirm that we are accessing the desired field and working with accurate data.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization11.png" alt="Visualization 11"></p>
</li>
<li><p>Lastly, this drop-down menu enables us to select the type of visualization we want to create. The default option displayed in the earlier image is &quot;Bar vertical stacked&quot;. If we click on that button, it will reveal additional available options (image redacted as not all options fit on the screen). From this expanded list, we can choose the desired visualization type that best suits our requirements and data presentation needs.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization4.png" alt="Visualization 4"></p>
</li>
</ol>
<hr>
<p>For this visualization, let&#39;s select the &quot;Table&quot; option. After selecting the &quot;Table&quot;, we can proceed to click on the &quot;Rows&quot; option. This will allow us to choose the specific data elements that we want to include in the table view.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization5.png" alt="Visualization 5"></p>
<p>Let&#39;s configure the &quot;Rows&quot; settings as follows.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization6.png" alt="Visualization 6"></p>
<p>Moving forward, let&#39;s close the &quot;Rows&quot; window and proceed to enter the &quot;Metrics&quot; configuration.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization7.png" alt="Visualization 7"></p>
<p>In the &quot;Metrics&quot; window, let&#39;s select &quot;count&quot; as the desired metric.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization8.png" alt="Visualization 8"></p>
<p>One final addition to the table is to include two more &quot;Rows&quot; settings to show the machine where the successful RDP logon attempt occurred and the machine that initiated the successful RDP logon attempt. To do this, we will select the <code>host.hostname.keyword</code> field that represents the computer reporting the successful RDP logon attempt and the <code>related.ip.keyword</code> field that represents the IP of the computer initiating the succsessful RDP logon attempt. This will allow us to display the involved machines alongside the count of successful logon attempts, as shown in the image.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization40.png" alt="Visualization 40"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization41.png" alt="Visualization 41"></p>
<p>As discussed, we want to monitor successful RDP logons specifically related to service accounts, knowing for a fact that all service accounts of the environment start with <code>svc-</code>. So, to conclude our visualization we need to specify the following KQL query.</p>
<p>&#x20; SIEM Visualization Example 3: Successful RDP Logon Related To Service Accounts</p>
<pre><code class="lang-shell-session">user<span class="hljs-selector-class">.name</span>: svc-*
</code></pre>
<p><strong>Note</strong>: As you can see we don&#39;t use the <code>.keyword</code> field in KQL queries.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization43.png" alt="Visualization 43"></p>
<p>Now we can see four columns in the table, which contain the following information:</p>
<ol>
<li>The service account whose credentials generated the successful RDP logon attempt event.</li>
<li>The machine on which the logon attempt occurred.</li>
<li>The IP of the machine that initiated the logon attempt.</li>
<li>The number of times the event has occurred (based on the specified time frame or the entire data set, depending on the settings).</li>
</ol>
<p>Finally, click on &quot;Save and return&quot;, and you will observe that the new visualization is added to the dashboard.</p>
<h2 id="siem-visualization-example-4-users-added-or-removed-from-a-local-group-within-a-specific-timeframe-">SIEM Visualization Example 4: Users Added Or Removed From A Local Group (Within A Specific Timeframe)</h2>
<p>In this SIEM visualization example, we aim to create a visualization to monitor user additions or removals from the local &quot;Administrators&quot; group from March 5th 2023 to date.</p>
<p>Our visualization will be based on the following Windows event logs.</p>
<ul>
<li><a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4732">4732: A member was added to a security-enabled local group</a></li>
<li><a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4733">4733: A member was removed from a security-enabled local group</a></li>
</ul>
<p>Navigate to the bottom of this section and click on <code>Click here to spawn the target system!</code>.</p>
<p>Navigate to <code>http://[Target IP]:5601</code>, click on the side navigation toggle, and click on &quot;Dashboard&quot;.</p>
<p>A prebaked dashboard should be visible. Let&#39;s click on the &quot;pencil&quot;/edit icon.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization16.png" alt="Visualization 16"></p>
<p>Now, to initiate the creation of our first visualization, we simply have to click on the &quot;Create visualization&quot; button.</p>
<p>Upon initiating the creation of our first visualization, the following new window will appear with various options and settings.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization1.png" alt="Visualization 1"></p>
<p>There are five things for us to notice on this window:</p>
<ol>
<li><p>A filter option that allows us to filter the data before creating a graph. In this case our goal is to display user additions or removals from the local &quot;Administrators&quot; group. We can use a filter to only consider event IDs that match <code>4732 – A member was added to a security-enabled local group</code> and <code>4733 – A member was removed from a security-enabled local group</code>. We can also use a filter to only consider 4732 and 4733 events where the local group is the &quot;Administrators&quot; one.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization44.png" alt="Visualization 44"></p>
</li>
<li>This field indicates the data set (index) that we are going to use. It is common for data from various infrastructure sources to be separated into different indices, such as network, Windows, Linux, etc. In this particular example, we will specify <code>windows*</code> in the &quot;Index pattern&quot;.</li>
<li><p>This search bar provides us with the ability to double-check the existence of a specific field within our data set, serving as another way to ensure that we are looking at the correct data. We are interested in the <code>user.name.keyword</code> field. We can use the search bar to quickly perform a search and verify if this field is present and discovered within our selected data set. This allows us to confirm that we are accessing the desired field and working with accurate data.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization11.png" alt="Visualization 11"></p>
</li>
<li><p>Lastly, this drop-down menu enables us to select the type of visualization we want to create. The default option displayed in the earlier image is &quot;Bar vertical stacked&quot;. If we click on that button, it will reveal additional available options (image redacted as not all options fit on the screen). From this expanded list, we can choose the desired visualization type that best suits our requirements and data presentation needs.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization4.png" alt="Visualization 4"></p>
</li>
</ol>
<hr>
<p>For this visualization, let&#39;s select the &quot;Table&quot; option. After selecting the &quot;Table&quot;, we can proceed to click on the &quot;Rows&quot; option. This will allow us to choose the specific data elements that we want to include in the table view.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization5.png" alt="Visualization 5"></p>
<p>Let&#39;s configure the &quot;Rows&quot; settings as follows.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization6.png" alt="Visualization 6"></p>
<p>Moving forward, let&#39;s close the &quot;Rows&quot; window and proceed to enter the &quot;Metrics&quot; configuration.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization7.png" alt="Visualization 7"></p>
<p>In the &quot;Metrics&quot; window, let&#39;s select &quot;count&quot; as the desired metric.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization8.png" alt="Visualization 8"></p>
<p>One final addition to the table is to include some more &quot;Rows&quot; settings to enhance our understanding.</p>
<ul>
<li>Which user was added to or removed from the group? (<code>winlog.event_data.MemberSid.keyword</code> field)</li>
<li>To which group was the addition or the removal performed? (double-checking that it is the &quot;Administrators&quot; one) (<code>group.name.keyword</code> field)</li>
<li>Was the user added to or removed from the group? (<code>event.action.keyword</code> field)</li>
<li><p>On which machine did the action occur? (<code>host.name.keyword</code> field)</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization46.png" alt="Visualization 46"></p>
</li>
</ul>
<p>Click on &quot;Save and return&quot;, and you will observe that the new visualization is added to the dashboard.</p>
<p>As discussed, we want to monitor user additions or removals from the local &quot;Administrators&quot; group <em>within a specific timeframe (March 5th 2023 to date)</em>.</p>
<p>We can narrow the scope of our visualization as follows.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization47.png" alt="Visualization 47"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization48.png" alt="Visualization 48"></p>
<p><img src="https://academy.hackthebox.com/storage/modules/211/visualization50.png" alt="Visualization 50"></p>
<p>Finally, let&#39;s click on the &quot;Save&quot; button so that all our edits persist.</p>
<h2 id="the-triaging-process">The Triaging Process</h2>
<hr>
<h3 id="what-is-alert-triaging-">What Is Alert Triaging?</h3>
<p><code>Alert triaging</code>, performed by a Security Operations Center (SOC) analyst, is the process of evaluating and prioritizing security alerts generated by various monitoring and detection systems to determine their level of threat and potential impact on an organization&#39;s systems and data. It involves systematically reviewing and categorizing alerts to effectively allocate resources and respond to security incidents.</p>
<p><code>Escalation</code> is an important aspect of alert triaging in a SOC environment. The escalation process typically involves notifying supervisors, incident response teams, or designated individuals within the organization who have the authority to make decisions and coordinate the response effort. The SOC analyst provides detailed information about the alert, including its severity, potential impact, and any relevant findings from the initial investigation. This allows the decision-makers to assess the situation and determine the appropriate course of action, such as involving specialized teams, initiating broader incident response procedures, or engaging external resources if necessary.</p>
<p>Escalation ensures that critical alerts receive prompt attention and facilitates effective coordination among different stakeholders, enabling a timely and efficient response to potential security incidents. It helps to leverage the expertise and decision-making capabilities of individuals who are responsible for managing and mitigating higher-level threats or incidents within the organization.</p>
<hr>
<h3 id="what-is-the-ideal-triaging-process-">What Is The Ideal Triaging Process?</h3>
<ol>
<li><p><code>Initial Alert Review</code>:</p>
</li>
<li><p>Thoroughly review the initial alert, including metadata, timestamp, source IP, destination IP, affected systems, and triggering rule/signature.</p>
</li>
<li><p>Analyze associated logs (network traffic, system, application) to understand the alert&#39;s context.</p>
</li>
<li><p><code>Alert Classification</code>:</p>
</li>
<li><p>Classify the alert based on severity, impact, and urgency using the organization&#39;s predefined classification system.</p>
</li>
<li><p><code>Alert Correlation</code>:</p>
</li>
<li><p>Cross-reference the alert with related alerts, events, or incidents to identify patterns, similarities, or potential indicators of compromise (IOCs).</p>
</li>
<li>Query the SIEM or log management system to gather relevant log data.</li>
<li><p>Leverage threat intelligence feeds to check for known attack patterns or malware signatures.</p>
</li>
<li><p><code>Enrichment of Alert Data</code>:</p>
</li>
<li><p>Gather additional information to enrich the alert data and gain context:</p>
<ul>
<li>Collect network packet captures, memory dumps, or file samples associated with the alert.</li>
<li>Utilize external threat intelligence sources, open-source tools, or sandboxes to analyze suspicious files, URLs, or IP addresses.</li>
<li>Conduct reconnaissance of affected systems for anomalies (network connections, processes, file modifications).</li>
</ul>
</li>
<li><p><code>Risk Assessment</code>:</p>
</li>
<li><p>Evaluate the potential risk and impact to critical assets, data, or infrastructure:</p>
<ul>
<li>Consider the value of affected systems, sensitivity of data, compliance requirements, and regulatory implications.</li>
<li>Determine likelihood of a successful attack or potential lateral movement.</li>
</ul>
</li>
<li><p><code>Contextual Analysis</code>:</p>
</li>
<li><p>The analyst considers the context surrounding the alert, including the affected assets, their criticality, and the sensitivity of the data they handle.</p>
</li>
<li>They evaluate the security controls in place, such as firewalls, intrusion detection/prevention systems, and endpoint protection solutions, to determine if the alert indicates a potential control failure or evasion technique.</li>
<li><p>The analyst assesses the relevant compliance requirements, industry regulations, and contractual obligations to understand the implications of the alert on the organization&#39;s legal and regulatory compliance posture.</p>
</li>
<li><p><code>Incident Response Planning</code>:</p>
</li>
<li><p>Initiate an incident response plan if the alert is significant:</p>
<ul>
<li>Document alert details, affected systems, observed behaviors, potential IOCs, and enrichment data.</li>
<li>Assign incident response team members with defined roles and responsibilities.</li>
<li>Coordinate with other teams (network operations, system administrators, vendors) as necessary.</li>
</ul>
</li>
<li><p><code>Consultation with IT Operations</code>:</p>
</li>
<li><p>Assess the need for additional context or missing information by consulting with IT operations or relevant departments:</p>
<ul>
<li>Engage in discussions or meetings to gather insights on the affected systems, recent changes, or ongoing maintenance activities.</li>
<li>Collaborate to understand any known issues, misconfigurations, or network changes that could potentially generate false-positive alerts.</li>
<li>Gain a holistic understanding of the environment and any non-malicious activities that might have triggered the alert.</li>
<li>Document the insights and information obtained during the consultation.</li>
</ul>
</li>
<li><p><code>Response Execution</code>:</p>
</li>
<li><p>Based on the alert review, risk assessment, and consultation, determine the appropriate response actions.</p>
</li>
<li>If the additional context resolves the alert or identifies it as a non-malicious event, take necessary actions without escalation.</li>
<li><p>If the alert still indicates potential security concerns or requires further investigation, proceed with the incident response actions.</p>
</li>
<li><p><code>Escalation</code>:</p>
</li>
<li><p>Identify triggers for escalation based on organization&#39;s policies and alert severity:</p>
<ul>
<li>Triggers may include compromise of critical systems/assets, ongoing attacks, unfamiliar/sophisticated techniques, widespread impact, or insider threats.</li>
</ul>
</li>
<li>Assess the alert against escalation triggers, considering potential consequences if not escalated.</li>
<li>Follow internal escalation process, notifying higher-level teams/management responsible for incident response.</li>
<li>Provide comprehensive alert summary, severity, potential impact, enrichment data, and risk assessment.</li>
<li>Document all communication related to escalation.</li>
<li><p>In some cases, escalate to external entities (law enforcement, incident response providers, CERTs) based on legal/regulatory requirements.</p>
</li>
<li><p><code>Continuous Monitoring</code>:</p>
</li>
<li><p>Continuously monitor the situation and incident response progress.</p>
</li>
<li>Maintain open communication with escalated teams, providing updates on developments, findings, or changes in severity/impact.</li>
<li><p>Collaborate closely with escalated teams for a coordinated response.</p>
</li>
<li><p><code>De-escalation</code>:</p>
</li>
<li><p>Evaluate the need for de-escalation as the incident response progresses and the situation is under control.</p>
</li>
<li>De-escalate when the risk is mitigated, incident is contained, and further escalation is unnecessary.</li>
<li>Notify relevant parties, providing a summary of actions taken, outcomes, and lessons learned.</li>
</ol>
<p>Regularly review and update the process, aligning it with organizational policies, procedures, and guidelines. Adapt the process to address emerging threats and evolving needs.</p>
