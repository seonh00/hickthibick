
<body>
  <div class="container">
<link rel="stylesheet" href="style.css">


<h1 id="intro-to-network-traffic-analysis">Intro to Network Traffic Analysis</h1>
<h2 id="cheat-sheet">Cheat Sheet</h2>
<p>The cheat sheet is a useful command reference for this module.</p>
<h3 id="tcpdump">Tcpdump</h3>
<table>
<thead>
<tr>
<th><strong>Command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tcpdump --version</code></td>
<td>Prints the tcpdump and libpcap version strings then exits.</td>
</tr>
<tr>
<td><code>tcpdump -h</code></td>
<td>Prints the help and usage information.</td>
</tr>
<tr>
<td><code>tcpdump -D</code></td>
<td>Prints a list of usable network interfaces from which tcpdump can capture.</td>
</tr>
<tr>
<td><code>tcpdump -i (interface name or #)</code></td>
<td>Executes tcpdump and utilizes the interface specified to capture on.</td>
</tr>
<tr>
<td><code>tcpdump -i (int) -w file.pcap</code></td>
<td>Runs a capture on the specified interface and writes the output to a file.</td>
</tr>
<tr>
<td><code>tcpdump -r file.pcap</code></td>
<td>TCPDump will read the output from a specified file.</td>
</tr>
<tr>
<td>`tcpdump -r/-w file.pcap -l \</td>
<td>grep &#39;string&#39;`</td>
</tr>
<tr>
<td><code>tcpdump -i (int) host (ip)</code></td>
<td>TCPDump will start a capture on the interface specified at (int) and will only capture traffic originating from or destined to the IP address or hostname specified after <code>host</code>.</td>
</tr>
<tr>
<td><code>tcpdump -i (int) port (#)</code></td>
<td>Will filter the capture for anything sourcing from or destined to port (#) and discard the rest.</td>
</tr>
<tr>
<td><code>tcpdump -i (int) proto (#)</code></td>
<td>Will filter the capture for any protocol traffic matching the (#). For example, (6) would filter for any TCP traffic and discard the rest.</td>
</tr>
<tr>
<td><code>tcpdump -i (int) (proto name)</code></td>
<td>Will utilize a protocols common name to filter the traffic captured. TCP/UDP/ICMP as examples.</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="tcpdump-common-switches-and-filters">Tcpdump Common Switches and Filters</h3>
<table>
<thead>
<tr>
<th><strong>Switch/Filter</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>D</code></td>
<td>Will display any interfaces available to capture from.</td>
</tr>
<tr>
<td><code>i</code></td>
<td>Selects an interface to capture from. ex. -i eth0</td>
</tr>
<tr>
<td><code>n</code></td>
<td>Do not resolve hostnames.</td>
</tr>
<tr>
<td><code>nn</code></td>
<td>Do not resolve hostnames or well-known ports.</td>
</tr>
<tr>
<td><code>e</code></td>
<td>Will grab the ethernet header along with upper-layer data.</td>
</tr>
<tr>
<td><code>X</code></td>
<td>Show Contents of packets in hex and ASCII.</td>
</tr>
<tr>
<td><code>XX</code></td>
<td>Same as X, but will also specify ethernet headers. (like using Xe)</td>
</tr>
<tr>
<td><code>v, vv, vvv</code></td>
<td>Increase the verbosity of output shown and saved.</td>
</tr>
<tr>
<td><code>c</code></td>
<td>Grab a specific number of packets, then quit the program.</td>
</tr>
<tr>
<td><code>s</code></td>
<td>Defines how much of a packet to grab.</td>
</tr>
<tr>
<td><code>S</code></td>
<td>change relative sequence numbers in the capture display to absolute sequence numbers. (13248765839 instead of 101)</td>
</tr>
<tr>
<td><code>q</code></td>
<td>Print less protocol information.</td>
</tr>
<tr>
<td><code>r file.pcap</code></td>
<td>Read from a file.</td>
</tr>
<tr>
<td><code>w file.pcap</code></td>
<td>Write into a file</td>
</tr>
<tr>
<td><code>host</code></td>
<td>Host will filter visible traffic to show anything involving the designated host. Bi-directional</td>
</tr>
<tr>
<td><code>src / dest</code></td>
<td><code>src</code> and <code>dest</code> are modifiers. We can use them to designate a source or destination host or port.</td>
</tr>
<tr>
<td><code>net</code></td>
<td><code>net</code> will show us any traffic sourcing from or destined to the network designated. It uses / notation.</td>
</tr>
<tr>
<td><code>proto</code></td>
<td>will filter for a specific protocol type. (ether, TCP, UDP, and ICMP as examples)</td>
</tr>
<tr>
<td><code>port</code></td>
<td><code>port</code> is bi-directional. It will show any traffic with the specified port as the source or destination.</td>
</tr>
<tr>
<td><code>portrange</code></td>
<td><code>Portrange</code> allows us to specify a range of ports. (0-1024)</td>
</tr>
<tr>
<td><code>less / greater &quot;&lt; &gt;&quot;</code></td>
<td><code>less</code> and <code>greater</code> can be used to look for a packet or protocol option of a specific size.</td>
</tr>
<tr>
<td><code>and / &amp;&amp;</code></td>
<td><code>and</code> <code>&amp;&amp;</code> can be used to concatenate two different filters together. for example, src host AND port.</td>
</tr>
<tr>
<td><code>or</code></td>
<td><code>or</code> Or allows for a match on either of two conditions. It does not have to meet both. It can be tricky.</td>
</tr>
<tr>
<td><code>not</code></td>
<td><code>not</code> is a modifier saying anything but x. For example, not UDP.</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="tshark">TShark</h3>
<table>
<thead>
<tr>
<th><strong>Command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tshark -h</code></td>
<td>Prints the help menu.</td>
</tr>
<tr>
<td><code>tshark -D</code></td>
<td>List available interfaces to capture from.</td>
</tr>
<tr>
<td><code>tshark -i (int)</code></td>
<td>Capture on a selected interface. Replace (int) with the interface name or number.</td>
</tr>
<tr>
<td><code>tshark -i eth0 -f &quot;host (ip)&quot;</code></td>
<td>apply a filter with (-f) looking for a specific host while utilizing tshark</td>
</tr>
<tr>
<td><code>D</code></td>
<td>Will display any interfaces available to capture from and then exit out.</td>
</tr>
<tr>
<td><code>L</code></td>
<td>Will list the Link-layer mediums you can capture from and then exit out. (ethernet as an example)</td>
</tr>
<tr>
<td><code>i</code></td>
<td>choose an interface to capture from. (-i eth0)</td>
</tr>
<tr>
<td><code>f</code></td>
<td>packet filter in libpcap syntax. Used during capture.</td>
</tr>
<tr>
<td><code>c</code></td>
<td>Grab a specific number of packets, then quit the program. Defines a stop condition.</td>
</tr>
<tr>
<td><code>a</code></td>
<td>Defines an autostop condition. It can be after a duration, specific file size, or after a certain number of packets.</td>
</tr>
<tr>
<td><code>r (pcap-file)</code></td>
<td>Read from a file.</td>
</tr>
<tr>
<td><code>W (pcap-file)</code></td>
<td>Write into a file using the pcapng format.</td>
</tr>
<tr>
<td><code>P</code></td>
<td>Will print the packet summary while writing into a file (-W)</td>
</tr>
<tr>
<td><code>x</code></td>
<td>will add Hex and ASCII output into the capture.</td>
</tr>
<tr>
<td><code>h</code></td>
<td>See the help menu</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="wireshark">WireShark</h3>
<table>
<thead>
<tr>
<th><strong>Capture Filter</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>host x.x.x.x</code></td>
<td>Capture only traffic pertaining to a certain host</td>
</tr>
<tr>
<td><code>net x.x.x.x/24</code></td>
<td>Capture traffic to or from a specific network (using slash notation to specify the mask)</td>
</tr>
<tr>
<td><code>src/dst net x.x.x.x/24</code></td>
<td>Using src or dst net will only capture traffic sourcing from the specified network or destined to the target network</td>
</tr>
<tr>
<td><code>port #</code></td>
<td>will filter out all traffic except the port you specify</td>
</tr>
<tr>
<td><code>not</code></td>
<td>will capture everything except the variable specified. ex. <code>not port 80</code></td>
</tr>
<tr>
<td><code>and</code></td>
<td>AND will concatenate your specified ports. ex. <code>host 192.168.1.1 and port 80</code></td>
</tr>
<tr>
<td><code>portrange x-x</code></td>
<td>Portrange will grab traffic from all ports within the range only</td>
</tr>
<tr>
<td><code>ip / ether / tcp</code></td>
<td>These filters will only grab traffic from specified protocol headers.</td>
</tr>
<tr>
<td><code>broadcast / multicast / unicast</code></td>
<td>Grabs a specific type of traffic. one to one, one to many, or one to all.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>Display Filter</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ip.addr == x.x.x.x</code></td>
<td>Capture only traffic pertaining to a certain host. This is an OR statement.</td>
</tr>
<tr>
<td><code>ip.addr == x.x.x.x/24</code></td>
<td>Capture traffic pertaining to a specific network. This is an OR statement.</td>
</tr>
<tr>
<td><code>ip.src/dst == x.x.x.x</code></td>
<td>Capture traffic to or from a specific host.</td>
</tr>
<tr>
<td><code>dns / tcp / ftp / arp / ip</code></td>
<td>filter traffic by a specific protocol. There are many more options.</td>
</tr>
<tr>
<td><code>tcp.port == x</code></td>
<td>filter by a specific tcp port.</td>
</tr>
<tr>
<td><code>src.port / dst.port ==x</code></td>
<td>will capture everything except the port specified.</td>
</tr>
<tr>
<td><code>and / or / not</code></td>
<td>AND will concatenate, OR will find either of two options, NOT will exclude your input option.</td>
</tr>
<tr>
<td><code>tcp.stream eq #</code></td>
<td>Allows us to follow a tcp session in which we captured the entire stream. Replace (#) with the session to reassemble.</td>
</tr>
<tr>
<td><code>http</code></td>
<td>Will filter for any traffic matching the http protocol.</td>
</tr>
<tr>
<td><code>http &amp;&amp; image-jfif</code></td>
<td>This filter will display any packet with a jpeg image file.</td>
</tr>
<tr>
<td><code>ftp</code></td>
<td>Filters for the ftp protocol.</td>
</tr>
<tr>
<td><code>ftp.request.command</code></td>
<td>Will filter for any control commands sent over ftp control channel.</td>
</tr>
<tr>
<td><code>ftp-data</code></td>
<td>Will show any objects transfered over ftp.</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="misc-commands">Misc Commands</h3>
<table>
<thead>
<tr>
<th><strong>Command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sudo *</code></td>
<td>Sudo will run the command that proceeds it with elevated privileges.</td>
</tr>
<tr>
<td><code>which (application)</code></td>
<td>Utilizes which to determine if (application) is installed on the host. Replace the application with what you are looking for. ex. <code>which tcpdump</code></td>
</tr>
<tr>
<td><code>sudo apt install (application)</code></td>
<td>Uses elevated privileges to install an application package if it does not exist on the host. ex. <code>sudo apt install wireshark</code></td>
</tr>
<tr>
<td><code>man (application)</code></td>
<td>Displays the manual pages for an application. ex. <code>man tcpdump</code>.</td>
</tr>
</tbody>
</table>
<h3 id="common-ports-and-protocols">Common Ports and Protocols</h3>
<table>
<thead>
<tr>
<th><strong>Port Number</strong></th>
<th><strong>Protocol</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>20</code></td>
<td>FTP-Data</td>
<td>Data channel for passing FTP files.</td>
</tr>
<tr>
<td><code>21</code></td>
<td>FTP-Command</td>
<td>Control channel for issuing commands to an FTP server.</td>
</tr>
<tr>
<td><code>22</code></td>
<td>SSH</td>
<td>Secure Shell Service port. Provides secure remote communications</td>
</tr>
<tr>
<td><code>23</code></td>
<td>Telnet</td>
<td>Telnet service provides cleartext communications between hosts.</td>
</tr>
<tr>
<td><code>25</code></td>
<td>SMTP</td>
<td>Simple Mail Transfer protocol. Utilized for email transmissions between servers.</td>
</tr>
<tr>
<td><code>53</code></td>
<td>DNS</td>
<td>Domain Name Services. Provides name resolution with multiple protocols</td>
</tr>
<tr>
<td><code>69</code></td>
<td>TFTP</td>
<td>Trivial File Transfer Protocol. A lightweight, minimal-function transfer protocol.</td>
</tr>
<tr>
<td><code>80</code></td>
<td>HTTP</td>
<td>HyperText Transfer Protocol. Provides dynamic web services</td>
</tr>
<tr>
<td><code>88</code></td>
<td>Kerberos</td>
<td>Providing cryptographic network authentication</td>
</tr>
<tr>
<td><code>110</code></td>
<td>POP3</td>
<td>Mail service utilized by clients to retrieve email from a server.</td>
</tr>
<tr>
<td><code>111</code></td>
<td>RPC</td>
<td>Remote Procedure Call. Remote service for managing network file systems.</td>
</tr>
<tr>
<td><code>115</code></td>
<td>SFTP</td>
<td>SSH File Transfer Protocol. An extension of SSH providing secure and reliable FTP services.</td>
</tr>
<tr>
<td><code>123</code></td>
<td>NTP</td>
<td>Network Time Protocol. Provides timing and sync services for network devices.</td>
</tr>
<tr>
<td><code>137</code></td>
<td>Netbios-NS</td>
<td>Local network name resolution.</td>
</tr>
<tr>
<td><code>139</code></td>
<td>Netbios-SSN</td>
<td>Provides session services for data transfer. Services like SMB can utilize it.</td>
</tr>
<tr>
<td><code>179</code></td>
<td>BGP</td>
<td>Border Gateway Protocol. BGP is a protocol for exchanging routing info with autonomous systems worldwide.</td>
</tr>
<tr>
<td><code>389</code></td>
<td>LDAP</td>
<td>Lightweight Directory Access Protocol. System agnostic authentication and authorization services.</td>
</tr>
<tr>
<td><code>443</code></td>
<td>HTTPS</td>
<td>HyperText Transfer Protocol Secure. An extension of HTTP utilizing SSL/TLS for encrypting the communications.</td>
</tr>
<tr>
<td><code>445</code></td>
<td>SMB</td>
<td>Server Message Block. SMB allows for the sharing of services, files, networking ports, and printers between hosts.</td>
</tr>
</tbody>
</table>
<h2 id="network-traffic-analysis">Network Traffic Analysis</h2>
<hr>
<p><code>Network Traffic Analysis (NTA)</code> can be described as the act of examining network traffic to characterize common ports and protocols utilized, establish a baseline for our environment, monitor and respond to threats, and ensure the greatest possible insight into our organization&#39;s network.</p>
<p>This process helps security specialists determine anomalies, including security threats in the network, early and effectively pinpoint threats. Network Traffic Analysis can also facilitate the process of meeting security guidelines. Attackers update their tactics frequently to avoid detection and leverage legitimate credentials with tools that most companies allow in their networks, making detection and, subsequently, response challenging for defenders. In such cases, Network Traffic Analysis can again prove helpful. Everyday use cases of NTA include:</p>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Collecting</code> real-time traffic within the network to analyze upcoming threats.</td>
</tr>
<tr>
<td><code>Setting</code> a baseline for day-to-day network communications.</td>
</tr>
<tr>
<td><code>Identifying</code> and analyzing traffic from non-standard ports, suspicious hosts, and issues with networking protocols such as HTTP errors, problems with TCP, or other networking misconfigurations.</td>
</tr>
<tr>
<td><code>Detecting</code> malware on the wire, such as ransomware, exploits, and non-standard interactions.</td>
</tr>
<tr>
<td>NTA is also useful when investigating past incidents and during threat hunting.</td>
</tr>
</tbody>
</table>
<p>Try to picture a threat actor targeting and infiltrating our network. If they wish to breach the network, attackers must inevitably interact and communicate with our infrastructure. Network communication takes place over many different ports and protocols, all being utilized concurrently by employees, equipment, and customers. To spot malicious traffic, we would need to use our knowledge of typical network traffic within our enclave. Doing so will narrow down our search and help us quickly find and disrupt adversarial communication.</p>
<p>For example, if we detect many <code>SYN</code> packets on ports that we never (or rarely) utilize in our network, we can conclude that this is most likely someone trying to determine what ports are open on our hosts. Actions like this are typical markers of a <code>portscan</code>. Performing such an analysis and coming to such conclusions requires specific skills and knowledge.</p>
<hr>
<h3 id="required-skills-and-knowledge">Required Skills and Knowledge</h3>
<p>The skills we are about to list and describe require theoretical and practical knowledge acquired over time. We do not have to know everything by heart, but we should know what to look for when certain aspects of the content seem unfamiliar. This applies not only to NTA but also to most other topics we will deal with in cybersecurity.</p>
<p><strong>TCP/IP Stack &amp; OSI Model</strong></p>
<p>This understanding will ensure we grasp how networking traffic and the host applications interact.</p>
<p><strong>Basic Network Concepts</strong></p>
<p>Understanding what types of traffic we will see at each level includes an understanding of the individual layers that make up the TCP/IP and OSI model and the concepts of switching and routing. If we tap a network on a backbone link, we will see much more traffic than usual, and it will be vastly different from what we find tapping an office switch.</p>
<p><strong>Common Ports and Protocols</strong></p>
<p>Identifying standard ports and protocols quickly and having a functional understanding of how they communicate will ensure we can identify potentially malicious or malformed network traffic.</p>
<p><strong>Concepts of IP Packets and the Sublayers</strong></p>
<p>Foundational knowledge of how TCP and UDP communicate will, at a minimum, ensure we understand what we see or are searching for. TCP, for example, is stream-oriented and allows us to follow a conversation between hosts easily. UDP is quick but not concerned with completeness, so it would be harder to recreate something from this packet type.</p>
<p><strong>Protocol Transport Encapsulation</strong></p>
<p>Each layer will encapsulate the previous. Being able to read or dissect when this encapsulation changes will help us move through data quicker. It is easy to see hints based on encapsulation headers.</p>
<hr>
<h3 id="environment-and-equipment">Environment and Equipment</h3>
<p>The list below contains many different tools and equipment types that can be utilized to perform network traffic analysis. Each will provide a different way to capture or dissect the traffic. Some offer ways to copy and capture, while others read and ingest. This module will explore just a few of these (<a href="https://www.wireshark.org/">Wireshark</a> and <a href="https://www.tcpdump.org/">tcpdump</a> mostly). Keep in mind these tools are not strictly geared for admins. Many of these can be used for malicious reasons as well.</p>
<p><strong>Common Traffic Analysis Tools</strong></p>
<table>
<thead>
<tr>
<th><strong>Tool</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tcpdump</code></td>
<td><a href="https://www.tcpdump.org/">tcpdump</a> is a command-line utility that, with the aid of LibPcap, captures and interprets network traffic from a network interface or capture file.</td>
</tr>
<tr>
<td><code>Tshark</code></td>
<td><a href="https://www.wireshark.org/docs/man-pages/tshark.html">TShark</a> is a network packet analyzer much like TCPDump. It will capture packets from a live network or read and decode from a file. It is the command-line variant of Wireshark.</td>
</tr>
<tr>
<td><code>Wireshark</code></td>
<td><a href="https://www.wireshark.org/">Wireshark</a> is a graphical network traffic analyzer. It captures and decodes frames off the wire and allows for an in-depth look into the environment. It can run many different dissectors against the traffic to characterize the protocols and applications and provide insight into what is happening.</td>
</tr>
<tr>
<td><code>NGrep</code></td>
<td><a href="https://github.com/jpr5/ngrep">NGrep</a> is a pattern-matching tool built to serve a similar function as grep for Linux distributions. The big difference is that it works with network traffic packets. NGrep understands how to read live traffic or traffic from a PCAP file and utilize regex expressions and BPF syntax. This tool shines best when used to debug traffic from protocols like HTTP and FTP.</td>
</tr>
<tr>
<td><code>tcpick</code></td>
<td><a href="http://tcpick.sourceforge.net/index.php?p=home.inc">tcpick</a> is a command-line packet sniffer that specializes in tracking and reassembling TCP streams. The functionality to read a stream and reassemble it back to a file with tcpick is excellent.</td>
</tr>
<tr>
<td><code>Network Taps</code></td>
<td>Taps (<a href="https://www.gigamon.com/">Gigamon</a>, <a href="https://www.niagaranetworks.com/products/network-tap">Niagra-taps</a>) are devices capable of taking copies of network traffic and sending them to another place for analysis. These can be in-line or out of band. They can actively capture and analyze the traffic directly or passively by putting the original packet back on the wire as if nothing had changed.</td>
</tr>
<tr>
<td><code>Networking Span Ports</code></td>
<td><a href="https://en.wikipedia.org/wiki/Port\_mirroring">Span Ports</a> are a way to copy frames from layer two or three networking devices during egress or ingress processing and send them to a collection point. Often a port is mirrored to send those copies to a log server.</td>
</tr>
<tr>
<td><code>Elastic Stack</code></td>
<td>The <a href="https://www.elastic.co/elastic-stack">Elastic Stack</a> is a culmination of tools that can take data from many sources, ingest the data, and visualize it, to enable searching and analysis of it.</td>
</tr>
<tr>
<td><code>SIEMS</code></td>
<td><code>SIEMS</code> (such as <a href="https://www.splunk.com/en\_us">Splunk</a>) are a central point in which data is analyzed and visualized. Alerting, forensic analysis, and day-to-day checks against the traffic are all use cases for a SIEM.</td>
</tr>
<tr>
<td>and others.</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="bpf-syntax">BPF Syntax</h3>
<p>Many of the tools mentioned above have their syntax and commands to utilize, but one that is shared among them is <a href="https://en.wikipedia.org/wiki/Berkeley\_Packet\_Filter">Berkeley Packet Filter (BPF)</a> syntax. This syntax is the primary method we will use. In essence, BPF is a technology that enables a raw interface to read and write from the Data-Link layer. With all this in mind, we care for BPF because of the filtering and decoding abilities it provides us. We will be utilizing BPF syntax through the module, so a basic understanding of how a BPF filter is set up can be helpful. For more information on BPF syntax, check out this <a href="https://www.ibm.com/docs/en/qsip/7.4?topic=queries-berkeley-packet-filters">reference</a>.</p>
<hr>
<h3 id="performing-network-traffic-analysis">Performing Network Traffic Analysis</h3>
<p>Performing analysis can be as simple as watching live traffic roll by in our console or as complex as capturing data with a tap, sending it back to a SIEM for ingestion, and analyzing the pcap data for signatures and alerts related to common tactics and techniques.</p>
<p>At a minimum, to listen passively, we need to be connected to the network segment we wish to listen on. This is especially true in a switched environment where VLANS and switch ports will not forward traffic outside their broadcast domain. With that in mind, if we wish to capture traffic from a specific VLAN, our capture device should be connected to that same network. Devices like network taps, switch or router configurations like span ports, and port mirroring can allow us to get a copy of all traffic traversing a specific link, regardless of what network segment or destination it belongs to.</p>
<p><strong>NTA Workflow</strong></p>
<p>Traffic analysis is not an exact science. NTA can be a very dynamic process and is not a direct loop. It is greatly influenced by what we are looking for (network errors vs. malicious actions) and where we have visibility into our network. Performing traffic analysis can distill down to a few basic tenants.</p>
<p><strong>NTA Workflow</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/workflow.png" alt="image"></p>
<p><strong>1. Ingest Traffic</strong></p>
<p>Once we have decided on our placement, begin capturing traffic. Utilize capture filters if we already have an idea of what we are looking for.</p>
<p><strong>2. Reduce Noise by Filtering</strong></p>
<p>Capturing traffic of a link, especially one in a production environment, can be extremely noisy. Once we complete the initial capture, an attempt to filter out unnecessary traffic from our view can make analysis easier. (Broadcast and Multicast traffic, for example.)</p>
<p><strong>3. Analyze and Explore</strong></p>
<p>Now is the time to start carving out data pertinent to the issue we are chasing down. Look at specific hosts, protocols, even things as specific as flags set in the TCP header. The following questions will help us:</p>
<ol>
<li>Is the traffic encrypted or plain text? Should it be?</li>
<li>Can we see users attempting to access resources to which they should not have access?</li>
<li>Are different hosts talking to each other that typically do not?</li>
</ol>
<p><strong>4. Detect the Root Issue</strong></p>
<ol>
<li>Are we seeing any errors? Is a device not responding that should be?</li>
<li>Use our analysis to decide if what we see is benign or potentially malicious.</li>
<li>Other tools like IDS and IPS can come in handy at this point. They can run heuristics and signatures against the traffic to determine if anything within is potentially malicious.</li>
</ol>
<p><strong>5. Fix and Monitor</strong></p>
<p>Fix and monitor is not a part of the loop but should be included in any workflow we perform. If we make a change or fix an issue, we should continue to monitor the source for a time to determine if the issue has been resolved.</p>
<h2 id="networking-primer-layers-1-4">Networking Primer - Layers 1-4</h2>
<hr>
<p>This section serves as a quick refresher on networking and how some standard protocols we can see while performing traffic captures work. These concepts are at the core of capturing and dissecting traffic. Without a fundamental understanding of typical network flow and what ports and protocols are used, we cannot accurately analyze any traffic we capture. If this is the first time you encounter some of these terms or concepts, we suggest completing the <a href="https://academy.hackthebox.com/course/preview/introduction-to-networking">Introduction to Networking</a> Module first.</p>
<hr>
<h3 id="osi-tcp-ip-models">OSI / TCP-IP Models</h3>
<p><strong>Networking Models</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/net\_models4.png" alt="image"></p>
<p>The image above gives a great view of the Open Systems Interconnect (<code>OSI</code>) model and the Transmission Control Protocol - Internet Protocol (<code>TCP-IP</code>) model side by side. The models are a graphical representation of how communication is handled between networked computers. Let&#39;s take a second to compare the two:</p>
<p><strong>Model Traits Comparison.</strong></p>
<table>
<thead>
<tr>
<th>Trait</th>
<th>OSI</th>
<th>TCP-IP</th>
</tr>
</thead>
<tbody>
<tr>
<td>Layers</td>
<td>Seven</td>
<td>Four</td>
</tr>
<tr>
<td>Flexibility</td>
<td>Strict</td>
<td>Loose</td>
</tr>
<tr>
<td>Dependency</td>
<td>Protocol independent &amp; generic</td>
<td>Based on common communication protocols</td>
</tr>
</tbody>
</table>
<p>When examining these two models, we can notice that the OSI model is segmented more than the TCP-IP model. This is because it is broken down into small functional chunks. Layers one through four of the OSI model are focused on controlling the transportation of data between hosts. This control includes everything from the physical medium used for transmission to the protocol utilized to manage the conversation or lack thereof when transporting data. Layers five through seven handle the interpretation, management, and presentation of the encapsulated data presented to the end-user. Think of the OSI model as the theory behind how everything works, whereas the TCP-IP model is more closely aligned with the actual functionality of networking. The TCP-IP model is a bit more blended, and the rules are flexible. The TCP-IP model comprises four layers where layers five, six, and seven of the OSI model align with layer four of the TCP-IP model. Layer three deals with transportation, layer two is the internet layer which aligns with the network layer in OSI, and layer one is the link-layer which covers layers two and one of the OSI model.</p>
<p>Throughout this module, we will examine many different Protocol Data Units (<code>PDU</code>), so a functional understanding of how it appears in theory and on the wire is required. A PDU is a data packet made up of control information and data encapsulated from each layer of the OSI model. The breakout below will show how the layers in the two models match up to a PDU.</p>
<p><strong>PDU Example</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/net\_models\_pdu2.png" alt="image"></p>
<p>When inspecting a PDU, we need to keep the idea of encapsulation in mind. As our data moves down the protocol stack, each layer will wrap the previous layers&#39; data in a new bubble we call encapsulation. This bubble adds the necessary information of that layer into the header of the PDU. This information can vary by level, but it includes what is held by the previous layer, operational flags, any options required to negotiate communications, the source and destination IP addresses, ports, transport, and application layer protocols.</p>
<p><strong>PDU Packet Breakdown</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/pdu-wireshark.png" alt="image"></p>
<p>The image above shows us the makeup of a PDU side by side with a packet breakout from Wireshark&#39;s Packet Details pane. Please take note that when we see the breakout in Wireshark, it is in reverse order. Wireshark shows us the PDU in reverse because it is in the order that it was unencapsulated.</p>
<hr>
<h3 id="addressing-mechanisms">Addressing Mechanisms</h3>
<p>Now that we have gone over the basic concepts driving networking behavior let us take some time to discuss the addressing mechanisms that enable the delivery of our packets to the correct hosts. We will begin with Media Access Control addresses first.</p>
<p><strong>MAC-Addressing</strong></p>
<p>Each logical or physical interface attached to a host has a Media Access Control (<code>MAC</code>) address. This address is a 48-bit <code>six octet</code> address represented in hexadecimal format. If we look at the image below, we can see an example of one by the <code>red</code> arrow.</p>
<p><strong>Mac-Address</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/Addressing.png" alt="image"></p>
<p>MAC-addressing is utilized in Layer two ( <code>the data-link or link-layer depending on which model you look at</code> ) communications between hosts. This works through host-to-host communication within a broadcast domain. If layer two traffic needs to cross a layer three interface, that PDU is sent to the layer three egress interface, and it is routed to the correct network. At layer two, this looks as though the PDU is addressed to the router interface, and the router will take the layer three address into account when determining where to send it next. Once it makes a choice, it strips the encapsulation at layer two and replaces it with new information that indicates the next physical address in the route.</p>
<hr>
<h3 id="ip-addressing">IP Addressing</h3>
<p>The Internet Protocol (<code>IP</code>) was developed to deliver data from one host to another across network boundaries. IP is responsible for routing packets, the encapsulation of data, and fragmentation and reassembly of datagrams when they reach the destination host. By nature, IP is a connectionless protocol that provides no assurances that data will reach its intended recipient. For the reliability and validation of data delivery, IP relies on upper-layer protocols such as TCP. Currently, there exist two main versions of IP. IPv4, which is the current dominant standard, and IPv6, which is intended to be the successor of IPv4.</p>
<p><strong>IPv4</strong></p>
<p>The most common addressing mechanism most are familiar with is the Internet Protocol address version 4 (<code>IPv4</code>). IPv4 addressing is the core method of routing packets across networks to hosts located outside our immediate vicinity. The image below shows us an example of an IPv4 address by the <code>green</code> arrow.</p>
<p><strong>IP Address</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/Addressing.png" alt="image"></p>
<p>An IPv4 address is made up of a 32-bit <code>four octet</code> number represented in decimal format. In our example, we can see the address <code>192.168.86.243</code>. Each octet of an IP address can be represented by a number ranging from <code>0</code> to <code>255</code>. When examining a PDU, we will find IP addresses in layer three (<code>Network</code>) of the OSI model and layer two (<code>internet</code>) of the TCP-IP model. We will not deep dive into IPv4 here, but for the sake of this module, understand what these addresses are, what they do for us, and at which layer they are used.</p>
<p><strong>IPv6</strong></p>
<p>After a little over a decade of utilizing IPv4, it was determined that we had quickly exhausted the pool of usable IP addresses. With such large chunks sectioned off for special use or private addressing, the world had quickly used up the available space. To help solve this issue, two things were done. The first was implementing variable-length subnet masks (<code>VLSM</code>) and Classless Inter-Domain Routing (<code>CIDR</code>). This allowed us to redefine the useable IP addresses in the v4 format changing how addresses were assigned to users. The second was the creation and continued development of <code>IPv6</code> as a successor to IPv4.</p>
<p>IPv6 provides us a much larger address space that can be utilized for any networked purpose. IPv6 is a 128-bit address <code>16 octets</code> represented in Hexadecimal format. We can see an example of a shortened IPv6 address in the image below by the blue arrow.</p>
<p><strong>IPv6 Address</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/Addressing.png" alt="image"></p>
<p>Along with a much larger address space, IPv6 provides: Better support for Multicasting (sending traffic from one to many) Global addressing per device Security within the protocol in the form of IPSec Simplified Packet headers allow for easier processing and move from connection to connection without being re-assigned an address.</p>
<p>IPv6 uses four main types of addresses within its schema:</p>
<p><strong>IPv6 Addressing Types</strong></p>
<table>
<thead>
<tr>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Unicast</code></td>
<td>Addresses for a single interface.</td>
</tr>
<tr>
<td><code>Anycast</code></td>
<td>Addresses for multiple interfaces, where only one of them receives the packet.</td>
</tr>
<tr>
<td><code>Multicast</code></td>
<td>Addresses for multiple interfaces, where all of them receive the same packet.</td>
</tr>
<tr>
<td><code>Broadcast</code></td>
<td>Does not exist and is realized with multicast addresses.</td>
</tr>
</tbody>
</table>
<p>When thinking about each address type, it is helpful to remember that Unicast traffic is host to host, while Multicast is one to many, and Anycast is one to many in a group where only one will answer the packet. (think load balancing).</p>
<p>Even with its current state providing many advantages over IPv4, the adoption of IPv6 has been slow to catch on.</p>
<p><strong>Adoption of IPv6</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/ipv6-adoption.png" alt="image"></p>
<p>At the time of writing, according to statistics published by Google, the adoption rate is only around 40 percent globally.</p>
<hr>
<h3 id="tcp-udp-transport-mechanisms">TCP / UDP, Transport Mechanisms</h3>
<p>The Transport Layer has several mechanisms to help ensure the seamless delivery of data from source to destination. Think about the Transport layer as a control hub. Application data from the higher layers have to traverse down the stack to the Transport layer. This layer directs how the traffic will be encapsulated and thrown to the lower layer protocols ( IP and MAC ). Once the data reaches its intended recipient, the Transport layer, working with the Network / Internet layer protocols, is responsible for reassembling the encapsulated data back in the correct order. The two mechanisms used to accomplish this task are the Transmission Control (<code>TCP</code>) and the User Datagram Protocol (<code>UDP</code>).</p>
<p><strong>TCP vs. UDP</strong></p>
<p>Let us take a second to examine these two protocols side by side.</p>
<p><strong>TCP VS. UDP</strong></p>
<table>
<thead>
<tr>
<th><strong>Characteristic</strong></th>
<th><strong>TCP</strong></th>
<th><strong>UDP</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Transmission</code></td>
<td>Connection-oriented</td>
<td>Connectionless. Fire and forget.</td>
</tr>
<tr>
<td><code>Connection Establishment</code></td>
<td>TCP uses a three-way handshake to ensure that a connection is established.</td>
<td>UDP does not ensure the destination is listening.</td>
</tr>
<tr>
<td><code>Data Delivery</code></td>
<td>Stream-based conversations</td>
<td>packet by packet, the source does not care if the destination is active</td>
</tr>
<tr>
<td><code>Receipt of data</code></td>
<td>Sequence and Acknowledgement numbers are utilized to account for data.</td>
<td>UDP does not care.</td>
</tr>
<tr>
<td><code>Speed</code></td>
<td>TCP has more overhead and is slower because of its built-in functions.</td>
<td>UDP is fast but unreliable.</td>
</tr>
</tbody>
</table>
<p>By looking at the table above, we can see that TCP and UDP provide two very different data transmission methods. TCP is considered a more reliable protocol since it allows for error checking and data acknowledgment as a normal function. In contrast, UDP is a quick, fire, and forget protocol best utilized when we care about speed over quality and validation.</p>
<p>To put this into perspective, TCP is utilized when moving data that requires completeness over speed. For example, when we use Secure Shell (<code>SSH</code>) to connect from one host to another, a connection is opened that stays active while you issue commands and perform actions. This is a function of TCP, ensuring our conversation with the distant host is not interrupted. If it does get interrupted for some reason, TCP will not reassemble a partial fragment of a packet and send it to the application. We can avoid errors this way. What would happen if we issued a command like <code>sudo passwd user</code> to change the user&#39;s password on a remote host, and during the change, part of the message drops. If this were over UDP, we would have no way of knowing what happened to the rest of that message and potentially mess up the user&#39;s password or worse. TCP helps prevent this by acknowledging each packet received to ensure the destination host has acquired each packet before assembling the command and sending it to the application for action.</p>
<p>On the other hand, when we require quick responses or utilize applications that require speed over completeness, UDP is our answer. Take streaming a video, for example. The user will not notice a pixel or two dropped from a streaming video. We care more about watching the video without it constantly stopping to buffer the next piece. Another example of this would be DNS. When a host requests a record entry for inlanefreight.com, the host is looking for a quick response to continue the process it was performing. The worst thing that happens if a DNS request is dropped is that it is reissued. No harm, no foul. The user will not receive corrupted data because of this drop.</p>
<p>UDP traffic appears like regular traffic; it is a single packet, with no response or acknowledgment that it was sent or received, so there is not much to show here. However, we can take a look at TCP and how it establishes connections.</p>
<hr>
<h3 id="tcp-three-way-handshake">TCP Three-way Handshake</h3>
<p>One of the ways TCP ensures the delivery of data from server to client is the utilization of sessions. These sessions are established through what is called a three-way handshake. To make this happen, TCP utilizes an option in the TCP header called flags. We will not deep dive into TCP flags now; know that the common flags we will see in a three-way handshake are Synchronization (<code>SYN</code>) and acknowledgment (<code>ACK</code>). When a host requests to have a conversation with a server over TCP;</p>
<ol>
<li>The <code>client</code> sends a packet with the SYN flag set to on along with other negotiable options in the TCP header.<ol>
<li>This is a synchronization packet. It will only be set in the first packet from host and server and enables establishing a session by allowing both ends to agree on a sequence number to start communicating with.</li>
<li>This is crucial for the tracking of packets. Along with the sequence number sync, many other options are negotiated in this phase to include window size, maximum segment size, and selective acknowledgments.</li>
</ol>
</li>
<li>The <code>server</code> will respond with a TCP packet that includes a SYN flag set for the sequence number negotiation and an ACK flag set to acknowledge the previous SYN packet sent by the host.<ol>
<li>The server will also include any changes to the TCP options it requires set in the options fields of the TCP header.</li>
</ol>
</li>
<li>The <code>client</code> will respond with a TCP packet with an ACK flag set agreeing to the negotiation.<ol>
<li>This packet is the end of the three-way handshake and established the connection between client and server.</li>
</ol>
</li>
</ol>
<p>Let us take a quick look at this in action to be familiar with it when it appears in our packet output later on in the module.</p>
<p><strong>TCP Three-way Handshake</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/three-way-handshake.png" alt="image"></p>
<p>When examining this output, we can see the start of our handshake on line one. Looking at the information highlighted in the <code>red box</code>, we can see our initial Syn flag is set. If we look at the port numbers underlined in <code>green</code>, we can see two numbers, <code>57678</code> and <code>80</code>. The first number is the random high port number in use by the client, and the second is the well-known port for HTTP used by the server to listen for incoming web request connections. In line 2, we can see the server&#39;s response to the client with an <code>SYN / ACK</code> packet sent to the same ports. On line 3, we can see the client acknowledge the server&#39;s synchronization packet to establish the connection.</p>
<p>Packet 4 shows us that the HTTP request was sent, and a session is established to stream the data for the image requested. We can see as the stream continues that TCP sends acknowledgments for each chunk of data sent. This is an example of typical TCP communication.</p>
<p>We have seen how a session is established with TCP; now, let us examine how a session is concluded.</p>
<p><strong>TCP Session Teardown</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/session-teardown.png" alt="image"></p>
<p>In the image above, a set of packets similar to our three-way handshake visible at the end of the output. This is how TCP gracefully shuts connections. Another flag we will see with TCP is the <code>FIN</code> flag. It is used for signaling that the data transfer is finished and the sender is requesting termination of the connection. The client acknowledges the receipt of the data and then sends a <code>FIN</code> and <code>ACK</code> to begin session termination. The server responds with an acknowledgment of the FIN and sends back its own FIN. Finally, the client acknowledges the session is complete and closes the connection. Before session termination, we should see a packet pattern of:</p>
<ol>
<li><code>FIN, ACK</code></li>
<li><code>FIN, ACK</code>,</li>
<li><code>ACK</code></li>
</ol>
<p>If we look at the image above detailing a session, we will see that this is the case. An output similar to this is considered an adequately terminated connection.</p>
<h2 id="networking-primer-layers-5-7">Networking Primer - Layers 5-7</h2>
<hr>
<p>We have seen how lower-level networking functions, now let us look at some of the upper layer protocols that handle our applications. It takes many different applications and services to maintain a network connection and ensure that data can be transferred between hosts. This section will outline just a vital few.</p>
<hr>
<h3 id="http">HTTP</h3>
<p>Hypertext Transfer Protocol (<code>HTTP</code>) is a stateless Application Layer protocol that has been in use since 1990. HTTP enables the transfer of data in clear text between a client and server over TCP. The client would send an HTTP request to the server, asking for a resource. A session is established, and the server responds with the requested media (HTML, images, hyperlinks, video). HTTP utilizes ports 80 or 8000 over TCP during normal operations. In exceptional circumstances, it can be modified to use alternate ports, or even at times, UDP.</p>
<p><strong>HTTP Methods</strong></p>
<p>To perform operations such as fetching webpages, requesting items for download, or posting your most recent tweet all require the use of specific methods. These methods define the actions taken when requesting a URI. Methods:</p>
<table>
<thead>
<tr>
<th><strong>Method</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>HEAD</code></td>
<td><code>required</code> is a safe method that requests a response from the server similar to a Get request except that the message body is not included. It is a great way to acquire more information about the server and its operational status.</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>required</code> Get is the most common method used. It requests information and content from the server. For example, <code>GET http://10.1.1.1/Webserver/index.html</code> requests the index.html page from the server based on our supplied URI.</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>optional</code> Post is a way to submit information to a server based on the fields in the request. For example, submitting a message to a Facebook post or website forum is a POST action. The actual action taken can vary based on the server, and we should pay attention to the response codes sent back to validate the action.</td>
</tr>
<tr>
<td><code>PUT</code></td>
<td><code>optional</code> Put will take the data appended to the message and place it under the requested URI. If an item does not exist there already, it will create one with the supplied data. If an object already exists, the new PUT will be considered the most up-to-date, and the object will be modified to match. The easiest way to visualize the differences between PUT and POST is to think of it like this; PUT will create or update an object at the URI supplied, while POST will create child entities at the provided URI. The action taken can be compared with the difference between creating a new file vs. writing comments about that file on the same page.</td>
</tr>
<tr>
<td><code>DELETE</code></td>
<td><code>optional</code> Delete does as the name implies. It will remove the object at the given URI.</td>
</tr>
<tr>
<td><code>TRACE</code></td>
<td><code>optional</code> Allows for remote server diagnosis. The remote server will echo the same request that was sent in its response if the TRACE method is enabled.</td>
</tr>
<tr>
<td><code>OPTIONS</code></td>
<td><code>optional</code> The Options method can gather information on the supported HTTP methods the server recognizes. This way, we can determine the requirements for interacting with a specific resource or server without actually requesting data or objects from it.</td>
</tr>
<tr>
<td><code>CONNECT</code></td>
<td><code>optional</code> Connect is reserved for use with Proxies or other security devices like firewalls. Connect allows for tunneling over HTTP. (<code>SSL tunnels</code>)</td>
</tr>
</tbody>
</table>
<p>Notice that we have <code>required</code> or <code>optional</code> listed beside each method. As a requirement by the standard, GET and HEAD must always work and exist with standard HTTP implementations. This is true only for them. The methods trace, options, delete, put and post are optional functionalities one can allow. An example of this is a read-only webpage like a blog post. The client PC can request a resource from the page but not modify, add, or delete the resource or resources.</p>
<p>For more information on HTTP as a protocol or how it operates, see <code>RFC:2616</code>.</p>
<hr>
<h3 id="https">HTTPS</h3>
<p>HTTP Secure (<code>HTTPS</code>) is a modification of the HTTP protocol designed to utilize Transport Layer Security (<code>TLS</code>) or Secure Sockets Layer (<code>SSL</code>) with older applications for data security. TLS is utilized as an encryption mechanism to secure the communications between a client and a server. TLS can wrap regular HTTP traffic within TLS, which means that we can encrypt our entire conversation, not just the data sent or requested. Before the TLS mechanism was in place, we were vulnerable to Man-in-the-middle attacks and other types of reconnaissance or hijacking, meaning anyone in the same LAN as the client or server could view the web traffic if they were listening on the wire. We can now have security implemented in the browser enabling everyone to encrypt their web habits, search requests, sessions or data transfers, bank transactions, and much more.</p>
<p>Even though it is HTTP at its base, HTTPS utilizes ports 443 and 8443 instead of the standard port 80. This is a simple way for the client to signal the server that it wishes to establish a secure connection. Let&#39;s look at an output of HTTPS traffic and discern how a <code>TLS handshake</code> functions for a minute.</p>
<p><strong>TLS Handshake Via HTTPS</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/https.png" alt="image"></p>
<p>In the first few packets, we can see that the client establishes a session to the server using port 443 <code>boxed in blue</code>. This signals the server that it wishes to use HTTPS as the application communication protocol.</p>
<p>Once a session is initiated via TCP, a TLS ClientHello is sent next to begin the TLS handshake. During the handshake, several parameters are agreed upon, including session identifier, peer x509 certificate, compression algorithm to be used, the cipher spec encryption algorithm, if the session is resumable, and a 48-byte master secret shared between the client and server to validate the session.</p>
<p>Once the session is established, all data and methods will be sent through the TLS connection and appear as TLS Application Data <code>as seen in the red box</code>. TLS is still using TCP as its transport protocol, so we will still see acknowledgment packets from the stream coming over port 443.</p>
<p>To summarize the handshake:</p>
<ol>
<li>Client and server exchange hello messages to agree on connection parameters.</li>
<li>Client and server exchange necessary cryptographic parameters to establish a premaster secret.</li>
<li>Client and server will exchange x.509 certificates and cryptographic information allowing for authentication within the session.</li>
<li>Generate a master secret from the premaster secret and exchanged random values.</li>
<li>Client and server issue negotiated security parameters to the record layer portion of the TLS protocol.</li>
<li>Client and server verify that their peer has calculated the same security parameters and that the handshake occurred without tampering by an attacker.</li>
</ol>
<p>Encryption in itself is a complex and lengthy topic that deserves its own module. This section is a simple summary of how HTTP and TLS provide security within the HTTPS application protocol. For more information on how HTTPS functions and how TLS performs security operations, see <code>RFC:2246</code>.</p>
<hr>
<h3 id="ftp">FTP</h3>
<p>File Transfer Protocol (<code>FTP</code>) is an Application Layer protocol that enables quick data transfer between computing devices. FTP can be utilized from the command-line, web browser, or through a graphical FTP client such as FileZilla. FTP itself is established as an insecure protocol, and most users have moved to utilize tools such as SFTP to transfer files through secure channels. As a note moving into the future, most modern web browsers have phased out support for FTP as of 2020.</p>
<p>When we think about communication between hosts, we typically think about a client and server talking over a single socket. Through this socket, both the client and server send commands and data over the same link. In this aspect, FTP is unique since it utilizes multiple ports at a time. FTP uses ports 20 and 21 over TCP. Port 20 is used for data transfer, while port 21 is utilized for issuing commands controlling the FTP session. In regards to authentication, FTP supports user authentication as well as allowing anonymous access if configured.</p>
<p>FTP is capable of running in two different modes, <code>active</code> or <code>passive</code>. Active is the default operational method utilized by FTP, meaning that the server listens for a control command <code>PORT</code> from the client, stating what port to use for data transfer. Passive mode enables us to access FTP servers located behind firewalls or a NAT-enabled link that makes direct TCP connections impossible. In this instance, the client would send the <code>PASV</code> command and wait for a response from the server informing the client what IP and port to utilize for the data transfer channel connection.</p>
<p><strong>FTP Command &amp; Response Examples</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/ftp-example.png" alt="image"></p>
<p>The image above shows several examples of requests issued over the FTP command channel <code>green arrows</code>, and the responses sent back from the FTP server <code>blue arrows</code>. This is all pretty standard stuff. For a list of each command and what it is doing, check out the table below.</p>
<p>When looking at FTP traffic, some common commands we can see passed over port 21 include:</p>
<p><strong>FTP Commands</strong></p>
<table>
<thead>
<tr>
<th><strong>Command</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USER</code></td>
<td>specifies the user to log in as.</td>
</tr>
<tr>
<td><code>PASS</code></td>
<td>sends the password for the user attempting to log in.</td>
</tr>
<tr>
<td><code>PORT</code></td>
<td>when in active mode, this will change the data port used.</td>
</tr>
<tr>
<td><code>PASV</code></td>
<td>switches the connection to the server from active mode to passive.</td>
</tr>
<tr>
<td><code>LIST</code></td>
<td>displays a list of the files in the current directory.</td>
</tr>
<tr>
<td><code>CWD</code></td>
<td>will change the current working directory to one specified.</td>
</tr>
<tr>
<td><code>PWD</code></td>
<td>prints out the directory you are currently working in.</td>
</tr>
<tr>
<td><code>SIZE</code></td>
<td>will return the size of a file specified.</td>
</tr>
<tr>
<td><code>RETR</code></td>
<td>retrieves the file from the FTP server.</td>
</tr>
<tr>
<td><code>QUIT</code></td>
<td>ends the session.</td>
</tr>
</tbody>
</table>
<p>This is not an exhaustive list of the possible FTP control commands that could be seen. These can vary based on the FTP application or shell in use. For more information on FTP, see <code>RFC:959</code>.</p>
<hr>
<h3 id="smb">SMB</h3>
<p>Server Message Block (<code>SMB</code>) is a protocol most widely seen in Windows enterprise environments that enables sharing resources between hosts over common networking architectures. SMB is a connection-oriented protocol that requires user authentication from the host to the resource to ensure the user has correct permissions to use that resource or perform actions. In the past, SMB utilized NetBIOS as its transport mechanism over UDP ports 137 and 138. Since modern changes, SMB now supports direct TCP transport over port 445, NetBIOS over TCP port 139, and even the QUIC protocol.</p>
<p>As a user, SMB provides us easy and convenient access to resources like printers, shared drives, authentication servers, and more. For this reason, SMB is very attractive to potential attackers as well.</p>
<p>Like any other application that uses TCP as its transport mechanism, it will perform standard functions like the three-way handshake and acknowledging received packets. Let us take a second to look at some SMB traffic to familiarize ourselves.</p>
<p><strong>SMB On The Wire</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/smb-actions.png" alt="image"></p>
<p>Looking at the image above, we can see that it performs the TCP handshake each time it establishes a session <code>orange boxes</code>. When looking at the source and destination ports <code>blue box</code>, port 445 is being utilized, signaling SMB traffic over TCP. If we look at the <code>green boxes,</code> the info field tells us a bit about what is happening in the SMB communication. In this example, there are many errors, which is an example of something to dig deeper into. One or two auth failures from a user is relatively common, but a large cluster of them repeating can signal a potential unauthorized individual trying to access a user&#39;s account or use their credentials to move. This is a common tactic of attackers, grab an authenticated user, steal their credentials, utilize them to move laterally, or access resources they typically would be denied access to.</p>
<p>This is just one example of SMB use. Another common thing we will see is file-share access between servers and hosts. For the most part, this is regular communication. However, if we see a host access file shares on other hosts, this is not common. Please pay attention to who is requesting connections, where to, and what they are doing.</p>
<h2 id="the-analysis-process">The Analysis Process</h2>
<hr>
<p>Network Traffic Analysis is a dynamic process that can change depending on the tools we have on hand, permissions given to us by the organization, and our network&#39;s visibility. Our goal is to provide a repeatable process we can begin to utilize when performing traffic analysis.</p>
<p>Traffic Analysis is a <code>detailed examination of an event or process</code>, determining its origin and impact, which can be used to trigger specific precautions and/or actions to support or prevent future occurrences. With network traffic, this means breaking down the data into understandable chunks, examining it for anything that deviates from regular network traffic, for potentially malicious traffic such as unauthorized remote communications from the internet over RDP, SSH, or Telnet, or unique instances preceding network issues. While performing our analysis, we are also looking to see what the trends look like within the traffic and determine if it matches a baseline of typical operational traffic.</p>
<p>Traffic analysis is a highly versatile and essential tool to have in our defensive toolbox. Without the ability to monitor traffic, we are working with a massive piece of the puzzle missing. Analytics on network usage, top-talking hosts and servers, and internal communications are all crucial pieces that provide us, the administrators and defenders, a way to see and correct issues before or soon after they happen. Visibility is probably the most beneficial thing it provides. With this visibility, we can capture traffic over different periods to set a baseline for our environment. This baseline makes it easier to see when a change has occurred. In more advanced implementations for NTA that include other tools like IDS/IPS, firewalls, host and network logs, and additional information being fed into Tools like Splunk or ELK Stack, having the ability to monitor traffic is invaluable. The tools help us quickly alert on malicious actions happening. Many defensive tools have signatures built for most of the common attacks and toolkits.</p>
<p>Having proper defensive capabilities is vital for everyone, but what about daily operations? How can NTA help us? Watching network traffic live can make it easy to troubleshoot a connection issue or determine if our infrastructure and the corresponding protocols are functioning correctly. If we can see where the traffic is going, we can determine if there is an issue.</p>
<p>Lastly, this is a dynamic skill, and using automated tools to aid us is perfectly fine. Just do not rely on them solely. Utilize the skills you have and perform manual checks as well. This will help us by putting eyes on our network. We will have checks and balances between ourselves and the tools since the tools can be beaten. Malicious actors are finding ways to bypass security measures all the time. The human eye is still our best resource for finding the bad.</p>
<hr>
<h3 id="analysis-dependencies">Analysis Dependencies</h3>
<p>Traffic capturing and analysis can be performed in two different ways, <code>active</code> or <code>passive</code>. Each has its dependencies. With passive, we are just copying data that we can see without directly interacting with the packets. For active traffic capture and analysis, the needs are a bit different. Active capture requires us to take a more hands-on approach. This process can also be referred to as <code>in-line</code> traffic captures. With both, how we analyze the data is up to us. We can perform the capture and analysis once done, or we can perform analysis in real-time while the traffic is live. The table below lays out the dependencies for each.</p>
<p><strong>Traffic Capture Dependencies</strong></p>
<table>
<thead>
<tr>
<th><strong>Dependencies</strong></th>
<th><strong>Passive</strong></th>
<th><strong>Active</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Permission</code></td>
<td><code>☑</code></td>
<td><code>☑</code></td>
<td>Depending on the organization we are working in, capturing data can be against policy or even against the law in some sensitive areas like healthcare or banking. Be sure always to obtain permission in writing from someone with the proper authority to grant it to you. We may style ourselves as hackers, but we want to stay in the light legally and ethically.</td>
</tr>
<tr>
<td><code>Mirrored Port</code></td>
<td><code>☑</code></td>
<td>☐</td>
<td>A switch or router network interface configured to copy data from other sources to that specific interface, along with the capability to place your NIC into promiscuous mode. Having packets copied to our port allows us to inspect any traffic destined to the other links we could normally not have visibility over. Since VLANs and switch ports will not forward traffic outside of their broadcast domain, we have to be connected to the segment or have that traffic copied to our specific port. When dealing with wireless, passive can be a bit more complicated. We must be connected to the SSID we wish to capture traffic off of. Just passively listening to the airwaves around us will present us with many SSID broadcast advertisements, but not much else.</td>
</tr>
<tr>
<td><code>Capture Tool</code></td>
<td><code>☑</code></td>
<td><code>☑</code></td>
<td>A way to ingest the traffic. A computer with access to tools like TCPDump, Wireshark, Netminer, or others is sufficient. Keep in mind that when dealing with PCAP data, these files can get pretty large quickly. Each time we apply a filter to it in tools like Wireshark, it causes the application to parse that data again. This can be a resource-intensive process, so make sure the host has abundant resources.</td>
</tr>
<tr>
<td><code>In-line Placement</code></td>
<td>☐</td>
<td><code>☑</code></td>
<td>Placing a Tap in-line requires a topology change for the network you are working in. The source and destination hosts will not notice a difference in the traffic, but for the sake of routing and switching, it will be an invisible next hop the traffic passes through on its way to the destination.</td>
</tr>
<tr>
<td><code>Network Tap or Host With Multiple NIC&#39;s</code></td>
<td>☐</td>
<td><code>☑</code></td>
<td>A computer with two NIC&#39;s, or a device such as a Network Tap is required to allow the data we are inspecting to flow still. Think of it as adding another router in the middle of a link. To actively capture the traffic, we will be duplicating data directly from the sources. The best placement for a tap is in a layer three link between switched segments. It allows for the capture of any traffic routing outside of the local network. A switched port or VLAN segmentation does not filter our view here.</td>
</tr>
<tr>
<td><code>Storage and Processing Power</code></td>
<td><code>☑</code></td>
<td><code>☑</code></td>
<td>You will need plenty of storage space and processing power for traffic capture off a tap. Much more traffic is traversing a layer three link than just inside a switched LAN. Think of it like this; When we passively capture traffic inside a LAN, it&#39;s like pouring water into a cup from a water fountain. It&#39;s a steady stream but manageable. Actively grabbing traffic from a routed link is more like using a water hose to fill up a teacup. There is a lot more pressure behind the flow, and it can be a lot for the host to process and store.</td>
</tr>
</tbody>
</table>
<p>The last dependency is more of a recommendation than a requirement, but we feel it is necessary to mention it. Having an understanding of how day-to-day traffic flows is critical to being successful. It is possible to perform traffic analysis without one, but it will be much harder and time-consuming. The baseline will enable us to quickly filter out common traffic for that network while performing our analysis. Doing so can speed our process up and help spot the outliers or issues much sooner. Let us look at this scenario for a second:</p>
<p>You are a network administrator for a large corporation with several thousand employees on campus. It has been brought to your attention that a segment of your network is having connectivity issues. Several of those hosts are reporting extremely high latency, along with new files appearing on their desktops. To start getting a picture of what is happening, you attach a computer to that segment and start a capture. After a few minutes have passed, you stop the capture and start your analysis.</p>
<p>Now consider this. Without a baseline of our daily network traffic, how do we know what is typical for that network? We grabbed a ton of information during the capture timeframe, and we need to clear some of it away. This process can take a lot of time since we will have to examine every conversation to ensure it is ok, determine if the hosts we see belong on the network or are rogue assets, among much more. This process quickly became a daunting task, right?</p>
<p>With this scenario and access to a network baseline, we can quickly strip away known-good communications. Utilizing data analysis tools such as the top talkers&#39; module in Wireshark can help identify hosts that may be sending a large amount of data. We can check this against the host&#39;s normal baseline to determine if it is out of character. Another way could be to look at connections between internal hosts or common and uncommon ports. Since we could clear our view, we can now see that several user hosts connect on ports 8080 and 445. The ports themselves are not weird, but the fact that it is two user PCs talking to each other over these ports is. Web traffic usually flows from a host to a hosted web server or an intranet web server hosting business applications. The same can be said for SMB traffic. It is very suspicious to see two hosts talking to each other over this port. With what we now know, we can quickly send up a trouble ticket looking for help handling a potential breach now.</p>
<p>When talking about network intrusions, the faster we can get visibility, the less potential damage to our network. Be sure to clearly understand how traffic flows in our networks and how protocols commonly act.</p>
<h2 id="analysis-in-practice">Analysis in Practice</h2>
<hr>
<p>The previous section defined network traffic analysis, the dependencies for performing traffic analysis, and its importance. This section will break down a workflow for performing traffic analysis, and we will become familiar with the key components.</p>
<p>This is not an exact science. It can be a very dynamic process and is not a direct loop. It is greatly influenced by what we are looking for (network errors vs. malicious actions) and where you have visibility into your network. Analysis can be distilled down to a few basic tenants, however.</p>
<hr>
<h3 id="descriptive-analysis">Descriptive Analysis</h3>
<p>Descriptive analysis is an essential step in any data analysis. It serves to describe a data set based on individual characteristics. It helps to detect possible errors in data collection and/or outliers in the data set.</p>
<ol>
<li><code>What is the issue?</code><ul>
<li>Suspected breach? Networking issue?</li>
</ul>
</li>
<li><code>Define our scope and the goal. (what are we looking for? which time period?)</code><ul>
<li>Target: multiple hosts potentially downloading a malicious file from bad.example.com</li>
<li>When: within the last 48 hours + 2 hours from now.</li>
<li>Supporting info: filenames/types &#39;superbad.exe&#39; &#39;new-crypto-miner.exe&#39;</li>
</ul>
</li>
<li><code>Define our target(s) (net / host(s) / protocol)</code><ul>
<li>Scope: 192.168.100.0/24 network, protocols used were HTTP and FTP.</li>
</ul>
</li>
</ol>
<p>Using our workflow, we will determine our issue, what we are looking for, when, and where to find it. Descriptive analysis covers these critical concepts for our analysis.</p>
<hr>
<h3 id="diagnostic-analysis">Diagnostic Analysis</h3>
<p>Diagnostic analysis clarifies the causes, effects, and interactions of conditions. In doing so, it provides insights that are obtained through correlations and interpretation. Characteristic here is a backward-looking view, as in the closely related descriptive analytics, with the subtle difference that it tries to find reasons for events and developments.</p>
<ol>
<li><code>Capture network traffic</code><ul>
<li>Plug into a link with access to the 192.168.100.0/24 network to capture live traffic to try and grab one of the executables in transfer. See if an admin can pull PCAP and/or netflow data from our SIEM for the historical data.</li>
</ul>
</li>
<li><code>Identification of required network traffic components (filtering)</code><ul>
<li>Once we have traffic, filter out any packets not needed for this investigation to include; any traffic that matches our common baseline and keep anything relevant to the scope of the investigation. For example, HTTP and FTP from the subnet, anything transferring or containing a GET request for the suspected executable files.</li>
</ul>
</li>
<li><code>An understanding of captured network traffic</code><ul>
<li>Once we have filtered out the noise, it is time to dig for our targets—filter on things like <code>ftp-data</code> to find any files transferred and reconstruct them. For HTTP, we can filter on <code>http.request.method == &quot;GET&quot;</code> to see any GET requests that match the filenames we are searching for. This can show us who has acquired the files and potentially other transfers internal to the network on the same protocols.</li>
</ul>
</li>
</ol>
<p>By capturing traffic around the source of our issue, clearing out any known good data, and then taking the time to inspect and understand what is left, we can determine if it is the cause of our problem. In doing so, we just performed diagnostic analysis. We are validating the cause of our problems and examining the events surrounding them.</p>
<hr>
<h3 id="predictive-analysis">Predictive Analysis</h3>
<p>By evaluating historical and current data, predictive analysis creates a predictive model for future probabilities. Based on the results of descriptive and diagnostic analyses, this method of data analysis makes it possible to identify trends, detect deviations from expected values at an early stage, and predict future occurrences as accurately as possible.</p>
<ol>
<li><code>Note-taking and mind mapping of the found results</code><ul>
<li>Annotating everything we do, see, or find throughout the investigation is crucial. Ensure we are taking ample notes, including:</li>
<li>Timeframes we captured traffic during.</li>
<li>Suspicious hosts within the network.</li>
<li>Conversations containing the files in question. ( to include timestamps and packet numbers)</li>
</ul>
</li>
<li><code>Summary of the analysis (what did we find?)</code><ul>
<li>Finally, summarize what we have found explaining the relevant details so that superiors can decide to quarantine the affected hosts or perform more significant incident response.</li>
<li>Our analysis will affect decisions made, so it is essential to be as clear and concise as possible.</li>
</ul>
</li>
</ol>
<p>By performing an evaluation of the data we have found, comparing it to our baseline traffic, and known bad data such as markers of infiltration or exploitation (like signatures for viruses and other hacking tools), we are performing Predictive Analysis. In this process, we paint a clear picture so that appropriate actions can be taken in response.</p>
<hr>
<h3 id="prescriptive-analysis">Prescriptive Analysis</h3>
<p>Prescriptive analysis aims to narrow down what actions to take to eliminate or prevent a future problem or trigger a specific activity or process. Using the results of our workflow, we can make sound decisions as to what actions are required to solve the problem and prevent it from happening again. To prescribe a solution is the culmination of this workflow. Once done and the problem is solved, it is prudent to reflect on the entire process and develop lessons learned. These lessons, when documented, will enable us to make our processes stronger—document what was done correctly, what actions failed to help, and what could improve.</p>
<p>This workflow is an example of how to begin the analysis process on captured traffic. Above we broke it down into its parts to explain where they fit within the analysis process and with which type of analysis it belongs. We include it here again as a whole so that it can serve as a template.</p>
<ol>
<li><code>What is the issue?</code><ul>
<li>Suspected breach? Networking issue?</li>
</ul>
</li>
<li><code>Define our scope and the goal (what are we looking for? which time period?)</code><ul>
<li>target: multiple hosts potentially downloading a malicious file from bad.example.com</li>
<li>when: within the last 48 hours + 2 hours from now.</li>
<li>supporting info: filenames/types &#39;superbad.exe&#39; &#39;new-crypto-miner.exe&#39;</li>
</ul>
</li>
<li><code>Define our target(s) (net / host(s) / protocol)</code><ul>
<li>scope: 192.168.100.0/24 network protocols used were HTTP and FTP.</li>
</ul>
</li>
<li><code>Capture network traffic</code><ul>
<li>plug into a link with access to the 192.168.100.0/24 network to capture live traffic to try and grab one of the executables in transfer. See if an admin can pull PCAP and/or netflow data from our SIEM for the historical data.</li>
</ul>
</li>
<li><code>Identification of required network traffic components (filtering)</code><ul>
<li>once we have traffic, filter out any traffic not needed for this investigation to include; any traffic that matches our common baseline and keep anything relevant to the scope. `HTTP and FTP from the subnet, anything transferring or containing a GET request for the suspected executable files.</li>
</ul>
</li>
<li><code>An understanding of captured network traffic</code><ul>
<li>Once we have filtered out the noise, it&#39;s time to dig for our targets—filter on things like <code>ftp-data</code> to find any files transferred and reconstruct them. For HTTP, we can filter on <code>http.request.method == &quot;GET&quot;</code> to see any GET requests that match the filenames we are searching for. This can show us who has acquired the files and potential other transfers internal to the network on the same protocols.</li>
</ul>
</li>
<li><code>Note-taking and mind mapping of the found results.</code><ul>
<li>Annotating everything we do, see, or find throughout the investigation is crucial. Ensure we are taking ample notes, including:</li>
<li>Timeframes we captured traffic during.</li>
<li>Suspicious hosts within the network.</li>
<li>Conversations containing the files in question. ( to include timestamps and packet numbers)</li>
</ul>
</li>
<li><code>Summary of the analysis (what did we find?)</code><ul>
<li>Finally, summarize what has been found, explaining the relevant details so that superiors can make an informed decision to quarantine the affected hosts or perform more significant incident response.</li>
<li>Our analysis will affect decisions made, so it is essential to be as clear and concise as possible.</li>
</ul>
</li>
</ol>
<p>Often this process is not a once-and-done kind of thing. It is usually cyclic, and we will need to rerun steps based on our analysis of the original capture to build a bigger picture. This could have been a much larger attack than what is in the examples. Suppose a full-scale incident response is deemed necessary. In that case, we may have to reanalyze the PCAP previously captured to look at any conversations that involve the affected hosts within several minutes of the executable transfer to ensure it did not spread over another route, as an example.</p>
<hr>
<h3 id="key-components-of-an-effective-analysis">Key Components of an Effective Analysis</h3>
<p><strong>1. Know your environment</strong></p>
<p>There are several key components to perform traffic analysis effectively. First, know the environment. If we are unsure if a host belongs in the network, how can we determine if it is rogue or not? Keeping asset inventories and network maps is vital. These will aid in the analysis process.</p>
<p><strong>2. Placement is Key</strong></p>
<p>Next, the placement of our host for capturing traffic is a critical thing. Closest to the source of the issue is the ideal placement of our capturing tool. If the traffic in question is coming from the internet, listening to the inbound links is a great way to see the complete picture. It is as close to the source as we, the administrators, can get. If the problem seems to be isolated to one host on our internal network, try placing the capture tools in the same segment as the problem host and see what traffic is happening within the segment.</p>
<p><strong>3. Persistence</strong></p>
<p>Persistence is the next critical component for us. The issue will not always be easy to spot. It may not even be a frequent event on the network. For example, an attacker&#39;s Command and Control server reaching out to the victim&#39;s computers may only happen on a time interval of once every several hours, or even once a day or less. This means that if we did not catch it the first time around, it might be a while before it appears in our logs. Don&#39;t lose the drive to find the problem. It could mean the difference between stopping the attacker and a full-scale breach like a ransomware attack.</p>
<hr>
<h3 id="analysis-approach">Analysis Approach</h3>
<p>We have spent some time discussing the analysis process and how to start a basic workflow when performing our tasks. Let&#39;s take a second to discuss some easy wins when looking at traffic and finding problems.</p>
<p>Start with <code>standard protocols first</code> and work our way into the <code>austere and specific</code> only to the organization. Most attacks will come from the internet, so it has to access the internal net somehow. This means there will be traffic generated and logs written about it. HTTP/S, FTP, E-mail, and basic TCP and UDP traffic will be the most common things seen coming from the world. Start at these and clear out anything that is not necessary to the investigation. After these, check standard protocols that allow for communications between networks, such as SSH, RDP, or Telnet. When looking for these types of anomalies, be mindful of the security policy of the network. Does our organization&#39;s security plan and implementations allow for RDP sessions that are initiated outside the enterprise? What about the use of Telnet?</p>
<p>Look for <code>patterns</code>. Is a specific host or set of hosts checking in with something on the internet at the same time daily? This is a typical Command and Control profile setup that can easily be spotted by looking for patterns in our traffic data.</p>
<p>Check anything <code>host to host</code> within our network. In a standard setup, the user&#39;s hosts will rarely talk to each other. So be suspicious of any traffic that appears like this. Typically hosts will talk to infrastructure for IP address leases, DNS requests, enterprise services and to find its route out. We will also see hosts talking with local webservers, file shares, and other critical infrastructure for the environment to function like Domain controllers and authentication apps.</p>
<p>Look for <code>unique</code> events. Things like a host who usually visits a specific site ten times a day changing its pattern and only doing so once is curious. Seeing a different User-Agent string not matching our applications or hosts talking to a server out on the internet is also something to be concerned with. A random port only being bound once or twice on a host is also of note. This could be an opening for things like C2 callbacks, someone opening a port to do something non-standard, or an application showing abnormal behavior. In large environments, patterns are expected, so anything sticking out warrants a look.</p>
<p><code>Don&#39;t be afraid to ask for help.</code> This may seem overstated and obvious, but after a bit of time staring at packet captures, things can blend together, and we may not see the whole picture. Having a second set of eyes on the data can be a huge help in spotting stuff that may get glossed over.</p>
<hr>
<p>In summary, the analysis process is a very dynamic task, and our days will never be the same. Keep learning, understand what is going on around us, and as your skills grow, so will the ability to detect threats. This process does not solely rely on the use of tools such as tcpdump and Wireshark. There are many helpful tools like Snort, Security Onion, Firewalls, and SIEMs that can help enrich our understanding of the environment and provide better protection. Do not be afraid to utilize these in investigations.</p>
<h2 id="tcpdump-fundamentals">Tcpdump Fundamentals</h2>
<hr>
<p><code>Tcpdump</code> is a command-line packet sniffer that can directly capture and interpret data frames from a file or network interface. It was built for use on any Unix-like operating system and had a Windows twin called <code>WinDump</code>. It is a potent and straightforward tool used on most Unix-based systems. It does not require a GUI and can be used through any terminal or remote connection, such as SSH. Nevertheless, this tool can seem overwhelming at first due to the many different functions and filters it offers us. However, once we learn the essential functions, we will find it much easier to use this tool efficiently. To capture network traffic from &quot;off the wire,&quot; it uses the libraries <code>pcap</code> and <code>libpcap</code>, paired with an interface in promiscuous mode to listen for data. This allows the program to see and capture packets sourcing from or destined for any device in the local area network, not just the packets destined for us.</p>
<p>TCPDump is available for most Unix systems and Unix derivatives, such as AIX, BSD, Linux, Solaris, and is supplied by many manufacturers already in the system. Due to the direct access to the hardware, we need the <code>root</code> or the <code>administrator&#39;s</code> privileges to run this tool. For us that means we will have to utilize <code>sudo</code> to execute TCPDump as seen in the examples below. <code>TCPDump</code> often comes preinstalled on the majority of Linux operating systems.</p>
<p>It should be noted that Windows had a port of TCPDump called Windump. Support for windump has ceased. As an alternative running a Linux distribution such as Parrot or Ubuntu in Windows Subsystem for Linux can be an easy way to have a Linux virtual host right on our computer, allowing for the use of TCPDump and many other Linux built tools.</p>
<p><strong>Locate Tcpdump</strong></p>
<p>To validate if the package exists on our host, use the following command:</p>
<p>Tcpdump Fundamentals</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">root</span>@<span class="hljs-keyword">htb</span>[/<span class="hljs-keyword">htb</span>]$ which tcpdump
</code></pre>
<p>Often it can be found in <code>/usr/sbin/tcpdump</code>. However, if the package does not exist, we can install it with:</p>
<p><strong>Install Tcpdump</strong></p>
<p>Tcpdump Fundamentals</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">root</span>@<span class="hljs-keyword">htb</span>[/<span class="hljs-keyword">htb</span>]$ sudo apt install tcpdump
</code></pre>
<p>We can run the tcpdump package with the <code>--version</code> switch to check our install and current package version to validate our install.</p>
<p><strong>Tcpdump Version Validation</strong></p>
<p>Tcpdump Fundamentals</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump --version

tcpdump version <span class="hljs-number">4.9</span><span class="hljs-number">.3</span>
libpcap version <span class="hljs-number">1.9</span><span class="hljs-number">.1</span> (with TPACKET_V3)
OpenSSL <span class="hljs-number">1.1</span><span class="hljs-number">.1</span>f  <span class="hljs-number">31</span> Mar <span class="hljs-number">2020</span>
</code></pre>
<hr>
<h3 id="traffic-captures-with-tcpdump">Traffic Captures with Tcpdump</h3>
<p>Because of the many different functions and filters, we should first familiarize ourselves with the tool&#39;s essential features. Let us discuss some basic TCPDump options, demo some commands, and show how to save traffic to <code>PCAP</code> files and read from these.</p>
<p><strong>Basic Capture Options</strong></p>
<p>Below is a table of basic Tcpdump switches we can use to modify how our captures run. These switches can be chained together to craft how the tool output is shown to us in STDOUT and what is saved to the capture file. This is not an exhaustive list, and there are many more we can use, but these are the most common and valuable.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>Switch Command</strong></th>
<th><strong>Result</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">D</td>
<td>Will display any interfaces available to capture from.</td>
</tr>
<tr>
<td style="text-align:center">i</td>
<td>Selects an interface to capture from. ex. -i eth0</td>
</tr>
<tr>
<td style="text-align:center">n</td>
<td>Do not resolve hostnames.</td>
</tr>
<tr>
<td style="text-align:center">nn</td>
<td>Do not resolve hostnames or well-known ports.</td>
</tr>
<tr>
<td style="text-align:center">e</td>
<td>Will grab the ethernet header along with upper-layer data.</td>
</tr>
<tr>
<td style="text-align:center">X</td>
<td>Show Contents of packets in hex and ASCII.</td>
</tr>
<tr>
<td style="text-align:center">XX</td>
<td>Same as X, but will also specify ethernet headers. (like using Xe)</td>
</tr>
<tr>
<td style="text-align:center">v, vv, vvv</td>
<td>Increase the verbosity of output shown and saved.</td>
</tr>
<tr>
<td style="text-align:center">c</td>
<td>Grab a specific number of packets, then quit the program.</td>
</tr>
<tr>
<td style="text-align:center">s</td>
<td>Defines how much of a packet to grab.</td>
</tr>
<tr>
<td style="text-align:center">S</td>
<td>change relative sequence numbers in the capture display to absolute sequence numbers. (13248765839 instead of 101)</td>
</tr>
<tr>
<td style="text-align:center">q</td>
<td>Print less protocol information.</td>
</tr>
<tr>
<td style="text-align:center">r file.pcap</td>
<td>Read from a file.</td>
</tr>
<tr>
<td style="text-align:center">w file.pcap</td>
<td>Write into a file</td>
</tr>
</tbody>
</table>
<p><strong>Man Page Utilization</strong></p>
<p>To see the complete list of switches, we can utilize the man pages:</p>
<p><strong>Tcpdump Man Page</strong></p>
<p>Tcpdump Fundamentals</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">root</span>@<span class="hljs-keyword">htb</span>[/<span class="hljs-keyword">htb</span>]$ man tcpdump
</code></pre>
<p>Here are some examples of basic Tcpdump switch usage along with descriptions of what is happening:</p>
<p><strong>Listing Available Interfaces</strong></p>
<p>Tcpdump Fundamentals</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -D

<span class="hljs-number">1</span><span class="hljs-selector-class">.eth0</span> [Up, Running, Connected]
<span class="hljs-number">2</span><span class="hljs-selector-class">.any</span> (Pseudo-device that captures on all interfaces) [Up, Running]
<span class="hljs-number">3</span><span class="hljs-selector-class">.lo</span> [Up, Running, Loopback]
<span class="hljs-number">4</span><span class="hljs-selector-class">.bluetooth0</span> (Bluetooth adapter number <span class="hljs-number">0</span>) [Wireless, Association status unknown]
<span class="hljs-number">5</span><span class="hljs-selector-class">.bluetooth-monitor</span> (Bluetooth Linux Monitor) [Wireless]
<span class="hljs-number">6</span><span class="hljs-selector-class">.nflog</span> (Linux netfilter log (NFLOG) interface) [<span class="hljs-attribute">none</span>]
<span class="hljs-number">7</span><span class="hljs-selector-class">.nfqueue</span> (Linux netfilter queue (NFQUEUE) interface) [<span class="hljs-attribute">none</span>]
<span class="hljs-number">8</span><span class="hljs-selector-class">.dbus-system</span> (D-Bus system bus) [<span class="hljs-attribute">none</span>]
<span class="hljs-number">9</span><span class="hljs-selector-class">.dbus-session</span> (D-Bus session bus) [<span class="hljs-attribute">none</span>]
</code></pre>
<p>The above command calls tcpdump using sudo privileges and lists the usable network interfaces. We can choose one of these network interfaces and tell tcpdump which interfaces it should listen to.</p>
<p><strong>Choosing an Interface to Capture From</strong></p>
<p>Tcpdump Fundamentals</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -i eth0
<span class="hljs-symbol">
tcpdump:</span> verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length <span class="hljs-number">262144</span> bytes
<span class="hljs-number">10</span>:<span class="hljs-number">58</span>:<span class="hljs-number">33.719241</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55260</span> &gt; <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https: Flags [P.], seq <span class="hljs-number">1953742992</span>:<span class="hljs-number">1953743073</span>, ack <span class="hljs-number">2034210498</span>, win <span class="hljs-number">501</span>, length <span class="hljs-number">81</span>
<span class="hljs-number">10</span>:<span class="hljs-number">58</span>:<span class="hljs-number">33.747853</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55260</span>: Flags [.], ack <span class="hljs-number">81</span>, win <span class="hljs-number">158</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">10</span>:<span class="hljs-number">58</span>:<span class="hljs-number">33.750393</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.52195</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain: <span class="hljs-number">7579</span>+ <span class="hljs-built_in">PTR</span>? <span class="hljs-number">1.1</span><span class="hljs-meta">.67</span><span class="hljs-meta">.172</span>.in-addr.arpa. (<span class="hljs-number">41</span>)
</code></pre>
<p>In this terminal, we are calling tcpdump and selecting the interface eth0 to capture traffic. Once we issue the command, tcpdump will begin to sniff traffic and see the first few packets across the interface. By issuing the <code>-nn</code> switches as seen below, we tell TCPDump to refrain from resolving IP addresses and port numbers to their hostnames and common port names. In this representation, the last octet is the port from/to which the connection goes.</p>
<p><strong>Disable Name Resolution</strong></p>
<p>Tcpdump Fundamentals</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -i eth0 -nn
<span class="hljs-symbol">
tcpdump:</span> verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length <span class="hljs-number">262144</span> bytes
<span class="hljs-number">11</span>:<span class="hljs-number">02</span>:<span class="hljs-number">35.580449</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48402</span> &gt; <span class="hljs-number">52.31</span><span class="hljs-meta">.199</span><span class="hljs-meta">.148</span><span class="hljs-meta">.443</span>: Flags [P.], seq <span class="hljs-number">988167196</span>:<span class="hljs-number">988167233</span>, ack <span class="hljs-number">1512376150</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">214282239</span> ecr <span class="hljs-number">77421665</span>], length <span class="hljs-number">37</span>
<span class="hljs-number">11</span>:<span class="hljs-number">02</span>:<span class="hljs-number">35.588695</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55272</span> &gt; <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span><span class="hljs-meta">.443</span>: Flags [P.], seq <span class="hljs-number">940648841</span>:<span class="hljs-number">940648916</span>, ack <span class="hljs-number">4248406693</span>, win <span class="hljs-number">501</span>, length <span class="hljs-number">75</span>
<span class="hljs-number">11</span>:<span class="hljs-number">02</span>:<span class="hljs-number">35.654368</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55272</span>: Flags [.], ack <span class="hljs-number">75</span>, win <span class="hljs-number">70</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">11</span>:<span class="hljs-number">02</span>:<span class="hljs-number">35.728889</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">52.31</span><span class="hljs-meta">.199</span><span class="hljs-meta">.148</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48402</span>: Flags [P.], seq <span class="hljs-number">1</span>:<span class="hljs-number">34</span>, ack <span class="hljs-number">37</span>, win <span class="hljs-number">118</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">77434740</span> ecr <span class="hljs-number">214282239</span>], length <span class="hljs-number">33</span>
<span class="hljs-number">11</span>:<span class="hljs-number">02</span>:<span class="hljs-number">35.728988</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48402</span> &gt; <span class="hljs-number">52.31</span><span class="hljs-meta">.199</span><span class="hljs-meta">.148</span><span class="hljs-meta">.443</span>: Flags [.], ack <span class="hljs-number">34</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">214282388</span> ecr <span class="hljs-number">77434740</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">11</span>:<span class="hljs-number">02</span>:<span class="hljs-number">35.729073</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">52.31</span><span class="hljs-meta">.199</span><span class="hljs-meta">.148</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48402</span>: Flags [P.], seq <span class="hljs-number">34</span>:<span class="hljs-number">65</span>, ack <span class="hljs-number">37</span>, win <span class="hljs-number">118</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">77434740</span> ecr <span class="hljs-number">214282239</span>], length <span class="hljs-number">31</span>
<span class="hljs-number">11</span>:<span class="hljs-number">02</span>:<span class="hljs-number">35.729081</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48402</span> &gt; <span class="hljs-number">52.31</span><span class="hljs-meta">.199</span><span class="hljs-meta">.148</span><span class="hljs-meta">.443</span>: Flags [.], ack <span class="hljs-number">65</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">214282388</span> ecr <span class="hljs-number">77434740</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">11</span>:<span class="hljs-number">02</span>:<span class="hljs-number">35.729348</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">52.31</span><span class="hljs-meta">.199</span><span class="hljs-meta">.148</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48402</span>: Flags [F.], seq <span class="hljs-number">65</span>, ack <span class="hljs-number">37</span>, win <span class="hljs-number">118</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">77434740</span> ecr <span class="hljs-number">214282239</span>], length <span class="hljs-number">0</span>
</code></pre>
<p>When utilizing the <code>-e</code> switch, we are tasking tcpdump to include the ethernet headers in the capture&#39;s output along with its regular content. We can see this worked by examining the output. Usually, the first and second fields consist of the Timestamp and then the IP header&#39;s beginning. Now it consists of Timestamp and the source MAC Address of the host.</p>
<p><strong>Display the Ethernet Header</strong></p>
<p>Tcpdump Fundamentals</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -i eth0 -e

tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length <span class="hljs-number">262144</span> bytes
<span class="hljs-number">11</span>:<span class="hljs-number">05:45.982115</span> <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29:97:52:65</span> (oui Unknown) &gt; <span class="hljs-number">8</span>a:<span class="hljs-number">66</span>:<span class="hljs-number">5</span>a:<span class="hljs-number">11</span>:<span class="hljs-number">8d</span>:<span class="hljs-number">64</span> (oui Unknown), ethertype IPv4 (<span class="hljs-number">0</span>x0800), length <span class="hljs-number">103</span>: <span class="hljs-number">172.16.146.2</span>.<span class="hljs-number">57142</span> &gt; ec<span class="hljs-number">2-99-80-22</span>-<span class="hljs-number">207</span>.eu-west-<span class="hljs-number">1</span>.compute.amazonaws.com.https: Flags [P.], seq <span class="hljs-number">922951468</span>:<span class="hljs-number">922951505</span>, ack <span class="hljs-number">1842875143</span>, win <span class="hljs-number">501</span>, options [nop,nop,TS val <span class="hljs-number">1368272062</span> ecr <span class="hljs-number">65637925</span>], length <span class="hljs-number">37</span>
<span class="hljs-number">11</span>:<span class="hljs-number">05</span>:<span class="hljs-number">45.989652</span> <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29:97:52:65</span> (oui Unknown) &gt; <span class="hljs-number">8</span>a:<span class="hljs-number">66</span>:<span class="hljs-number">5</span>a:<span class="hljs-number">11</span>:<span class="hljs-number">8d</span>:<span class="hljs-number">64</span> (oui Unknown), ethertype IPv4 (<span class="hljs-number">0</span>x0800), length <span class="hljs-number">129</span>: <span class="hljs-number">172.16.146.2</span>.<span class="hljs-number">55272</span> &gt; <span class="hljs-number">172.67.1.1</span>.https: Flags [P.], seq <span class="hljs-number">940656124</span>:<span class="hljs-number">940656199</span>, ack <span class="hljs-number">4248413119</span>, win <span class="hljs-number">501</span>, length <span class="hljs-number">75</span>
<span class="hljs-number">11</span>:<span class="hljs-number">05</span>:<span class="hljs-number">46.047731</span> <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29:97:52:65</span> (oui Unknown) &gt; <span class="hljs-number">8</span>a:<span class="hljs-number">66</span>:<span class="hljs-number">5</span>a:<span class="hljs-number">11</span>:<span class="hljs-number">8d</span>:<span class="hljs-number">64</span> (oui Unknown), ethertype IPv4 (<span class="hljs-number">0</span>x0800), length <span class="hljs-number">85</span>: <span class="hljs-number">172.16.146.2</span>.<span class="hljs-number">54006</span> &gt; <span class="hljs-number">172.16.146.1</span>.domain: <span class="hljs-number">31772</span>+ <span class="hljs-keyword">PTR</span>? <span class="hljs-number">207.22.80.99</span>.in-addr.arpa. (<span class="hljs-number">43</span>)
<span class="hljs-number">11</span>:<span class="hljs-number">05:46.049134</span> <span class="hljs-number">8</span>a:<span class="hljs-number">66</span>:<span class="hljs-number">5</span>a:<span class="hljs-number">11</span>:<span class="hljs-number">8d</span>:<span class="hljs-number">64</span> (oui Unknown) &gt; <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29:97:52:65</span> (oui Unknown), ethertype IPv4 (<span class="hljs-number">0</span>x0800), length <span class="hljs-number">147</span>: <span class="hljs-number">172.16.146.1</span>.domain &gt; <span class="hljs-number">172.16.146.2</span>.<span class="hljs-number">54006</span>: <span class="hljs-number">31772 1/0</span>/<span class="hljs-number">0</span> <span class="hljs-keyword">PTR</span> ec<span class="hljs-number">2-99-80-22</span>-<span class="hljs-number">207</span>.eu-west-<span class="hljs-number">1</span>.compute.amazonaws.com. (<span class="hljs-number">105</span>)
</code></pre>
<p>By issuing the <code>-X</code> switch, we can see the packet a bit clearer now. We get an ASCII output on the right to interpret anything in clear text that corresponds to the hexadecimal output on the left.</p>
<p><strong>Include ASCII and Hex Output</strong></p>
<p>Tcpdump Fundamentals</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -i eth0 -X

tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length <span class="hljs-number">262144</span> bytes
<span class="hljs-number">11</span>:<span class="hljs-number">10</span>:<span class="hljs-number">34.972248</span> IP <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span><span class="hljs-number">.57170</span> &gt; ec2<span class="hljs-number">-99</span><span class="hljs-number">-80</span><span class="hljs-number">-22</span><span class="hljs-number">-207.</span>eu-west<span class="hljs-number">-1.</span>compute.amazonaws.com.https: Flags [P.], seq <span class="hljs-number">2612172989</span>:<span class="hljs-number">2612173026</span>, ack <span class="hljs-number">3165195759</span>, win <span class="hljs-number">501</span>, options [nop,nop,TS val <span class="hljs-number">1368561052</span> ecr <span class="hljs-number">65712142</span>], length <span class="hljs-number">37</span>
    <span class="hljs-number">0x0000</span>:  <span class="hljs-number">4500</span> <span class="hljs-number">0059</span> <span class="hljs-number">4352</span> <span class="hljs-number">4000</span> <span class="hljs-number">4006</span> <span class="hljs-number">3</span>f1b ac10 <span class="hljs-number">9202</span>  E..YCR@.@.?.....
    <span class="hljs-number">0x0010</span>:  <span class="hljs-number">6350</span> <span class="hljs-number">16</span>cf df52 <span class="hljs-number">01</span>bb <span class="hljs-number">9</span>bb2 <span class="hljs-number">98</span>bd bca9 <span class="hljs-number">0</span>def  cP...R..........
    <span class="hljs-number">0x0020</span>:  <span class="hljs-number">8018</span> <span class="hljs-number">01</span>f5 b87d <span class="hljs-number">0000</span> <span class="hljs-number">0101</span> <span class="hljs-number">080</span>a <span class="hljs-number">5192</span> <span class="hljs-number">959</span>c  .....}......Q...
    <span class="hljs-number">0x0030</span>:  <span class="hljs-number">03</span>ea b00e <span class="hljs-number">1703</span> <span class="hljs-number">0300</span> <span class="hljs-number">2000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span>  ................
    <span class="hljs-number">0x0040</span>:  <span class="hljs-number">0</span>adb <span class="hljs-number">84</span>ac <span class="hljs-number">34</span>b4 <span class="hljs-number">910</span>a <span class="hljs-number">0</span>fb4 <span class="hljs-number">2</span>f49 <span class="hljs-number">9865</span> eb45  ....<span class="hljs-number">4.</span>..../I.e.E
    <span class="hljs-number">0x0050</span>:  <span class="hljs-number">883</span>c eafd <span class="hljs-number">8266</span> <span class="hljs-number">3e23</span> <span class="hljs-number">88</span>                   .&lt;...f&gt;#.
<span class="hljs-number">11</span>:<span class="hljs-number">10</span>:<span class="hljs-number">34.984582</span> IP <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span><span class="hljs-number">.38732</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.1</span>.domain: <span class="hljs-number">22938</span>+ A? app.hackthebox.eu. (<span class="hljs-number">35</span>)
    <span class="hljs-number">0x0000</span>:  <span class="hljs-number">4500</span> <span class="hljs-number">003</span>f <span class="hljs-number">2e6</span>b <span class="hljs-number">4000</span> <span class="hljs-number">4011</span> <span class="hljs-number">901</span>e ac10 <span class="hljs-number">9202</span>  E..?.k@.@.......
    <span class="hljs-number">0x0010</span>:  ac10 <span class="hljs-number">9201</span> <span class="hljs-number">974</span>c <span class="hljs-number">0035</span> <span class="hljs-number">002</span>b <span class="hljs-number">7</span>c61 <span class="hljs-number">599</span>a <span class="hljs-number">0100</span>  .....L<span class="hljs-number">.5</span>.+|aY...
    <span class="hljs-number">0x0020</span>:  <span class="hljs-number">0001</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0361</span> <span class="hljs-number">7070</span> <span class="hljs-number">0</span>a68 <span class="hljs-number">6163</span>  .........app.hac
    <span class="hljs-number">0x0030</span>:  <span class="hljs-number">6</span>b74 <span class="hljs-number">6865</span> <span class="hljs-number">626</span>f <span class="hljs-number">7802</span> <span class="hljs-number">6575</span> <span class="hljs-number">0000</span> <span class="hljs-number">0100</span> <span class="hljs-number">01</span>    kthebox.eu.....
<span class="hljs-number">11</span>:<span class="hljs-number">10</span>:<span class="hljs-number">35.055497</span> IP <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span><span class="hljs-number">.43116</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.1</span>.domain: <span class="hljs-number">6524</span>+ PTR? <span class="hljs-number">207.22</span><span class="hljs-number">.80</span><span class="hljs-number">.99</span>.<span class="hljs-keyword">in</span>-addr.arpa. (<span class="hljs-number">43</span>)
    <span class="hljs-number">0x0000</span>:  <span class="hljs-number">4500</span> <span class="hljs-number">0047</span> <span class="hljs-number">2e72</span> <span class="hljs-number">4000</span> <span class="hljs-number">4011</span> <span class="hljs-number">900</span>f ac10 <span class="hljs-number">9202</span>  E..G.r@.@.......
    <span class="hljs-number">0x0010</span>:  ac10 <span class="hljs-number">9201</span> a86c <span class="hljs-number">0035</span> <span class="hljs-number">0033</span> <span class="hljs-number">7</span>c69 <span class="hljs-number">197</span>c <span class="hljs-number">0100</span>  .....l<span class="hljs-number">.5</span><span class="hljs-number">.3</span>|i.|..
    <span class="hljs-number">0x0020</span>:  <span class="hljs-number">0001</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0332</span> <span class="hljs-number">3037</span> <span class="hljs-number">0232</span> <span class="hljs-number">3202</span>  ........<span class="hljs-number">.207</span><span class="hljs-number">.22</span>.
    <span class="hljs-number">0x0030</span>:  <span class="hljs-number">3830</span> <span class="hljs-number">0239</span> <span class="hljs-number">3907</span> <span class="hljs-number">696</span>e <span class="hljs-number">2</span>d61 <span class="hljs-number">6464</span> <span class="hljs-number">7204</span> <span class="hljs-number">6172</span>  <span class="hljs-number">80.99</span>.<span class="hljs-keyword">in</span>-addr.ar
    <span class="hljs-number">0x0040</span>:  <span class="hljs-number">7061</span> <span class="hljs-number">0000</span> <span class="hljs-number">0</span>c00 <span class="hljs-number">01</span>                        pa.....
</code></pre>
<p>Pay attention to the level of detail in the output above. We will notice that we have information on the IP header options like time to live, offset, and other flags and more details into the upper layer protocols. Below, we are combining the switches to craft the output to our liking.</p>
<p><strong>Tcpdump Switch Combinations</strong></p>
<p>Tcpdump Fundamentals</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -i eth0 -nnvXX

tcpdump: listening on eth0, link-type EN10MB (Ethernet), snapshot length <span class="hljs-number">262144</span> bytes
<span class="hljs-number">11</span>:<span class="hljs-number">13:59.149599</span> IP (tos <span class="hljs-number">0</span>x0, ttl <span class="hljs-number">64</span>, id <span class="hljs-number">24075</span>, offset <span class="hljs-number">0</span>, flags [DF], proto TCP (<span class="hljs-number">6</span>), length <span class="hljs-number">89</span>)
    <span class="hljs-number">172.16.146.2</span>.<span class="hljs-number">42454</span> &gt; <span class="hljs-number">54.77.251.34</span>.<span class="hljs-number">443</span>: Flags [P.], cksum <span class="hljs-number">0</span>x6fce (incorrect -&gt; <span class="hljs-number">0</span>xb042), seq <span class="hljs-number">671020720</span>:<span class="hljs-number">671020757</span>, ack <span class="hljs-number">3699222968</span>, win <span class="hljs-number">501</span>, options [nop,nop,TS val <span class="hljs-number">1154433101</span> ecr <span class="hljs-number">1116647414</span>], length <span class="hljs-number">37</span>
    <span class="hljs-number">0</span>x0000:  <span class="hljs-number">8a66 5a11</span> <span class="hljs-number">8d</span>64 <span class="hljs-number">000</span>c <span class="hljs-number">2997 5265</span> <span class="hljs-number">0800 4500</span>  .fZ..d..).Re..E.
    <span class="hljs-number">0</span>x0010:  <span class="hljs-number">0059</span> <span class="hljs-number">5</span>e0b <span class="hljs-number">4000 4006</span> <span class="hljs-number">6d</span>11 ac10 <span class="hljs-number">9202</span> <span class="hljs-number">364d</span>  .Y^.@.@.m.....<span class="hljs-number">6</span>M
    <span class="hljs-number">0</span>x0020:  fb22 a5d6 <span class="hljs-number">01</span>bb <span class="hljs-number">27</span>fe f6b0 dc7d a<span class="hljs-number">9b8 8018</span>  ."....'....}....
    <span class="hljs-number">0</span>x0030:  <span class="hljs-number">01</span>f5 <span class="hljs-number">6</span>fce <span class="hljs-number">0000 0101</span> <span class="hljs-number">080</span>a <span class="hljs-number">44</span>cf <span class="hljs-number">404d</span> <span class="hljs-number">428</span>e  ..o.......D.@MB.
    <span class="hljs-number">0</span>x0040:  aff6 <span class="hljs-number">1703 0300</span> <span class="hljs-number">2000 0000</span> <span class="hljs-number">0000 0000</span> <span class="hljs-number">09</span>bb  ................
    <span class="hljs-number">0</span>x0050:  <span class="hljs-number">38d</span>9 d89a <span class="hljs-number">2d70 73d5</span> a01e <span class="hljs-number">9d</span>f7 <span class="hljs-number">2</span>c48 <span class="hljs-number">5</span>b8a  <span class="hljs-number">8</span>...-ps.....,H[.
    <span class="hljs-number">0</span>x0060:  d64d <span class="hljs-number">8</span>e42 <span class="hljs-number">2</span>ccc <span class="hljs-number">43</span>                        .M.B,.C
<span class="hljs-number">11</span>:<span class="hljs-number">13:59.157113</span> IP (tos <span class="hljs-number">0</span>x0, ttl <span class="hljs-number">64</span>, id <span class="hljs-number">31823</span>, offset <span class="hljs-number">0</span>, flags [DF], proto UDP (<span class="hljs-number">17</span>), length <span class="hljs-number">63</span>)
    <span class="hljs-number">172.16.146.2</span>.<span class="hljs-number">55351</span> &gt; <span class="hljs-number">172.16.146.1</span>.<span class="hljs-number">53</span>: <span class="hljs-number">26460</span>+ <span class="hljs-keyword">A</span>? app.hackthebox.eu. (<span class="hljs-number">35</span>)
    <span class="hljs-number">0</span>x0000:  <span class="hljs-number">8a66 5a11</span> <span class="hljs-number">8d</span>64 <span class="hljs-number">000</span>c <span class="hljs-number">2997 5265</span> <span class="hljs-number">0800 4500</span>  .fZ..d..).Re..E.
    <span class="hljs-number">0</span>x0010:  <span class="hljs-number">003</span>f <span class="hljs-number">7</span>c4f <span class="hljs-number">4000 4011</span> <span class="hljs-number">423</span>a ac10 <span class="hljs-number">9202</span> ac10  .?|O@.@.B:......
    <span class="hljs-number">0</span>x0020:  <span class="hljs-number">9201</span> d<span class="hljs-number">837 0035</span> <span class="hljs-number">002</span>b <span class="hljs-number">7</span>c61 <span class="hljs-number">675</span>c <span class="hljs-number">0100 0001</span>  ...<span class="hljs-number">7</span>.<span class="hljs-number">5</span>.+|ag\....
    <span class="hljs-number">0</span>x0030:  <span class="hljs-number">0000 0000</span> <span class="hljs-number">0000 0361</span> <span class="hljs-number">7070 0a68</span> <span class="hljs-number">6163 6b74</span>  .......app.hackt
    <span class="hljs-number">0</span>x0040:  <span class="hljs-number">6865</span> <span class="hljs-number">626</span>f <span class="hljs-number">7802 6575</span> <span class="hljs-number">0000 0100</span> <span class="hljs-number">01</span>         hebox.eu.....
<span class="hljs-number">11</span>:<span class="hljs-number">13:59.158029</span> IP (tos <span class="hljs-number">0</span>x0, ttl <span class="hljs-number">64</span>, id <span class="hljs-number">20784</span>, offset <span class="hljs-number">0</span>, flags [none], proto UDP (<span class="hljs-number">17</span>), length <span class="hljs-number">111</span>)
    <span class="hljs-number">172.16.146.1</span>.<span class="hljs-number">53</span> &gt; <span class="hljs-number">172.16.146.2</span>.<span class="hljs-number">55351</span>: <span class="hljs-number">26460 3/0</span>/<span class="hljs-number">0</span> app.hackthebox.eu. <span class="hljs-keyword">A</span> <span class="hljs-number">104.20.55.68</span>, app.hackthebox.eu. <span class="hljs-keyword">A</span> <span class="hljs-number">172.67.1.1</span>, app.hackthebox.eu. <span class="hljs-keyword">A</span> <span class="hljs-number">104.20.66.68</span> (<span class="hljs-number">83</span>)
    <span class="hljs-number">0</span>x0000:  <span class="hljs-number">000</span>c <span class="hljs-number">2997 5265</span> <span class="hljs-number">8a66 5a11</span> <span class="hljs-number">8d64 0800</span> <span class="hljs-number">4500</span>  ..).Re.fZ..d..E.
    <span class="hljs-number">0</span>x0010:  <span class="hljs-number">006</span>f <span class="hljs-number">5130 0000</span> <span class="hljs-number">4011</span> ad29 ac10 <span class="hljs-number">9201</span> ac10  .oQ0..@..)......
    <span class="hljs-number">0</span>x0020:  <span class="hljs-number">9202 0035</span> d837 <span class="hljs-number">005</span>b <span class="hljs-number">9d</span>2e <span class="hljs-number">675</span>c <span class="hljs-number">8180 0001</span>  ...<span class="hljs-number">5</span>.<span class="hljs-number">7</span>.[..g\....
    <span class="hljs-number">0</span>x0030:  <span class="hljs-number">0003 0000</span> <span class="hljs-number">0000 0361</span> <span class="hljs-number">7070 0a68</span> <span class="hljs-number">6163 6b74</span>  .......app.hackt
    <span class="hljs-number">0</span>x0040:  <span class="hljs-number">6865</span> <span class="hljs-number">626</span>f <span class="hljs-number">7802 6575</span> <span class="hljs-number">0000 0100</span> <span class="hljs-number">01c0 0c00</span>  hebox.eu........
    <span class="hljs-number">0</span>x0050:  <span class="hljs-number">0100 0100</span> <span class="hljs-number">0000</span> ab00 <span class="hljs-number">0468 1437</span> <span class="hljs-number">44c0 0c00</span>  .........h.<span class="hljs-number">7</span>D...
    <span class="hljs-number">0</span>x0060:  <span class="hljs-number">0100 0100</span> <span class="hljs-number">0000</span> ab00 <span class="hljs-number">04</span>ac <span class="hljs-number">4301 01c0</span> <span class="hljs-number">0</span>c00  ..........C.....
    <span class="hljs-number">0</span>x0070:  <span class="hljs-number">0100 0100</span> <span class="hljs-number">0000</span> ab00 <span class="hljs-number">0468 1442</span> <span class="hljs-number">44</span>         .........h.BD
<span class="hljs-number">11</span>:<span class="hljs-number">13:59.158335</span> IP (tos <span class="hljs-number">0</span>x0, ttl <span class="hljs-number">64</span>, id <span class="hljs-number">20242</span>, offset <span class="hljs-number">0</span>, flags [DF], proto TCP (<span class="hljs-number">6</span>), length <span class="hljs-number">60</span>)
    <span class="hljs-number">172.16.146.2</span>.<span class="hljs-number">55416</span> &gt; <span class="hljs-number">172.67.1.1</span>.<span class="hljs-number">443</span>: Flags [S], cksum <span class="hljs-number">0</span>xeb85 (incorrect -&gt; <span class="hljs-number">0</span>x72f7), seq <span class="hljs-number">3766489491</span>, win <span class="hljs-number">64240</span>, options [mss <span class="hljs-number">1460</span>,sackOK,TS val <span class="hljs-number">508232750</span> ecr <span class="hljs-number">0</span>,nop,wscale <span class="hljs-number">7</span>], length <span class="hljs-number">0</span>
    <span class="hljs-number">0</span>x0000:  <span class="hljs-number">8a66 5a11</span> <span class="hljs-number">8d</span>64 <span class="hljs-number">000</span>c <span class="hljs-number">2997 5265</span> <span class="hljs-number">0800 4500</span>  .fZ..d..).Re..E.
    <span class="hljs-number">0</span>x0010:  <span class="hljs-number">003</span>c <span class="hljs-number">4f12 4000</span> <span class="hljs-number">4006 0053</span> ac10 <span class="hljs-number">9202</span> ac43  .&lt;O.@.@..S.....C
    <span class="hljs-number">0</span>x0020:  <span class="hljs-number">0101</span> d878 <span class="hljs-number">01</span>bb e<span class="hljs-number">080 1193</span> <span class="hljs-number">0000 0000</span> a002  ...x............
    <span class="hljs-number">0</span>x0030:  faf0 eb85 <span class="hljs-number">0000 0204</span> <span class="hljs-number">05b4 0402</span> <span class="hljs-number">080</span>a <span class="hljs-number">1</span>e4b  ...............K
    <span class="hljs-number">0</span>x0040:  <span class="hljs-number">042</span>e <span class="hljs-number">0000 0000</span> <span class="hljs-number">0103 0307</span>                 ..........
</code></pre>
<p>When utilizing the switches, chaining them together as in the example <code>above</code> is best practice.</p>
<hr>
<h3 id="tcpdump-output">Tcpdump Output</h3>
<p>When looking at the output from TCPDump, it can be a bit overwhelming. Running through these basic switches has already shown us several different views. We are going to take a minute to dissect that output and explain what we are seeing. The image and table below will define each field. Keep in mind that the more verbose we are with our filters, the more detail from each header is shown.</p>
<p><strong>Tcpdump Shell Breakdown</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/breakdown.png" alt="image"></p>
<table>
<thead>
<tr>
<th><strong>Filter</strong></th>
<th><strong>Result</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Timestamp</td>
<td><code>Yellow</code> The timestamp field comes first and is configurable to show the time and date in a format we can ingest easily.</td>
</tr>
<tr>
<td>Protocol</td>
<td><code>Orange</code> This section will tell us what the upper-layer header is. In our example, it shows IP.</td>
</tr>
<tr>
<td>Source &amp; Destination IP.Port</td>
<td><code>Orange</code> This will show us the source and destination of the packet along with the port number used to connect. Format == <code>IP.port == 172.16.146.2.21</code></td>
</tr>
<tr>
<td>Flags</td>
<td><code>Green</code> This portion shows any flags utilized.</td>
</tr>
<tr>
<td>Sequence and Acknowledgement Numbers</td>
<td><code>Red</code> This section shows the sequence and acknowledgment numbers used to track the TCP segment. Our example is utilizing low numbers to assume that relative sequence and ack numbers are being displayed.</td>
</tr>
<tr>
<td>Protocol Options</td>
<td><code>Blue</code> Here, we will see any negotiated TCP values established between the client and server, such as window size, selective acknowledgments, window scale factors, and more.</td>
</tr>
<tr>
<td>Notes / Next Header</td>
<td><code>White</code> Misc notes the dissector found will be present here. As the traffic we are looking at is encapsulated, we may see more header information for different protocols. In our example, we can see the TCPDump dissector recognizes FTP traffic within the encapsulation to display it for us.</td>
</tr>
</tbody>
</table>
<p>There are many other options and information that can be shown. This information varies based on the amount of verbosity that is enabled. For a more detailed understanding of IP and other protocol headers, check out the <code>Networking Primer</code> in section two or the <code>Networking fundamentals</code> path.</p>
<p>There is a great advantage in knowing how a network functions and how to use the filters that TCPDump provides. With them, we can view the network traffic, parse it for any issues, and identify suspicious network interactions quickly. Theoretically, we can use <code>tcpdump</code> to create an IDS/IPS system by having a Bash script analyze the intercepted packets according to a specific pattern. We can then set conditions to, for example, ban a particular IP address that has sent too many ICMP echo requests for a certain period.</p>
<hr>
<h3 id="file-input-output-with-tcpdump">File Input/Output with Tcpdump</h3>
<p>Using <code>-w</code> will write our capture to a file. Keep in mind that as we capture traffic off the wire, we can quickly use up open disk space and run into storage issues if we are not careful. The larger our network segment, the quicker we will use up storage. Utilizing the switches demonstrated above can help tune the amount of data stored in our PCAPs.</p>
<p><strong>Save our PCAP Output to a File</strong></p>
<p>Tcpdump Fundamentals</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -i eth0 -w ~/output.pcap

tcpdump: listening <span class="hljs-keyword">on</span> eth0, link-type EN10MB (Ethernet), snapshot <span class="hljs-built_in">length</span> <span class="hljs-number">262144</span> bytes
<span class="hljs-number">10</span> packets captured
<span class="hljs-number">131</span> packets received <span class="hljs-keyword">by</span> filter
<span class="hljs-number">0</span> packets dropped <span class="hljs-keyword">by</span> kernel
</code></pre>
<p>This capture above will generate the output to a file called <code>output.pcap</code>. When running tcpdump in this way, the output will not scroll our terminal as usual. All output from tcpdump is being redirected to the file we specified for the capture.</p>
<p><strong>Reading Output From a File</strong></p>
<p>Tcpdump Fundamentals</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -r ~/output.pcap

reading from file /home/trey/output.pcap, link-type EN10MB (Ethernet), snapshot length <span class="hljs-number">262144</span>
<span class="hljs-number">11</span>:<span class="hljs-number">15</span>:<span class="hljs-number">40.321509</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.57236</span> &gt; ec2-<span class="hljs-number">99</span>-<span class="hljs-number">80</span>-<span class="hljs-number">22</span>-<span class="hljs-number">207.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [P.], seq <span class="hljs-number">2751910362</span>:<span class="hljs-number">2751910399</span>, ack <span class="hljs-number">946558143</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">1368866401</span> ecr <span class="hljs-number">65790024</span>], length <span class="hljs-number">37</span>
<span class="hljs-number">11</span>:<span class="hljs-number">15</span>:<span class="hljs-number">40.337302</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55416</span> &gt; <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https: Flags [P.], seq <span class="hljs-number">3766493458</span>:<span class="hljs-number">3766493533</span>, ack <span class="hljs-number">4098207917</span>, win <span class="hljs-number">501</span>, length <span class="hljs-number">75</span>
<span class="hljs-number">11</span>:<span class="hljs-number">15</span>:<span class="hljs-number">40.398103</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55416</span>: Flags [.], ack <span class="hljs-number">75</span>, win <span class="hljs-number">73</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">11</span>:<span class="hljs-number">15</span>:<span class="hljs-number">40.457416</span> <span class="hljs-built_in">IP</span> ec2-<span class="hljs-number">99</span>-<span class="hljs-number">80</span>-<span class="hljs-number">22</span>-<span class="hljs-number">207.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.57236</span>: Flags [.], ack <span class="hljs-number">37</span>, win <span class="hljs-number">118</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">65799068</span> ecr <span class="hljs-number">1368866401</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">11</span>:<span class="hljs-number">15</span>:<span class="hljs-number">40.458582</span> <span class="hljs-built_in">IP</span> ec2-<span class="hljs-number">99</span>-<span class="hljs-number">80</span>-<span class="hljs-number">22</span>-<span class="hljs-number">207.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.57236</span>: Flags [P.], seq <span class="hljs-number">34</span>:<span class="hljs-number">65</span>, ack <span class="hljs-number">37</span>, win <span class="hljs-number">118</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">65799068</span> ecr <span class="hljs-number">1368866401</span>], length <span class="hljs-number">31</span>
<span class="hljs-number">11</span>:<span class="hljs-number">15</span>:<span class="hljs-number">40.458599</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.57236</span> &gt; ec2-<span class="hljs-number">99</span>-<span class="hljs-number">80</span>-<span class="hljs-number">22</span>-<span class="hljs-number">207.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [.], ack <span class="hljs-number">1</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">1368866538</span> ecr <span class="hljs-number">65799068</span>,<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,sack <span class="hljs-number">1</span> {<span class="hljs-number">34</span>:<span class="hljs-number">65</span>}], length <span class="hljs-number">0</span>
<span class="hljs-number">11</span>:<span class="hljs-number">15</span>:<span class="hljs-number">40.458643</span> <span class="hljs-built_in">IP</span> ec2-<span class="hljs-number">99</span>-<span class="hljs-number">80</span>-<span class="hljs-number">22</span>-<span class="hljs-number">207.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.57236</span>: Flags [P.], seq <span class="hljs-number">1</span>:<span class="hljs-number">34</span>, ack <span class="hljs-number">37</span>, win <span class="hljs-number">118</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">65799068</span> ecr <span class="hljs-number">1368866401</span>], length <span class="hljs-number">33</span>
<span class="hljs-number">11</span>:<span class="hljs-number">15</span>:<span class="hljs-number">40.458655</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.57236</span> &gt; ec2-<span class="hljs-number">99</span>-<span class="hljs-number">80</span>-<span class="hljs-number">22</span>-<span class="hljs-number">207.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [.], ack <span class="hljs-number">65</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">1368866538</span> ecr <span class="hljs-number">65799068</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">11</span>:<span class="hljs-number">15</span>:<span class="hljs-number">40.458915</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.57236</span> &gt; ec2-<span class="hljs-number">99</span>-<span class="hljs-number">80</span>-<span class="hljs-number">22</span>-<span class="hljs-number">207.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [P.], seq <span class="hljs-number">37</span>:<span class="hljs-number">68</span>, ack <span class="hljs-number">65</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">1368866539</span> ecr <span class="hljs-number">65799068</span>], length <span class="hljs-number">31</span>
<span class="hljs-number">11</span>:<span class="hljs-number">15</span>:<span class="hljs-number">40.458964</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.57236</span> &gt; ec2-<span class="hljs-number">99</span>-<span class="hljs-number">80</span>-<span class="hljs-number">22</span>-<span class="hljs-number">207.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [F.], seq <span class="hljs-number">68</span>, ack <span class="hljs-number">65</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">1368866539</span> ecr <span class="hljs-number">65799068</span>], length <span class="hljs-number">0</span>
</code></pre>
<p>This will read the capture stored in <code>output.pcap</code>. Notice it is back to a basic view. To get more detailed information out of the capture file, reapply our switches.</p>
<h2 id="tcpdump-packet-filtering">Tcpdump Packet Filtering</h2>
<hr>
<p>Tcpdump provides a robust and efficient way to parse the data included in our captures via packet filters. This section will examine those filters and get a glimpse at how it modifies the output from our capture.</p>
<hr>
<h3 id="filtering-and-advanced-syntax-options">Filtering and Advanced Syntax Options</h3>
<p>Utilizing more advanced filtering options like those listed below will enable us to trim down what traffic is printed to output or sent to file. By reducing the amount of info we capture and write to disk, we can help reduce the space needed to write the file and help the buffer process data quicker. Filters can be handy when paired with standard tcpdump syntax options. We can capture as widely as we wish, or be super specific only to capture packets from a particular host, or even with a particular bit in the TCP header set to on. It is highly recommended to explore the more advanced filters and find different combinations.</p>
<p>These filters and advanced operators are by no means an exhaustive list. They were chosen because they are the most frequently used and will get us up and running quickly. When implemented, these filters will inspect any packets captured and look for the given values in the protocol header to match.</p>
<p><strong>Helpful TCPDump Filters</strong></p>
<table>
<thead>
<tr>
<th><strong>Filter</strong></th>
<th><strong>Result</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>host</td>
<td><code>host</code> will filter visible traffic to show anything involving the designated host. Bi-directional</td>
</tr>
<tr>
<td>src / dest</td>
<td><code>src</code> and <code>dest</code> are modifiers. We can use them to designate a source or destination host or port.</td>
</tr>
<tr>
<td>net</td>
<td><code>net</code> will show us any traffic sourcing from or destined to the network designated. It uses / notation.</td>
</tr>
<tr>
<td>proto</td>
<td>will filter for a specific protocol type. (ether, TCP, UDP, and ICMP as examples)</td>
</tr>
<tr>
<td>port</td>
<td><code>port</code> is bi-directional. It will show any traffic with the specified port as the source or destination.</td>
</tr>
<tr>
<td>portrange</td>
<td><code>portrange</code> allows us to specify a range of ports. (0-1024)</td>
</tr>
<tr>
<td>less / greater &quot;&lt; &gt;&quot;</td>
<td><code>less</code> and <code>greater</code> can be used to look for a packet or protocol option of a specific size.</td>
</tr>
<tr>
<td>and / &amp;&amp;</td>
<td><code>and</code> <code>&amp;&amp;</code> can be used to concatenate two different filters together. for example, src host AND port.</td>
</tr>
<tr>
<td>or</td>
<td><code>or</code> allows for a match on either of two conditions. It does not have to meet both. It can be tricky.</td>
</tr>
<tr>
<td>not</td>
<td><code>not</code> is a modifier saying anything but x. For example, not UDP.</td>
</tr>
</tbody>
</table>
<p>With these filters, we can filter the network traffic on most properties to facilitate the analysis. Let us look at some examples of these filters and how they look when we use them. When using the <code>host</code> filter, whatever IP we input will be checked for in the source or destination IP field. This can be seen in the output below.</p>
<p><strong>Host Filter</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ ### Syntax: host [<span class="hljs-built_in">IP</span>]
root@htb[/htb]$ sudo tcpdump -i eth0 host <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>
<span class="hljs-symbol">
tcpdump:</span> verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length <span class="hljs-number">262144</span> bytes
<span class="hljs-number">14</span>:<span class="hljs-number">50</span>:<span class="hljs-number">53.072536</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48738</span> &gt; ec2-<span class="hljs-number">52</span>-<span class="hljs-number">31</span>-<span class="hljs-number">199</span>-<span class="hljs-number">148.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [P.], seq <span class="hljs-number">3400465007</span>:<span class="hljs-number">3400465044</span>, ack <span class="hljs-number">254421756</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">220968655</span> ecr <span class="hljs-number">80852594</span>], length <span class="hljs-number">37</span>
<span class="hljs-number">14</span>:<span class="hljs-number">50</span>:<span class="hljs-number">53.108740</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55606</span> &gt; <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https: Flags [P.], seq <span class="hljs-number">4227143181</span>:<span class="hljs-number">4227143273</span>, ack <span class="hljs-number">1980233980</span>, win <span class="hljs-number">21975</span>, length <span class="hljs-number">92</span>
<span class="hljs-number">14</span>:<span class="hljs-number">50</span>:<span class="hljs-number">53.173084</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55606</span>: Flags [.], ack <span class="hljs-number">92</span>, win <span class="hljs-number">69</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">14</span>:<span class="hljs-number">50</span>:<span class="hljs-number">53.175017</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.35744</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain: <span class="hljs-number">55991</span>+ <span class="hljs-built_in">PTR</span>? <span class="hljs-number">148.199</span><span class="hljs-meta">.31</span><span class="hljs-meta">.52</span>.in-addr.arpa. (<span class="hljs-number">44</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">50</span>:<span class="hljs-number">53.175714</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.35744</span>: <span class="hljs-number">55991</span> <span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span> <span class="hljs-built_in">PTR</span> ec2-<span class="hljs-number">52</span>-<span class="hljs-number">31</span>-<span class="hljs-number">199</span>-<span class="hljs-number">148.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com. (<span class="hljs-number">107</span>)
</code></pre>
<p>This filter is often used when we want to examine only a specific host or server. With this, we can identify with whom this host or server communicates and in which way. Based on our network configurations, we will understand if this connection is legitimate. If the communication seems strange, we can use other filters and options to view the content in more detail. Besides the individual hosts, we can also define the source host as well as the target host. We can also define entire networks and their ports.</p>
<p><strong>Source/Destination Filter</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ ### Syntax: src/dst [host|net|port] [<span class="hljs-built_in">IP</span>|Network Range|Port]
root@htb[/htb]$ sudo tcpdump -i eth0 src host <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>
<span class="hljs-symbol">
tcpdump:</span> verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length <span class="hljs-number">262144</span> bytes
<span class="hljs-number">14</span>:<span class="hljs-number">53</span>:<span class="hljs-number">36.199628</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48766</span> &gt; ec2-<span class="hljs-number">52</span>-<span class="hljs-number">31</span>-<span class="hljs-number">199</span>-<span class="hljs-number">148.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [P.], seq <span class="hljs-number">1428378231</span>:<span class="hljs-number">1428378268</span>, ack <span class="hljs-number">3778572066</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">221131782</span> ecr <span class="hljs-number">80889856</span>], length <span class="hljs-number">37</span>
<span class="hljs-number">14</span>:<span class="hljs-number">53</span>:<span class="hljs-number">36.203166</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55606</span> &gt; <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https: Flags [P.], seq <span class="hljs-number">4227144035</span>:<span class="hljs-number">4227144103</span>, ack <span class="hljs-number">1980235221</span>, win <span class="hljs-number">21975</span>, length <span class="hljs-number">68</span>
<span class="hljs-number">14</span>:<span class="hljs-number">53</span>:<span class="hljs-number">36.267059</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.36424</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain: <span class="hljs-number">40873</span>+ <span class="hljs-built_in">PTR</span>? <span class="hljs-number">148.199</span><span class="hljs-meta">.31</span><span class="hljs-meta">.52</span>.in-addr.arpa. (<span class="hljs-number">44</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">53</span>:<span class="hljs-number">36.267880</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.51151</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain: <span class="hljs-number">10032</span>+ <span class="hljs-built_in">PTR</span>? <span class="hljs-number">2.146</span><span class="hljs-meta">.16</span><span class="hljs-meta">.172</span>.in-addr.arpa. (<span class="hljs-number">43</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">53</span>:<span class="hljs-number">36.276425</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.46588</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain: <span class="hljs-number">28357</span>+ <span class="hljs-built_in">PTR</span>? <span class="hljs-number">1.1</span><span class="hljs-meta">.67</span><span class="hljs-meta">.172</span>.in-addr.arpa. (<span class="hljs-number">41</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">53</span>:<span class="hljs-number">36.337722</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48766</span> &gt; ec2-<span class="hljs-number">52</span>-<span class="hljs-number">31</span>-<span class="hljs-number">199</span>-<span class="hljs-number">148.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [.], ack <span class="hljs-number">34</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">221131920</span> ecr <span class="hljs-number">80899875</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">14</span>:<span class="hljs-number">53</span>:<span class="hljs-number">36.338841</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48766</span> &gt; ec2-<span class="hljs-number">52</span>-<span class="hljs-number">31</span>-<span class="hljs-number">199</span>-<span class="hljs-number">148.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [.], ack <span class="hljs-number">65</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">221131921</span> ecr <span class="hljs-number">80899875</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">14</span>:<span class="hljs-number">53</span>:<span class="hljs-number">36.339273</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48766</span> &gt; ec2-<span class="hljs-number">52</span>-<span class="hljs-number">31</span>-<span class="hljs-number">199</span>-<span class="hljs-number">148.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [P.], seq <span class="hljs-number">37</span>:<span class="hljs-number">68</span>, ack <span class="hljs-number">66</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">221131922</span> ecr <span class="hljs-number">80899875</span>], length <span class="hljs-number">31</span>
<span class="hljs-number">14</span>:<span class="hljs-number">53</span>:<span class="hljs-number">36.339334</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48766</span> &gt; ec2-<span class="hljs-number">52</span>-<span class="hljs-number">31</span>-<span class="hljs-number">199</span>-<span class="hljs-number">148.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [F.], seq <span class="hljs-number">68</span>, ack <span class="hljs-number">66</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">221131922</span> ecr <span class="hljs-number">80899875</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">14</span>:<span class="hljs-number">53</span>:<span class="hljs-number">36.370791</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.32972</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain: <span class="hljs-number">3856</span>+ <span class="hljs-built_in">PTR</span>? <span class="hljs-number">1.146</span><span class="hljs-meta">.16</span><span class="hljs-meta">.172</span>.in-addr.arpa. (<span class="hljs-number">43</span>)
</code></pre>
<p>Source and destination allow us to work with the directions of communication. For example, in the last output, we have specified that our <code>source</code> host is <code>172.16.146.2</code>, and only packets sent from this host will be intercepted. This can be done for ports, and network ranges as well. An example of this utilizing <code>src port #</code> would look something like this:</p>
<p><strong>Utilizing Source With Port as a Filter</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -<span class="hljs-selector-tag">i</span> eth0 tcp src port <span class="hljs-number">80</span>

<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">08.222534</span> IP <span class="hljs-number">65.208</span>.<span class="hljs-number">228.223</span><span class="hljs-selector-class">.http</span> &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237</span><span class="hljs-selector-class">.pools</span><span class="hljs-selector-class">.arcor-ip</span><span class="hljs-selector-class">.net</span>.<span class="hljs-number">3372</span>: Flags [S.], seq <span class="hljs-number">290218379</span>, ack <span class="hljs-number">951057940</span>, win <span class="hljs-number">5840</span>, options [mss <span class="hljs-number">1380</span>,nop,nop,sackOK], length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">08.783340</span> IP <span class="hljs-number">65.208</span>.<span class="hljs-number">228.223</span><span class="hljs-selector-class">.http</span> &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237</span><span class="hljs-selector-class">.pools</span><span class="hljs-selector-class">.arcor-ip</span><span class="hljs-selector-class">.net</span>.<span class="hljs-number">3372</span>: Flags [.], ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">08.993643</span> IP <span class="hljs-number">65.208</span>.<span class="hljs-number">228.223</span><span class="hljs-selector-class">.http</span> &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237</span><span class="hljs-selector-class">.pools</span><span class="hljs-selector-class">.arcor-ip</span><span class="hljs-selector-class">.net</span>.<span class="hljs-number">3372</span>: Flags [.], seq <span class="hljs-number">1</span>:<span class="hljs-number">1381</span>, ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">1380</span>: HTTP: HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.123830</span> IP <span class="hljs-number">65.208</span>.<span class="hljs-number">228.223</span><span class="hljs-selector-class">.http</span> &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237</span><span class="hljs-selector-class">.pools</span><span class="hljs-selector-class">.arcor-ip</span><span class="hljs-selector-class">.net</span>.<span class="hljs-number">3372</span>: Flags [.], seq <span class="hljs-number">1381</span>:<span class="hljs-number">2761</span>, ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">1380</span>: HTTP
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.754737</span> IP <span class="hljs-number">65.208</span>.<span class="hljs-number">228.223</span><span class="hljs-selector-class">.http</span> &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237</span><span class="hljs-selector-class">.pools</span><span class="hljs-selector-class">.arcor-ip</span><span class="hljs-selector-class">.net</span>.<span class="hljs-number">3372</span>: Flags [.], seq <span class="hljs-number">2761</span>:<span class="hljs-number">4141</span>, ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">1380</span>: HTTP
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.864896</span> IP <span class="hljs-number">65.208</span>.<span class="hljs-number">228.223</span><span class="hljs-selector-class">.http</span> &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237</span><span class="hljs-selector-class">.pools</span><span class="hljs-selector-class">.arcor-ip</span><span class="hljs-selector-class">.net</span>.<span class="hljs-number">3372</span>: Flags [P.], seq <span class="hljs-number">4141</span>:<span class="hljs-number">5521</span>, ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">1380</span>: HTTP
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.945011</span> IP <span class="hljs-number">65.208</span>.<span class="hljs-number">228.223</span><span class="hljs-selector-class">.http</span> &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237</span><span class="hljs-selector-class">.pools</span><span class="hljs-selector-class">.arcor-ip</span><span class="hljs-selector-class">.net</span>.<span class="hljs-number">3372</span>: Flags [.], seq <span class="hljs-number">5521</span>:<span class="hljs-number">6901</span>, ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">1380</span>: HTTP
</code></pre>
<p>Notice now that we only see one side of the conversation? This is because we are filtering on the source port of 80 (HTTP). Used in this manner, <code>net</code> will grab anything matching the <code>/</code> notation for a network. In the example, we are looking for anything destined for the <code>172.16.146.0/24</code> network.</p>
<p><strong>Using Destination in Combination with the Net Filter</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -i eth0 dest net <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.0</span>/<span class="hljs-number">24</span>
<span class="hljs-symbol">
tcpdump:</span> verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length <span class="hljs-number">262144</span> bytes
<span class="hljs-number">16</span>:<span class="hljs-number">33</span>:<span class="hljs-number">14.376003</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">64.233</span><span class="hljs-meta">.177</span><span class="hljs-meta">.103</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.36050</span>: Flags [.], ack <span class="hljs-number">1486880537</span>, win <span class="hljs-number">316</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">2311579424</span> ecr <span class="hljs-number">263866084</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">16</span>:<span class="hljs-number">33</span>:<span class="hljs-number">14.442123</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">64.233</span><span class="hljs-meta">.177</span><span class="hljs-meta">.103</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.36050</span>: Flags [P.], seq <span class="hljs-number">0</span>:<span class="hljs-number">385</span>, ack <span class="hljs-number">1</span>, win <span class="hljs-number">316</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">2311579493</span> ecr <span class="hljs-number">263866084</span>], length <span class="hljs-number">385</span>
<span class="hljs-number">16</span>:<span class="hljs-number">33</span>:<span class="hljs-number">14.442188</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">64.233</span><span class="hljs-meta">.177</span><span class="hljs-meta">.103</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.36050</span>: Flags [P.], seq <span class="hljs-number">385</span>:<span class="hljs-number">1803</span>, ack <span class="hljs-number">1</span>, win <span class="hljs-number">316</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">2311579493</span> ecr <span class="hljs-number">263866084</span>], length <span class="hljs-number">1418</span>
<span class="hljs-number">16</span>:<span class="hljs-number">33</span>:<span class="hljs-number">14.442223</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">64.233</span><span class="hljs-meta">.177</span><span class="hljs-meta">.103</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.36050</span>: Flags [.], seq <span class="hljs-number">1803</span>:<span class="hljs-number">4639</span>, ack <span class="hljs-number">1</span>, win <span class="hljs-number">316</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">2311579494</span> ecr <span class="hljs-number">263866084</span>], length <span class="hljs-number">2836</span>
<span class="hljs-number">16</span>:<span class="hljs-number">33</span>:<span class="hljs-number">14.443161</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">64.233</span><span class="hljs-meta">.177</span><span class="hljs-meta">.103</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.36050</span>: Flags [P.], seq <span class="hljs-number">4639</span>:<span class="hljs-number">5817</span>, ack <span class="hljs-number">1</span>, win <span class="hljs-number">316</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">2311579495</span> ecr <span class="hljs-number">263866084</span>], length <span class="hljs-number">1178</span>
<span class="hljs-number">16</span>:<span class="hljs-number">33</span>:<span class="hljs-number">14.443199</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">64.233</span><span class="hljs-meta">.177</span><span class="hljs-meta">.103</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.36050</span>: Flags [.], seq <span class="hljs-number">5817</span>:<span class="hljs-number">8653</span>, ack <span class="hljs-number">1</span>, win <span class="hljs-number">316</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">2311579495</span> ecr <span class="hljs-number">263866084</span>], length <span class="hljs-number">2836</span>
<span class="hljs-number">16</span>:<span class="hljs-number">33</span>:<span class="hljs-number">14.444407</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">64.233</span><span class="hljs-meta">.177</span><span class="hljs-meta">.103</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.36050</span>: Flags [.], seq <span class="hljs-number">8653</span>:<span class="hljs-number">10071</span>, ack <span class="hljs-number">1</span>, win <span class="hljs-number">316</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">2311579497</span> ecr <span class="hljs-number">263866084</span>], length <span class="hljs-number">1418</span>
<span class="hljs-number">16</span>:<span class="hljs-number">33</span>:<span class="hljs-number">14.445479</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">64.233</span><span class="hljs-meta">.177</span><span class="hljs-meta">.103</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.36050</span>: Flags [.], seq <span class="hljs-number">10071</span>:<span class="hljs-number">11489</span>, ack <span class="hljs-number">1</span>, win <span class="hljs-number">316</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">2311579497</span> ecr <span class="hljs-number">263866084</span>], length <span class="hljs-number">1418</span>
<span class="hljs-number">16</span>:<span class="hljs-number">33</span>:<span class="hljs-number">14.445531</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">64.233</span><span class="hljs-meta">.177</span><span class="hljs-meta">.103</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.36050</span>: Flags [.], seq <span class="hljs-number">11489</span>:<span class="hljs-number">12907</span>, ack <span class="hljs-number">1</span>, win <span class="hljs-number">316</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">2311579498</span> ecr <span class="hljs-number">263866084</span>], length <span class="hljs-number">1418</span>
<span class="hljs-number">16</span>:<span class="hljs-number">33</span>:<span class="hljs-number">14.446955</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">64.233</span><span class="hljs-meta">.177</span><span class="hljs-meta">.103</span><span class="hljs-meta">.443</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.36050</span>: Flags [.], seq <span class="hljs-number">12907</span>:<span class="hljs-number">14325</span>, ack <span class="hljs-number">1</span>, win <span class="hljs-number">316</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">2311579498</span> ecr <span class="hljs-number">263866084</span>], length <span class="hljs-number">1418</span>
</code></pre>
<p>This filter can utilize the common protocol name or protocol number for any IP, IPv6, or Ethernet protocol. Common examples would be <code>tcp[6], udp[17], or icmp[1]</code>. We can utilize both the common name <code>top</code> and the protocol number <code>bottom</code> in the outputs above. We can see it produced the same output. For the most part, these are interchangeable, but utilizing <code>proto</code> will become more useful when you are starting to dissect a specific part of the IP or other protocol headers. It will be more apparent later in this section when we talk about looking for TCP flags. We can take a look at this <a href="https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml">resource</a> for a helpful list covering protocol numbers.</p>
<p><strong>Protocol Filter</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ ### Syntax: [tcp/udp/icmp]
root@htb[/htb]$ sudo tcpdump -i eth0 udp

<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.864896</span> IP dialin-<span class="hljs-number">145-254-160-237</span>.pools.arcor-ip.net.<span class="hljs-number">3009</span> &gt; <span class="hljs-number">145.253.2.203</span>.domain: <span class="hljs-number">35</span>+ <span class="hljs-keyword">A</span>? pagead2.googlesyndication.com. (<span class="hljs-number">47</span>)
<span class="hljs-number">06</span>:<span class="hljs-number">17:10.225414</span> IP <span class="hljs-number">145.253.2.203</span>.domain &gt; dialin-<span class="hljs-number">145-254-160-237</span>.pools.arcor-ip.net.<span class="hljs-number">3009</span>: <span class="hljs-number">35 4/0/0</span> <span class="hljs-keyword">CNAME</span> pagead2.google.com., <span class="hljs-keyword">CNAME</span> pagead.google.akadns.net., <span class="hljs-keyword">A</span> <span class="hljs-number">216.239.59.104</span>, <span class="hljs-keyword">A</span> <span class="hljs-number">216.239.59.99</span> (<span class="hljs-number">146</span>)
</code></pre>
<p><strong>Protocol Number Filter</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ ### Syntax: proto [protocol number]
root@htb[/htb]$ sudo tcpdump -i eth0 proto <span class="hljs-number">17</span>

<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.864896</span> IP dialin-<span class="hljs-number">145-254-160-237</span>.pools.arcor-ip.net.<span class="hljs-number">3009</span> &gt; <span class="hljs-number">145.253.2.203</span>.domain: <span class="hljs-number">35</span>+ <span class="hljs-keyword">A</span>? pagead2.googlesyndication.com. (<span class="hljs-number">47</span>)
<span class="hljs-number">06</span>:<span class="hljs-number">17:10.225414</span> IP <span class="hljs-number">145.253.2.203</span>.domain &gt; dialin-<span class="hljs-number">145-254-160-237</span>.pools.arcor-ip.net.<span class="hljs-number">3009</span>: <span class="hljs-number">35 4/0/0</span> <span class="hljs-keyword">CNAME</span> pagead2.google.com., <span class="hljs-keyword">CNAME</span> pagead.google.akadns.net., <span class="hljs-keyword">A</span> <span class="hljs-number">216.239.59.104</span>, <span class="hljs-keyword">A</span> <span class="hljs-number">216.239.59.99</span> (<span class="hljs-number">146</span>)
</code></pre>
<p>Using the <code>port</code> filter, we should keep in mind what we are looking for and how that protocol functions. Some standard protocols like HTTP or HTTPS only use ports 80 and 443 with the transport protocol of TCP. With that in mind, picture ports as a simple way to establish connections and protocols like TCP and UDP to determine if they use an established method. Ports by themselves can be used for anything, so filtering on port 80 will show all traffic over that port number. However, if we are looking to capture all HTTP traffic, utilizing <code>tcp port 80</code> will ensure we only see HTTP traffic.</p>
<p>With protocols that use both TCP and UDP for different functions, such as DNS, we can filter looking at one or the other <code>TCP/UDP port 53</code> or filter for <code>port 53</code>. By doing this, we will see any traffic-utilizing that port, regardless of the transport protocol.</p>
<p><strong>Port Filter</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ ### Syntax: port [port number]
root@htb[/htb]$ sudo tcpdump -i eth0 tcp port <span class="hljs-number">443</span>

<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">07.311224</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [S], seq <span class="hljs-number">951057939</span>, win <span class="hljs-number">8760</span>, options [mss <span class="hljs-number">1460</span>,<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,sackOK], length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">08.222534</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span>: Flags [S.], seq <span class="hljs-number">290218379</span>, ack <span class="hljs-number">951057940</span>, win <span class="hljs-number">5840</span>, options [mss <span class="hljs-number">1380</span>,<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,sackOK], length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">08.222534</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">1</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">08.222534</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [P.], seq <span class="hljs-number">1</span>:<span class="hljs-number">480</span>, ack <span class="hljs-number">1</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">479</span>: HTTP: GET /download.html HTTP/<span class="hljs-number">1.1</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">08.783340</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span>: Flags [.], ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">08.993643</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span>: Flags [.], seq <span class="hljs-number">1</span>:<span class="hljs-number">1381</span>, ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">1380</span>: HTTP: HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.123830</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">1381</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.123830</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span>: Flags [.], seq <span class="hljs-number">1381</span>:<span class="hljs-number">2761</span>, ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">1380</span>: HTTP
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.324118</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">2761</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.754737</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span>: Flags [.], seq <span class="hljs-number">2761</span>:<span class="hljs-number">4141</span>, ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">1380</span>: HTTP
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.864896</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span>: Flags [P.], seq <span class="hljs-number">4141</span>:<span class="hljs-number">5521</span>, ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">1380</span>: HTTP
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.864896</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">5521</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.945011</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span>: Flags [.], seq <span class="hljs-number">5521</span>:<span class="hljs-number">6901</span>, ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">1380</span>: HTTP
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">10.125270</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">6901</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">10.205385</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span>: Flags [.], seq <span class="hljs-number">6901</span>:<span class="hljs-number">8281</span>, ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">1380</span>: HTTP
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">10.295515</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3371</span> &gt; <span class="hljs-number">216.239</span><span class="hljs-meta">.59</span><span class="hljs-meta">.99</span>.http: Flags [P.], seq <span class="hljs-number">918691368</span>:<span class="hljs-number">918692089</span>, ack <span class="hljs-number">778785668</span>, win <span class="hljs-number">8760</span>, length <span class="hljs-number">721</span>: HTTP: GET /pagead/ads?client=ca-pub-<span class="hljs-number">2309191948673629</span>&amp;random=<span class="hljs-number">1084443430285</span>&amp;lmt=<span class="hljs-number">1082467020</span>&amp;format=468x60_as&amp;output=html&amp;url=http<span class="hljs-subst">%3</span>A<span class="hljs-subst">%2</span>F<span class="hljs-subst">%2</span>Fwww.ethereal.com<span class="hljs-subst">%2</span>Fdownload.html&amp;color_bg=FFFFFF&amp;color_text=<span class="hljs-number">333333</span>&amp;color_link=<span class="hljs-number">000000</span>&amp;color_url=<span class="hljs-number">666633</span>&amp;color_border=<span class="hljs-number">666633</span> HTTP/<span class="hljs-number">1.1</span>
</code></pre>
<p>Apart from the individual ports, we can also define specific ranges of these ports, which are then listened to by TCPdump. Listening on a range of ports can be especially useful when we see network traffic from ports that do not match the services running on our servers. For example, if we have a web server with TCP ports 80 and 443 running in a particular segment of our network and suddenly have outgoing network traffic from TCP port 10000 or others, it is very suspicious.</p>
<p>The <code>portrange</code> filter, as seen below, allows us to see everything from within the port range. In the example, we see some DNS traffic along with some HTTP web requests.</p>
<p><strong>Port Range Filter</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ ### Syntax: portrange [portrange <span class="hljs-number">0</span>-<span class="hljs-number">65535</span>]
root@htb[/htb]$ sudo tcpdump -i eth0 portrange <span class="hljs-number">0</span>-<span class="hljs-number">1024</span>
<span class="hljs-symbol">
tcpdump:</span> verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length <span class="hljs-number">262144</span> bytes
<span class="hljs-number">13</span>:<span class="hljs-number">10</span>:<span class="hljs-number">35.092477</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.32824</span>: <span class="hljs-number">47775</span> <span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span> CNAME autopush.prod.mozaws.net. (<span class="hljs-number">81</span>)
<span class="hljs-number">13</span>:<span class="hljs-number">10</span>:<span class="hljs-number">35.093217</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48078</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain: <span class="hljs-number">30234</span>+ A? ocsp.pki.goog. (<span class="hljs-number">31</span>)
<span class="hljs-number">13</span>:<span class="hljs-number">10</span>:<span class="hljs-number">35.093334</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48078</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain: <span class="hljs-number">32024</span>+ AAAA? ocsp.pki.goog. (<span class="hljs-number">31</span>)
<span class="hljs-number">13</span>:<span class="hljs-number">10</span>:<span class="hljs-number">35.136255</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48078</span>: <span class="hljs-number">32024</span> <span class="hljs-number">2</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span> CNAME pki-goog.l.google.com., AAAA <span class="hljs-number">2607</span>:f8b0:<span class="hljs-number">4002</span>:c09::5e (<span class="hljs-number">94</span>)
<span class="hljs-number">13</span>:<span class="hljs-number">10</span>:<span class="hljs-number">35.137348</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.48078</span>: <span class="hljs-number">30234</span> <span class="hljs-number">2</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span> CNAME pki-goog.l.google.com., A <span class="hljs-number">172.217</span><span class="hljs-meta">.164</span><span class="hljs-meta">.67</span> (<span class="hljs-number">82</span>)
<span class="hljs-number">13</span>:<span class="hljs-number">10</span>:<span class="hljs-number">35.137989</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55074</span> &gt; atl26s18-<span class="hljs-keyword">in</span>-f3<span class="hljs-meta">.1e100</span>.net.http: Flags [S], seq <span class="hljs-number">1146136517</span>, win <span class="hljs-number">64240</span>, options [mss <span class="hljs-number">1460</span>,sackOK,TS val <span class="hljs-number">1337520268</span> ecr <span class="hljs-number">0</span>,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">7</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">13</span>:<span class="hljs-number">10</span>:<span class="hljs-number">35.174443</span> <span class="hljs-built_in">IP</span> atl26s18-<span class="hljs-keyword">in</span>-f3<span class="hljs-meta">.1e100</span>.net.http &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55074</span>: Flags [S.], seq <span class="hljs-number">345110814</span>, ack <span class="hljs-number">1146136518</span>, win <span class="hljs-number">65535</span>, options [mss <span class="hljs-number">1430</span>,sackOK,TS val <span class="hljs-number">1000152427</span> ecr <span class="hljs-number">1337520268</span>,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">8</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">13</span>:<span class="hljs-number">10</span>:<span class="hljs-number">35.174481</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55074</span> &gt; atl26s18-<span class="hljs-keyword">in</span>-f3<span class="hljs-meta">.1e100</span>.net.http: Flags [.], ack <span class="hljs-number">1</span>, win <span class="hljs-number">502</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">1337520304</span> ecr <span class="hljs-number">1000152427</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">13</span>:<span class="hljs-number">10</span>:<span class="hljs-number">35.174716</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55074</span> &gt; atl26s18-<span class="hljs-keyword">in</span>-f3<span class="hljs-meta">.1e100</span>.net.http: Flags [P.], seq <span class="hljs-number">1</span>:<span class="hljs-number">379</span>, ack <span class="hljs-number">1</span>, win <span class="hljs-number">502</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">1337520305</span> ecr <span class="hljs-number">1000152427</span>], length <span class="hljs-number">378</span>: HTTP: POST /gts1o1core HTTP/<span class="hljs-number">1.1</span>
<span class="hljs-number">13</span>:<span class="hljs-number">10</span>:<span class="hljs-number">35.208007</span> <span class="hljs-built_in">IP</span> atl26s18-<span class="hljs-keyword">in</span>-f3<span class="hljs-meta">.1e100</span>.net.http &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55074</span>: Flags [.], ack <span class="hljs-number">379</span>, win <span class="hljs-number">261</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">1000152462</span> ecr <span class="hljs-number">1337520305</span>], length <span class="hljs-number">0</span>
</code></pre>
<p>Next, we are looking for any packet less than 64 bytes. From the following output, we can see that for this capture, those packets mainly consisted of <code>SYN</code>, <code>FIN</code>, or <code>KeepAlive</code> packets. Less than and greater than can be a helpful modifier set. For example, let us say we are looking to capture traffic that includes a file transfer or set of files. We know these files will be larger than regular traffic. To demonstrate, we can utilize <code>greater 500</code> (alternatively <code>&#39;&gt;500&#39;</code>), which will only show us packets with a size larger than 500 bytes. This will strip out all the extra packets from the view we know we are not concerned with already.</p>
<p><strong>Less/Greater Filter</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ ### Syntax: less/greater [size <span class="hljs-keyword">in</span> bytes]
root@htb[/htb]$ sudo tcpdump -i eth0 less <span class="hljs-number">64</span>

<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">07.311224</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [S], seq <span class="hljs-number">951057939</span>, win <span class="hljs-number">8760</span>, options [mss <span class="hljs-number">1460</span>,<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,sackOK], length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">08.222534</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span>: Flags [S.], seq <span class="hljs-number">290218379</span>, ack <span class="hljs-number">951057940</span>, win <span class="hljs-number">5840</span>, options [mss <span class="hljs-number">1380</span>,<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,sackOK], length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">08.222534</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">1</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">08.783340</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span>: Flags [.], ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.123830</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">1381</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.324118</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">2761</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09.864896</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">5521</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">10.125270</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">6901</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">10.325558</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">8281</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">10.806249</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">11041</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">10.956465</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">216.239</span><span class="hljs-meta">.59</span><span class="hljs-meta">.99</span>.http &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3371</span>: Flags [.], ack <span class="hljs-number">918692089</span>, win <span class="hljs-number">31460</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">11.126710</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">12421</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">11.266912</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3371</span> &gt; <span class="hljs-number">216.239</span><span class="hljs-meta">.59</span><span class="hljs-meta">.99</span>.http: Flags [.], ack <span class="hljs-number">1590</span>, win <span class="hljs-number">8760</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">11.527286</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">13801</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">11.667488</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">16561</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">11.807689</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">17941</span>, win <span class="hljs-number">9660</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">12.088092</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3371</span> &gt; <span class="hljs-number">216.239</span><span class="hljs-meta">.59</span><span class="hljs-meta">.99</span>.http: Flags [.], ack <span class="hljs-number">1590</span>, win <span class="hljs-number">8760</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">12.328438</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">18365</span>, win <span class="hljs-number">9236</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">25.216971</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span>: Flags [F.], seq <span class="hljs-number">18365</span>, ack <span class="hljs-number">480</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">25.216971</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [.], ack <span class="hljs-number">18366</span>, win <span class="hljs-number">9236</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">37.374452</span> <span class="hljs-built_in">IP</span> dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span> &gt; <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http: Flags [F.], seq <span class="hljs-number">480</span>, ack <span class="hljs-number">18366</span>, win <span class="hljs-number">9236</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">37.704928</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">65.208</span><span class="hljs-meta">.228</span><span class="hljs-meta">.223</span>.http &gt; dialin-<span class="hljs-number">145</span>-<span class="hljs-number">254</span>-<span class="hljs-number">160</span>-<span class="hljs-number">237.</span>pools.arcor-<span class="hljs-built_in">ip</span>.net<span class="hljs-meta">.3372</span>: Flags [.], ack <span class="hljs-number">481</span>, win <span class="hljs-number">6432</span>, length <span class="hljs-number">0</span>
</code></pre>
<p>Above was an excellent example of using <code>less</code>. We can utilize the modifier <code>greater 500</code> to only show me packets with 500 or more bytes. It came back with a unique response in the ASCII. Can we tell what happened here?</p>
<p><strong>Utilizing Greater</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -i eth0 greater <span class="hljs-number">500</span>

<span class="hljs-number">21</span>:<span class="hljs-number">12</span>:<span class="hljs-number">43.548353</span> IP <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>.telnet &gt; <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span><span class="hljs-number">.1550</span>: Flags [P.], seq <span class="hljs-number">401695766</span>:<span class="hljs-number">401696254</span>, ack <span class="hljs-number">2579866052</span>, win <span class="hljs-number">17376</span>, options [nop,nop,TS val <span class="hljs-number">2467382</span> ecr <span class="hljs-number">10234152</span>], <span class="hljs-built_in">length</span> <span class="hljs-number">488</span>
E...;...@.................d.......C........
.%<span class="hljs-number">.6</span>..)(Warning: no Kerberos tickets issued.
OpenBSD <span class="hljs-number">2.6</span>-beta (OOF) <span class="hljs-comment">#4: Tue Oct 12 20:42:32 CDT 1999</span>

Welcome <span class="hljs-built_in">to</span> OpenBSD: The proactively secure Unix-like operating <span class="hljs-keyword">system</span>.

Please use <span class="hljs-keyword">the</span> sendbug(<span class="hljs-number">1</span>) utility <span class="hljs-built_in">to</span> report bugs <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> <span class="hljs-keyword">system</span>.
Before reporting <span class="hljs-keyword">a</span> bug, please <span class="hljs-keyword">try</span> <span class="hljs-built_in">to</span> reproduce <span class="hljs-keyword">it</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> latest
<span class="hljs-built_in">version</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> code.  With bug reports, please <span class="hljs-keyword">try</span> <span class="hljs-built_in">to</span> ensure that
enough information <span class="hljs-built_in">to</span> reproduce <span class="hljs-keyword">the</span> problem is enclosed, <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">a</span>
known fix <span class="hljs-keyword">for</span> <span class="hljs-keyword">it</span> exists, <span class="hljs-built_in">include</span> that <span class="hljs-keyword">as</span> well.
</code></pre>
<p><code>AND</code> as a modifier will show us anything that meets both requirements set. For example, <code>host 10.12.1.122 and tcp port 80</code> will look for anything from the source host and contain port 80 TCP or UDP traffic. Both criteria have to be met for the filter to capture the packet. We can see this in action above. Here we utilize <code>host 192.168.0.1 and port 23</code> as a filter. So we will see only traffic that is from this particular host that is only port 23 traffic.</p>
<p><strong>AND Filter</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ ### Syntax: <span class="hljs-keyword">and</span> [requirement]
root@htb[/htb]$ sudo tcpdump -i eth0 host <span class="hljs-number">192.168</span><span class="hljs-meta">.0</span><span class="hljs-meta">.1</span> <span class="hljs-keyword">and</span> port <span class="hljs-number">23</span>

<span class="hljs-number">21</span>:<span class="hljs-number">12</span>:<span class="hljs-number">38.387203</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">192.168</span><span class="hljs-meta">.0</span><span class="hljs-meta">.2</span><span class="hljs-meta">.1550</span> &gt; <span class="hljs-number">192.168</span><span class="hljs-meta">.0</span><span class="hljs-meta">.1</span>.telnet: Flags [S], seq <span class="hljs-number">2579865836</span>, win <span class="hljs-number">32120</span>, options [mss <span class="hljs-number">1460</span>,sackOK,TS val <span class="hljs-number">10233636</span> ecr <span class="hljs-number">0</span>,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">0</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">21</span>:<span class="hljs-number">12</span>:<span class="hljs-number">38.389728</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">192.168</span><span class="hljs-meta">.0</span><span class="hljs-meta">.1</span>.telnet &gt; <span class="hljs-number">192.168</span><span class="hljs-meta">.0</span><span class="hljs-meta">.2</span><span class="hljs-meta">.1550</span>: Flags [S.], seq <span class="hljs-number">401695549</span>, ack <span class="hljs-number">2579865837</span>, win <span class="hljs-number">17376</span>, options [mss <span class="hljs-number">1448</span>,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">0</span>,<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">2467372</span> ecr <span class="hljs-number">10233636</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">21</span>:<span class="hljs-number">12</span>:<span class="hljs-number">38.389775</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">192.168</span><span class="hljs-meta">.0</span><span class="hljs-meta">.2</span><span class="hljs-meta">.1550</span> &gt; <span class="hljs-number">192.168</span><span class="hljs-meta">.0</span><span class="hljs-meta">.1</span>.telnet: Flags [.], ack <span class="hljs-number">1</span>, win <span class="hljs-number">32120</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">10233636</span> ecr <span class="hljs-number">2467372</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">21</span>:<span class="hljs-number">12</span>:<span class="hljs-number">38.391363</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">192.168</span><span class="hljs-meta">.0</span><span class="hljs-meta">.2</span><span class="hljs-meta">.1550</span> &gt; <span class="hljs-number">192.168</span><span class="hljs-meta">.0</span><span class="hljs-meta">.1</span>.telnet: Flags [P.], seq <span class="hljs-number">1</span>:<span class="hljs-number">28</span>, ack <span class="hljs-number">1</span>, win <span class="hljs-number">32120</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">10233636</span> ecr <span class="hljs-number">2467372</span>], length <span class="hljs-number">27</span> [telnet <span class="hljs-built_in">DO</span> SUPPRESS GO AHEAD, WILL TERMINAL TYPE, WILL NAWS, WILL TSPEED, WILL LFLOW, WILL LINEMODE, WILL NEW-ENVIRON, <span class="hljs-built_in">DO</span> STATUS, WILL XDISPLOC]
<span class="hljs-number">21</span>:<span class="hljs-number">12</span>:<span class="hljs-number">38.537538</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">192.168</span><span class="hljs-meta">.0</span><span class="hljs-meta">.1</span>.telnet &gt; <span class="hljs-number">192.168</span><span class="hljs-meta">.0</span><span class="hljs-meta">.2</span><span class="hljs-meta">.1550</span>: Flags [P.], seq <span class="hljs-number">1</span>:<span class="hljs-number">4</span>, ack <span class="hljs-number">28</span>, win <span class="hljs-number">17349</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">2467372</span> ecr <span class="hljs-number">10233636</span>], length <span class="hljs-number">3</span> [telnet <span class="hljs-built_in">DO</span> AUTHENTICATION]
</code></pre>
<p>The other modifiers, <code>OR</code> and <code>NOT</code> provide us with a way to specify multiple conditions or negate something. Let us play with that a bit now. What do we notice about this output?</p>
<p><strong>Basic Capture With No Filter</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -i eth0
<span class="hljs-symbol">
tcpdump:</span> verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length <span class="hljs-number">262144</span> bytes
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">51.224071</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span> &gt; dns.google: ICMP echo request, id <span class="hljs-number">19623</span>, seq <span class="hljs-number">72</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">51.251635</span> <span class="hljs-built_in">IP</span> dns.google &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>: ICMP echo reply, id <span class="hljs-number">19623</span>, seq <span class="hljs-number">72</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">51.329340</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.39003</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain: <span class="hljs-number">8231</span>+ <span class="hljs-built_in">PTR</span>? <span class="hljs-number">8.8</span><span class="hljs-meta">.8</span><span class="hljs-meta">.8</span>.in-addr.arpa. (<span class="hljs-number">38</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">51.330334</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.39003</span>: <span class="hljs-number">8231</span> <span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span> <span class="hljs-built_in">PTR</span> dns.google. (<span class="hljs-number">62</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">51.330613</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.50633</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain: <span class="hljs-number">65266</span>+ <span class="hljs-built_in">PTR</span>? <span class="hljs-number">2.146</span><span class="hljs-meta">.16</span><span class="hljs-meta">.172</span>.in-addr.arpa. (<span class="hljs-number">43</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">51.331461</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.50633</span>: <span class="hljs-number">65266</span> NXDomain* <span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span> (<span class="hljs-number">43</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">51.399970</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.54742</span> &gt; <span class="hljs-number">72.21</span><span class="hljs-meta">.91</span><span class="hljs-meta">.29</span>.http: Flags [.], ack <span class="hljs-number">358742210</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">1924174236</span> ecr <span class="hljs-number">1068405332</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">51.420559</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">72.21</span><span class="hljs-meta">.91</span><span class="hljs-meta">.29</span>.http &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.54742</span>: Flags [.], ack <span class="hljs-number">1</span>, win <span class="hljs-number">131</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">1068415563</span> ecr <span class="hljs-number">1924143536</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">51.432107</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.41928</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain: <span class="hljs-number">7232</span>+ <span class="hljs-built_in">PTR</span>? <span class="hljs-number">1.146</span><span class="hljs-meta">.16</span><span class="hljs-meta">.172</span>.in-addr.arpa. (<span class="hljs-number">43</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">51.432795</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.41928</span>: <span class="hljs-number">7232</span> NXDomain* <span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span> (<span class="hljs-number">43</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">51.433048</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.47075</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain: <span class="hljs-number">18932</span>+ <span class="hljs-built_in">PTR</span>? <span class="hljs-number">29.91</span><span class="hljs-meta">.21</span><span class="hljs-meta">.72</span>.in-addr.arpa. (<span class="hljs-number">42</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">51.434374</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.47075</span>: <span class="hljs-number">18932</span> NXDomain <span class="hljs-number">0</span>/<span class="hljs-number">1</span>/<span class="hljs-number">0</span> (<span class="hljs-number">113</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">52.225941</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span> &gt; dns.google: ICMP echo request, id <span class="hljs-number">19623</span>, seq <span class="hljs-number">73</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">52.252523</span> <span class="hljs-built_in">IP</span> dns.google &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>: ICMP echo reply, id <span class="hljs-number">19623</span>, seq <span class="hljs-number">73</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">52.683881</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.47004</span> &gt; <span class="hljs-number">151.139</span><span class="hljs-meta">.128</span><span class="hljs-meta">.14</span>.http: Flags [.], ack <span class="hljs-number">2006616877</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">1585722998</span> ecr <span class="hljs-number">2103316650</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:<span class="hljs-number">52.712283</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">151.139</span><span class="hljs-meta">.128</span><span class="hljs-meta">.14</span>.http &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.47004</span>: Flags [.], ack <span class="hljs-number">1</span>, win <span class="hljs-number">507</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">2103326900</span> ecr <span class="hljs-number">1585692473</span>], length <span class="hljs-number">0</span>
</code></pre>
<p>We have a mix of different sources and destinations along with multiple protocol types. If we were to use the <code>OR</code> (alternatively <code>||</code>) modifier, we could ask for traffic from a specific host or just ICMP traffic as an example. Let us rerun it and add in an <code>OR</code>.</p>
<p><strong>OR Filter</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ ### Syntax: <span class="hljs-keyword">or</span>/|| [requirement]
root@htb[/htb]$ sudo tcpdump -r sus.pcap icmp <span class="hljs-keyword">or</span> host <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>

reading from file sus.pcap, link-type EN10MB (Ethernet), snapshot length <span class="hljs-number">262144</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">03.659163</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span> &gt; dns.google: ICMP echo request, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">21</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">03.691278</span> <span class="hljs-built_in">IP</span> dns.google &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>: ICMP echo reply, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">21</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">03.879882</span> ARP, Request who-has <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span> tell <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>, length <span class="hljs-number">28</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">03.880266</span> ARP, Reply <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span> is-<span class="hljs-meta">at</span> 8a:<span class="hljs-number">66</span>:5a:<span class="hljs-number">11</span>:<span class="hljs-number">8d</span>:<span class="hljs-number">64</span> (oui Unknown), length <span class="hljs-number">46</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">04.661179</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span> &gt; dns.google: ICMP echo request, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">22</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">04.687120</span> <span class="hljs-built_in">IP</span> dns.google &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>: ICMP echo reply, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">22</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">05.663097</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span> &gt; dns.google: ICMP echo request, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">23</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">05.686092</span> <span class="hljs-built_in">IP</span> dns.google &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>: ICMP echo reply, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">23</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">06.664174</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span> &gt; dns.google: ICMP echo request, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">24</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">06.697469</span> <span class="hljs-built_in">IP</span> dns.google &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>: ICMP echo reply, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">24</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">07.666273</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span> &gt; dns.google: ICMP echo request, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">25</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">07.701475</span> <span class="hljs-built_in">IP</span> dns.google &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>: ICMP echo reply, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">25</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">08.668364</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span> &gt; dns.google: ICMP echo request, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">26</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">08.694948</span> <span class="hljs-built_in">IP</span> dns.google &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>: ICMP echo reply, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">26</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">09.670523</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span> &gt; dns.google: ICMP echo request, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">27</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">09.694974</span> <span class="hljs-built_in">IP</span> dns.google &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>: ICMP echo reply, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">27</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">10.672858</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span> &gt; dns.google: ICMP echo request, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">28</span>, length <span class="hljs-number">64</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">10.697834</span> <span class="hljs-built_in">IP</span> dns.google &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>: ICMP echo reply, id <span class="hljs-number">51661</span>, seq <span class="hljs-number">28</span>, length <span class="hljs-number">64</span>
</code></pre>
<p>Our traffic looks a bit different now. That is because a lot of the packets matched the ICMP variable while some matched the host variable. So in this output, we can see some ARP traffic and ICMP traffic. The filter worked since 172.16.146.2 matched the other variable and appeared as a host in either the source or destination field. Now, what happens if we utilize the <code>NOT</code> (alternatively <code>!</code>) modifier.</p>
<p><strong>NOT Filter</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ ### Syntax: <span class="hljs-keyword">not</span>/! [requirement]
root@htb[/htb]$ sudo tcpdump -r sus.pcap <span class="hljs-keyword">not</span> icmp

<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">03.879882</span> ARP, Request who-has <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span> tell <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span>, length <span class="hljs-number">28</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">03.880266</span> ARP, Reply <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span> is-<span class="hljs-meta">at</span> 8a:<span class="hljs-number">66</span>:5a:<span class="hljs-number">11</span>:<span class="hljs-number">8d</span>:<span class="hljs-number">64</span> (oui Unknown), length <span class="hljs-number">46</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">16.541657</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55592</span> &gt; ec2-<span class="hljs-number">52</span>-<span class="hljs-number">211</span>-<span class="hljs-number">164</span>-<span class="hljs-number">46.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [P.], seq <span class="hljs-number">3569937476</span>:<span class="hljs-number">3569937513</span>, ack <span class="hljs-number">2948818703</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">713252991</span> ecr <span class="hljs-number">12282469</span>], length <span class="hljs-number">37</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">16.568659</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.53329</span> &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain: <span class="hljs-number">24866</span>+ A? app.hackthebox.eu. (<span class="hljs-number">35</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">16.616032</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.1</span>.domain &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.53329</span>: <span class="hljs-number">24866</span> <span class="hljs-number">3</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span> A <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>, A <span class="hljs-number">104.20</span><span class="hljs-meta">.66</span><span class="hljs-meta">.68</span>, A <span class="hljs-number">104.20</span><span class="hljs-meta">.55</span><span class="hljs-meta">.68</span> (<span class="hljs-number">83</span>)
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">16.616396</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.56204</span> &gt; <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https: Flags [S], seq <span class="hljs-number">2697802378</span>, win <span class="hljs-number">64240</span>, options [mss <span class="hljs-number">1460</span>,sackOK,TS val <span class="hljs-number">533261003</span> ecr <span class="hljs-number">0</span>,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">7</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">16.637895</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.56204</span>: Flags [S.], seq <span class="hljs-number">752000032</span>, ack <span class="hljs-number">2697802379</span>, win <span class="hljs-number">65535</span>, options [mss <span class="hljs-number">1400</span>,<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,sackOK,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">10</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">16.637937</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.56204</span> &gt; <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https: Flags [.], ack <span class="hljs-number">1</span>, win <span class="hljs-number">502</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">16.644551</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.56204</span> &gt; <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https: Flags [P.], seq <span class="hljs-number">1</span>:<span class="hljs-number">514</span>, ack <span class="hljs-number">1</span>, win <span class="hljs-number">502</span>, length <span class="hljs-number">513</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">16.667236</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.56204</span>: Flags [.], ack <span class="hljs-number">514</span>, win <span class="hljs-number">66</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">16.668307</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.56204</span>: Flags [P.], seq <span class="hljs-number">1</span>:<span class="hljs-number">2766</span>, ack <span class="hljs-number">514</span>, win <span class="hljs-number">66</span>, length <span class="hljs-number">2765</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">16.668319</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.56204</span> &gt; <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https: Flags [.], ack <span class="hljs-number">2766</span>, win <span class="hljs-number">496</span>, length <span class="hljs-number">0</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">16.670536</span> <span class="hljs-built_in">IP</span> ec2-<span class="hljs-number">52</span>-<span class="hljs-number">211</span>-<span class="hljs-number">164</span>-<span class="hljs-number">46.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55592</span>: Flags [P.], seq <span class="hljs-number">1</span>:<span class="hljs-number">34</span>, ack <span class="hljs-number">37</span>, win <span class="hljs-number">114</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">12294021</span> ecr <span class="hljs-number">713252991</span>], length <span class="hljs-number">33</span>
<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">16.670559</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.55592</span> &gt; ec2-<span class="hljs-number">52</span>-<span class="hljs-number">211</span>-<span class="hljs-number">164</span>-<span class="hljs-number">46.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [.], ack <span class="hljs-number">34</span>, win <span class="hljs-number">501</span>, options [<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,TS val <span class="hljs-number">713253120</span> ecr <span class="hljs-number">12294021</span>], length <span class="hljs-number">0</span>
</code></pre>
<p>It looks much different now. We only see some ARP traffic, and then we see some HTTPS traffic we did not get to before. This is because we negated any ICMP traffic from being displayed using <code>not icmp</code>.</p>
<hr>
<h3 id="pre-capture-filters-vs-post-capture-processing">Pre-Capture Filters VS. Post-Capture Processing</h3>
<p>When utilizing filters, we can apply them directly to the capture or apply them when reading a capture file. By applying them to the capture, it will drop any traffic not matching the filter. This will reduce the amount of data in the captures and potentially clear out traffic we may need later, so use them only when looking for something specific, such as troubleshooting a network connectivity issue. When applying the filter to capture, we have read from a file, and the filter will parse the file and remove anything from our terminal output not matching the specified filter. Using a filter in this way can help us investigate while saving potential valuable data in the captures. It will not permanently change the capture file, and to change or clear the filter from our output will require we rerunning our command with a change in the syntax.</p>
<hr>
<h3 id="interpreting-tips-and-tricks">Interpreting Tips and Tricks</h3>
<p>Using the <code>-S</code> switch will display absolute sequence numbers, which can be extremely long. Typically, tcpdump displays relative sequence numbers, which are easier to track and read. However, if we look for these values in another tool or log, we will only find the packet based on absolute sequence numbers. For example, 13245768092588 to 100.</p>
<p>The <code>-v</code>, <code>-X</code>, and <code>-e</code> switches can help you increase the amount of data captured, while the <code>-c</code>, <code>-n</code>, <code>-s</code>, <code>-S</code>, and <code>-q</code> switches can help reduce and modify the amount of data written and seen.</p>
<p>Many handy options that can be used but are not always directly valuable for everyone are the <code>-A</code> and <code>-l</code> switches. A will show only the ASCII text after the packet line, instead of both ASCII and Hex. <code>L</code> will tell tcpdump to output packets in a different mode. <code>L</code> will line buffer instead of pooling and pushing in chunks. It allows us to send the output directly to another tool such as <code>grep</code> using a pipe <code>|</code>.</p>
<p><strong>Tips and Tricks</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$sudo tcpdump -Ar telnet.pcap

<span class="hljs-number">21</span>:<span class="hljs-number">12</span>:<span class="hljs-number">43.528695</span> IP <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>.telnet &gt; <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span><span class="hljs-number">.1550</span>: Flags [P.], seq <span class="hljs-number">157</span>:<span class="hljs-number">217</span>, ack <span class="hljs-number">216</span>, win <span class="hljs-number">17376</span>, options [nop,nop,TS val <span class="hljs-number">2467382</span> ecr <span class="hljs-number">10234022</span>], length <span class="hljs-number">60</span>
E..p;...@..p..............c.......C........
.%<span class="hljs-number">.6</span>..(.Last login: Sat Nov <span class="hljs-number">27</span> <span class="hljs-number">20</span>:<span class="hljs-number">11</span>:<span class="hljs-number">43</span> on ttyp2 <span class="hljs-keyword">from</span> bam.zing.org

<span class="hljs-number">21</span>:<span class="hljs-number">12</span>:<span class="hljs-number">43.546441</span> IP <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span><span class="hljs-number">.1550</span> &gt; <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>.telnet: Flags [.], ack <span class="hljs-number">217</span>, win <span class="hljs-number">32120</span>, options [nop,nop,TS val <span class="hljs-number">10234152</span> ecr <span class="hljs-number">2467382</span>], length <span class="hljs-number">0</span>
E..<span class="hljs-number">4</span>FP@.@.s...................d...}x.......
..)(.%<span class="hljs-number">.6</span>
<span class="hljs-number">21</span>:<span class="hljs-number">12</span>:<span class="hljs-number">43.548353</span> IP <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>.telnet &gt; <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span><span class="hljs-number">.1550</span>: Flags [P.], seq <span class="hljs-number">217</span>:<span class="hljs-number">705</span>, ack <span class="hljs-number">216</span>, win <span class="hljs-number">17376</span>, options [nop,nop,TS val <span class="hljs-number">2467382</span> ecr <span class="hljs-number">10234152</span>], length <span class="hljs-number">488</span>
E...;...@.................d.......C........
.%<span class="hljs-number">.6</span>..)(Warning: no Kerberos tickets issued.
OpenBSD <span class="hljs-number">2.6</span>-beta (OOF) #<span class="hljs-number">4</span>: Tue Oct <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">42</span>:<span class="hljs-number">32</span> CDT <span class="hljs-number">1999</span>

Welcome to OpenBSD: The proactively secure Unix-like operating <span class="hljs-keyword">system</span>.

Please use the sendbug(<span class="hljs-number">1</span>) utility to report bugs <span class="hljs-keyword">in</span> the <span class="hljs-keyword">system</span>.
Before reporting a bug, please try to reproduce it <span class="hljs-keyword">with</span> the latest
version <span class="hljs-keyword">of</span> the <span class="hljs-keyword">code</span>.  With bug reports, please try to ensure that
enough information to reproduce the problem is enclosed, and <span class="hljs-keyword">if</span> a
known fix for it exists, include that <span class="hljs-keyword">as</span> well.


<span class="hljs-number">21</span>:<span class="hljs-number">12</span>:<span class="hljs-number">43.566442</span> IP <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span><span class="hljs-number">.1550</span> &gt; <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>.telnet: Flags [.], ack <span class="hljs-number">705</span>, win <span class="hljs-number">32120</span>, options [nop,nop,TS val <span class="hljs-number">10234154</span> ecr <span class="hljs-number">2467382</span>], length <span class="hljs-number">0</span>
E..<span class="hljs-number">4</span>FQ@.@.s...................e...}x<span class="hljs-number">.0</span>.....
..)*.%<span class="hljs-number">.6</span>
</code></pre>
<p>Notice how it has the ASCII values shown below each output line because of our use of <code>-A</code>. This can be helpful when quickly looking for something human-readable in the output.</p>
<p><strong>Piping a Capture to Grep</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -Ar <span class="hljs-keyword">http</span>.cap -l | grep <span class="hljs-string">'mailto:*'</span>

reading <span class="hljs-built_in">from</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">http</span>.cap, link-type EN10MB (Ethernet), snapshot <span class="hljs-built_in">length</span> <span class="hljs-number">65535</span>
  &lt;<span class="hljs-keyword">a</span> href=<span class="hljs-string">"mailto:ethereal-web[AT]ethereal.com"</span>&gt;ethereal-web[AT]ethereal.com&lt;/<span class="hljs-keyword">a</span>&gt;
  &lt;<span class="hljs-keyword">a</span> href=<span class="hljs-string">"mailto:free-support[AT]thewrittenword.com"</span>&gt;free-support[AT]thewrittenword.com&lt;/<span class="hljs-keyword">a</span>&gt;
  &lt;<span class="hljs-keyword">a</span> href=<span class="hljs-string">"mailto:ethereal-users[AT]ethereal.com"</span>&gt;ethereal-users[AT]ethereal.com&lt;/<span class="hljs-keyword">a</span>&gt;
  &lt;<span class="hljs-keyword">a</span> href=<span class="hljs-string">"mailto:ethereal-web[AT]ethereal.com"</span>&gt;ethereal-web[AT]ethereal.com&lt;/<span class="hljs-keyword">a</span>&gt;
</code></pre>
<p>Using <code>-l</code> in this way allowed us to examine the capture quickly and grep for keywords or formatting we suspected could be there. In this case, we used the <code>-l</code> to pass the output to <code>grep</code> and looking for any instance of the phrase <code>mailto:*</code>. This shows us every line with our search in it, and we can see the results above. Using modifiers and redirecting output can be a quick way to scrape websites for email addresses, naming standards, and much more.</p>
<p>We can dig as deep as we wish into the packets we captured. It requires a bit of knowledge of how the protocols are structured, however. For example, if we wanted to see only packets with the TCP SYN flag set, we could use the following command:</p>
<p><strong>Looking for TCP Protocol Flags</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">root</span>@<span class="hljs-keyword">htb</span>[/<span class="hljs-keyword">htb</span>]$ tcpdump -i eth0 <span class="hljs-string">'tcp[13] &amp;2 != 0'</span>
</code></pre>
<p>This is counting to the 13th byte in the structure and looking at the 2nd bit. If it is set to 1 or ON, the SYN flag is set.</p>
<p><strong>Hunting For a SYN Flag</strong></p>
<p>Tcpdump Packet Filtering</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tcpdump -i eth0 <span class="hljs-string">'tcp[13] &amp;2 != 0'</span>
<span class="hljs-symbol">
tcpdump:</span> verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length <span class="hljs-number">262144</span> bytes
<span class="hljs-number">15</span>:<span class="hljs-number">18</span>:<span class="hljs-number">14.630993</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.56244</span> &gt; <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https: Flags [S], seq <span class="hljs-number">122498858</span>, win <span class="hljs-number">64240</span>, options [mss <span class="hljs-number">1460</span>,sackOK,TS val <span class="hljs-number">534699017</span> ecr <span class="hljs-number">0</span>,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">7</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">15</span>:<span class="hljs-number">18</span>:<span class="hljs-number">14.654698</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.67</span><span class="hljs-meta">.1</span><span class="hljs-meta">.1</span>.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.56244</span>: Flags [S.], seq <span class="hljs-number">3728841459</span>, ack <span class="hljs-number">122498859</span>, win <span class="hljs-number">65535</span>, options [mss <span class="hljs-number">1400</span>,<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,sackOK,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">10</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">15</span>:<span class="hljs-number">18</span>:<span class="hljs-number">15.017464</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.60202</span> &gt; a23-<span class="hljs-number">54</span>-<span class="hljs-number">168</span>-<span class="hljs-number">81.</span>deploy.static.akamaitechnologies.com.https: Flags [S], seq <span class="hljs-number">777468939</span>, win <span class="hljs-number">64240</span>, options [mss <span class="hljs-number">1460</span>,sackOK,TS val <span class="hljs-number">1348555130</span> ecr <span class="hljs-number">0</span>,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">7</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">15</span>:<span class="hljs-number">18</span>:<span class="hljs-number">15.021329</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.49652</span> &gt; <span class="hljs-number">104.16</span><span class="hljs-meta">.88</span><span class="hljs-meta">.20</span>.https: Flags [S], seq <span class="hljs-number">1954080833</span>, win <span class="hljs-number">64240</span>, options [mss <span class="hljs-number">1460</span>,sackOK,TS val <span class="hljs-number">274098564</span> ecr <span class="hljs-number">0</span>,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">7</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">15</span>:<span class="hljs-number">18</span>:<span class="hljs-number">15.022640</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.45214</span> &gt; <span class="hljs-number">104.18</span><span class="hljs-meta">.22</span><span class="hljs-meta">.52</span>.https: Flags [S], seq <span class="hljs-number">1072203471</span>, win <span class="hljs-number">64240</span>, options [mss <span class="hljs-number">1460</span>,sackOK,TS val <span class="hljs-number">1445124063</span> ecr <span class="hljs-number">0</span>,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">7</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">15</span>:<span class="hljs-number">18</span>:<span class="hljs-number">15.042399</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">104.18</span><span class="hljs-meta">.22</span><span class="hljs-meta">.52</span>.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.45214</span>: Flags [S.], seq <span class="hljs-number">215464563</span>, ack <span class="hljs-number">1072203472</span>, win <span class="hljs-number">65535</span>, options [mss <span class="hljs-number">1400</span>,<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,sackOK,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">10</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">15</span>:<span class="hljs-number">18</span>:<span class="hljs-number">15.043646</span> <span class="hljs-built_in">IP</span> a23-<span class="hljs-number">54</span>-<span class="hljs-number">168</span>-<span class="hljs-number">81.</span>deploy.static.akamaitechnologies.com.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.60202</span>: Flags [S.], seq <span class="hljs-number">1390108870</span>, ack <span class="hljs-number">777468940</span>, win <span class="hljs-number">28960</span>, options [mss <span class="hljs-number">1460</span>,sackOK,TS val <span class="hljs-number">3405787409</span> ecr <span class="hljs-number">1348555130</span>,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">7</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">15</span>:<span class="hljs-number">18</span>:<span class="hljs-number">15.044764</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">104.16</span><span class="hljs-meta">.88</span><span class="hljs-meta">.20</span>.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.49652</span>: Flags [S.], seq <span class="hljs-number">2086758283</span>, ack <span class="hljs-number">1954080834</span>, win <span class="hljs-number">65535</span>, options [mss <span class="hljs-number">1400</span>,<span class="hljs-keyword">nop</span>,<span class="hljs-keyword">nop</span>,sackOK,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">10</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">15</span>:<span class="hljs-number">18</span>:<span class="hljs-number">16.131983</span> <span class="hljs-built_in">IP</span> <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.45684</span> &gt; ec2-<span class="hljs-number">34</span>-<span class="hljs-number">255</span>-<span class="hljs-number">145</span>-<span class="hljs-number">175.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https: Flags [S], seq <span class="hljs-number">4017793011</span>, win <span class="hljs-number">64240</span>, options [mss <span class="hljs-number">1460</span>,sackOK,TS val <span class="hljs-number">933634389</span> ecr <span class="hljs-number">0</span>,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">7</span>], length <span class="hljs-number">0</span>
<span class="hljs-number">15</span>:<span class="hljs-number">18</span>:<span class="hljs-number">16.261855</span> <span class="hljs-built_in">IP</span> ec2-<span class="hljs-number">34</span>-<span class="hljs-number">255</span>-<span class="hljs-number">145</span>-<span class="hljs-number">175.</span>eu-west-<span class="hljs-number">1.</span>compute.amazonaws.com.https &gt; <span class="hljs-number">172.16</span><span class="hljs-meta">.146</span><span class="hljs-meta">.2</span><span class="hljs-meta">.45684</span>: Flags [S.], seq <span class="hljs-number">106675091</span>, ack <span class="hljs-number">4017793012</span>, win <span class="hljs-number">26847</span>, options [mss <span class="hljs-number">1460</span>,sackOK,TS val <span class="hljs-number">12653884</span> ecr <span class="hljs-number">933634389</span>,<span class="hljs-keyword">nop</span>,wscale <span class="hljs-number">8</span>], length <span class="hljs-number">0</span>
</code></pre>
<p>Our results include only packets with the TCP <code>SYN</code> flag set from what we see above.</p>
<p>TCPDump can be a powerful tool if we understand our networking and how hosts interact with one another. Take the time to understand typical protocol header structures to spot the anomaly when the time comes. Here are a few links to further our studies on standard Protocols and their structures. Except for the Wikipedia link, each link should take us directly to the RFC that sets the standard in place for each.</p>
<p><strong>Protocol RFC Links</strong></p>
<table>
<thead>
<tr>
<th><strong>Link</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://tools.ietf.org/html/rfc791">IP Protocol</a></td>
<td><code>RFC 791</code> describes IP and its functionality.</td>
</tr>
<tr>
<td><a href="https://tools.ietf.org/html/rfc792">ICMP Protocol</a></td>
<td><code>RFC 792</code> describes ICMP and its functionality.</td>
</tr>
<tr>
<td><a href="https://tools.ietf.org/html/rfc793">TCP Protocol</a></td>
<td><code>RFC 793</code> describes the TCP protocol and how it functions.</td>
</tr>
<tr>
<td><a href="https://tools.ietf.org/html/rfc768">UDP Protocol</a></td>
<td><code>RFC 768</code> describes UDP and how it operates.</td>
</tr>
<tr>
<td><a href="https://en.wikipedia.org/wiki/List\_of\_RFCs#Topical\_list">RFC Quick Links</a></td>
<td>This Wikipedia article contains a large list of protocols tied to the RFC that explains their implementation.</td>
</tr>
</tbody>
</table>
<h2 id="interrogating-network-traffic-with-capture-and-display-filters">Interrogating Network Traffic With Capture and Display Filters</h2>
<hr>
<p>This lab aims to provide some exposure to interrogating network traffic and give everyone some valuable practice implementing packet filters. We will be utilizing filters like <code>host</code>, <code>port</code>, <code>protocol</code>, and more to change our view while digging through a .PCAP file.</p>
<p>Now that we have proven capable of capturing network traffic for the Corporation, management has tasked us with performing a quick analysis of the traffic our team has captured while surveying the network. The goal is to determine what servers are answering DNS and HTTP/S requests in our local network.</p>
<p>If you wish to take a more exploratory approach to this lab, I have posted the overall tasks to accomplish. For a more detailed walkthrough of how to complete each step, look below each task in the solution bubble.</p>
<hr>
<h3 id="tasks">Tasks</h3>
<p>Utilizing <code>TCPDump-lab-2.zip</code> in the optional resources, perform the lab to the best of your ability. Finding everything on the first shot is not the goal. Our understanding of the concepts is our primary concern. As we perform these actions repeatedly, it will get easier.</p>
<p><strong>Task #1</strong></p>
<p><code>Read a capture from a file without filters implemented.</code></p>
<p>To start, let&#39;s examine this pcap with no filters applied.</p>
<details>

<summary>Click to show answer</summary>

<code>shell-session</code>

</details>

<hr>
<p><strong>Task #2</strong></p>
<p><code>Identify the type of traffic seen.</code></p>
<p>Take note of what types of traffic can be seen. (Ports utilized, protocols, any other information you deem relevant.) What filters can we use to make this task easier?</p>
<p>What type of traffic do we see?</p>
<p>Common protocols:</p>
<p>Ports utilized:</p>
<details>

<summary>Click to show answers</summary>



</details>

<hr>
<p><strong>Task #3</strong></p>
<p><code>Identify conversations.</code></p>
<p>We have examined the basics of this traffic, now determine if you notice any patterns with the traffic.\
Are you noticing any common connections between a server and host? If so, who?</p>
<p>What are the client and server port numbers used in the first full TCP three-way handshake?</p>
<p>Who are the servers in these conversations? How do we know?</p>
<p>Who are the receiving hosts?</p>
<details>

<summary>Click to show answer</summary>



</details>

<hr>
<p><strong>Task #4</strong></p>
<p><code>Interpret the capture in depth.</code></p>
<p>Now that we have some familiarity with the pcap file, let&#39;s do some analysis. Utilize whatever syntax necessary to accomplish answering the questions below.</p>
<p>What is the timestamp of the first established conversation in the pcap file?</p>
<p>What is the IP address/s of apache.org from the DNS server responses?</p>
<p>What protocol is being utilized in that first conversation? (name/#)</p>
<details>

<summary>Click to show answer</summary>



</details>

<hr>
<p><strong>Task #5</strong></p>
<p><code>Filter out traffic.</code></p>
<p>It&#39;s time to clear some of this data out now. Reload the pcap file and filter out all traffic that is not DNS. What can you see?</p>
<p>Who is the DNS server for this segment?</p>
<p>What domain name/s were requested in the pcap file?</p>
<p>What type of DNS Records could be seen?</p>
<details>

<summary>Click to show answer</summary>

<code>shell-session</code>

</details>

<p>Now that we are only seeing DNS traffic and have a better grasp on how the packet appears, try to answer the following questions regarding name resolution in the enterprise: Who requests an A record for apache.org? (hostname or IP)</p>
<p>What information does an A record provide?</p>
<p>Who is the responding DNS server in the pcap? (hostname or IP)</p>
<hr>
<p><strong>Task #6</strong></p>
<p><code>Filter for TCP traffic.</code></p>
<p>Now that we have a clear idea of our DNS server let&#39;s look for any webservers present. Filter out the view so that we only see the traffic pertaining to HTTP or HTTPS. What web pages were requested?</p>
<p>What are the most common HTTP request methods from this PCAP?</p>
<p>What is the most common HTTP response from this PCAP?</p>
<details>

<summary>Click to show answer</summary>



</details>

<p><strong>Task #7</strong></p>
<p><code>What can you determine about the server in the first conversation.</code></p>
<p>Let&#39;s take a closer look. What can be determined about the webserver in the first conversation? Does anything stick out? For some clarity, make sure our view includes the Hex and ASCII output for the pcap.</p>
<p>Can we determine what application is running the webserver?</p>
<details>

<summary>Click to show answer</summary>



</details>

<hr>
<h3 id="summary">Summary</h3>
<p>Through this lab, we expanded our horizons while utilizing TCPDump to analyze PCAP traffic. We learned how to capture and display filters effectively, dissected traffic to determine what protocols were running in the environment, and even gleaned some critical information about our enterprise segments, DNS, and Webservers. Continue to play on your own and see how deep the rabbit hole goes. Can you capture traffic in your home network and answer the same questions?</p>
<hr>
<h3 id="tips-for-analysis">Tips For Analysis</h3>
<p>Below is a list of questions we can ask ourselves during the analysis process to keep on track.</p>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>what type of traffic do you see? (protocol, port, etc.)</td>
</tr>
<tr>
<td>Is there more than one conversation? (how many?)</td>
</tr>
<tr>
<td>How many unique hosts?</td>
</tr>
<tr>
<td>What is the timestamp of the first conversation in the pcap (tcp traffic)</td>
</tr>
<tr>
<td>What traffic can I filter out to clean up my view?</td>
</tr>
<tr>
<td>Who are the servers in the PCAP? (answering on well-known ports, 53, 80, etc.)</td>
</tr>
<tr>
<td>What records were requested or methods used? (GET, POST, DNS A records, etc.)</td>
</tr>
</tbody>
</table>
<h2 id="analysis-with-wireshark">Analysis with Wireshark</h2>
<hr>
<p><code>Wireshark</code> is a free and open-source network traffic analyzer much like tcpdump but with a graphical interface. Wireshark is multi-platform and capable of capturing live data off many different interface types (to include WiFi, USB, and Bluetooth) and saving the traffic to several different formats. Wireshark allows the user to dive much deeper into the inspection of network packets than other tools. What makes Wireshark truly powerful is the analysis capability it provides, giving a detailed insight into the traffic.</p>
<p>Depending on the host we are using, we may not always have a GUI to utilize traditional Wireshark. Lucky for us, several variants allow us to use it from the command line.</p>
<p><strong>Features and Capabilities:</strong></p>
<ul>
<li>Deep packet inspection for hundreds of different protocols</li>
<li>Graphical and TTY interfaces</li>
<li>Capable of running on most Operating systems</li>
<li>Ethernet, IEEE 802.11, PPP/HDLC, ATM, Bluetooth, USB, Token Ring, Frame Relay, FDDI, among others</li>
<li>Decryption capabilities for IPsec, ISAKMP, Kerberos, SNMPv3, SSL/TLS, WEP, and WPA/WPA2</li>
<li>Many many more...</li>
</ul>
<hr>
<h3 id="requirements-for-use">Requirements for Use</h3>
<p>Wireshark requires the following for use:</p>
<p><strong>Windows:</strong></p>
<ul>
<li>The Universal C Runtime. This is included with Windows 10 and Windows Server 2019 and is installed automatically on earlier versions if Microsoft Windows Update is enabled. Otherwise, KB2999226 or KB3118401 must be installed.</li>
<li>Any modern 64-bit AMD64/x86-64 or 32-bit x86 processor.</li>
<li>500 MB available RAM. Larger capture files require more RAM.</li>
<li>500 MB available disk space. Capture files require additional disk space.</li>
<li>Any modern display. 1280 × 1024 or higher resolution is recommended. Wireshark will make use of HiDPI or Retina resolutions if available. Power users will find multiple monitors useful.</li>
<li>A supported network card for capturing:<ul>
<li>Ethernet. Any card supported by Windows should work.</li>
<li>802.11. See the Wireshark wiki page. Capturing raw 802.11 information may be difficult without special equipment.</li>
</ul>
</li>
<li>To install, download the executable from wireshark.org, validate the hash, and install.</li>
</ul>
<p><strong>Linux:</strong></p>
<ul>
<li>Wireshark runs on most UNIX and UNIX-like platforms, including Linux and most BSD variants. The system requirements should be comparable to the specifications listed above for Windows.</li>
<li>Binary packages are available for most Unix and Linux distributions.</li>
<li>To validate if the package exists on a host, use the following command:</li>
</ul>
<p><strong>Locating Wireshark</strong></p>
<p>Analysis with Wireshark</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">root</span>@<span class="hljs-keyword">htb</span>[/<span class="hljs-keyword">htb</span>]$ which wireshark
</code></pre>
<p>If the package does not exist, (It can often be found in <code>/usr/sbin/wireshark</code>) you can install it with:</p>
<p><strong>Installing Wireshark On Linux</strong></p>
<p>Analysis with Wireshark</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">root</span>@<span class="hljs-keyword">htb</span>[/<span class="hljs-keyword">htb</span>]$ sudo apt install wireshark
</code></pre>
<hr>
<h3 id="tshark-vs-wireshark-terminal-vs-gui-">TShark VS. Wireshark (Terminal vs. GUI)</h3>
<p>Both options have their merits. TShark is a purpose-built terminal tool based on Wireshark. TShark shares many of the same features that are included in Wireshark and even shares syntax and options. TShark is perfect for use on machines with little or no desktop environment and can easily pass the capture information it receives to another tool via the command line. Wireshark is the feature-rich GUI option for traffic capture and analysis. If you wish to have the full-featured experience and work from a machine with a desktop environment, the Wireshark GUI is the way to go.</p>
<p><strong>Basic TShark Switches</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>Switch Command</strong></th>
<th><strong>Result</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">D</td>
<td>Will display any interfaces available to capture from and then exit out.</td>
</tr>
<tr>
<td style="text-align:center">L</td>
<td>Will list the Link-layer mediums you can capture from and then exit out. (ethernet as an example)</td>
</tr>
<tr>
<td style="text-align:center">i</td>
<td>choose an interface to capture from. (-i eth0)</td>
</tr>
<tr>
<td style="text-align:center">f</td>
<td>packet filter in libpcap syntax. Used during capture.</td>
</tr>
<tr>
<td style="text-align:center">c</td>
<td>Grab a specific number of packets, then quit the program. Defines a stop condition.</td>
</tr>
<tr>
<td style="text-align:center">a</td>
<td>Defines an autostop condition. Can be after a duration, specific file size, or after a certain number of packets.</td>
</tr>
<tr>
<td style="text-align:center">r (pcap-file)</td>
<td>Read from a file.</td>
</tr>
<tr>
<td style="text-align:center">W (pcap-file)</td>
<td>Write into a file using the pcapng format.</td>
</tr>
<tr>
<td style="text-align:center">P</td>
<td>Will print the packet summary while writing into a file (-W)</td>
</tr>
<tr>
<td style="text-align:center">x</td>
<td>will add Hex and ASCII output into the capture.</td>
</tr>
<tr>
<td style="text-align:center">h</td>
<td>See the help menu</td>
</tr>
</tbody>
</table>
<p><code>To see the full list of switches you can utilize:</code></p>
<p><strong>TShark Help</strong></p>
<p>Analysis with Wireshark</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">root</span>@<span class="hljs-keyword">htb</span>[/<span class="hljs-keyword">htb</span>]$ tshark -h
</code></pre>
<p><strong>TShark Basic Usage</strong></p>
<p>TShark can use filters for protocols, common items like hosts and ports, and even the ability to dig deeper into the packets and dissect individual fields from the packet.</p>
<p><strong>Locating TShark</strong></p>
<p>Analysis with Wireshark</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ which tshark

root@htb[/htb]$ tshark -D

root@htb[/htb]$ tshark -i <span class="hljs-number">1</span> -w /tmp/test.pcap

Capturing <span class="hljs-literal">on</span> <span class="hljs-string">'Wi-Fi: en0'</span>
<span class="hljs-number">484</span>
</code></pre>
<p>With the basic string in the command line above, we utilize TShark to capture on en0, specified with the <code>-i</code> flag and the <code>-w</code> option to save the capture to a specified output file. Utilizing TShark is very similar to TCPDump in the filters and switches we can use. Both tools utilize BPF syntax. To read the capture, tshark can be passed the <code>-r</code> switch just like in TCPDump, or we can pass the <code>-P</code> switch to have tshark print the packet summaries while writing out to a file. Below is an example of reading from the PCAP file we previously captured.</p>
<p><strong>Selecting an Interface &amp; Writing to a File</strong></p>
<p>Analysis with Wireshark</p>
<pre><code class="lang-shell-session"><span class="hljs-selector-tag">root</span>@<span class="hljs-keyword">htb</span>[/<span class="hljs-keyword">htb</span>]$ sudo tshark -i eth0 -w /tmp/test.pcap
</code></pre>
<p><strong>Applying Filters</strong></p>
<p>Analysis with Wireshark</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ sudo tshark -i eth0 -f <span class="hljs-string">"host 172.16.146.2"</span>

Capturing on 'eth0'
    <span class="hljs-number">1</span> <span class="hljs-number">0.000000000</span> <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span> → <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.1</span> DNS <span class="hljs-number">70</span> Standard query <span class="hljs-number">0x0804</span> A github.com
    <span class="hljs-number">2</span> <span class="hljs-number">0.258861645</span> <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.1</span> → <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span> DNS <span class="hljs-number">86</span> Standard query response <span class="hljs-number">0x0804</span> A github.com A <span class="hljs-number">140.82</span><span class="hljs-number">.113</span><span class="hljs-number">.4</span>
    <span class="hljs-number">3</span> <span class="hljs-number">0.259866711</span> <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span> → <span class="hljs-number">140.82</span><span class="hljs-number">.113</span><span class="hljs-number">.4</span> TCP <span class="hljs-number">74</span> <span class="hljs-number">48256</span> → <span class="hljs-number">443</span> [SYN] Seq=<span class="hljs-number">0</span> Win=<span class="hljs-number">64240</span> Len=<span class="hljs-number">0</span> MSS=<span class="hljs-number">1460</span> SACK_PERM=<span class="hljs-number">1</span> TSval=<span class="hljs-number">1321417850</span> TSecr=<span class="hljs-number">0</span> WS=<span class="hljs-number">128</span>
    <span class="hljs-number">4</span> <span class="hljs-number">0.299681376</span> <span class="hljs-number">140.82</span><span class="hljs-number">.113</span><span class="hljs-number">.4</span> → <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span> TCP <span class="hljs-number">74</span> <span class="hljs-number">443</span> → <span class="hljs-number">48256</span> [SYN, ACK] Seq=<span class="hljs-number">0</span> Ack=<span class="hljs-number">1</span> Win=<span class="hljs-number">65535</span> Len=<span class="hljs-number">0</span> MSS=<span class="hljs-number">1436</span> SACK_PERM=<span class="hljs-number">1</span> TSval=<span class="hljs-number">3885991869</span> TSecr=<span class="hljs-number">1321417850</span> WS=<span class="hljs-number">1024</span>
    <span class="hljs-number">5</span> <span class="hljs-number">0.299771728</span> <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span> → <span class="hljs-number">140.82</span><span class="hljs-number">.113</span><span class="hljs-number">.4</span> TCP <span class="hljs-number">66</span> <span class="hljs-number">48256</span> → <span class="hljs-number">443</span> [ACK] Seq=<span class="hljs-number">1</span> Ack=<span class="hljs-number">1</span> Win=<span class="hljs-number">64256</span> Len=<span class="hljs-number">0</span> TSval=<span class="hljs-number">1321417889</span> TSecr=<span class="hljs-number">3885991869</span>
    <span class="hljs-number">6</span> <span class="hljs-number">0.306888828</span> <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span> → <span class="hljs-number">140.82</span><span class="hljs-number">.113</span><span class="hljs-number">.4</span> TLSv1 <span class="hljs-number">579</span> Client Hello
    <span class="hljs-number">7</span> <span class="hljs-number">0.347570701</span> <span class="hljs-number">140.82</span><span class="hljs-number">.113</span><span class="hljs-number">.4</span> → <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span> TLSv1<span class="hljs-number">.3</span> <span class="hljs-number">2785</span> Server Hello, Change Cipher Spec, Application Data, Application Data, Application Data, Application Data
    <span class="hljs-number">8</span> <span class="hljs-number">0.347653593</span> <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span> → <span class="hljs-number">140.82</span><span class="hljs-number">.113</span><span class="hljs-number">.4</span> TCP <span class="hljs-number">66</span> <span class="hljs-number">48256</span> → <span class="hljs-number">443</span> [ACK] Seq=<span class="hljs-number">514</span> Ack=<span class="hljs-number">2720</span> Win=<span class="hljs-number">63488</span> Len=<span class="hljs-number">0</span> TSval=<span class="hljs-number">1321417937</span> TSecr=<span class="hljs-number">3885991916</span>
    <span class="hljs-number">9</span> <span class="hljs-number">0.358887130</span> <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span> → <span class="hljs-number">140.82</span><span class="hljs-number">.113</span><span class="hljs-number">.4</span> TLSv1<span class="hljs-number">.3</span> <span class="hljs-number">130</span> Change Cipher Spec, Application Data
   <span class="hljs-number">10</span> <span class="hljs-number">0.359781588</span> <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span> → <span class="hljs-number">140.82</span><span class="hljs-number">.113</span><span class="hljs-number">.4</span> TLSv1<span class="hljs-number">.3</span> <span class="hljs-number">236</span> Application Data
   <span class="hljs-number">11</span> <span class="hljs-number">0.360037927</span> <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span> → <span class="hljs-number">140.82</span><span class="hljs-number">.113</span><span class="hljs-number">.4</span> TLSv1<span class="hljs-number">.3</span> <span class="hljs-number">758</span> Application Data
   <span class="hljs-number">12</span> <span class="hljs-number">0.360482668</span> <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span> → <span class="hljs-number">140.82</span><span class="hljs-number">.113</span><span class="hljs-number">.4</span> TLSv1<span class="hljs-number">.3</span> <span class="hljs-number">258</span> Application Data
   <span class="hljs-number">13</span> <span class="hljs-number">0.397331368</span> <span class="hljs-number">140.82</span><span class="hljs-number">.113</span><span class="hljs-number">.4</span> → <span class="hljs-number">172.16</span><span class="hljs-number">.146</span><span class="hljs-number">.2</span> TLSv1<span class="hljs-number">.3</span> <span class="hljs-number">145</span> Application Data
</code></pre>
<p><code>-f</code> allows us to apply filters to the capture. In the example, we utilized <code>host</code>, but you can use almost any filter Wireshark recognizes. We have touched on TShark a bit now. Let&#39;s take a look at a nifty tool called Termshark.</p>
<hr>
<h3 id="termshark">Termshark</h3>
<p>Termshark is a Text-based User Interface (TUI) application that provides the user with a Wireshark-like interface right in your terminal window.</p>
<p><strong>Termshark</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/termshark.png" alt="image"></p>
<p>Termshark can be found at <a href="https://github.com/gcla/termshark">Termshark</a>. It can be built from the source by cloning the repo, or pull down one of the current stable releases from <a href="https://github.com/gcla/termshark/releases">https://github.com/gcla/termshark/releases</a> , extract the file, and hit the ground running.</p>
<p>For help navigating this TUI, see the image below.</p>
<p><strong>Termshark Help</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/termshark-help.png" alt="image"></p>
<p>To start Termshark, issue the same strings, much like TShark or tcpdump. We can specify an interface to capture on, filters, and other settings from the terminal. The Termshark window will not open until it senses traffic in its capture filter. So give it a second if nothing happens.</p>
<hr>
<h3 id="wireshark-gui-walkthrough">Wireshark GUI Walkthrough</h3>
<p>Now that we have spent time learning the art of packet capture from the command line let&#39;s spend some time in Wireshark. We will take a few minutes to examine what we are looking at in the output below. Let&#39;s dissect this view of the Wireshark GUI.</p>
<p><strong>Wireshark GUI</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/wireshark-interface.png" alt="image"></p>
<p>Three Main Panes: <code>See Figure above</code></p>
<ol>
<li>Packet List: <code>Orange</code><ul>
<li>In this window, we see a summary line of each packet that includes the fields listed below by default. We can add or remove columns to change what information is presented.<ul>
<li>Number- Order the packet arrived in Wireshark</li>
<li>Time- Unix time format</li>
<li>Source- Source IP</li>
<li>Destination- Destination IP</li>
<li>Protocol- The protocol used (TCP, UDP, DNS, ECT.)</li>
<li>Information- Information about the packet. This field can vary based on the type of protocol used within. It will show, for example, what type of query It is for a DNS packet.</li>
</ul>
</li>
</ul>
</li>
<li>Packet Details: <code>Blue</code><ul>
<li>The Packet Details window allows us to drill down into the packet to inspect the protocols with greater detail. It will break it down into chunks that we would expect following the typical OSI Model reference. <code>The packet is dissected into different encapsulation layers for inspection.</code></li>
<li>Keep in mind, Wireshark will show this encapsulation in reverse order with lower layer encapsulation at the top of the window and higher levels at the bottom.</li>
</ul>
</li>
<li>Packet Bytes: <code>Green</code><ul>
<li>The Packet Bytes window allows us to look at the packet contents in ASCII or hex output. As we select a field from the windows above, it will be highlighted in the Packet Bytes window and show us where that bit or byte falls within the overall packet.</li>
<li>This is a great way to validate that what we see in the Details pane is accurate and the interpretation Wireshark made matches the packet output.</li>
<li>Each line in the output contains the data offset, sixteen hexadecimal bytes, and sixteen ASCII bytes. Non-printable bytes are replaced with a period in the ASCII format.</li>
</ul>
</li>
</ol>
<p><strong>Other Notable Features</strong></p>
<p>When looking at the Wireshark interface, we will notice a few different option areas and radial buttons. These areas are control points in which we can modify the interface and our view of the packets in the current capture. <code>See Figure below</code></p>
<p><strong>Wireshark Menu</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/wireshark-menu.png" alt="image"></p>
<h3 id="performing-our-first-capture-in-wireshark">Performing our first capture in Wireshark</h3>
<p>Starting a capture with Wireshark is a simple endeavor. The gif below will show the steps.</p>
<p><strong>Steps To Start A Capture</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/first-capture-ws.gif" alt="image"></p>
<p>Keep in mind, any time we change the capture options, Wireshark will restart the trace. Much like TCPDump, Wireshark has capture and display filter options that can be used.</p>
<hr>
<h3 id="the-basics">The Basics</h3>
<p><strong>The Toolbar</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/wireshark-toolbar.jpg" alt="image"></p>
<p>Wireshark&#39;s Toolbar is a central point to manage the many features Wireshark includes. From here, we can start and stop captures, change interfaces, open and save .pcap files and apply different filters or analysis add-ins.</p>
<p><strong>How to Save a Capture</strong></p>
<p>Let&#39;s say we need to capture what we have in our window currently for troubleshooting later. Saving a capture is super simple:</p>
<ul>
<li>Select File ⇢ save OR</li>
<li>From the toolbar, select the file option and choose where to save the file and in what format.</li>
</ul>
<p>Be aware that Wireshark can save captures into multiple formats. Choose the one needed for the scenario, but we will use the <code>.pcap</code> format for now.</p>
<hr>
<h3 id="pre-capture-and-post-capture-processing-and-filtering">Pre-capture and Post-capture Processing and Filtering</h3>
<p>While capturing traffic with Wireshark, we have several options regarding how and when we filter out traffic. This is accomplished utilizing Capture and Display filters. The Former initiated before the capture starts and the latter during or after capture is complete. While Wireshark has a bunch of useful baked-in functionality, it is worth mentioning that it has a bit of trouble handling large captures. The more packets captured, the longer it will take Wireshark to run the display or analysis filter against it. It can take from just a couple of seconds to a few minutes if it completes at all. If we are working with a large pcap file, it may be best to break it up into smaller chunks first.</p>
<p><strong>Capture Filters</strong></p>
<p><code>Capture Filters-</code> are entered before the capture is started. These use BPF syntax like <code>host 214.15.2.30</code> much in the same fashion as TCPDump. We have fewer filter options this way, and a capture filter will drop all other traffic not explicitly meeting the criteria set. This is a great way to trim down the data you write to disk when troubleshooting a connection, such as capturing the conversations between two hosts.</p>
<p>Here is a table of common and helpful capture filters with a description of each:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>Capture Filters</strong></th>
<th><strong>Result</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">host x.x.x.x</td>
<td>Capture only traffic pertaining to a certain host</td>
</tr>
<tr>
<td style="text-align:center">net x.x.x.x/24</td>
<td>Capture traffic to or from a specific network (using slash notation to specify the mask)</td>
</tr>
<tr>
<td style="text-align:center">src/dst net x.x.x.x/24</td>
<td>Using src or dst net will only capture traffic sourcing from the specified network or destined to the target network</td>
</tr>
<tr>
<td style="text-align:center">port #</td>
<td>will filter out all traffic except the port you specify</td>
</tr>
<tr>
<td style="text-align:center">not port #</td>
<td>will capture everything except the port specified</td>
</tr>
<tr>
<td style="text-align:center">port # and #</td>
<td>AND will concatenate your specified ports</td>
</tr>
<tr>
<td style="text-align:center">portrange x-x</td>
<td>portrange will grab traffic from all ports within the range only</td>
</tr>
<tr>
<td style="text-align:center">ip / ether / tcp</td>
<td>These filters will only grab traffic from specified protocol headers.</td>
</tr>
<tr>
<td style="text-align:center">broadcast / multicast / unicast</td>
<td>Grabs a specific type of traffic. one to one, one to many, or one to all.</td>
</tr>
</tbody>
</table>
<p><strong>Applying a Capture Filter</strong></p>
<p>Before we apply a capture filter, let us take a look at the built-in filters. To do so: Click on the capture radial at the top of the Wireshark window → then select capture filters from the drop-down.</p>
<p><strong>Filter List</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/capture-filter-list.png" alt="image"></p>
<p>From here, we can modify the existing filters or add our own.</p>
<p>To apply the filter to a capture, we will: Click on the capture radial at the top of the Wireshark window → then select Options from the drop-down → in the new window select the drop-down for Capture filter for selected interfaces or type in the filter we wish to use. <code>below the red arrow in the picture below</code></p>
<p><strong>Applying A Capture Filter</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/how-to-add-cap.png" alt="image"></p>
<p><strong>Display Filters</strong></p>
<p><code>Display Filters-</code> are used while the capture is running and after the capture has stopped. Display filters are proprietary to Wireshark, which offers many different options for almost any protocol.</p>
<p>Here is a table of common and helpful display filters with a description of each:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>Display Filters</strong></th>
<th><strong>Result</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ip.addr == x.x.x.x</td>
<td>Capture only traffic pertaining to a certain host. This is an OR statement.</td>
</tr>
<tr>
<td style="text-align:center">ip.addr == x.x.x.x/24</td>
<td>Capture traffic pertaining to a specific network. This is an OR statement.</td>
</tr>
<tr>
<td style="text-align:center">ip.src/dst == x.x.x.x</td>
<td>Capture traffic to or from a specific host</td>
</tr>
<tr>
<td style="text-align:center">dns / tcp / ftp / arp / ip</td>
<td>filter traffic by a specific protocol. There are many more options.</td>
</tr>
<tr>
<td style="text-align:center">tcp.port == x</td>
<td>filter by a specific tcp port.</td>
</tr>
<tr>
<td style="text-align:center">tcp.port / udp.port != x</td>
<td>will capture everything except the port specified</td>
</tr>
<tr>
<td style="text-align:center">and / or / not</td>
<td>AND will concatenate, OR will find either of two options, NOT will exclude your input option.</td>
</tr>
</tbody>
</table>
<p>Keep in mind, while utilizing Display filters traffic is processed to show only what is requested but the rest of the capture file will not be overwritten. Applying Display filters and analysis options will cause Wireshark to reprocess the pcap data in order to apply.</p>
<p><strong>Applying a Display Filter</strong></p>
<p>Applying a display filter is even easier than a capture filter. From the main Wireshark capture window, all we need to do is: select the bookmark in the Toolbar → , then select an option from the drop-down. Alternatively, place the cursor in the text radial → and type in the filter we wish to use. If the field turns green, the filter is correct. <code>Just like in the image below.</code></p>
<p><strong>Applying Display Filters</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/display-filter.png" alt="image"></p>
<p>When using capture and display filters, keep in mind that what we specify is taken in a literal sense. For example, filtering for port 80 traffic is not the same as filtering for HTTP. Think of ports and protocols more like guidelines instead of rigid rules. Ports can be bound and used for different purposes other than what they were originally intended. For example, filtering for HTTP will look for key markers that the protocol uses, such as GET/POST requests, and show results from them. Filtering for port 80 will show anything sent or received over that port regardless of the transport protocol.</p>
<p>In the next section, we will work with some of the more advanced features of Wireshark.</p>
<h2 id="wireshark-advanced-usage">Wireshark Advanced Usage</h2>
<hr>
<p>In this section, we will cover some advanced usage with Wireshark. The project developers have included many different capabilities ranging from tracking TCP conversations to cracking wireless credentials. The inclusion of many different plugins makes Wireshark one of the best traffic analysis tools.</p>
<hr>
<h3 id="plugins">Plugins</h3>
<p>The analyze and statistics radials provide a plethora of plugins to run against the capture. In this section, we will work through a couple of them. We would cover all of which Wireshark offers, but sadly, it is simply not achievable in an introductory module. I urge everyone to experiment and play as we go through this journey.</p>
<p><strong>The Statistics and Analyze Tabs</strong></p>
<p>The Statistics and Analyze tabs can provide us with great insight into the data we are examining. From these points, we can utilize many of the baked-in plugins Wireshark has to offer.</p>
<p>The plugins here can give us detailed reports about the network traffic being utilized. It can show us everything from the top talkers in our environment to specific conversations and even breakdown by IP and protocol.</p>
<p><strong>Statistics Tab</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/wireshark-statistics.png" alt="image"></p>
<p><strong>Analyze</strong></p>
<p>From the Analyze tab, we can utilize plugins that allow us to do things such as following TCP streams, filter on conversation types, prepare new packet filters and examine the expert info Wireshark generates about the traffic. Below are a few examples of how to use these plugins.</p>
<p><strong>Analyze Tab</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/analyze.png" alt="image"></p>
<p><strong>Following TCP Streams</strong></p>
<p>Wireshark can stitch TCP packets back together to recreate the entire stream in a readable format. This ability also allows us to pull data (<code>images, files, etc.</code>) out of the capture. This works for almost any protocol that utilizes TCP as a transport mechanism.</p>
<p>To utilize this feature:</p>
<ul>
<li>right-click on a packet from the stream we wish to recreate.</li>
<li>select follow → TCP</li>
<li>this will open a new window with the stream stitched back together. From here, we can see the entire conversation.</li>
</ul>
<p><strong>Follow A Stream Via GUI</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/follow-tcp.gif" alt="image"></p>
<p>Alternatively, we can utilize the filter <code>tcp.stream eq #</code> to find and track conversations captured in the pcap file.</p>
<h3 id="filter-for-a-specific-tcp-stream">Filter For A Specific TCP Stream</h3>
<p><img src="https://academy.hackthebox.com/storage/modules/81/tcp-stream.gif" alt="image"></p>
<p>Notice that the first three packets in the image above have a full TCP handshake. Following those packets, we can see the stream transferring data. We have cleared anything not related out of view by utilizing the filter, and we now can see the conversation in order.</p>
<p><strong>Extracting Data and Files From a Capture</strong></p>
<p>Wireshark can recover many different types of data from streams. It requires you to have captured the entire conversation. Otherwise, this ability will fail to put an incomplete datagram back together. If we want a more in-depth understanding of how this capability works, check out the Networking 101 Module or research TCP/IP fragmentation.</p>
<p>To extract files from a stream:</p>
<ul>
<li>stop your capture.</li>
<li>Select the File radial → Export → , then select the protocol format to extract from.</li>
<li>(DICOM, HTTP, SMB, etc.)</li>
</ul>
<p><strong>Extract Files From The GUI</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/extract-http.gif" alt="image"></p>
<p>Another exciting way to grab data out of the pcap file comes from FTP. The File Transfer Protocol moves data between a server and host to pull it out of the raw bytes and reconstruct the file. (image, text documents, etc.) FTP utilizes TCP as its transport protocol and uses ports <code>20 &amp; 21</code> to function. TCP port 20 is used to transfer data between the server and host, while port 21 is used as the FTP control port. Any commands such as login, listing files, and issuing download or uploads happen over this port. To do so, we need to look at the different <code>FTP</code> display filters in Wireshark. A complete list of these can be found <a href="https://www.wireshark.org/docs/dfref/f/ftp.html">here</a>. For now, we will look at three:</p>
<ul>
<li><code>ftp</code> - Will display anything about the FTP protocol.<ul>
<li>We can utilize this to get a feel for what hosts/servers are transferring data over FTP.</li>
</ul>
</li>
</ul>
<p><strong>FTP Disector</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/ftp-disector.png" alt="image"></p>
<ul>
<li><code>ftp.request.command</code> - Will show any commands sent across the ftp-control channel ( port 21 )<ul>
<li>We can look for information like usernames and passwords with this filter. It can also show us filenames for anything requested.</li>
</ul>
</li>
</ul>
<p><strong>FTP-Request-Command Filter</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/ftp-request-command.png" alt="image"></p>
<ul>
<li><code>ftp-data</code> - Will show any data transferred over the data channel ( port 20 )<ul>
<li>If we filter on a conversation and utilize <code>ftp-data</code>, we can capture anything sent during the conversation. We can reconstruct anything transferred by placing the raw data back into a new file and naming it appropriately.</li>
</ul>
</li>
</ul>
<p><strong>FTP-Data Filter</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/81/ftp-data.png" alt="image"></p>
<p>Since FTP utilizes TCP as its transport mechanism, we can utilize the <code>follow tcp stream</code> function we utilized earlier in the section to group any conversation we wish to explore. The basic steps to dissect FTP data from a pcap are as follows:</p>
<ol>
<li>Identify any FTP traffic using the <code>ftp</code> display filter.</li>
<li>Look at the command controls sent between the server and hosts to determine if anything was transferred and who did so with the <code>ftp.request.command</code> filter.</li>
<li>Choose a file, then filter for <code>ftp-data</code>. Select a packet that corresponds with our file of interest and follow the TCP stream that correlates to it.</li>
<li>Once done, Change &quot;<code>Show and save data as</code>&quot; to &quot;<code>Raw</code>&quot; and save the content as the original file name.</li>
<li>Validate the extraction by checking the file type.</li>
</ol>
